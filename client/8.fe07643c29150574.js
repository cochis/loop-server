(self.webpackChunkloop_app=self.webpackChunkloop_app||[]).push([[8],{7008:(Ju,Co,Et)=>{"use strict";Et.r(Co),Et.d(Co,{PublicModule:()=>ri});var ai=Et(6814),ln=Et(5004),m=Et(9291),a=Et(8014),Se=Et(7806);function vn(B,Ae){if(1&B&&(m.TgZ(0,"div")(1,"div",4),m._UZ(2,"h5",5),m.ALo(3,"translate"),m.qZA()()),2&B){const C=Ae.$implicit;m.Tol(C.className),m.xp6(2),m.Q6J("innerHTML",m.lcZ(3,3,"carousel."+C.name),m.oJD)}}let Qi=(()=>{class B{constructor(){this.carousel=[{name:"slide1",className:"carousel-item active"},{name:"slide2",className:"carousel-item"},{name:"slide3",className:"carousel-item"}]}static#e=this.\u0275fac=function(j){return new(j||B)};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-carrousel"]],decls:4,vars:1,consts:[[1,"carousel-slider","carousel-fade"],["id","carouselExampleCaptions","data-bs-ride","carousel",1,"carousel","slide"],[1,"carousel-inner"],[3,"class",4,"ngFor","ngForOf"],[1,"carousel-caption","d-md-block"],[1,"title-carousel",3,"innerHTML"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2),m.YNc(3,vn,4,5,"div",3),m.qZA()()()),2&j&&(m.xp6(3),m.Q6J("ngForOf",ce.carousel))},dependencies:[ai.sg,Se.X$],styles:[".carousel-item[_ngcontent-%COMP%]{height:400px}.carousel-caption[_ngcontent-%COMP%]{text-align:left;position:initial;margin-top:5%}.title-carousel[_ngcontent-%COMP%]{font-size:80px}.carousel-slider[_ngcontent-%COMP%]{height:430px;margin-top:7%}@media (min-width: 0px) and (max-width: 700px){.title-carousel[_ngcontent-%COMP%]{font-size:45px!important}.carousel-slider[_ngcontent-%COMP%]{height:305px!important}}@media (min-width: 701px) and (max-width: 1550px){.title-carousel[_ngcontent-%COMP%]{font-size:55px!important}.carousel-slider[_ngcontent-%COMP%]{height:295px!important}}  h5.title-carousel>b{font-weight:bolder}  h5.title-carousel>span{font-weight:100}"]})}return B})(),pt=(()=>{class B{static#e=this.\u0275fac=function(j){return new(j||B)};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-about-us"]],decls:21,vars:17,consts:[[1,"div-about-us","container"],[1,"row"],[1,"col-md-7","col-sm-12","text-justify"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2")(4,"b"),m._uU(5),m.ALo(6,"uppercase"),m.ALo(7,"translate"),m.qZA()(),m._UZ(8,"br"),m.TgZ(9,"p"),m._uU(10),m.ALo(11,"translate"),m.qZA(),m.TgZ(12,"p"),m._uU(13),m.ALo(14,"translate"),m.qZA(),m.TgZ(15,"p"),m._uU(16),m.ALo(17,"translate"),m.qZA(),m.TgZ(18,"p"),m._uU(19),m.ALo(20,"translate"),m.qZA()()()()),2&j&&(m.xp6(5),m.hij(" ",m.lcZ(6,5,m.lcZ(7,7,"about_us.title"))," "),m.xp6(5),m.hij(" ",m.lcZ(11,9,"about_us.description1")," "),m.xp6(3),m.hij(" ",m.lcZ(14,11,"about_us.description2")," "),m.xp6(3),m.hij(" ",m.lcZ(17,13,"about_us.description3")," "),m.xp6(3),m.hij(" ",m.lcZ(20,15,"about_us.description4")," "))},dependencies:[ai.gd,Se.X$],styles:["div.div-about-us[_ngcontent-%COMP%]{padding-top:5%;padding-bottom:5%;margin-top:85px}div.div-about-us[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:20px}@media (min-width: 0px) and (max-width: 700px){div.div-about-us[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px!important}div.div-about-us[_ngcontent-%COMP%]{margin-top:165px}}"]})}return B})();var ut=Et(9972),xi=Et(3517),Mi=Et(1890);const bn=["itemsContainer"];function Gr(B,Ae){1&B&&m.GkF(0)}function qr(B,Ae){if(1&B&&(m.TgZ(0,"div",11),m.Hsn(1),m.YNc(2,Gr,1,0,"ng-container",12),m.qZA()),2&B){const C=m.oxw();m.xp6(2),m.Q6J("ngTemplateOutlet",C.headerTemplate)}}const cn=function(B){return{"p-carousel-prev p-link":!0,"p-disabled":B}},gr=function(B,Ae){return{"p-carousel-prev-icon pi":!0,"pi-chevron-left":B,"pi-chevron-up":Ae}};function yr(B,Ae){if(1&B){const C=m.EpF();m.TgZ(0,"button",13),m.NdJ("click",function(ce){m.CHM(C);const je=m.oxw();return m.KtG(je.navBackward(ce))}),m._UZ(1,"span",2),m.qZA()}if(2&B){const C=m.oxw();m.Q6J("ngClass",m.VKq(3,cn,C.isBackwardNavDisabled()))("disabled",C.isBackwardNavDisabled()),m.xp6(1),m.Q6J("ngClass",m.WLB(5,gr,!C.isVertical(),C.isVertical()))}}function Be(B,Ae){1&B&&m.GkF(0)}const Fi=function(B,Ae,C){return{"p-carousel-item p-carousel-item-cloned":!0,"p-carousel-item-active":B,"p-carousel-item-start":Ae,"p-carousel-item-end":C}},wn=function(B){return{$implicit:B}};function Io(B,Ae){if(1&B&&(m.TgZ(0,"div",2),m.YNc(1,Be,1,0,"ng-container",14),m.qZA()),2&B){const C=Ae.$implicit,j=Ae.index,ce=m.oxw();m.Q6J("ngClass",m.kEZ(3,Fi,-1*ce.totalShiftedItems===ce.value.length,0===j,ce.clonedItemsForStarting.length-1===j)),m.xp6(1),m.Q6J("ngTemplateOutlet",ce.itemTemplate)("ngTemplateOutletContext",m.VKq(7,wn,C))}}function vt(B,Ae){1&B&&m.GkF(0)}const di=function(B,Ae,C){return{"p-carousel-item":!0,"p-carousel-item-active":B,"p-carousel-item-start":Ae,"p-carousel-item-end":C}};function rs(B,Ae){if(1&B&&(m.TgZ(0,"div",2),m.YNc(1,vt,1,0,"ng-container",14),m.qZA()),2&B){const C=Ae.$implicit,j=Ae.index,ce=m.oxw();m.Q6J("ngClass",m.kEZ(3,di,ce.firstIndex()<=j&&ce.lastIndex()>=j,ce.firstIndex()===j,ce.lastIndex()===j)),m.xp6(1),m.Q6J("ngTemplateOutlet",ce.itemTemplate)("ngTemplateOutletContext",m.VKq(7,wn,C))}}function Ao(B,Ae){1&B&&m.GkF(0)}function $r(B,Ae){if(1&B&&(m.TgZ(0,"div",2),m.YNc(1,Ao,1,0,"ng-container",14),m.qZA()),2&B){const C=Ae.$implicit,j=Ae.index,ce=m.oxw();m.Q6J("ngClass",m.kEZ(3,Fi,-1*ce.totalShiftedItems===ce.numVisible,0===j,ce.clonedItemsForFinishing.length-1===j)),m.xp6(1),m.Q6J("ngTemplateOutlet",ce.itemTemplate)("ngTemplateOutletContext",m.VKq(7,wn,C))}}const Wr=function(B){return{"p-carousel-next p-link":!0,"p-disabled":B}},_t=function(B,Ae){return{"p-carousel-prev-icon pi":!0,"pi-chevron-right":B,"pi-chevron-down":Ae}};function Xr(B,Ae){if(1&B){const C=m.EpF();m.TgZ(0,"button",13),m.NdJ("click",function(ce){m.CHM(C);const je=m.oxw();return m.KtG(je.navForward(ce))}),m._UZ(1,"span",2),m.qZA()}if(2&B){const C=m.oxw();m.Q6J("ngClass",m.VKq(3,Wr,C.isForwardNavDisabled()))("disabled",C.isForwardNavDisabled()),m.xp6(1),m.Q6J("ngClass",m.WLB(5,_t,!C.isVertical(),C.isVertical()))}}const tr=function(B){return{"p-carousel-indicator":!0,"p-highlight":B}};function zn(B,Ae){if(1&B){const C=m.EpF();m.TgZ(0,"li",2)(1,"button",15),m.NdJ("click",function(ce){const nt=m.CHM(C).index,Dt=m.oxw(2);return m.KtG(Dt.onDotClick(ce,nt))}),m.qZA()()}if(2&B){const C=Ae.index,j=m.oxw(2);m.Q6J("ngClass",m.VKq(5,tr,j._page===C)),m.xp6(1),m.Tol(j.indicatorStyleClass),m.Q6J("ngClass","p-link")("ngStyle",j.indicatorStyle)}}function ir(B,Ae){if(1&B&&(m.TgZ(0,"ul",0),m.YNc(1,zn,2,7,"li",8),m.qZA()),2&B){const C=m.oxw();m.Tol(C.indicatorsContentClass),m.Q6J("ngClass","p-carousel-indicators p-reset")("ngStyle",C.indicatorsContentStyle),m.xp6(1),m.Q6J("ngForOf",C.totalDotsArray())}}function ni(B,Ae){1&B&&m.GkF(0)}function xr(B,Ae){if(1&B&&(m.TgZ(0,"div",16),m.Hsn(1,1),m.YNc(2,ni,1,0,"ng-container",12),m.qZA()),2&B){const C=m.oxw();m.xp6(2),m.Q6J("ngTemplateOutlet",C.footerTemplate)}}const Hr=[[["p-header"]],[["p-footer"]]],Tn=function(B,Ae){return{"p-carousel p-component":!0,"p-carousel-vertical":B,"p-carousel-horizontal":Ae}},hn=function(B){return{height:B}},nr=["p-header","p-footer"];let kn=(()=>{class B{constructor(C,j,ce,je,nt){this.el=C,this.zone=j,this.cd=ce,this.renderer=je,this.document=nt,this.orientation="horizontal",this.verticalViewPortHeight="300px",this.contentClass="",this.indicatorsContentClass="",this.indicatorStyleClass="",this.circular=!1,this.showIndicators=!0,this.showNavigators=!0,this.autoplayInterval=0,this.onPage=new m.vpe,this._numVisible=1,this._numScroll=1,this._oldNumScroll=0,this.prevState={numScroll:0,numVisible:0,value:[]},this.defaultNumScroll=1,this.defaultNumVisible=1,this._page=0,this.isRemainingItemsAdded=!1,this.remainingItems=0,this.swipeThreshold=20,this.totalShiftedItems=this.page*this.numScroll*-1}get page(){return this._page}set page(C){this.isCreated&&C!==this._page&&(this.autoplayInterval&&(this.stopAutoplay(),this.allowAutoplay=!1),C>this._page&&C<=this.totalDots()-1?this.step(-1,C):C<this._page&&this.step(1,C)),this._page=C}get numVisible(){return this._numVisible}set numVisible(C){this._numVisible=C}get numScroll(){return this._numVisible}set numScroll(C){this._numScroll=C}get value(){return this._value}set value(C){this._value=C}ngOnChanges(C){C.value&&this.circular&&this._value&&this.setCloneItems(),this.isCreated&&(C.numVisible&&(this.responsiveOptions&&(this.defaultNumVisible=this.numVisible),this.isCircular()&&this.setCloneItems(),this.createStyle(),this.calculatePosition()),C.numScroll&&this.responsiveOptions&&(this.defaultNumScroll=this.numScroll))}ngAfterContentInit(){this.id=(0,Mi.Th)(),this.allowAutoplay=!!this.autoplayInterval,this.circular&&this.setCloneItems(),this.responsiveOptions&&(this.defaultNumScroll=this._numScroll,this.defaultNumVisible=this._numVisible),this.createStyle(),this.calculatePosition(),this.responsiveOptions&&this.bindDocumentListeners(),this.templates.forEach(C=>{switch(C.getType()){case"item":default:this.itemTemplate=C.template;break;case"header":this.headerTemplate=C.template;break;case"footer":this.footerTemplate=C.template}})}ngAfterContentChecked(){const C=this.isCircular();let j=this.totalShiftedItems;if(this.value&&this.itemsContainer&&(this.prevState.numScroll!==this._numScroll||this.prevState.numVisible!==this._numVisible||this.prevState.value.length!==this.value.length)){this.autoplayInterval&&this.stopAutoplay(),this.remainingItems=(this.value.length-this._numVisible)%this._numScroll;let ce=this._page;0!==this.totalDots()&&ce>=this.totalDots()&&(ce=this.totalDots()-1,this._page=ce,this.onPage.emit({page:this.page})),j=ce*this._numScroll*-1,C&&(j-=this._numVisible),ce===this.totalDots()-1&&this.remainingItems>0?(j+=-1*this.remainingItems+this._numScroll,this.isRemainingItemsAdded=!0):this.isRemainingItemsAdded=!1,j!==this.totalShiftedItems&&(this.totalShiftedItems=j),this._oldNumScroll=this._numScroll,this.prevState.numScroll=this._numScroll,this.prevState.numVisible=this._numVisible,this.prevState.value=[...this._value],this.totalDots()>0&&this.itemsContainer.nativeElement&&(this.itemsContainer.nativeElement.style.transform=this.isVertical()?`translate3d(0, ${j*(100/this._numVisible)}%, 0)`:`translate3d(${j*(100/this._numVisible)}%, 0, 0)`),this.isCreated=!0,this.autoplayInterval&&this.isAutoplay()&&this.startAutoplay()}C&&(0===this.page?j=-1*this._numVisible:0===j&&(j=-1*this.value.length,this.remainingItems>0&&(this.isRemainingItemsAdded=!0)),j!==this.totalShiftedItems&&(this.totalShiftedItems=j))}createStyle(){this.carouselStyle||(this.carouselStyle=this.renderer.createElement("style"),this.carouselStyle.type="text/css",this.renderer.appendChild(this.document.head,this.carouselStyle));let C=`\n            #${this.id} .p-carousel-item {\n\t\t\t\tflex: 1 0 ${100/this.numVisible}%\n\t\t\t}\n        `;if(this.responsiveOptions){this.responsiveOptions.sort((j,ce)=>{const je=j.breakpoint,nt=ce.breakpoint;let Dt=null;return Dt=null==je&&null!=nt?-1:null!=je&&null==nt?1:null==je&&null==nt?0:"string"==typeof je&&"string"==typeof nt?je.localeCompare(nt,void 0,{numeric:!0}):je<nt?-1:je>nt?1:0,-1*Dt});for(let j=0;j<this.responsiveOptions.length;j++){let ce=this.responsiveOptions[j];C+=`\n                    @media screen and (max-width: ${ce.breakpoint}) {\n                        #${this.id} .p-carousel-item {\n                            flex: 1 0 ${100/ce.numVisible}%\n                        }\n                    }\n                `}}this.carouselStyle.innerHTML=C}calculatePosition(){if(this.responsiveOptions){let C={numVisible:this.defaultNumVisible,numScroll:this.defaultNumScroll};if(typeof window<"u"){let j=window.innerWidth;for(let ce=0;ce<this.responsiveOptions.length;ce++){let je=this.responsiveOptions[ce];parseInt(je.breakpoint,10)>=j&&(C=je)}}if(this._numScroll!==C.numScroll){let j=this._page;j=Math.floor(j*this._numScroll/C.numScroll);let ce=C.numScroll*this.page*-1;this.isCircular()&&(ce-=C.numVisible),this.totalShiftedItems=ce,this._numScroll=C.numScroll,this._page=j,this.onPage.emit({page:this.page})}this._numVisible!==C.numVisible&&(this._numVisible=C.numVisible,this.setCloneItems()),this.cd.markForCheck()}}setCloneItems(){this.clonedItemsForStarting=[],this.clonedItemsForFinishing=[],this.isCircular()&&(this.clonedItemsForStarting.push(...this.value.slice(-1*this._numVisible)),this.clonedItemsForFinishing.push(...this.value.slice(0,this._numVisible)))}firstIndex(){return this.isCircular()?-1*(this.totalShiftedItems+this.numVisible):-1*this.totalShiftedItems}lastIndex(){return this.firstIndex()+this.numVisible-1}totalDots(){return this.value?.length?Math.ceil((this.value.length-this._numVisible)/this._numScroll)+1:0}totalDotsArray(){const C=this.totalDots();return C<=0?[]:Array(C).fill(0)}isVertical(){return"vertical"===this.orientation}isCircular(){return this.circular&&this.value&&this.value.length>=this.numVisible}isAutoplay(){return this.autoplayInterval&&this.allowAutoplay}isForwardNavDisabled(){return this.isEmpty()||this._page>=this.totalDots()-1&&!this.isCircular()}isBackwardNavDisabled(){return this.isEmpty()||this._page<=0&&!this.isCircular()}isEmpty(){return!this.value||0===this.value.length}navForward(C,j){(this.isCircular()||this._page<this.totalDots()-1)&&this.step(-1,j),this.autoplayInterval&&(this.stopAutoplay(),this.allowAutoplay=!1),C&&C.cancelable&&C.preventDefault()}navBackward(C,j){(this.isCircular()||0!==this._page)&&this.step(1,j),this.autoplayInterval&&(this.stopAutoplay(),this.allowAutoplay=!1),C&&C.cancelable&&C.preventDefault()}onDotClick(C,j){let ce=this._page;this.autoplayInterval&&(this.stopAutoplay(),this.allowAutoplay=!1),j>ce?this.navForward(C,j):j<ce&&this.navBackward(C,j)}step(C,j){let ce=this.totalShiftedItems;const je=this.isCircular();null!=j?(ce=this._numScroll*j*-1,je&&(ce-=this._numVisible),this.isRemainingItemsAdded=!1):(ce+=this._numScroll*C,this.isRemainingItemsAdded&&(ce+=this.remainingItems-this._numScroll*C,this.isRemainingItemsAdded=!1),j=Math.abs(Math.floor((je?ce+this._numVisible:ce)/this._numScroll))),je&&this.page===this.totalDots()-1&&-1===C?(ce=-1*(this.value.length+this._numVisible),j=0):je&&0===this.page&&1===C?(ce=0,j=this.totalDots()-1):j===this.totalDots()-1&&this.remainingItems>0&&(ce+=-1*this.remainingItems-this._numScroll*C,this.isRemainingItemsAdded=!0),this.itemsContainer&&(this.itemsContainer.nativeElement.style.transform=this.isVertical()?`translate3d(0, ${ce*(100/this._numVisible)}%, 0)`:`translate3d(${ce*(100/this._numVisible)}%, 0, 0)`,this.itemsContainer.nativeElement.style.transition="transform 500ms ease 0s"),this.totalShiftedItems=ce,this._page=j,this.onPage.emit({page:this.page})}startAutoplay(){this.interval=setInterval(()=>{this.totalDots()>0&&(this.page===this.totalDots()-1?this.step(-1,0):this.step(-1,this.page+1))},this.autoplayInterval)}stopAutoplay(){this.interval&&clearInterval(this.interval)}onTransitionEnd(){this.itemsContainer&&(this.itemsContainer.nativeElement.style.transition="",(0===this.page||this.page===this.totalDots()-1)&&this.isCircular()&&(this.itemsContainer.nativeElement.style.transform=this.isVertical()?`translate3d(0, ${this.totalShiftedItems*(100/this._numVisible)}%, 0)`:`translate3d(${this.totalShiftedItems*(100/this._numVisible)}%, 0, 0)`))}onTouchStart(C){let j=C.changedTouches[0];this.startPos={x:j.pageX,y:j.pageY}}onTouchMove(C){C.cancelable&&C.preventDefault()}onTouchEnd(C){let j=C.changedTouches[0];this.isVertical()?this.changePageOnTouch(C,j.pageY-this.startPos.y):this.changePageOnTouch(C,j.pageX-this.startPos.x)}changePageOnTouch(C,j){Math.abs(j)>this.swipeThreshold&&(j<0?this.navForward(C):this.navBackward(C))}bindDocumentListeners(){!this.documentResizeListener&&typeof window<"u"&&(this.documentResizeListener=C=>{this.calculatePosition()},window.addEventListener("resize",this.documentResizeListener))}unbindDocumentListeners(){this.documentResizeListener&&typeof window<"u"&&(window.removeEventListener("resize",this.documentResizeListener),this.documentResizeListener=null)}ngOnDestroy(){this.responsiveOptions&&this.unbindDocumentListeners(),this.autoplayInterval&&this.stopAutoplay()}}return B.\u0275fac=function(C){return new(C||B)(m.Y36(m.SBq),m.Y36(m.R0b),m.Y36(m.sBO),m.Y36(m.Qsj),m.Y36(ai.K0))},B.\u0275cmp=m.Xpm({type:B,selectors:[["p-carousel"]],contentQueries:function(C,j,ce){if(1&C&&(m.Suo(ce,ut.h4,5),m.Suo(ce,ut.$_,5),m.Suo(ce,ut.jx,4)),2&C){let je;m.iGM(je=m.CRH())&&(j.headerFacet=je.first),m.iGM(je=m.CRH())&&(j.footerFacet=je.first),m.iGM(je=m.CRH())&&(j.templates=je)}},viewQuery:function(C,j){if(1&C&&m.Gf(bn,5),2&C){let ce;m.iGM(ce=m.CRH())&&(j.itemsContainer=ce.first)}},hostAttrs:[1,"p-element"],inputs:{page:"page",numVisible:"numVisible",numScroll:"numScroll",responsiveOptions:"responsiveOptions",orientation:"orientation",verticalViewPortHeight:"verticalViewPortHeight",contentClass:"contentClass",indicatorsContentClass:"indicatorsContentClass",indicatorsContentStyle:"indicatorsContentStyle",indicatorStyleClass:"indicatorStyleClass",indicatorStyle:"indicatorStyle",value:"value",circular:"circular",showIndicators:"showIndicators",showNavigators:"showNavigators",autoplayInterval:"autoplayInterval",style:"style",styleClass:"styleClass"},outputs:{onPage:"onPage"},features:[m.TTD],ngContentSelectors:nr,decls:14,vars:22,consts:[[3,"ngClass","ngStyle"],["class","p-carousel-header",4,"ngIf"],[3,"ngClass"],[1,"p-carousel-container"],["type","button","pRipple","",3,"ngClass","disabled","click",4,"ngIf"],[1,"p-carousel-items-content",3,"ngStyle"],[1,"p-carousel-items-container",3,"transitionend","touchend","touchstart","touchmove"],["itemsContainer",""],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass","class","ngStyle",4,"ngIf"],["class","p-carousel-footer",4,"ngIf"],[1,"p-carousel-header"],[4,"ngTemplateOutlet"],["type","button","pRipple","",3,"ngClass","disabled","click"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","button",3,"ngClass","ngStyle","click"],[1,"p-carousel-footer"]],template:function(C,j){1&C&&(m.F$t(Hr),m.TgZ(0,"div",0),m.YNc(1,qr,3,1,"div",1),m.TgZ(2,"div",2)(3,"div",3),m.YNc(4,yr,2,8,"button",4),m.TgZ(5,"div",5)(6,"div",6,7),m.NdJ("transitionend",function(){return j.onTransitionEnd()})("touchend",function(je){return j.onTouchEnd(je)})("touchstart",function(je){return j.onTouchStart(je)})("touchmove",function(je){return j.onTouchMove(je)}),m.YNc(8,Io,2,9,"div",8),m.YNc(9,rs,2,9,"div",8),m.YNc(10,$r,2,9,"div",8),m.qZA()(),m.YNc(11,Xr,2,8,"button",4),m.qZA(),m.YNc(12,ir,2,5,"ul",9),m.qZA(),m.YNc(13,xr,3,1,"div",10),m.qZA()),2&C&&(m.Tol(j.styleClass),m.Q6J("ngClass",m.WLB(17,Tn,j.isVertical(),!j.isVertical()))("ngStyle",j.style),m.uIk("id",j.id),m.xp6(1),m.Q6J("ngIf",j.headerFacet||j.headerTemplate),m.xp6(1),m.Tol(j.contentClass),m.Q6J("ngClass","p-carousel-content"),m.xp6(2),m.Q6J("ngIf",j.showNavigators),m.xp6(1),m.Q6J("ngStyle",m.VKq(20,hn,j.isVertical()?j.verticalViewPortHeight:"auto")),m.xp6(3),m.Q6J("ngForOf",j.clonedItemsForStarting),m.xp6(1),m.Q6J("ngForOf",j.value),m.xp6(1),m.Q6J("ngForOf",j.clonedItemsForFinishing),m.xp6(1),m.Q6J("ngIf",j.showNavigators),m.xp6(1),m.Q6J("ngIf",j.showIndicators),m.xp6(1),m.Q6J("ngIf",j.footerFacet||j.footerTemplate))},dependencies:[ai.mk,ai.sg,ai.O5,ai.tP,ai.PC,xi.H],styles:[".p-carousel{display:flex;flex-direction:column}.p-carousel-content{display:flex;flex-direction:column;overflow:auto}.p-carousel-prev,.p-carousel-next{align-self:center;flex-grow:0;flex-shrink:0;display:flex;justify-content:center;align-items:center;overflow:hidden;position:relative}.p-carousel-container{display:flex;flex-direction:row}.p-carousel-items-content{overflow:hidden;width:100%}.p-carousel-items-container{display:flex;flex-direction:row}.p-carousel-indicators{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap}.p-carousel-indicator>button{display:flex;align-items:center;justify-content:center}.p-carousel-vertical .p-carousel-container{flex-direction:column}.p-carousel-vertical .p-carousel-items-container{flex-direction:column;height:100%}.p-items-hidden .p-carousel-item{visibility:hidden}.p-items-hidden .p-carousel-item.p-carousel-item-active{visibility:visible}\n"],encapsulation:2,changeDetection:0}),B})(),Ui=(()=>{class B{}return B.\u0275fac=function(C){return new(C||B)},B.\u0275mod=m.oAB({type:B}),B.\u0275inj=m.cJS({imports:[ai.ez,ut.m8,xi.T,ai.ez,ut.m8]}),B})();var Dn=Et(7465);const Yr=function(B){return["/home/services",B]};function Zi(B,Ae){if(1&B&&(m.TgZ(0,"div",6),m._UZ(1,"img",7),m.TgZ(2,"h5"),m._uU(3),m.ALo(4,"uppercase"),m.ALo(5,"translate"),m.qZA(),m._UZ(6,"br"),m.TgZ(7,"p",8),m._uU(8),m.ALo(9,"translate"),m.ALo(10,"translate"),m.ALo(11,"translate"),m.qZA(),m._UZ(12,"br"),m.TgZ(13,"a",9),m._uU(14),m.ALo(15,"uppercase"),m.ALo(16,"translate"),m.qZA()()),2&B){const C=Ae.$implicit;m.xp6(1),m.Q6J("src","/assets/img/icon_service"+C+".png",m.LSH),m.xp6(2),m.hij(" ",m.lcZ(4,5,m.lcZ(5,7,"services.service"+C+"_short"))," "),m.xp6(5),m.hij(" ",m.lcZ(9,9,"services.service"+C+"_desc").length>100?m.lcZ(10,11,"services.service"+C+"_desc").substring(0,100)+"...":m.lcZ(11,13,"services.service"+C+"_desc")," "),m.xp6(5),m.Q6J("routerLink",m.VKq(19,Yr,C)),m.xp6(1),m.hij(" ",m.lcZ(15,15,m.lcZ(16,17,"services.click_here"))," ")}}let So=(()=>{class B{constructor(){this.services=Dn.V,this.responsiveOptions=[{breakpoint:"1024px",numVisible:3,numScroll:3},{breakpoint:"768px",numVisible:2,numScroll:2},{breakpoint:"560px",numVisible:1,numScroll:1}],kn.prototype.onTouchMove=()=>{}}static#e=this.\u0275fac=function(j){return new(j||B)};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-services"]],decls:12,vars:13,consts:[[1,"div-services"],[1,"container"],[1,"row"],[1,"col-12"],[3,"value","numVisible","numScroll","circular","autoplayInterval","responsiveOptions","showIndicators","showNavigators"],["pTemplate","item"],[1,"service-item"],[1,"icon-service",3,"src"],[1,"text-justify"],["nghref","#",1,"btn","btn-outline-info","btn-more",3,"routerLink"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2")(5,"b"),m._uU(6),m.ALo(7,"uppercase"),m.ALo(8,"translate"),m.qZA()(),m._UZ(9,"br"),m.TgZ(10,"p-carousel",4),m.YNc(11,Zi,17,21,"ng-template",5),m.qZA()()()()()),2&j&&(m.xp6(6),m.Oqu(m.lcZ(7,9,m.lcZ(8,11,"services.title"))),m.xp6(4),m.Q6J("value",ce.services)("numVisible",3)("numScroll",1)("circular",!0)("autoplayInterval",3e3)("responsiveOptions",ce.responsiveOptions)("showIndicators",!0)("showNavigators",!1))},dependencies:[ln.rH,kn,ut.jx,ai.gd,Se.X$],styles:[".div-services[_ngcontent-%COMP%]{background-color:var(--color-light-gray-2);padding-top:5%;padding-bottom:5%}.service-item[_ngcontent-%COMP%]{background-color:var(--color-white);padding:50px;border-radius:15px;margin-right:1rem;min-height:370px}img.icon-service[_ngcontent-%COMP%]{width:40px;margin-bottom:25px}button.btn-more[_ngcontent-%COMP%]{position:absolute}@media (min-width: 0px) and (max-width: 700px){.service-item[_ngcontent-%COMP%]{margin-right:2px!important;margin-left:2px!important;min-height:444px!important}}"]})}return B})();var ti=Et(4829),qi=Et(5592),Mt=Et(1631),en=Et(4266),tn=Et(4674),En=Et(7400);const vr=["addListener","removeListener"],Jr=["addEventListener","removeEventListener"],Pn=["on","off"];function br(B,Ae,C,j){if((0,tn.m)(C)&&(j=C,C=void 0),j)return br(B,Ae,C).pipe((0,En.Z)(j));const[ce,je]=function Kr(B){return(0,tn.m)(B.addEventListener)&&(0,tn.m)(B.removeEventListener)}(B)?Jr.map(nt=>Dt=>B[nt](Ae,Dt,C)):function Ln(B){return(0,tn.m)(B.addListener)&&(0,tn.m)(B.removeListener)}(B)?vr.map(Ti(B,Ae)):function wr(B){return(0,tn.m)(B.on)&&(0,tn.m)(B.off)}(B)?Pn.map(Ti(B,Ae)):[];if(!ce&&(0,en.z)(B))return(0,Mt.z)(nt=>br(nt,Ae,C))((0,ti.Xf)(B));if(!ce)throw new TypeError("Invalid event target");return new qi.y(nt=>{const Dt=(...on)=>nt.next(1<on.length?on:on[0]);return ce(Dt),()=>je(Dt)})}function Ti(B,Ae){return C=>j=>B[C](Ae,j)}const Tr=["carousel"];function On(B,Ae){if(1&B&&m._UZ(0,"button",14),2&B){const C=Ae.index;m.Tol(0===C?"active":""),m.uIk("data-bs-slide-to",C)}}function Qr(B,Ae){if(1&B&&(m.TgZ(0,"div")(1,"h1"),m._uU(2),m.ALo(3,"uppercase"),m.ALo(4,"translate"),m.qZA(),m.TgZ(5,"p"),m._uU(6),m.ALo(7,"translate"),m.qZA()()),2&B){const C=Ae.$implicit;m.Tol(0===Ae.index?"carousel-item active":"carousel-item"),m.xp6(2),m.hij(" ",m.lcZ(3,4,m.lcZ(4,6,"services.value"+C))," "),m.xp6(4),m.hij(" ",m.lcZ(7,8,"services.value_desc"+C)," ")}}let Er=(()=>{class B{constructor(C){this.route=C,this.values=[1,2,3,4],this.currentBackground=1}ngOnInit(){this.changeBackground()}ngAfterViewInit(){br(this.carousel.nativeElement,"slide.bs.carousel").subscribe(C=>{this.currentBackground=C.to+1,this.changeBackground()})}changeBackground(){const C=document.getElementById("values-container");C.classList.remove("background1"),C.classList.remove("background2"),C.classList.remove("background3"),C.classList.remove("background4"),C.classList.add("background"+this.currentBackground)}goContact(){this.route.navigate(["/home/contact"])}static#e=this.\u0275fac=function(j){return new(j||B)(m.Y36(ln.F0))};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-values"]],viewQuery:function(j,ce){if(1&j&&m.Gf(Tr,5),2&j){let je;m.iGM(je=m.CRH())&&(ce.carousel=je.first)}},decls:17,vars:7,consts:[["id","values-container",1,"values-container"],[1,"container-fluid"],[1,"row"],[1,"col-md-4","col-sm-12"],["id","carouselValues","data-bs-ride","carousel","data-bs-interval","8000",1,"carousel","slide","carousel-fade"],["carousel",""],[1,"carousel-indicators","hidden-sm"],["type","button","data-bs-target","#carouselValues","aria-current","true",3,"class",4,"ngFor","ngForOf"],[1,"carousel-inner"],[3,"class",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-primary","btn-lg","btn-learn-more",3,"click"],[1,"col-md-8","col-sm-12","hidden-sm"],[1,"image-container"],["src","/assets/img/big-logo.png"],["type","button","data-bs-target","#carouselValues","aria-current","true"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4,5)(6,"div",6),m.YNc(7,On,1,3,"button",7),m.qZA(),m.TgZ(8,"div",8),m.YNc(9,Qr,8,10,"div",9),m.qZA()(),m.TgZ(10,"button",10),m.NdJ("click",function(){return ce.goContact()}),m._uU(11),m.ALo(12,"uppercase"),m.ALo(13,"translate"),m.qZA()(),m.TgZ(14,"div",11)(15,"div",12),m._UZ(16,"img",13),m.qZA()()()()()),2&j&&(m.xp6(7),m.Q6J("ngForOf",ce.values),m.xp6(2),m.Q6J("ngForOf",ce.values),m.xp6(2),m.hij(" ",m.lcZ(12,3,m.lcZ(13,5,"carousel.credit_button"))," "))},dependencies:[ai.sg,ai.gd,Se.X$],styles:["div.values-container[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:bottom;background-size:cover;height:900px}div.background1[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,var(--color-white) 12.51%,var(--color-black-2) 100%),url(/assets/img/values-background1.png);transition:.3s ease-in}div.background2[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,var(--color-white) 12.51%,var(--color-black-2) 100%),url(/assets/img/values-background2.png);transition:.3s ease-in}div.background3[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,var(--color-white) 12.51%,var(--color-black-2) 100%),url(/assets/img/values-background3.png);transition:.3s ease-in}div.background4[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,var(--color-white) 12.51%,var(--color-black-2) 100%),url(/assets/img/values-background4.png);transition:.3s ease-in}.vertical[_ngcontent-%COMP%]   .carousel-item[_ngcontent-%COMP%]{height:100vh;min-height:350px;background:no-repeat center center scroll;background-size:cover}.vertical[_ngcontent-%COMP%]   .carousel-item-next.carousel-item-left[_ngcontent-%COMP%], .vertical[_ngcontent-%COMP%]   .carousel-item-prev.carousel-item-right[_ngcontent-%COMP%]{transform:translateZ(0)}.vertical[_ngcontent-%COMP%]   .carousel-item-next[_ngcontent-%COMP%], .vertical[_ngcontent-%COMP%]   .active.carousel-item-right[_ngcontent-%COMP%]{transform:translate3d(0,100% 0)}.vertical[_ngcontent-%COMP%]   .carousel-item-prev[_ngcontent-%COMP%], .vertical[_ngcontent-%COMP%]   .active.carousel-item-left[_ngcontent-%COMP%]{transform:translate3d(0,-100%,0)}.carousel-indicators[_ngcontent-%COMP%]{position:absolute;margin:auto;height:20px;inset:0 auto 0 10px;width:auto;transform:rotate(90deg)}.carousel-indicators[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{display:block;border-radius:12px;width:12px;height:12px;border:0}.carousel-indicators[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{margin-bottom:5px;background:var(--color-white)}.carousel.vertical[_ngcontent-%COMP%]   .carousel-control-prev[_ngcontent-%COMP%], .carousel.vertical[_ngcontent-%COMP%]   .carousel-control-next[_ngcontent-%COMP%]{right:auto;left:13.5px;width:50px}.carousel.vertical[_ngcontent-%COMP%]   .carousel-control-prev.up[_ngcontent-%COMP%]{top:0;bottom:50%}.carousel.vertical[_ngcontent-%COMP%]   .carousel-control-next.down[_ngcontent-%COMP%]{top:50%;bottom:0}.carousel.vertical[_ngcontent-%COMP%]   .carousel-control-prev.up[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .carousel.vertical[_ngcontent-%COMP%]   .carousel-control-next.down[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;top:50%;z-index:5;display:inline-block;font-size:2em}.carousel.vertical[_ngcontent-%COMP%]   .carousel-control-prev.up[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .carousel.vertical[_ngcontent-%COMP%]   .carousel-control-next.down[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{left:50%;margin-left:-10px;top:50%;margin-top:-10px}.carousel-caption[_ngcontent-%COMP%]{max-width:100%;width:100%;height:85%;left:0}.carousel-indicators[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:15px!important;height:15px!important;border-radius:50%;background-color:var(--color-blue-indicator);margin-right:15px}#carouselValues[_ngcontent-%COMP%]{margin-top:50%}.carousel-inner[_ngcontent-%COMP%]{margin-left:30%}.carousel-inner[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{color:var(--color-dark-gray)}.carousel-inner[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > h1[_ngcontent-%COMP%]{margin-bottom:30px;font-size:40px}.carousel-inner[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{font-size:24px}button.btn-learn-more[_ngcontent-%COMP%]{position:absolute;width:300px;left:7%;margin-top:2%;padding:15px}div.image-container[_ngcontent-%COMP%]{position:relative}div.image-container[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{position:absolute;right:-12px;margin-top:14%;width:660px}@media (min-width: 0px) and (max-width: 770px){div.values-container[_ngcontent-%COMP%]{height:750px!important}.carousel-inner[_ngcontent-%COMP%]{margin-left:0%!important}.carousel-inner[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > h1[_ngcontent-%COMP%]{margin-bottom:20px;font-size:30px;margin-left:0!important}.carousel-inner[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{font-size:18px;text-align:justify;color:var(--color-black)}.carousel-indicators[_ngcontent-%COMP%]{margin:90px -55px!important}button.btn-learn-more[_ngcontent-%COMP%]{margin-top:70px;width:100%;position:inherit}}"]})}return B})(),Ni=(()=>{class B{static#e=this.\u0275fac=function(j){return new(j||B)};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-home"]],decls:19,vars:3,consts:[[1,"home-image"],[1,"main-container","container"],["nghref","#","routerLink","/home/contact",1,"btn","btn-primary","btn-lg"],[1,"img-about-us"],["id","about_us_section"],["id","services_section"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1),m._UZ(2,"app-carrousel")(3,"br"),m.TgZ(4,"a",2),m._uU(5),m.ALo(6,"translate"),m.qZA(),m._UZ(7,"br")(8,"br")(9,"br")(10,"br")(11,"br")(12,"br")(13,"br"),m.qZA(),m.TgZ(14,"div",3),m._UZ(15,"app-about-us",4),m.qZA(),m._UZ(16,"app-services",5)(17,"app-values")(18,"app-footer"),m.qZA()),2&j&&(m.xp6(5),m.Oqu(m.lcZ(6,1,"carousel.more_information")))},dependencies:[ln.rH,a.c,Qi,pt,So,Er,Se.X$],styles:["div.home-image[_ngcontent-%COMP%]{position:absolute;height:120vh;width:100%;background-image:linear-gradient(180deg,var(--color-black) -15.22%,var(--color-middle-black) 60%),linear-gradient(365deg,var(--color-white) 3%,var(--color-middle-black) 70%),url(/assets/img/home-background.gif);background-repeat:no-repeat;background-size:cover;top:0;background-position:65% 80%}div.img-about-us[_ngcontent-%COMP%]{background-image:url(/assets/img/about-us-background.png);background-repeat:no-repeat;background-position:100%;background-size:contain;background-color:#fefeff}@media (min-width: 0px) and (max-width: 700px){div.img-about-us[_ngcontent-%COMP%]{background-image:unset!important}div.home-image[_ngcontent-%COMP%]{background-position:65% 0%}}"]})}return B})();var eo=Et(2181),Rn=Et(7981);const Bn=function(B){return{"background-image":B}};let Fn=(()=>{class B{constructor(C,j,ce){this.route=C,this.router=j,this.navigation=ce,this.serviceId=0,this.subscription=j.events.pipe((0,eo.h)(je=>je instanceof ln.m2)).subscribe(je=>{this.serviceId=Number(je.url.split("/")[3])})}ngOnInit(){this.navigation.navigateToTop(),this.serviceId=Number(this.route.snapshot.paramMap.get("id"))}goToServices(){this.router.navigate(["/home"]),setTimeout(()=>{this.navigation.navigateToSection("services_section")},200)}prevService(){let C=this.serviceId-1;C<1&&(C=5),this.serviceId=C,this.router.navigate(["/home/services/",C])}nextService(){let C=this.serviceId+1;C>5&&(C=1),this.serviceId=C,this.router.navigate(["/home/services/",C])}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static#e=this.\u0275fac=function(j){return new(j||B)(m.Y36(ln.gz),m.Y36(ln.F0),m.Y36(Rn.f))};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-offered-services"]],decls:48,vars:39,consts:[["v-if","serviceId > 0",1,"offered-services"],[1,"main-container","container"],[1,"row"],[1,"col-md-6"],[1,"container-service"],[1,"back-link",3,"click"],[1,"fa","fa-chevron-left"],[3,"src"],[1,"text-justify"],[3,"innerHTML"],["type","button","routerLink","/dashboard/quote-service",1,"btn","btn-lg","btn-primary"],[1,"navigation-responsive"],["type","button",1,"btn","btn-sm","btn-secondary",3,"click"],[1,"fa","fa-angle-left"],[1,"fa","fa-angle-right"],["nghref","#",1,"navigation-services","left",3,"click"],["nghref","#",1,"navigation-services","right",3,"click"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),m._UZ(5,"br"),m.TgZ(6,"span",5),m.NdJ("click",function(){return ce.goToServices()}),m._UZ(7,"i",6),m._uU(8),m.ALo(9,"uppercase"),m.ALo(10,"translate"),m.qZA(),m.TgZ(11,"h1"),m._uU(12),m.ALo(13,"uppercase"),m.ALo(14,"translate"),m.qZA(),m.TgZ(15,"h3"),m._UZ(16,"img",7),m._uU(17),m.ALo(18,"uppercase"),m.ALo(19,"translate"),m.qZA(),m.TgZ(20,"p",8),m._uU(21),m.ALo(22,"translate"),m.qZA(),m.TgZ(23,"p",8)(24,"b"),m._uU(25),m.ALo(26,"uppercase"),m.ALo(27,"translate"),m.qZA()(),m._UZ(28,"div",9),m.ALo(29,"translate"),m.TgZ(30,"p",8),m._uU(31),m.ALo(32,"translate"),m.qZA(),m.TgZ(33,"button",10),m._uU(34),m.ALo(35,"uppercase"),m.ALo(36,"translate"),m.qZA(),m.TgZ(37,"div",11)(38,"button",12),m.NdJ("click",function(){return ce.prevService()}),m._UZ(39,"i",13),m.qZA(),m._uU(40," \xa0 "),m.TgZ(41,"button",12),m.NdJ("click",function(){return ce.nextService()}),m._UZ(42,"i",14),m.qZA()(),m.TgZ(43,"a",15),m.NdJ("click",function(){return ce.prevService()}),m._UZ(44,"i",13),m.qZA(),m.TgZ(45,"a",16),m.NdJ("click",function(){return ce.nextService()}),m._UZ(46,"i",14),m.qZA()()()()(),m._UZ(47,"app-footer"),m.qZA()),2&j&&(m.Akn(m.VKq(37,Bn,"url(/assets/img/service"+ce.serviceId+".png)")),m.xp6(8),m.hij("\xa0\xa0 ",m.lcZ(9,11,m.lcZ(10,13,"services.back_button"))," "),m.xp6(4),m.hij(" ",m.lcZ(13,15,m.lcZ(14,17,"services.title"))," "),m.xp6(4),m.Q6J("src","/assets/img/icon_service"+ce.serviceId+".png",m.LSH),m.xp6(1),m.hij(" ",m.lcZ(18,19,m.lcZ(19,21,"services.service"+ce.serviceId))," "),m.xp6(4),m.hij(" ",m.lcZ(22,23,"services.service"+ce.serviceId+"_desc")," "),m.xp6(4),m.Oqu(m.lcZ(26,25,m.lcZ(27,27,"services.include_service"))),m.xp6(3),m.s9C("innerHTML",m.lcZ(29,29,"services.service"+ce.serviceId+"_include"),m.oJD),m.xp6(3),m.hij(" ",m.lcZ(32,31,"services.text_summary_service")," "),m.xp6(3),m.hij(" ",m.lcZ(35,33,m.lcZ(36,35,"services.quote_now_button"))," "))},dependencies:[ln.rH,a.c,ai.gd,Se.X$],styles:['@charset "UTF-8";div.offered-services h1{margin-top:30px}div.offered-services h3{color:var(--color-primary-pink);font-weight:700;margin-bottom:30px}div.offered-services ul.list-services,div.offered-services ul.sublist-services{list-style:none;color:var(--color-light-gray)}div.offered-services ul.list-services>li{font-weight:700;margin-bottom:10px;margin-top:10px}div.offered-services img{width:30px}div.offered-services ul.list-services>li:before{content:"\\2022";color:var(--color-primary-pink);font-weight:700;display:inline-block;width:1em;margin-left:-1em}div.offered-services ul.sublist-services>li:before{content:"\\2022";color:var(--color-light-gray);font-weight:700;display:inline-block;width:1em;margin-left:-1em}div.offered-services p{margin-bottom:30px}div.offered-services button{width:250px;margin-bottom:30px}div.offered-services{background-repeat:no-repeat;background-position:100% 0%}div.container-service{min-height:554px;position:relative}span.back-link{font-weight:400;cursor:pointer}a.navigation-services{color:var(--color-light-gray);position:absolute;top:30%;font-size:80px;cursor:pointer;opacity:.5}a.navigation-services.right{right:-100px}a.navigation-services.left{left:-60px}div.navigation-responsive{display:none;position:absolute;top:20px;right:0}div.navigation-responsive button{width:50px}@media (min-width: 0px) and (max-width: 991px){div.offered-services{background-image:unset!important}div.container-service{min-height:unset}}@media (min-width: 0px) and (max-width: 1260px){a.navigation-services{display:none}div.navigation-responsive{display:block}}\n'],encapsulation:2})}return B})();var li=Et(2574),Mr=Et(9151),Ot=Et(6223),Mn=Et(7645),Cr=Et(9862);const Ir=Mr.N.base_url;let $i=(()=>{class B{constructor(C){this.http=C}sendContact(C){return this.http.post(`${Ir}/mailer/sendContacto`,C)}static#e=this.\u0275fac=function(j){return new(j||B)(m.LFG(Cr.eN))};static#t=this.\u0275prov=m.Yz7({token:B,factory:B.\u0275fac})}return B})();var Un=Et(5828);function zo(B,Ae){1&B&&(m.TgZ(0,"span",45),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&B&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"validations.required")))}function Ar(B,Ae){1&B&&(m.TgZ(0,"span",45),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&B&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"validations.required")))}function rr(B,Ae){1&B&&(m.TgZ(0,"span",45),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&B&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"validations.required")))}function Sr(B,Ae){1&B&&(m.TgZ(0,"span",45),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&B&&(m.xp6(1),m.hij("",m.lcZ(2,1,"validations.required")," "))}function nn(B,Ae){1&B&&(m.TgZ(0,"span",45),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&B&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"validations.required")))}function Zn(B,Ae){1&B&&(m.TgZ(0,"span",45),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&B&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"validations.required")))}function to(B,Ae){1&B&&(m.TgZ(0,"span",45),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&B&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"validations.required")))}function G(B,Ae){1&B&&m._UZ(0,"img",46)}function S(B,Ae){1&B&&m._UZ(0,"img",47)}const D=function(){return{width:"30vw"}},V=function(){return{"960px":"90vw"}};let X=(()=>{class B{constructor(C,j,ce,je,nt){this.navigation=C,this.translate=j,this.fb=ce,this.validator=je,this.contactService=nt,this.style="mapbox://styles/mapbox/streets-v11",this.lat=26.507855368773555,this.lng=-80.19337591520025,this.displayConfirmation=!1,this.isError=!1,this.titleMesasge="",this.message="",this.formContact=this.fb.group({name:["",[Ot.kI.required]],surname:[""],email:["",[Ot.kI.required,Ot.kI.email]],phone:["",[Ot.kI.required]],business:["",[Ot.kI.required]],contactReason:[""],acceptTerms1:[!1],acceptTerms2:[!1],notes:[""]}),C.navigateToTop(250)}ngOnInit(){this.map=new li.Map({accessToken:Mr.N.mapbox.accessToken,container:"map",style:this.style,zoom:11,center:[this.lng,this.lat]}),this.map.addControl(new li.NavigationControl);const C=this.translate.instant("contact.marker_title");new li.Marker({color:"red"}).setLngLat([this.lng,this.lat]).setPopup((new li.Popup).setHTML(`\n          <h6><b>${C} - ${this.translate.instant("contact.us_office")}</b></h6>\n          <a href="https://maps.google.com/?q=${this.lat},${this.lng}" target="_blank">Directions</a>\n        `)).addTo(this.map),new li.Marker({color:"red"}).setLngLat([-99.16715885989345,19.41910444939983]).setPopup((new li.Popup).setHTML(`\n          <h6><b>${C} - ${this.translate.instant("contact.mexico_office")}</b></h6>\n          <a href="https://maps.google.com/?q=19.41910444939983,-99.16715885989345" target="_blank">Directions</a>\n        `)).addTo(this.map),new li.Marker({color:"red"}).setLngLat([-3.692818357723195,40.44846225129876]).setPopup((new li.Popup).setHTML(`\n          <h6><b>${C} - ${this.translate.instant("contact.europe_office")}</b></h6>\n          <a href="https://maps.google.com/?q=40.44846225129876,-3.692818357723195" target="_blank">Directions</a>\n        `)).addTo(this.map)}submitContact(){this.formContact.valid&&(console.log("this.formContact.valid",this.formContact.valid),console.log("this.formContact",this.formContact))}closeContact(){this.isError||this.formContact.reset(),this.displayConfirmation=!1}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static#e=this.\u0275fac=function(j){return new(j||B)(m.Y36(Rn.f),m.Y36(Se.sK),m.Y36(Ot.qu),m.Y36(Mn.o),m.Y36($i))};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-contact"]],decls:125,vars:93,consts:[[1,"contact-container"],[1,"header"],[1,"container","padding-50"],[1,"row"],[1,"col-8"],[1,"col-4","text-end"],["src","/assets/img/map-icon.png"],["id","map",1,"map"],[1,"info","padding-50"],[1,"container"],[1,"col-md-3","col-12"],[1,"office-container"],[1,"block","office-text"],["src","/assets/img/map-marker.png"],[1,"info-text","mb-2"],[1,"info-text","mb-0"],[1,"info-text",2,"text-align","center"],[1,"card-info"],[2,"color","#e81f76"],["src","/assets/img/email2.png"],["href","mailto:info@loopintermodal.com",2,"color","#757783"],[1,"col-md-1","col-12"],[1,"col-md-8","col-12"],[1,"form-container"],[3,"formGroup","ngSubmit"],["type","text","formControlName","name",1,"form-control","mb-0",3,"placeholder"],[1,"divError","mb-4"],["class","font-responsive text-danger",4,"ngIf"],["type","text","formControlName","surname",1,"form-control","mb-0",3,"placeholder"],["type","text","formControlName","email","required","",1,"form-control","mb-0",3,"placeholder"],["type","text","formControlName","phone",1,"form-control","mb-0",3,"placeholder"],["type","text","formControlName","business",1,"form-control","mb-0",3,"placeholder"],["formControlName","notes",1,"form-control","mb-0",3,"placeholder"],["type","checkbox","formControlName","acceptTerms1",1,"form-check-input"],["acceptTerms",""],["for","acceptTerms ",2,"margin-left","50px","cursor","pointer"],["routerLink","/home/aviso/",1,"font-responsive","text-danger"],["type","checkbox","formControlName","acceptTerms2",1,"form-check-input"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"],[1,"confirmation-dialog",3,"visible","modal","breakpoints","draggable","resizable","closeOnEscape","visibleChange"],["src","/assets/img/success.png","class","mb-3",4,"ngIf"],["src","/assets/img/error.png","class","mb-3",4,"ngIf"],[3,"innerHTML"],["type","button",1,"btn","btn-primary","w-100",3,"click"],[1,"mb-0"],[1,"font-responsive","text-danger"],["src","/assets/img/success.png",1,"mb-3"],["src","/assets/img/error.png",1,"mb-3"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h1"),m._uU(6),m.ALo(7,"uppercase"),m.ALo(8,"translate"),m.qZA()(),m.TgZ(9,"div",5),m._UZ(10,"img",6),m.qZA()()()(),m._UZ(11,"div",7),m.TgZ(12,"div",8)(13,"div",9)(14,"div",3)(15,"div",10)(16,"div",11)(17,"span",12),m._UZ(18,"img",13),m._uU(19),m.ALo(20,"uppercase"),m.ALo(21,"translate"),m.qZA(),m.TgZ(22,"p",14),m._uU(23," 50 W. Mashta Dr. Suite 4 Miami, Florida 33149 - USA "),m.qZA(),m.TgZ(24,"p",15)(25,"b"),m._uU(26),m.ALo(27,"translate"),m.qZA(),m._uU(28," +1 (305) 564 1315 "),m.qZA()(),m.TgZ(29,"div",11)(30,"span",12),m._UZ(31,"img",13),m._uU(32),m.ALo(33,"uppercase"),m.ALo(34,"translate"),m.qZA(),m.TgZ(35,"p",14),m._uU(36,"Av. Oaxaca 86 - 1 CDMX, Mexico 06700"),m.qZA(),m.TgZ(37,"p",15)(38,"b"),m._uU(39),m.ALo(40,"translate"),m.qZA(),m._uU(41," +52 (55) 6826 3041 "),m.qZA()(),m.TgZ(42,"div",11)(43,"span",12),m._UZ(44,"img",13),m._uU(45),m.ALo(46,"uppercase"),m.ALo(47,"translate"),m.qZA(),m.TgZ(48,"p",14),m._uU(49),m.ALo(50,"translate"),m.qZA()(),m.TgZ(51,"div",11)(52,"div",9)(53,"p",16)(54,"span",17)(55,"h4",18),m._UZ(56,"img",19),m._uU(57),m.ALo(58,"uppercase"),m.ALo(59,"translate"),m.qZA(),m.TgZ(60,"a",20),m._uU(61,"info@loopintermodal.com"),m.qZA()()()()()(),m.TgZ(62,"div",21),m._uU(63,"\xa0"),m.qZA(),m.TgZ(64,"div",22)(65,"div",23)(66,"form",24),m.NdJ("ngSubmit",function(){return ce.submitContact()}),m._UZ(67,"input",25),m.ALo(68,"translate"),m.TgZ(69,"div",26),m.YNc(70,zo,3,3,"span",27),m.qZA(),m._UZ(71,"input",28),m.ALo(72,"translate"),m.TgZ(73,"div",26),m.YNc(74,Ar,3,3,"span",27),m.qZA(),m._UZ(75,"input",29),m.ALo(76,"translate"),m.TgZ(77,"div",26),m.YNc(78,rr,3,3,"span",27),m.qZA(),m._UZ(79,"input",30),m.ALo(80,"translate"),m.TgZ(81,"div",26),m.YNc(82,Sr,3,3,"span",27),m.qZA(),m._UZ(83,"input",31),m.ALo(84,"translate"),m.TgZ(85,"div",26),m.YNc(86,nn,3,3,"span",27),m.qZA(),m._UZ(87,"textarea",32),m.ALo(88,"translate"),m.TgZ(89,"div",26),m.YNc(90,Zn,3,3,"span",27),m.qZA(),m._UZ(91,"input",33,34),m.TgZ(93,"label",35)(94,"span",36),m._uU(95),m.ALo(96,"translate"),m._UZ(97,"br"),m.qZA()(),m._UZ(98,"input",37,34),m.TgZ(100,"label",35)(101,"span",36)(102,"b"),m._uU(103),m.ALo(104,"translate"),m.qZA()()(),m.TgZ(105,"div",26),m.YNc(106,to,3,3,"span",27),m.qZA(),m.TgZ(107,"button",38),m._uU(108),m.ALo(109,"uppercase"),m.ALo(110,"translate"),m.qZA()()()()()()(),m.TgZ(111,"p-dialog",39),m.NdJ("visibleChange",function(nt){return ce.displayConfirmation=nt}),m.YNc(112,G,1,0,"img",40),m.YNc(113,S,1,0,"img",41),m.TgZ(114,"h3"),m._uU(115),m.ALo(116,"uppercase"),m.qZA(),m._UZ(117,"p",42)(118,"hr"),m.TgZ(119,"button",43),m.NdJ("click",function(){return ce.closeContact()}),m._uU(120),m.ALo(121,"uppercase"),m.ALo(122,"translate"),m.qZA(),m._UZ(123,"hr",44),m.qZA(),m._UZ(124,"app-footer"),m.qZA()),2&j&&(m.xp6(6),m.hij(" ",m.lcZ(7,39,m.lcZ(8,41,"contact.title"))," "),m.xp6(13),m.hij(" ",m.lcZ(20,43,m.lcZ(21,45,"contact.us_office"))," "),m.xp6(7),m.hij("",m.lcZ(27,47,"contact.phone_label"),":"),m.xp6(6),m.hij(" ",m.lcZ(33,49,m.lcZ(34,51,"contact.mexico_office"))," "),m.xp6(7),m.hij("",m.lcZ(40,53,"contact.phone_label"),":"),m.xp6(6),m.hij(" ",m.lcZ(46,55,m.lcZ(47,57,"contact.europe_office"))," "),m.xp6(4),m.hij(" P.\xba de la Castellana, 77, 28046 Madrid, ",m.lcZ(50,59,"contact.spain_label")," "),m.xp6(8),m.hij(" ",m.lcZ(58,61,m.lcZ(59,63,"quotes.email"))," "),m.xp6(9),m.Q6J("formGroup",ce.formContact),m.xp6(1),m.MGl("placeholder","",m.lcZ(68,65,"contact.form.name")," *"),m.xp6(3),m.Q6J("ngIf",ce.validator.validFormField(ce.formContact,"name")),m.xp6(1),m.MGl("placeholder","",m.lcZ(72,67,"contact.form.surname")," "),m.xp6(3),m.Q6J("ngIf",ce.validator.validFormField(ce.formContact,"surname")),m.xp6(1),m.MGl("placeholder","",m.lcZ(76,69,"contact.form.email")," *"),m.xp6(3),m.Q6J("ngIf",ce.validator.validFormField(ce.formContact,"email")),m.xp6(1),m.MGl("placeholder","",m.lcZ(80,71,"contact.form.phone")," *"),m.xp6(3),m.Q6J("ngIf",ce.validator.validFormField(ce.formContact,"phone")),m.xp6(1),m.MGl("placeholder","",m.lcZ(84,73,"contact.form.business")," *"),m.xp6(3),m.Q6J("ngIf",ce.validator.validFormField(ce.formContact,"business")),m.xp6(1),m.MGl("placeholder","",m.lcZ(88,75,"contact.form.reasons")," "),m.xp6(3),m.Q6J("ngIf",ce.validator.validFormField(ce.formContact,"notes")),m.xp6(5),m.hij(" ",m.lcZ(96,77,"validations.accept_privacy1")," "),m.xp6(8),m.hij(" ",m.lcZ(104,79,"validations.accept_privacy2")," "),m.xp6(3),m.Q6J("ngIf",ce.validator.validFormField(ce.formContact,"business")),m.xp6(1),m.Q6J("disabled",!ce.formContact.valid),m.xp6(1),m.hij(" ",m.lcZ(109,81,m.lcZ(110,83,"contact.form.send"))," "),m.xp6(3),m.Akn(m.DdM(91,D)),m.Q6J("visible",ce.displayConfirmation)("modal",!0)("breakpoints",m.DdM(92,V))("draggable",!1)("resizable",!1)("closeOnEscape",!1),m.xp6(1),m.Q6J("ngIf",!ce.isError),m.xp6(1),m.Q6J("ngIf",ce.isError),m.xp6(2),m.Oqu(m.lcZ(116,85,ce.titleMesasge)),m.xp6(2),m.Q6J("innerHTML",ce.message,m.oJD),m.xp6(3),m.hij(" ",m.lcZ(121,87,m.lcZ(122,89,"contact.message_button"))," "))},dependencies:[ai.O5,ln.rH,a.c,Ot._Y,Ot.Fj,Ot.Wl,Ot.JJ,Ot.JL,Ot.Q7,Ot.sg,Ot.u,Un.V,ai.gd,Se.X$],styles:[".info-text[_ngcontent-%COMP%]{color:#757783}.email[_ngcontent-%COMP%]{text-decoration:underline}.contact-container[_ngcontent-%COMP%]{margin-top:60px}.contact-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:#fff;background-image:url(/assets/img/logo-dashboard.png);background-repeat:no-repeat;background-position-x:100%}.contact-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{line-height:88px}.contact-container[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{background-color:#add8e6;height:275px}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{background-color:#f4f5f6}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .office-text[_ngcontent-%COMP%]{color:var(--color-primary-pink);font-weight:700;font-size:22px}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{background-color:#fff;padding:25px;border-radius:7px}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:125px}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .office-container[_ngcontent-%COMP%]{margin-bottom:100px}@media (min-width: 0px) and (max-width: 991px){.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .office-container[_ngcontent-%COMP%]{margin-bottom:30px}}.padding-50[_ngcontent-%COMP%]{padding-top:50px;padding-bottom:50px}  .mapboxgl-ctrl-bottom-right{display:none!important}  .confirmation-dialog .p-dialog-header{display:none!important}  .confirmation-dialog .p-dialog-content{border-radius:6px!important;padding-top:2rem!important}"]})}return B})();var ie=Et(6593);let le=(()=>{class B{static#e=this.\u0275fac=function(j){return new(j||B)};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-avisop"]],decls:155,vars:0,consts:[[1,"row","text-justify",2,"background-color","white"],[1,"col-12","mt-3"],["href","tel:+525568263041",2,"color","#db5191"],["href","mailto:info@loopintermodal.com",2,"color","#db5191"],[2,"list-style","none"],[1,"mt-3","text-justify"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1),m._uU(2," La presente Pol\xedtica de protecci\xf3n de datos personales (en adelante, \u201cPol\xedtica de Privacidad\u201d) regula el tratamiento de datos personales de los usuarios web, de acuerdo con lo establecido en la legislaci\xf3n aplicable en materia de protecci\xf3n de datos. "),m.qZA(),m.TgZ(3,"div",1)(4,"b"),m._uU(5," \xbfQUI\xc9N ES EL RESPONSABLE DEL TRATAMIENTO DE SUS DATOS PERSONALES? "),m.qZA(),m._UZ(6,"br"),m._uU(7," RESPONSABLE DE TRATAMIENTO: LOOP INTERMODAL S.A. DE C.V. "),m._UZ(8,"br"),m._uU(9," Direcci\xf3n: Av. Oaxaca 86 - 3. Col. Roma Norte CDMX, M\xe9xico 06700 "),m._UZ(10,"br"),m._uU(11," Tel\xe9fono de contacto: "),m.TgZ(12,"a",2),m._uU(13,"+52 55 6826-3041"),m.qZA(),m._UZ(14,"br"),m._uU(15," Correo electr\xf3nico: "),m.TgZ(16,"a",3),m._uU(17,"info@loopintermodal.com"),m.qZA(),m._UZ(18,"br")(19,"br"),m._uU(20," Usted confirma y garantiza la veracidad y exactitud de los datos aportados, y que \xe9stos se ajustan a su estado actual. En este sentido, se compromete a comunicar cualquier modificaci\xf3n que se produjera en los mismos, de acuerdo con el procedimiento establecido en el apartado relativo al ejercicio de sus derechos. "),m.qZA(),m.TgZ(21,"div",1)(22,"b"),m._uU(23," \xbfCON QU\xc9 FINALIDADES VAMOS A TRATAR SUS DATOS PERSONALES? "),m.qZA(),m._UZ(24,"br"),m._uU(25," Le informamos de que todos los datos tratados por LOOP INTERMODAL S.A. DE C.V. son necesarios para las finalidades descritas en la presente Pol\xedtica de Privacidad y el hecho de no facilitarse supondr\xeda la imposibilidad de poder gestionar adecuadamente la relaci\xf3n existente con usted. A continuaci\xf3n, se describen las diferentes finalidades con las que se tratan sus datos personales y las bases que legitiman el tratamiento: "),m.TgZ(26,"ul",4)(27,"li",5)(28,"b"),m._uU(29," CONTACTOS DE LA WEB O DEL CORREO ELECTR\xd3NICO "),m.qZA(),m.TgZ(30,"p"),m._uU(31," \xbfQu\xe9 datos recopilamos a trav\xe9s de la Web? "),m._UZ(32,"br"),m._uU(33," Podemos tratar su IP, qu\xe9 sistema operativo o navegador usa, e incluso la duraci\xf3n de su visita, de forma an\xf3nima. "),m._UZ(34,"br"),m.qZA()()()(),m.TgZ(35,"div",1),m._uU(36," Si nos facilita sus datos en el formulario de contacto, como Nombre, Tel\xe9fono y/o Correo Electr\xf3nico, se identificar\xe1n para poder contactar con usted en caso de que sea necesario. "),m.qZA(),m.TgZ(37,"div",1)(38,"b"),m._uU(39," \xbfCon qu\xe9 finalidades vamos a tratar sus datos personales? "),m.qZA(),m._UZ(40,"br"),m._uU(41," Contestar a sus consultas, solicitudes o peticiones. Gestionar el servicio solicitado, contestar su solicitud, o tramitar su petici\xf3n. Informaci\xf3n por medios electr\xf3nicos, que versen sobre su solicitud. Informaci\xf3n comercial o de eventos por medios electr\xf3nicos, llamada telef\xf3nica o mensaje de texto (SMS), siempre que exista autorizaci\xf3n expresa. "),m._UZ(42,"br")(43,"br"),m.TgZ(44,"b"),m._uU(45," El consentimiento de SMS y los n\xfameros de tel\xe9fono nunca se compartir\xe1n con terceros o afiliados bajo ninguna circunstancia "),m.qZA(),m._UZ(46,"br")(47,"br"),m._uU(48," Realizar an\xe1lisis y mejoras en la Web, sobre nuestros productos y servicios. Mejorar nuestra estrategia comercial. "),m.qZA(),m._UZ(49,"div",1),m.TgZ(50,"div",1)(51,"b"),m._uU(52," \xbfCu\xe1l es la legitimaci\xf3n para el tratamiento de sus datos? "),m.qZA(),m._UZ(53,"br"),m.TgZ(54,"p"),m._uU(55," La aceptaci\xf3n y consentimiento del interesado: En aquellos casos donde para realizar una solicitud sea necesario cumplimentar un formulario y hacer un \u201cclick\u201d en el bot\xf3n de enviar, la realizaci\xf3n del mismo implica necesariamente que ha sido informado y ha otorgado expresamente su consentimiento al contenido de la cl\xe1usula anexada a dicho formulario o aceptaci\xf3n de la pol\xedtica de privacidad. Todos nuestros formularios cuentan con el s\xedmbolo * en los datos obligatorios. Si no facilita esos campos, o no marca el checkbox de aceptaci\xf3n de la pol\xedtica de privacidad, no se permitir\xe1 el env\xedo de la informaci\xf3n. Normalmente tiene la siguiente f\xf3rmula: \u201c\u25a1 He le\xeddo y acepto la Pol\xedtica de privacidad.\u201d "),m.qZA()(),m.TgZ(56,"div",1)(57,"ul",4)(58,"li"),m._uU(59," CLIENTES "),m.TgZ(60,"p"),m._UZ(61,"br"),m.TgZ(62,"b"),m._uU(63," \xbfCon qu\xe9 finalidades vamos a tratar sus datos personales? "),m.qZA(),m._UZ(64,"br"),m._uU(65," Elaboraci\xf3n del presupuesto y seguimiento del mismo mediante comunicaciones entre ambas partes. Informaci\xf3n por medios electr\xf3nicos, que versen sobre su solicitud. Informaci\xf3n comercial o de eventos por medios electr\xf3nicos, llamada telef\xf3nica o mensaje de texto (SMS), siempre que exista autorizaci\xf3n expresa. Gestionar los servicios administrativos, de comunicaciones y de log\xedstica realizados por el Responsable. Facturaci\xf3n y declaraci\xf3n de los impuestos oportunos. Realizar las transacciones que correspondan. Gestiones de control y recobro. "),m.qZA(),m.TgZ(66,"p"),m._UZ(67,"br"),m.TgZ(68,"b"),m._uU(69," \xbfCu\xe1l es la legitimaci\xf3n para el tratamiento de sus datos? "),m.qZA(),m._UZ(70,"br"),m._uU(71," La base legal es la aceptaci\xf3n de una relaci\xf3n contractual, o en su defecto su consentimiento al contactar con nosotros u ofrecernos sus productos por alguna v\xeda. "),m.qZA()()()(),m.TgZ(72,"div",1)(73,"ul",4)(74,"li"),m._uU(75," PROVEEDORES "),m.TgZ(76,"p"),m._UZ(77,"br"),m.TgZ(78,"b"),m._uU(79," \xbfCon qu\xe9 finalidades vamos a tratar sus datos personales? "),m.qZA(),m._UZ(80,"br"),m._uU(81," Informaci\xf3n por medios electr\xf3nicos, que versen sobre su solicitud. Informaci\xf3n comercial o de eventos por medios electr\xf3nicos, llamada telef\xf3nica o mensaje de texto (SMS), siempre que exista autorizaci\xf3n expresa. Gestionar los servicios administrativos, de comunicaciones y de log\xedstica realizados por el Responsable. Facturaci\xf3n. Realizar las transacciones que correspondan. Facturaci\xf3n y declaraci\xf3n de los impuestos oportunos. Gestiones de control y recobro. "),m.qZA(),m.TgZ(82,"p"),m._UZ(83,"br"),m.TgZ(84,"b"),m._uU(85," \xbfCu\xe1l es la legitimaci\xf3n para el tratamiento de sus datos? "),m.qZA(),m._UZ(86,"br"),m._uU(87," La base legal es la aceptaci\xf3n de una relaci\xf3n contractual, o en su defecto su consentimiento al contactar con nosotros u ofrecernos sus productos por alguna v\xeda. "),m.qZA()()()(),m.TgZ(88,"div",1)(89,"ul",4)(90,"li"),m._uU(91," DEMANDANTES DE EMPLEO "),m.TgZ(92,"p"),m._UZ(93,"br"),m.TgZ(94,"b"),m._uU(95," \xbfCon qu\xe9 finalidades vamos a tratar sus datos personales? "),m.qZA(),m._UZ(96,"br"),m._uU(97," Organizaci\xf3n de procesos de selecci\xf3n para la contrataci\xf3n de empleados. Citarle para entrevistas de trabajo y evaluar su candidatura. Si nos has dado su consentimiento, se lo podremos ceder a empresas colaboradoras o afines, con el \xfanico objetivo de ayudarle a encontrar empleo. \xbfDurante cu\xe1nto tiempo vamos a mantener los datos personales? Asimismo, le comunicamos que transcurrido un a\xf1o desde la recepci\xf3n de su curr\xedculum vitae, procederemos a su destrucci\xf3n segura. "),m.qZA(),m.TgZ(98,"p"),m._UZ(99,"br"),m.TgZ(100,"b"),m._uU(101," \xbfCu\xe1l es la legitimaci\xf3n para el tratamiento de sus datos? "),m.qZA(),m._UZ(102,"br"),m._uU(103," La base legal es su consentimiento inequ\xedvoco, al enviarnos su CV. "),m._UZ(104,"br"),m.qZA()()()(),m.TgZ(105,"div",1)(106,"b"),m._uU(107," \xbfIncluimos datos personales de terceras personas? "),m.qZA(),m._UZ(108,"br"),m._uU(109," No, como norma general s\xf3lo tratamos los datos que nos facilitan los titulares. Si nos aporta datos de terceros deber\xe1, con car\xe1cter previo, informar y solicitar su consentimiento a dichas personas, o de lo contrario nos exime de cualquier responsabilidad por el incumplimiento de este requisito. "),m._UZ(110,"br"),m.TgZ(111,"b"),m._uU(112," \xbfY datos de menores? "),m.qZA(),m._UZ(113,"br"),m._uU(114," No tratamos datos de menores de 14 a\xf1os sin consentimiento del padre, madre o tutor legal. Por tanto, abst\xe9ngase de facilitarlos si no tiene esa edad o, en su caso, de facilitar datos de terceros que no tengan la citada edad. LOOP INTERMODAL S.A. DE C.V. se exime de cualquier responsabilidad por el incumplimiento de esta previsi\xf3n. "),m._UZ(115,"br"),m.TgZ(116,"b"),m._uU(117," \xbfRealizaremos comunicaciones por medios electr\xf3nicos? "),m.qZA(),m._UZ(118,"br"),m._uU(119," Solo se realizan para gestionar su solicitud, si es uno de los medios de contacto que nos ha facilitado. Si realizamos comunicaciones comerciales, habr\xe1n sido previa y expresamente autorizadas por usted. "),m.qZA(),m.TgZ(120,"div",1)(121,"b"),m._uU(122," \xbfA QUI\xc9NES LE COMUNICAREMOS SUS DATOS? "),m.qZA(),m.TgZ(123,"p"),m._uU(124," En los t\xe9rminos descritos en el apartado sobre las finalidades del tratamiento, LOOP INTERMODAL S.A. DE C.V. podr\xe1 comunicar sus datos personales a las siguientes entidades: Autoridades p\xfablicas, reguladores u \xf3rganos gubernamentales o jurisdiccionales en aquellos supuestos en que es necesario hacerlo por ley, normativa local o en el cumplimiento de obligaciones regulatorias. Entre otros, a las administraciones tributarias. En el caso de que usted solicite la portabilidad de sus datos, sus datos personales ser\xe1n cedidos a la entidad que usted designe. "),m.qZA()(),m.TgZ(125,"div",1)(126,"b"),m._uU(127," TRANSFERENCIAS INTERNACIONALES DE DATOS "),m.qZA(),m.TgZ(128,"p"),m._uU(129," Como norma general, no se efect\xfaan transferencias de datos a terceros localizados o cuyos servidores se ubiquen fuera del pa\xeds. No obstante, en aquellos supuestos excepcionales en los que dichas transferencias internacionales se produzcan, se adoptar\xe1n las medidas necesarias para que \xe9stas se hagan a un pa\xeds u organizaci\xf3n que haya ofrecido garant\xedas adecuadas o las mismas puedan fundamentarse en los principios legitimadores establecidos normativamente. \xbfDURANTE QU\xc9 PLAZO ALMACENAREMOS SUS DATOS? Trataremos sus datos, siempre y cuando sean necesarios para la finalidad para los que fueron recogidos y, una vez finalizada la relaci\xf3n que legitima el tratamiento de sus datos, \xe9stos se almacenar\xe1n bloqueados con el \xfanico objetivo de realizar la formulaci\xf3n y defensa de reclamaciones y la oportuna cesi\xf3n a requerimiento de las autoridades, \xfanicamente durante el tiempo establecido legalmente. Asimismo, una vez finalizada la relaci\xf3n contractual, trataremos sus datos personales para el env\xedo de comunicaciones comerciales, siempre que dispongamos del consentimiento expreso para ello. "),m.qZA()(),m.TgZ(130,"div",1)(131,"b"),m._uU(132," DECISIONES AUTOMATIZADAS Y ELABORACI\xd3N DE PERFILES "),m.qZA(),m.TgZ(133,"p"),m._uU(134," La entidad no elaborar\xe1 perfiles ni realizar\xe1 decisiones automatizadas. "),m.qZA()(),m.TgZ(135,"div",1)(136,"b"),m._uU(137," \xbfCU\xc1LES SON SUS DERECHOS? "),m.qZA(),m.TgZ(138,"p"),m._uU(139," Le informamos que, de acuerdo con la normativa vigente, usted tiene derecho a revocar el consentimiento otorgado, as\xed como a ejercer sus derechos de acceso, rectificaci\xf3n, supresi\xf3n, limitaci\xf3n, oposici\xf3n, as\xed como el derecho a la portabilidad de tus datos y a no ser objeto de decisiones automatizadas. "),m.qZA()(),m.TgZ(140,"div",1)(141,"b"),m._uU(142," \xbfC\xd3MO PUEDE EJERCER SUS DERECHOS? "),m.qZA(),m.TgZ(143,"p"),m._uU(144," De acuerdo con la legislaci\xf3n aplicable, le informamos que podr\xe1 ejercitar los derechos, poni\xe9ndose en contacto en la siguiente direcci\xf3n de correo: "),m.TgZ(145,"a",3),m._uU(146,"info@loopintermodal.com"),m.qZA(),m._uU(147," indic\xe1ndonos el motivo de su solicitud y el derecho que quiere ejercitar. "),m.qZA()(),m.TgZ(148,"div",1)(149,"b"),m._uU(150," MODIFICACI\xd3N DE LA POL\xcdTICA DE PRIVACIDAD "),m.qZA(),m.TgZ(151,"p"),m._uU(152," LOOP INTERMODAL S.A. DE C.V. puede modificar total o parcialmente esta Pol\xedtica de Privacidad si as\xed lo requiere la legislaci\xf3n aplicable. Si requiere que borrar syu informaci\xf3n contacta con nosotros al correo electr\xf3nico "),m.TgZ(153,"a",3),m._uU(154,"info@loopintermodal.com"),m.qZA()()()())}})}return B})(),ae=(()=>{class B{static#e=this.\u0275fac=function(j){return new(j||B)};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-policy"]],decls:171,vars:0,consts:[[1,"row","text-justify",2,"background-color","white"],[1,"col-12","mt-3"],["href","tel:+13055641315",2,"color","#db5191"],["href","mailto:info@loopintermodal.com",2,"color","#db5191"],[2,"list-style","none"],[1,"mt-3","text-justify"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1),m._uU(2,' The following Personal Data Protection Policy (hereinafter, "Privacy Policy") regulates the processing of web users\u2019 personal data, per the applicable legislation on data protection. '),m.qZA(),m.TgZ(3,"div",1)(4,"b"),m._uU(5," WHO IS RESPONSIBLE FOR THE PROCESSING OF YOUR PERSONAL DATA? "),m.qZA(),m._UZ(6,"br"),m._uU(7," DATA CONTROLLER: LOOP INTERMODAL LLC "),m._UZ(8,"br"),m._uU(9," Address: 50 W. Mashta Dr. Suite 4 Miami, FL 33149 "),m._UZ(10,"br"),m._uU(11," Contact phone: "),m.TgZ(12,"a",2),m._uU(13,"+1 305-564-1315"),m.qZA(),m._UZ(14,"br"),m._uU(15," Email: "),m.TgZ(16,"a",3),m._uU(17,"info@loopintermodal.com"),m.qZA(),m._UZ(18,"br")(19,"br"),m._uU(20," You confirm and guarantee the truthfulness and accuracy of the data provided, and that they are adjusted to your current state. In this sense, you agree to communicate any modifications, per the procedure established in the section regarding exercising your rights. "),m.qZA(),m.TgZ(21,"div",1)(22,"b"),m._uU(23," WHAT PURPOSES WILL WE PROCESS YOUR PERSONAL DATA FOR?? "),m.qZA(),m._UZ(24,"br"),m._uU(25," We inform you that all data processed by JASU INDUSTRIES S.A. DE C.V. are necessary for the purposes described in this Privacy Policy. Failure to provide them would imply the impossibility of properly managing the existing relationship with you. Below are the different purposes for which we process your personal data and the bases that legitimize the processing: "),m.TgZ(26,"ul",4)(27,"li",5)(28,"b"),m._uU(29," WEB OR EMAIL CONTACTS "),m.qZA(),m.TgZ(30,"p"),m._uU(31," What data do we collect through the Website? "),m._UZ(32,"br"),m._uU(33," We may process your IP, what operating system or browser you use, and even the duration of your visit, anonymously. "),m._UZ(34,"br"),m.qZA()()()(),m.TgZ(35,"div",1),m._uU(36," If you provide us with data in the contact form, such as Name, E-mail, or Phone Number you will be identified to contact you if necessary. "),m.qZA(),m.TgZ(37,"div",1)(38,"b"),m._uU(39," What purposes will we process your personal data for? "),m.qZA(),m._UZ(40,"br"),m._uU(41," Answering your queries, requests, or petitions. Managing the requested service, responding to your request, or processing your petition. Information by electronic means, related to your request. Commercial or event information via electronic means, phone call, or text message (SMS) provided there is express authorization. "),m._UZ(42,"br")(43,"br"),m.TgZ(44,"b"),m._uU(45," SMS consent and phone numbers will never be shared with third parties or affiliates under any circumstances. "),m.qZA(),m._UZ(46,"br")(47,"br"),m._uU(48," Conducting analysis and improvements on the Website, our products, and services. Improving our commercial strategy. "),m.qZA(),m._UZ(49,"div",1),m.TgZ(50,"div",1)(51,"b"),m._uU(52," What is the legitimacy of the processing of your data? "),m.qZA(),m._UZ(53,"br"),m.TgZ(54,"p"),m._uU(55,' The acceptance and consent of the interested party: In those cases where it is necessary to complete a form and click on the "send" button to make a request, doing so necessarily implies that you have been informed and have expressly consented to the content of the clause attached to said form or acceptance of the privacy policy. All our forms have the symbol * in the mandatory data. If you do not provide those fields or do not check the acceptance checkbox of the privacy policy, the information will not be sent. Normally it has the following formula: "\u25a1 I have read and accepted the Privacy Policy." '),m.qZA()(),m.TgZ(56,"div",1)(57,"ul",4)(58,"li"),m._uU(59," CLIENTS "),m.TgZ(60,"p"),m._UZ(61,"br"),m.TgZ(62,"b"),m._uU(63," What purposes will we process your personal data for? "),m.qZA(),m._UZ(64,"br"),m._uU(65," Preparation of the budget and follow-up through communications between both parties. Information by electronic means, related to your request. Commercial or event information via electronic means, phone call, or text message (SMS) provided there is express authorization. Manage administrative, communication, and logistics services performed by the Controller. Billing and declaration of the relevant taxes. Carry out the corresponding transactions. Control and recovery management. "),m.qZA(),m.TgZ(66,"p"),m._UZ(67,"br"),m.TgZ(68,"b"),m._uU(69," What is the legitimacy of the processing of your data? "),m.qZA(),m._UZ(70,"br"),m._uU(71," The legal basis is the acceptance of a contractual relationship, or your consent when contacting us or offering us your products by any means. "),m.qZA()()()(),m.TgZ(72,"div",1)(73,"ul",4)(74,"li"),m._uU(75," SUPPLIERS "),m.TgZ(76,"p"),m._UZ(77,"br"),m.TgZ(78,"b"),m._uU(79," What purposes will we process your personal data for? "),m.qZA(),m._UZ(80,"br"),m._uU(81," Information by electronic means, related to your request. Commercial or event information via electronic means, phone call, or text message (SMS) provided there is express authorization. Manage administrative, communication, and logistics services performed by the Controller. Billing. Carry out the corresponding transactions. Billing and declaration of the relevant taxes. Control and recovery management. "),m.qZA(),m.TgZ(82,"p"),m._UZ(83,"br"),m.TgZ(84,"b"),m._uU(85," What is the legitimacy of the processing of your data? "),m.qZA(),m._UZ(86,"br"),m._uU(87," The legal basis is the acceptance of a contractual relationship, or your consent when contacting us or offering us your products by any means. "),m.qZA()()()(),m.TgZ(88,"div",1)(89,"ul",4)(90,"li"),m._uU(91," JOB APPLICANTS "),m.TgZ(92,"p"),m._UZ(93,"br"),m.TgZ(94,"b"),m._uU(95," What purposes will we process your personal data for? "),m.qZA(),m._UZ(96,"br"),m._uU(97," Organization of selection processes for the hiring of employees. Summoning you for job interviews and evaluating your candidacy. If you have given us your consent, we may transfer it to collaborating or related companies, solely to help you find employment. "),m.qZA(),m.TgZ(98,"p"),m._UZ(99,"br"),m.TgZ(100,"b"),m._uU(101," For how long will we keep personal data? "),m.qZA(),m._UZ(102,"br"),m._uU(103," Likewise, we inform you that one year after receiving your resume, we will proceed to its secure destruction. "),m._UZ(104,"br"),m.qZA(),m.TgZ(105,"p"),m._UZ(106,"br"),m.TgZ(107,"b"),m._uU(108," What is the legitimacy of the processing of your data? "),m.qZA(),m._UZ(109,"br"),m._uU(110," The legal basis is your unequivocal consent, by sending us your CV. "),m._UZ(111,"br"),m.qZA()()()(),m.TgZ(112,"div",1)(113,"b"),m._uU(114," Do we include the personal data of third parties? "),m.qZA(),m._UZ(115,"br"),m._uU(116," No, as a general rule, we only process the data provided by the owners. If you provide us with data from third parties, you must, beforehand, inform and request their consent, or otherwise exempt us from any responsibility for non-compliance with this requirement. "),m._UZ(117,"br"),m.TgZ(118,"b"),m._uU(119," And data from minors? "),m.qZA(),m._UZ(120,"br"),m._uU(121," We do not process data of minors under 14 years of age without the consent of the father, mother, or legal guardian. Therefore, refrain from providing them if you are under that age or, if applicable, from providing data from third parties who do not have said age. LOOP INTERMODAL LLC exempts itself from any responsibility for non-compliance with this provision. "),m._UZ(122,"br"),m.TgZ(123,"b"),m._uU(124," Will we carry out electronic communications? "),m.qZA(),m._UZ(125,"br"),m._uU(126," They are only carried out to manage your request if it is one of the contact methods you have provided us. "),m._UZ(127,"br"),m._uU(128," If we carry out commercial communications, they will have been previously and expressly authorized by you. "),m.qZA(),m.TgZ(129,"div",1)(130,"b"),m._uU(131," TO WHOM WILL WE COMMUNICATE YOUR DATA? "),m.qZA(),m.TgZ(132,"p"),m._uU(133," In the terms described in the section on the purposes of the processing, LOOP INTERMODAL LLC may communicate your personal data to the following entities: Public authorities, regulators, or governmental or jurisdictional bodies in those cases where it is necessary to do so by law, local regulations, or in compliance with regulatory obligations. Among others, to tax administrations. "),m._UZ(134,"br"),m._uU(135," If you request the portability of your data, your personal data will be transferred to the entity you designate. "),m.qZA()(),m.TgZ(136,"div",1)(137,"b"),m._uU(138," INTERNATIONAL DATA TRANSFERS "),m.qZA(),m.TgZ(139,"p"),m._uU(140," As a general rule, data transfers to third parties or servers outside the legislation area are not made. However, in those exceptional cases where such international transfers occur, the necessary measures will be taken to ensure that they are made to a country or organization that has offered adequate guarantees or they may be based on the legitimizing principles established by regulations. "),m.qZA()(),m.TgZ(141,"div",1)(142,"b"),m._uU(143," FOR HOW LONG WILL WE STORE YOUR DATA? "),m.qZA(),m.TgZ(144,"p"),m._uU(145," We will process your data as long as they are necessary for the purpose for which they were collected, and once the relationship that legitimizes the processing of your data has ended, they will be stored and blocked solely to formulate and defend claims and the timely transfer at the request of the authorities, only for the time established by law. Likewise, once the contractual relationship has ended, we will process your personal data for sending commercial communications, provided that we have express consent for it. "),m.qZA()(),m.TgZ(146,"div",1)(147,"b"),m._uU(148," AUTOMATED DECISIONS AND PROFILING "),m.qZA(),m.TgZ(149,"p"),m._uU(150," The entity will not create profiles or make automated decisions. "),m.qZA()(),m.TgZ(151,"div",1)(152,"b"),m._uU(153," WHAT ARE YOUR RIGHTS? "),m.qZA(),m.TgZ(154,"p"),m._uU(155," We inform you that, per current regulations, you have the right to revoke the consent given, as well as to exercise your rights of access, rectification, deletion, limitation, and opposition, as well as the right to data portability and not to be subject to automated decisions. "),m.qZA()(),m.TgZ(156,"div",1)(157,"b"),m._uU(158," HOW CAN YOU EXERCISE YOUR RIGHTS? "),m.qZA(),m.TgZ(159,"p"),m._uU(160," Under applicable legislation, we inform you that you can exercise your rights by contacting us at the following email address:"),m.TgZ(161,"a",3),m._uU(162,"info@loopintermodal.com"),m.qZA(),m._uU(163," indicating the reason for your request and the right you wish to exercise. "),m.qZA()(),m.TgZ(164,"div",1)(165,"b"),m._uU(166," MODIFICATION OF THE PRIVACY POLICY "),m.qZA(),m.TgZ(167,"p"),m._uU(168," LOOP INTERMODAL LLC may totally or partially modify this Privacy Policy if required by applicable law. If you require us to delete your information, please contact us at "),m.TgZ(169,"a",3),m._uU(170,"info@loopintermodal.com"),m.qZA()()()())}})}return B})();function ne(B,Ae){1&B&&m._UZ(0,"app-policy")}function ue(B,Ae){1&B&&m._UZ(0,"app-avisop")}function Ce(B,Ae){1&B&&m._UZ(0,"img",15)}function Ze(B,Ae){1&B&&m._UZ(0,"img",16)}const ke=function(){return{width:"30vw"}},tt=function(){return{"960px":"90vw"}},Je=[{path:"",children:[{path:"",component:Ni},{path:"services/:id",component:Fn},{path:"contact",component:X},{path:"aviso",component:(()=>{class B{constructor(C,j,ce,je,nt){this.navigation=C,this.translate=j,this.fb=ce,this.validator=je,this.sanitizer=nt,this.style="mapbox://styles/mapbox/streets-v11",this.lat=26.507855368773555,this.lng=-80.19337591520025,this.displayConfirmation=!1,this.lang="",this.isError=!1,this.titleMesasge="",this.message="",this.formContact=this.fb.group({name:["",[Ot.kI.required]],surname:["",[Ot.kI.required]],email:["",[Ot.kI.required,Ot.kI.email]],phone:["",[Ot.kI.required,Ot.kI.minLength(10)]],business:["",[Ot.kI.required]],contactReason:["",[Ot.kI.required]],notes:["",[Ot.kI.required]]}),C.navigateToTop(250),this.pdf=this.sanitizer.bypassSecurityTrustResourceUrl("/assets/docs/"+this.translate.instant("notice.file")),this.lang=this.translate.instant("notice.file")}ngOnInit(){this.map=new li.Map({accessToken:Mr.N.mapbox.accessToken,container:"map",style:this.style,zoom:11,center:[this.lng,this.lat]}),this.map.addControl(new li.NavigationControl);const C=this.translate.instant("contact.marker_title");new li.Marker({color:"red"}).setLngLat([this.lng,this.lat]).setPopup((new li.Popup).setHTML(`\n          <h6><b>${C} - ${this.translate.instant("contact.us_office")}</b></h6>\n          <a href="https://maps.google.com/?q=${this.lat},${this.lng}" target="_blank">Directions</a>\n        `)).addTo(this.map),new li.Marker({color:"red"}).setLngLat([-99.16715885989345,19.41910444939983]).setPopup((new li.Popup).setHTML(`\n          <h6><b>${C} - ${this.translate.instant("contact.mexico_office")}</b></h6>\n          <a href="https://maps.google.com/?q=19.41910444939983,-99.16715885989345" target="_blank">Directions</a>\n        `)).addTo(this.map),new li.Marker({color:"red"}).setLngLat([-3.692818357723195,40.44846225129876]).setPopup((new li.Popup).setHTML(`\n          <h6><b>${C} - ${this.translate.instant("contact.europe_office")}</b></h6>\n          <a href="https://maps.google.com/?q=40.44846225129876,-3.692818357723195" target="_blank">Directions</a>\n        `)).addTo(this.map)}submitContact(){this.formContact.valid&&(this.message="",this.titleMesasge="")}closeContact(){this.isError||this.formContact.reset(),this.displayConfirmation=!1}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static#e=this.\u0275fac=function(j){return new(j||B)(m.Y36(Rn.f),m.Y36(Se.sK),m.Y36(Ot.qu),m.Y36(Mn.o),m.Y36(ie.H7))};static#t=this.\u0275cmp=m.Xpm({type:B,selectors:[["app-aviso"]],decls:29,vars:28,consts:[[1,"contact-container"],[1,"header"],[1,"container","padding-50"],[1,"row"],[1,"col-8"],[1,"info","padding-50"],[1,"container"],[1,"col-12"],[4,"ngIf"],[1,"confirmation-dialog",3,"visible","modal","breakpoints","draggable","resizable","closeOnEscape","visibleChange"],["src","/assets/img/success.png","class","mb-3",4,"ngIf"],["src","/assets/img/error.png","class","mb-3",4,"ngIf"],[3,"innerHTML"],["type","button",1,"btn","btn-primary","w-100",3,"click"],[1,"mb-0"],["src","/assets/img/success.png",1,"mb-3"],["src","/assets/img/error.png",1,"mb-3"]],template:function(j,ce){1&j&&(m.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h1"),m._uU(6),m.ALo(7,"uppercase"),m.ALo(8,"translate"),m.qZA()()()()(),m.TgZ(9,"div",5)(10,"div",6)(11,"div",3)(12,"div",7),m.YNc(13,ne,1,0,"app-policy",8),m.YNc(14,ue,1,0,"app-avisop",8),m.qZA()()()(),m.TgZ(15,"p-dialog",9),m.NdJ("visibleChange",function(nt){return ce.displayConfirmation=nt}),m.YNc(16,Ce,1,0,"img",10),m.YNc(17,Ze,1,0,"img",11),m.TgZ(18,"h3"),m._uU(19),m.ALo(20,"uppercase"),m.qZA(),m._UZ(21,"p",12)(22,"hr"),m.TgZ(23,"button",13),m.NdJ("click",function(){return ce.closeContact()}),m._uU(24),m.ALo(25,"uppercase"),m.ALo(26,"translate"),m.qZA(),m._UZ(27,"hr",14),m.qZA(),m._UZ(28,"app-footer"),m.qZA()),2&j&&(m.xp6(6),m.hij(" ",m.lcZ(7,16,m.lcZ(8,18,"notice.title"))," "),m.xp6(7),m.Q6J("ngIf",""!==ce.lang&&"notice-en.pdf"==ce.lang),m.xp6(1),m.Q6J("ngIf",""!==ce.lang&&"notice-es.pdf"==ce.lang),m.xp6(1),m.Akn(m.DdM(26,ke)),m.Q6J("visible",ce.displayConfirmation)("modal",!0)("breakpoints",m.DdM(27,tt))("draggable",!1)("resizable",!1)("closeOnEscape",!1),m.xp6(1),m.Q6J("ngIf",!ce.isError),m.xp6(1),m.Q6J("ngIf",ce.isError),m.xp6(2),m.Oqu(m.lcZ(20,20,ce.titleMesasge)),m.xp6(2),m.Q6J("innerHTML",ce.message,m.oJD),m.xp6(3),m.hij(" ",m.lcZ(25,22,m.lcZ(26,24,"contact.message_button"))," "))},dependencies:[ai.O5,a.c,le,ae,Un.V,ai.gd,Se.X$],styles:[".info-text[_ngcontent-%COMP%]{color:#757783}.email[_ngcontent-%COMP%]{text-decoration:underline}.contact-container[_ngcontent-%COMP%]{margin-top:60px}.contact-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:#fff;background-image:url(/assets/img/logo-dashboard.png);background-repeat:no-repeat;background-position-x:100%}.contact-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{line-height:88px}.contact-container[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{background-color:#add8e6;height:275px}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{background-color:#f4f5f6}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .office-text[_ngcontent-%COMP%]{color:var(--color-primary-pink);font-weight:700;font-size:22px}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{background-color:#fff;padding:25px;border-radius:7px}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:125px}.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .office-container[_ngcontent-%COMP%]{margin-bottom:100px}@media (min-width: 0px) and (max-width: 991px){.contact-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .office-container[_ngcontent-%COMP%]{margin-bottom:30px}}.padding-50[_ngcontent-%COMP%]{padding-top:50px;padding-bottom:50px}  .mapboxgl-ctrl-bottom-right{display:none!important}  .confirmation-dialog .p-dialog-header{display:none!important}  .confirmation-dialog .p-dialog-content{border-radius:6px!important;padding-top:2rem!important}"]})}return B})()},{path:"**",redirectTo:""}]}];let ot=(()=>{class B{static#e=this.\u0275fac=function(j){return new(j||B)};static#t=this.\u0275mod=m.oAB({type:B});static#i=this.\u0275inj=m.cJS({imports:[ln.Bz.forChild(Je),ln.Bz]})}return B})();var ft=Et(2552);Et(5619),Et(8645),Et(2572),Et(4664),Et(8180),Et(7398),Et(9773);let ao=(()=>{class B{}return B.\u0275fac=function(C){return new(C||B)},B.\u0275mod=m.oAB({type:B}),B.\u0275inj=m.cJS({}),B})();var Di=Et(3807);let ri=(()=>{class B{static#e=this.\u0275fac=function(j){return new(j||B)};static#t=this.\u0275mod=m.oAB({type:B});static#i=this.\u0275inj=m.cJS({providers:[$i],imports:[ai.ez,ot,ft.m,ao,Se.aw,Ui,Di.kW,Ot.u5,ft.m,Ot.UX,Un.S]})}return B})()},2574:function(Ju){Ju.exports=function(){"use strict";var Co,Et,ai;function ln(a,Se){if(Co)if(Et){var vn="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Co+")(sharedChunk); ("+Et+")(sharedChunk); self.onerror = null;",Qi={};Co(Qi),ai=Se(Qi),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(ai.workerUrl=window.URL.createObjectURL(new Blob([vn],{type:"text/javascript"})))}else Et=Se;else Co=Se}return ln(0,function(a){var Se=typeof self<"u"?self:{},vn="2.12.1";let Qi;const pt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Qi){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Qi=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{Qi=t}}return Qi},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ut={supported:!1,testSupport:function(t){!bn&&Mi&&(Gr?qr(t):xi=t)}};let xi,Mi,bn=!1,Gr=!1;function qr(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Mi),t.isContextLost())return;ut.supported=!0}catch{}t.deleteTexture(e),bn=!0}Se.document&&(Mi=Se.document.createElement("img"),Mi.onload=function(){xi&&qr(xi),xi=null,Gr=!0},Mi.onerror=function(){bn=!0,xi=null},Mi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const cn="01";var gr=yr;function yr(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}yr.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var s=this.sampleCurveX(i)-t;if(Math.abs(s)<e)return i;var c=this.sampleCurveDerivativeX(i);if(Math.abs(c)<1e-6)break;i-=s/c}var u=0,p=1;for(i=t,r=0;r<20&&(s=this.sampleCurveX(i),!(Math.abs(s-t)<e));r++)t>s?u=i:p=i,i=.5*(p-u)+u;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Be=Fi;function Fi(t,e){this.x=t,this.y=e}Fi.prototype={clone:function(){return new Fi(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),s=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fi.convert=function(t){return t instanceof Fi?t:Array.isArray(t)?new Fi(t[0],t[1]):t};const wn=Math.PI/180,Io=180/Math.PI;function vt(t){return t*wn}function di(t){return t*Io}const rs=[[0,0],[1,0],[1,1],[0,1]];function Ao(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function $r(t,e,i,r){const s=new gr(t,e,i,r);return function(c){return s.solve(c)}}const Wr=$r(.25,.1,.25,1);function _t(t,e,i){return Math.min(i,Math.max(e,t))}function Xr(t,e,i){return(i=_t((i-t)/(e-t),0,1))*i*(3-2*i)}function tr(t,e,i){const r=i-e,s=((t-e)%r+r)%r+e;return s===e?i:s}function zn(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const s=new Array(t.length);let c=null;t.forEach((u,p)=>{e(u,(_,g)=>{_&&(c=_),s[p]=g,0==--r&&i(c,s)})})}function ir(t){const e=[];for(const i in t)e.push(t[i]);return e}function ni(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}let xr=1;function Hr(){return xr++}function Tn(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function hn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function nr(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function kn(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Ui(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Dn(t,e,i){const r={};for(const s in t)r[s]=e.call(i||this,t[s],s,t);return r}function Yr(t,e,i){const r={};for(const s in t)e.call(i||this,t[s],s,t)&&(r[s]=t[s]);return r}function Zi(t){return Array.isArray(t)?t.map(Zi):"object"==typeof t&&t?Dn(t,Zi):t}const So={};function ti(t){So[t]||(typeof console<"u"&&console.warn(t),So[t]=!0)}function qi(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Mt(t){let e=0;for(let i,r,s=0,c=t.length,u=c-1;s<c;u=s++)i=t[s],r=t[u],e+=(r.x-i.x)*(i.y+r.y);return e}function en(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function tn(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,s,c)=>{const u=s||c;return e[r]=!u||u.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let En=null;function vr(t){if(null==En){const e=t.navigator?t.navigator.userAgent:null;En=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return En}function Jr(t){try{const e=Se[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Pn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const br="mapbox-tiles";let Ti,Ln,wr=500,Kr=50;function Tr(){try{return Se.caches}catch{}}function On(){Tr()&&!Ti&&(Ti=Se.caches.open(br))}function Qr(t){const e=t.indexOf("?");if(e<0)return t;const r=function(s){const c=s.indexOf("?");return c>0?s.slice(c+1).split("&"):[]}(t).filter(s=>{const c=s.split("=");return"language"===c[0]||"worldview"===c[0]});return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let Er=1/0;const Ni={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ni);class eo extends Error{constructor(e,i,r){401===i&&Un(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Rn=en()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Se.location.protocol?Se.parent:Se).location.href,Bn=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Rn())&&!/^\w+:/.test(i))){if(Se.fetch&&Se.Request&&Se.AbortController&&Se.Request.prototype.hasOwnProperty("signal"))return function(r,s){const c=new Se.AbortController,u=new Se.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:Rn(),signal:c.signal});let p=!1,_=!1;const g=(v=u.url).indexOf("sku=")>0&&Un(v);var v;"json"===r.type&&u.headers.set("Accept","application/json");const w=(I,A,k)=>{if(_)return;if(I&&"SecurityError"!==I.message&&ti(I),A&&k)return T(A);const L=Date.now();Se.fetch(u).then(W=>{if(W.ok){const J=g?W.clone():null;return T(W,J,L)}return s(new eo(W.statusText,W.status,r.url))}).catch(W=>{20!==W.code&&s(new Error(W.message))})},T=(I,A,k)=>{("arrayBuffer"===r.type?I.arrayBuffer():"json"===r.type?I.json():I.text()).then(L=>{_||(A&&k&&function(W,J,$){if(On(),!Ti)return;const Y={status:J.status,statusText:J.statusText,headers:new Se.Headers};J.headers.forEach((fe,pe)=>Y.headers.set(pe,fe));const ee=tn(J.headers.get("Cache-Control")||"");if(ee["no-store"])return;ee["max-age"]&&Y.headers.set("Expires",new Date($+1e3*ee["max-age"]).toUTCString());const K=Y.headers.get("Expires");K&&(new Date(K).getTime()-$<42e4||function(fe,pe){if(void 0===Ln)try{new Response(new ReadableStream),Ln=!0}catch{Ln=!1}Ln?pe(fe.body):fe.blob().then(pe)}(J,fe=>{const pe=new Se.Response(fe,Y);On(),Ti&&Ti.then(we=>we.put(Qr(W.url),pe)).catch(we=>ti(we.message))}))}(u,A,k),p=!0,s(null,L,I.headers.get("Cache-Control"),I.headers.get("Expires")))}).catch(L=>{_||s(new Error(L.message))})};return g?function(I,A){if(On(),!Ti)return A(null);const k=Qr(I.url);Ti.then(L=>{L.match(k).then(W=>{const J=function($){if(!$)return!1;const Y=new Date($.headers.get("Expires")||0),ee=tn($.headers.get("Cache-Control")||"");return Y>Date.now()&&!ee["no-cache"]}(W);L.delete(k),J&&L.put(k,W.clone()),A(null,W,J)}).catch(A)}).catch(A)}(u,w):w(null,null),{cancel:()=>{_=!0,p||c.abort()}}}(t,e);if(en()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,s){const c=new Se.XMLHttpRequest;c.open(r.method||"GET",r.url,!0),"arrayBuffer"===r.type&&(c.responseType="arraybuffer");for(const u in r.headers)c.setRequestHeader(u,r.headers[u]);return"json"===r.type&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials="include"===r.credentials,c.onerror=()=>{s(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||0===c.status)&&null!==c.response){let u=c.response;if("json"===r.type)try{u=JSON.parse(c.response)}catch(p){return s(p)}s(null,u,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else s(new eo(c.statusText,c.status,r.url))},c.send(r.body),{cancel:()=>c.abort()}}(t,e)},Fn=function(t,e){return Bn(ni(t,{type:"arrayBuffer"}),e)};function li(t){const e=Se.document.createElement("a");return e.href=t,e.protocol===Se.document.location.protocol&&e.host===Se.document.location.host}const Mr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ot,Mn;Ot=[],Mn=0;const Cr=function(t,e){if(ut.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Mn>=pt.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ot.push(c),c}Mn++;let i=!1;const r=()=>{if(!i)for(i=!0,Mn--;Ot.length&&Mn<pt.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Ot.shift(),{requestParameters:u,callback:p,cancelled:_}=c;_||(c.cancel=Cr(u,p).cancel)}},s=Fn(t,(c,u,p,_)=>{r(),c?e(c):u&&(Se.createImageBitmap?function(g,v){const w=new Se.Blob([new Uint8Array(g)],{type:"image/png"});Se.createImageBitmap(w).then(T=>{v(null,T)}).catch(T=>{v(new Error(`Could not load image because of ${T.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(u,(g,v)=>e(g,v,p,_)):function(g,v){const w=new Se.Image,T=Se.URL;w.onload=()=>{v(null,w),T.revokeObjectURL(w.src),w.onload=null,Se.requestAnimationFrame(()=>{w.src=Mr})},w.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Se.Blob([new Uint8Array(g)],{type:"image/png"});w.src=g.byteLength?T.createObjectURL(I):Mr}(u,(g,v)=>e(g,v,p,_)))});return{cancel:()=>{s.cancel(),r()}}},Ir="NO_ACCESS_TOKEN";function $i(t){return 0===t.indexOf("mapbox:")}function Un(t){return pt.API_URL_REGEX.test(t)}function zo(t){return pt.API_CDN_URL_REGEX.test(t)}function Ar(t){return pt.API_STYLE_REGEX.test(t)&&!rr(t)}function rr(t){return pt.API_SPRITE_REGEX.test(t)}const Sr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function nn(t){const e=t.match(Sr);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Zn(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function to(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Se.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class G{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=to(pt.ACCESS_TOKEN);let r="";return r=i&&i.u?Se.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(s,c)=>String.fromCharCode(+("0x"+c)))):pt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=Jr("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const s=Se.localStorage.getItem(i);s&&(this.eventData=JSON.parse(s));const c=Se.localStorage.getItem(r);c&&(this.anonId=c)}catch{ti("Unable to read from LocalStorage")}}saveEventData(){const e=Jr("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{Se.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&Se.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{ti("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,s){if(!pt.EVENTS_URL)return;const c=nn(pt.EVENTS_URL);c.params.push(`access_token=${s||pt.ACCESS_TOKEN||""}`);const u={event:this.type,created:new Date(e).toISOString()},p=i?ni(u,i):u,_={url:Zn(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};var v;this.pendingRequest=(v=g=>{this.pendingRequest=null,r(g),this.saveEventData(),this.processRequests(s)},Bn(ni(_,{method:"POST"}),v))}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const S=new class extends G{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){pt.EVENTS_URL&&pt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>$i(i)||Un(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=to(pt.ACCESS_TOKEN),i=e?e.u:pt.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;nr(this.anonId)||(this.anonId=Tn(),r=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),u=new Date(s),p=(s-this.eventData.lastSuccess)/864e5;r=r||p>=1||p<-1||c.getDate()!==u.getDate()}else r=!0;r?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:vn,skuId:cn,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=s,this.eventData.tokenU=i)},t):this.processRequests()}},D=S.postTurnstileEvent.bind(S),V=new class extends G{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,pt.EVENTS_URL&&(i||pt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Ir)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),nr(this.anonId)||(this.anonId=Tn()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:vn,skuId:cn,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}},X=V.postMapLoadEvent.bind(V),ie=new class extends G{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){pt.EVENTS_URL&&(t||pt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(s){const c=Se.performance.getEntriesByType("resource"),u=Se.performance.getEntriesByType("mark"),p=function(T){const I={};if(T)for(const A in T)if("other"!==A)for(const k of T[A]){const L=`${A}ResolveRangeMin`,W=`${A}ResolveRangeMax`,J=`${A}RequestCount`,$=`${A}RequestCachedCount`;I[L]=Math.min(I[L]||1/0,k.startTime),I[W]=Math.max(I[W]||-1/0,k.responseEnd);const Y=ee=>{void 0===I[ee]&&(I[ee]=0),++I[ee]};void 0!==k.transferSize&&0===k.transferSize&&Y($),Y(J)}return I}(function(T,I){const A={};if(T)for(const k of T){const L=I(k);void 0===A[L]&&(A[L]=[]),A[L].push(k)}return A}(c,ke)),_=Se.devicePixelRatio,g=Se.navigator.connection||Se.navigator.mozConnection||Se.navigator.webkitConnection,v={counters:[],metadata:[],attributes:[]},w=(T,I,A)=>{null!=A&&T.push({name:I,value:A.toString()})};for(const T in p)w(v.counters,T,p[T]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(w(v.counters,"interactionRangeMin",s.interactionRange[0]),w(v.counters,"interactionRangeMax",s.interactionRange[1])),u)for(const T of Object.keys(Ce)){const I=Ce[T],A=u.find(k=>k.name===I);A&&w(v.counters,I,A.startTime)}return w(v.counters,"visibilityHidden",s.visibilityHidden),w(v.attributes,"style",function(T){if(T)for(const I of T){const A=I.name.split("?")[0];if(Ar(A)){const k=A.split("/").slice(-2);if(2===k.length)return`mapbox://styles/${k[0]}/${k[1]}`}}}(c)),w(v.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),w(v.attributes,"fogEnabled",s.fogEnabled?"true":"false"),w(v.attributes,"projection",s.projection),w(v.attributes,"zoom",s.zoom),w(v.metadata,"devicePixelRatio",_),w(v.metadata,"connectionEffectiveType",g?g.effectiveType:void 0),w(v.metadata,"navigatorUserAgent",Se.navigator.userAgent),w(v.metadata,"screenWidth",Se.screen.width),w(v.metadata,"screenHeight",Se.screen.height),w(v.metadata,"windowWidth",Se.innerWidth),w(v.metadata,"windowHeight",Se.innerHeight),w(v.metadata,"mapWidth",s.width/_),w(v.metadata,"mapHeight",s.height/_),w(v.metadata,"webglRenderer",s.renderer),w(v.metadata,"webglVendor",s.vendor),w(v.metadata,"sdkVersion",vn),w(v.metadata,"sdkIdentifier","mapbox-gl-js"),v}(i);for(const s of r.metadata);for(const s of r.counters);for(const s of r.attributes);this.postEvent(e,r,()=>{},t)}},le=ie.postPerformanceEvent.bind(ie),ae=new class extends G{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!pt.API_URL||!pt.SESSION_PATH)return;const s=nn(pt.API_URL+pt.SESSION_PATH);s.params.push(`sku=${e||""}`),s.params.push(`access_token=${r||pt.ACCESS_TOKEN||""}`);const c={url:Zn(s),headers:{"Content-Type":"text/plain"}};var p;this.pendingRequest=(p=u=>{this.pendingRequest=null,i(u),this.saveEventData(),this.processRequests(r)},Bn(ni(c,{method:"GET"}),p))}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,pt.SESSION_PATH&&pt.API_URL&&(i||pt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Ir)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}},ne=ae.getSessionAPI.bind(ae),ue=new Set,Ce={create:"create",load:"load",fullLoad:"fullLoad"},Ze={mark(t){Se.performance.mark(t)},measure(t,e,i){Se.performance.measure(t,e,i)}};function ke(t){const e=t.name.split("?")[0];return zo(e)&&e.includes("mapbox-gl.js")?"javascript":zo(e)&&e.includes("mapbox-gl.css")?"css":pt.API_FONTS_REGEX.test(e)?"fontRange":rr(e)?"sprite":Ar(e)?"style":pt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const tt=Se.performance;function Ke(t){const e=t?t.url.toString():void 0;return tt.getEntriesByName(e)}let Je,ot,ft,ct;const We={now:()=>void 0!==ft?ft:Se.performance.now(),setNow(t){ft=t},restoreNow(){ft=void 0},frame(t){const e=Se.requestAnimationFrame(t);return{cancel:()=>Se.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;ct||(ct=Se.document.createElement("canvas"));const s=ct.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return(i>ct.width||r>ct.height)&&(ct.width=i,ct.height=r),s.clearRect(-e,-e,i+2*e,r+2*e),s.drawImage(t,0,0,i,r),s.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(Je||(Je=Se.document.createElement("a")),Je.href=t,Je.href),get devicePixelRatio(){return Se.devicePixelRatio},get prefersReducedMotion(){return!!Se.matchMedia&&(null==ot&&(ot=Se.matchMedia("(prefers-reduced-motion: reduce)")),ot.matches)}};function Ct(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function jt(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class Ei{constructor(e,i={}){ni(this,i),this.type=e}}class ki extends Ei{constructor(e,i={}){super("error",ni({error:e},i))}}class Ut{on(e,i){return this._listeners=this._listeners||{},Ct(e,i,this._listeners),this}off(e,i){return jt(e,i,this._listeners),jt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ct(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){"string"==typeof e&&(e=new Ei(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const s=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const p of s)p.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const p of c)jt(r,p,this._oneTimeListeners),p.call(this,e);const u=this._eventedParent;u&&(ni(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(e))}else e instanceof ki&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function pi(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function ii(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function un(t){if(Array.isArray(t))return t.map(un);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=un(t[i]);return e}return ii(t)}class Ns extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Ht=Ns;class ko{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,s]of i)this.bindings[r]=s}concat(e){return new ko(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var os=ko;const vi={kind:"null"},Ne={kind:"number"},bt={kind:"string"},gt={kind:"boolean"},rn={kind:"color"},or={kind:"object"},mt={kind:"value"},io={kind:"collator"},sr={kind:"formatted"},Nn={kind:"resolvedImage"};function bi(t,e){return{kind:"array",itemType:t,N:e}}function Qt(t){if("array"===t.kind){const e=Qt(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const dn=[vi,Ne,bt,gt,rn,sr,or,bi(mt),Nn];function no(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!no(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const i of dn)if(!no(i,e))return null}return`Expected ${Qt(t)} but found ${Qt(e)} instead.`}function ro(t,e){return e.some(i=>i.kind===t.kind)}function oo(t,e){return e.some(i=>"null"===i?null===t:"array"===i?Array.isArray(t):"object"===i?t&&!Array.isArray(t)&&"object"==typeof t:i===typeof t)}var so,ss={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ar(t){return(t=Math.round(t))<0?0:t>255?255:t}function ao(t){return ar("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function as(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Vs(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{so={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in ss)return ss[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),s=i.indexOf(")");if(-1!==r&&s+1===i.length){var c=i.substr(0,r),u=i.substr(r+1,s-(r+1)).split(","),p=1;switch(c){case"rgba":if(4!==u.length)return null;p=as(u.pop());case"rgb":return 3!==u.length?null:[ao(u[0]),ao(u[1]),ao(u[2]),p];case"hsla":if(4!==u.length)return null;p=as(u.pop());case"hsl":if(3!==u.length)return null;var _=(parseFloat(u[0])%360+360)%360/360,g=as(u[1]),v=as(u[2]),w=v<=.5?v*(g+1):v+g-v*g,T=2*v-w;return[ar(255*Vs(T,w,_+1/3)),ar(255*Vs(T,w,_)),ar(255*Vs(T,w,_-1/3)),p];default:return null}}return null}}catch{}class Di{constructor(e,i,r,s=1){this.r=e,this.g=i,this.b=r,this.a=s}static parse(e){if(!e)return;if(e instanceof Di)return e;if("string"!=typeof e)return;const i=so(e);return i?new Di(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,s]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${s})`}toArray(){const{r:e,g:i,b:r,a:s}=this;return 0===s?[0,0,0,0]:[255*e/s,255*i/s,255*r/s,s]}toArray01(){const{r:e,g:i,b:r,a:s}=this;return 0===s?[0,0,0,0]:[e/s,i/s,r/s,s]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a:s}=this;return[e,i,r,s]}}Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1),Di.blue=new Di(0,0,1,1);var ri=Di;class B{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ae{constructor(e,i,r,s,c){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=s,this.textColor=c}}class C{constructor(e){this.sections=e}static fromString(e){return new C([new Ae(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof C?e:C.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class j{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new j({name:e,available:!1}):null}serialize(){return["image",this.name]}}function ce(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function je(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof ri||t instanceof B||t instanceof C||t instanceof j)return!0;if(Array.isArray(t)){for(const e of t)if(!je(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!je(t[e]))return!1;return!0}return!1}function nt(t){if(null===t)return vi;if("string"==typeof t)return bt;if("boolean"==typeof t)return gt;if("number"==typeof t)return Ne;if(t instanceof ri)return rn;if(t instanceof B)return io;if(t instanceof C)return sr;if(t instanceof j)return Nn;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const s=nt(r);if(i){if(i===s)continue;i=mt;break}i=s}return bi(i||mt,e)}return or}function Dt(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ri||t instanceof C||t instanceof j?t.toString():JSON.stringify(t)}class on{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!je(e[1]))return i.error("invalid value");const r=e[1];let s=nt(r);const c=i.expectedType;return"array"!==s.kind||0!==s.N||!c||"array"!==c.kind||"number"==typeof c.N&&0!==c.N||(s=c),new on(s,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ri?["rgba"].concat(this.value.toArray()):this.value instanceof C?this.value.serialize():this.value}}var Cn=on,fi=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const lr={string:bt,number:Ne,boolean:gt,object:or};class Do{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,s=1;const c=e[0];if("array"===c){let p,_;if(e.length>2){const g=e[1];if("string"!=typeof g||!(g in lr)||"object"===g)return i.error('The item type argument of "array" must be one of string, number, boolean',1);p=lr[g],s++}else p=mt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);_=e[2],s++}r=bi(p,_)}else r=lr[c];const u=[];for(;s<e.length;s++){const p=i.parse(e[s],s,mt);if(!p)return null;u.push(p)}return new Do(r,u)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!no(this.type,nt(r)))return r;if(i===this.args.length-1)throw new fi(`Expected value to be of type ${Qt(this.type)}, but found ${Qt(nt(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){i.push(r.kind);const s=e.N;("number"==typeof s||this.args.length>1)&&i.push(s)}}return i.concat(this.args.map(r=>r.serialize()))}}var pn=Do;class zr{constructor(e){this.type=sr,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return i.error("First argument must be an image or text section.");const s=[];let c=!1;for(let u=1;u<=e.length-1;++u){const p=e[u];if(c&&"object"==typeof p&&!Array.isArray(p)){c=!1;let _=null;if(p["font-scale"]&&(_=i.parse(p["font-scale"],1,Ne),!_))return null;let g=null;if(p["text-font"]&&(g=i.parse(p["text-font"],1,bi(bt)),!g))return null;let v=null;if(p["text-color"]&&(v=i.parse(p["text-color"],1,rn),!v))return null;const w=s[s.length-1];w.scale=_,w.font=g,w.textColor=v}else{const _=i.parse(e[u],1,mt);if(!_)return null;const g=_.type.kind;if("string"!==g&&"value"!==g&&"null"!==g&&"resolvedImage"!==g)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,s.push({content:_,scale:null,font:null,textColor:null})}}return new zr(s)}evaluate(e){return new C(this.sections.map(i=>{const r=i.content.evaluate(e);return nt(r)===Nn?new Ae("",r,null,null,null):new Ae(Dt(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class lo{constructor(e){this.type=Nn,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const r=i.parse(e[1],1,bt);return r?new lo(r):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),r=j.fromString(i);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(i)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const js={"to-boolean":gt,"to-color":rn,"to-number":Ne,"to-string":bt};class Po{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0];if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return i.error("Expected one argument.");const s=js[r],c=[];for(let u=1;u<e.length;u++){const p=i.parse(e[u],u,mt);if(!p)return null;c.push(p)}return new Po(s,c)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let i,r;for(const s of this.args){if(i=s.evaluate(e),r=null,i instanceof ri)return i;if("string"==typeof i){const c=e.parseColor(i);if(c)return c}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ce(i[0],i[1],i[2],i[3]),!r))return new ri(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new fi(r||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const r of this.args){if(i=r.evaluate(e),null===i)return 0;const s=Number(i);if(!isNaN(s))return s}throw new fi(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?C.fromString(Dt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?j.fromString(Dt(this.args[0].evaluate(e))):Dt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new zr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new lo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Vn=Po;const co=["Unknown","Point","LineString","Polygon"];var ls=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?co[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ri.parse(t)),e}};class Lo{constructor(e,i,r,s){this.name=e,this.type=i,this._evaluate=r,this.args=s}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],s=Lo.definitions[r];if(!s)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(s)?s[0]:s.type,u=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,p=u.filter(([g])=>!Array.isArray(g)||g.length===e.length-1);let _=null;for(const[g,v]of p){_=new uo(i.registry,i.path,null,i.scope);const w=[];let T=!1;for(let I=1;I<e.length;I++){const A=e[I],k=Array.isArray(g)?g[I-1]:g.type,L=_.parse(A,1+w.length,k);if(!L){T=!0;break}w.push(L)}if(!T)if(Array.isArray(g)&&g.length!==w.length)_.error(`Expected ${g.length} arguments, but found ${w.length} instead.`);else{for(let I=0;I<w.length;I++){const A=Array.isArray(g)?g[I]:g.type,k=w[I];_.concat(I+1).checkSubtype(A,k.type)}if(0===_.errors.length)return new Lo(r,c,v,w)}}if(1===p.length)i.errors.push(..._.errors);else{const g=(p.length?p:u).map(([w])=>{return T=w,Array.isArray(T)?`(${T.map(Qt).join(", ")})`:`(${Qt(T.type)}...)`;var T}).join(" | "),v=[];for(let w=1;w<e.length;w++){const T=i.parse(e[w],1+v.length);if(!T)return null;v.push(Qt(T.type))}i.error(`Expected arguments of type ${g}, but found (${v.join(", ")}) instead.`)}return null}static register(e,i){Lo.definitions=i;for(const r in i)e[r]=Lo}}var kr=Lo;class Gs{constructor(e,i,r){this.type=io,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return i.error("Collator options argument must be an object.");const s=i.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,gt);if(!s)return null;const c=i.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,gt);if(!c)return null;let u=null;return r.locale&&(u=i.parse(r.locale,1,bt),!u)?null:new Gs(s,c,u)}evaluate(e){return new B(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ci=8192;function qs(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function cs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function tc(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(i*s*Ci),Math.round(r*s*Ci)]}function ic(t,e,i){const r=t[0]-e[0],s=t[1]-e[1],c=t[0]-i[0],u=t[1]-i[1];return r*u-c*s==0&&r*c<=0&&s*u<=0}function $s(t,e){let i=!1;for(let u=0,p=e.length;u<p;u++){const _=e[u];for(let g=0,v=_.length;g<v-1;g++){if(ic(t,_[g],_[g+1]))return!1;(s=_[g])[1]>(r=t)[1]!=(c=_[g+1])[1]>r[1]&&r[0]<(c[0]-s[0])*(r[1]-s[1])/(c[1]-s[1])+s[0]&&(i=!i)}}var r,s,c;return i}function nc(t,e){for(let i=0;i<e.length;i++)if($s(t,e[i]))return!0;return!1}function Ws(t,e,i,r){const s=r[0]-i[0],c=r[1]-i[1],u=(t[0]-i[0])*c-s*(t[1]-i[1]),p=(e[0]-i[0])*c-s*(e[1]-i[1]);return u>0&&p<0||u<0&&p>0}function hs(t,e,i){for(const g of i)for(let v=0;v<g.length-1;++v)if((p=[(u=g[v+1])[0]-(c=g[v])[0],u[1]-c[1]])[0]*(_=[(s=e)[0]-(r=t)[0],s[1]-r[1]])[1]-p[1]*_[0]!=0&&Ws(r,s,c,u)&&Ws(c,u,r,s))return!0;var r,s,c,u,p,_;return!1}function Za(t,e){for(let i=0;i<t.length;++i)if(!$s(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(hs(t[i],t[i+1],e))return!1;return!0}function rc(t,e){for(let i=0;i<e.length;i++)if(Za(t,e[i]))return!0;return!1}function us(t,e,i){const r=[];for(let s=0;s<t.length;s++){const c=[];for(let u=0;u<t[s].length;u++){const p=tc(t[s][u],i);qs(e,p),c.push(p)}r.push(c)}return r}function Na(t,e,i){const r=[];for(let s=0;s<t.length;s++){const c=us(t[s],e,i);r.push(c)}return r}function ho(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const s=.5*r;let c=t[0]-i[0]>s?-r:i[0]-t[0]>s?r:0;0===c&&(c=t[0]-i[2]>s?-r:i[2]-t[0]>s?r:0),t[0]+=c}qs(e,t)}function Pt(t,e,i,r){const s=Math.pow(2,r.z)*Ci,c=[r.x*Ci,r.y*Ci],u=[];if(!t)return u;for(const p of t)for(const _ of p){const g=[_.x+c[0],_.y+c[1]];ho(g,e,i,s),u.push(g)}return u}function oc(t,e,i,r){const s=Math.pow(2,r.z)*Ci,c=[r.x*Ci,r.y*Ci],u=[];if(!t)return u;for(const _ of t){const g=[];for(const v of _){const w=[v.x+c[0],v.y+c[1]];qs(e,w),g.push(w)}u.push(g)}if(e[2]-e[0]<=s/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const _ of u)for(const g of _)ho(g,e,i,s)}var p;return u}class ds{constructor(e,i){this.type=gt,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(je(e[1])){const r=e[1];if("FeatureCollection"===r.type)for(let s=0;s<r.features.length;++s){const c=r.features[s].geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new ds(r,r.features[s].geometry)}else if("Feature"===r.type){const s=r.geometry.type;if("Polygon"===s||"MultiPolygon"===s)return new ds(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new ds(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,r){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],u=i.canonicalID();if(!u)return!1;if("Polygon"===r.type){const p=us(r.coordinates,c,u),_=Pt(i.geometry(),s,c,u);if(!cs(s,c))return!1;for(const g of _)if(!$s(g,p))return!1}if("MultiPolygon"===r.type){const p=Na(r.coordinates,c,u),_=Pt(i.geometry(),s,c,u);if(!cs(s,c))return!1;for(const g of _)if(!nc(g,p))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,r){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],u=i.canonicalID();if(!u)return!1;if("Polygon"===r.type){const p=us(r.coordinates,c,u),_=oc(i.geometry(),s,c,u);if(!cs(s,c))return!1;for(const g of _)if(!Za(g,p))return!1}if("MultiPolygon"===r.type){const p=Na(r.coordinates,c,u),_=oc(i.geometry(),s,c,u);if(!cs(s,c))return!1;for(const g of _)if(!rc(g,p))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Va=ds;function Oo(t){if(t instanceof kr&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Va)return!1;let e=!0;return t.eachChild(i=>{e&&!Oo(i)&&(e=!1)}),e}function Xs(t){if(t instanceof kr&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(i=>{e&&!Xs(i)&&(e=!1)}),e}function ps(t,e){if(t instanceof kr&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!ps(r,e)&&(i=!1)}),i}class Hs{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new Hs(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ja=Hs;class Ys{constructor(e,i=[],r,s=new os,c=[]){this.registry=e,this.path=i,this.key=i.map(u=>`[${u}]`).join(""),this.scope=s,this.errors=c,this.expectedType=r}parse(e,i,r,s,c={}){return i?this.concat(i,r,s)._parse(e,c):this._parse(e,c)}_parse(e,i){function r(s,c,u){return"assert"===u?new pn(c,[s]):"coerce"===u?new Vn(c,[s]):s}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const s=e[0];if("string"!=typeof s)return this.error(`Expression name must be a string, but found ${typeof s} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const c=this.registry[s];if(c){let u=c.parse(e,this);if(!u)return null;if(this.expectedType){const p=this.expectedType,_=u.type;if("string"!==p.kind&&"number"!==p.kind&&"boolean"!==p.kind&&"object"!==p.kind&&"array"!==p.kind||"value"!==_.kind)if("color"!==p.kind&&"formatted"!==p.kind&&"resolvedImage"!==p.kind||"value"!==_.kind&&"string"!==_.kind){if(this.checkSubtype(p,_))return null}else u=r(u,p,i.typeAnnotation||"coerce");else u=r(u,p,i.typeAnnotation||"assert")}if(!(u instanceof Cn)&&"resolvedImage"!==u.type.kind&&Ro(u)){const p=new ls;try{u=new Cn(u.type,u.evaluate(p))}catch(_){return this.error(_.message),null}}return u}return this.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const s="number"==typeof e?this.path.concat(e):this.path,c=r?this.scope.concat(r):this.scope;return new Ys(this.registry,s,i||null,c,this.errors)}error(e,...i){const r=`${this.key}${i.map(s=>`[${s}]`).join("")}`;this.errors.push(new Ht(r,e))}checkSubtype(e,i){const r=no(e,i);return r&&this.error(r),r}}var uo=Ys;function Ro(t){if(t instanceof ja)return Ro(t.boundExpression);if(t instanceof kr&&"error"===t.name||t instanceof Gs||t instanceof Va)return!1;const e=t instanceof Vn||t instanceof pn;let i=!0;return t.eachChild(r=>{i=e?i&&Ro(r):i&&r instanceof Cn}),!!i&&Oo(t)&&ps(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Js(t,e){const i=t.length-1;let r,s,c=0,u=i,p=0;for(;c<=u;)if(p=Math.floor((c+u)/2),r=t[p],s=t[p+1],r<=e){if(p===i||e<s)return p;c=p+1}else{if(!(r>e))throw new fi("Input is not a number.");u=p-1}return 0}class fs{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[s,c]of r)this.labels.push(s),this.outputs.push(c)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,Ne);if(!r)return null;const s=[];let c=null;i.expectedType&&"value"!==i.expectedType.kind&&(c=i.expectedType);for(let u=1;u<e.length;u+=2){const p=1===u?-1/0:e[u],_=e[u+1],g=u,v=u+1;if("number"!=typeof p)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(s.length&&s[s.length-1][0]>=p)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',g);const w=i.parse(_,v,c);if(!w)return null;c=c||w.type,s.push([p,w])}return new fs(c,r,s)}evaluate(e){const i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);const s=this.input.evaluate(e);if(s<=i[0])return r[0].evaluate(e);const c=i.length;return s>=i[c-1]?r[c-1].evaluate(e):r[Js(i,s)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Ks=fs;function At(t,e,i){return t*(1-i)+e*i}var Qs=Object.freeze({__proto__:null,number:At,color:function(t,e,i){return new ri(At(t.r,e.r,i),At(t.g,e.g,i),At(t.b,e.b,i),At(t.a,e.a,i))},array:function(t,e,i){return t.map((r,s)=>At(r,e[s],i))}});const qa=4/29,ea=6/29,ac=3*ea*ea,lc=Math.PI/180,Ph=180/Math.PI;function ta(t){return t>.008856451679035631?Math.pow(t,1/3):t/ac+qa}function ia(t){return t>ea?t*t*t:ac*(t-qa)}function $a(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Wa(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function cc(t){const e=Wa(t.r),i=Wa(t.g),r=Wa(t.b),s=ta((.4124564*e+.3575761*i+.1804375*r)/.95047),c=ta((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*c-16,a:500*(s-c),b:200*(c-ta((.0193339*e+.119192*i+.9503041*r)/1.08883)),alpha:t.a}}function hc(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*ia(e),i=.95047*ia(i),r=1.08883*ia(r),new ri($a(3.2404542*i-1.5371385*e-.4985314*r),$a(-.969266*i+1.8760108*e+.041556*r),$a(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function Lh(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const ms={forward:cc,reverse:hc,interpolate:function(t,e,i){return{l:At(t.l,e.l,i),a:At(t.a,e.a,i),b:At(t.b,e.b,i),alpha:At(t.alpha,e.alpha,i)}}},Bo={forward:function(t){const{l:e,a:i,b:r}=cc(t),s=Math.atan2(r,i)*Ph;return{h:s<0?s+360:s,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*lc,i=t.c;return hc({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Lh(t.h,e.h,i),c:At(t.c,e.c,i),l:At(t.l,e.l,i),alpha:At(t.alpha,e.alpha,i)}}};var uc=Object.freeze({__proto__:null,lab:ms,hcl:Bo});class na{constructor(e,i,r,s,c){this.type=e,this.operator=i,this.interpolation=r,this.input=s,this.labels=[],this.outputs=[];for(const[u,p]of c)this.labels.push(u),this.outputs.push(p)}static interpolationFactor(e,i,r,s){let c=0;if("exponential"===e.name)c=Xa(i,e.base,r,s);else if("linear"===e.name)c=Xa(i,1,r,s);else if("cubic-bezier"===e.name){const u=e.controlPoints;c=new gr(u[0],u[1],u[2],u[3]).solve(Xa(i,1,r,s))}return c}static parse(e,i){let[r,s,c,...u]=e;if(!Array.isArray(s)||0===s.length)return i.error("Expected an interpolation type expression.",1);if("linear"===s[0])s={name:"linear"};else if("exponential"===s[0]){const g=s[1];if("number"!=typeof g)return i.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:g}}else{if("cubic-bezier"!==s[0])return i.error(`Unknown interpolation type ${String(s[0])}`,1,0);{const g=s.slice(1);if(4!==g.length||g.some(v=>"number"!=typeof v||v<0||v>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:g}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(c=i.parse(c,2,Ne),!c)return null;const p=[];let _=null;"interpolate-hcl"===r||"interpolate-lab"===r?_=rn:i.expectedType&&"value"!==i.expectedType.kind&&(_=i.expectedType);for(let g=0;g<u.length;g+=2){const v=u[g],w=u[g+1],T=g+3,I=g+4;if("number"!=typeof v)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(p.length&&p[p.length-1][0]>=v)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',T);const A=i.parse(w,I,_);if(!A)return null;_=_||A.type,p.push([v,A])}return"number"===_.kind||"color"===_.kind||"array"===_.kind&&"number"===_.itemType.kind&&"number"==typeof _.N?new na(_,r,s,c,p):i.error(`Type ${Qt(_)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);const s=this.input.evaluate(e);if(s<=i[0])return r[0].evaluate(e);const c=i.length;if(s>=i[c-1])return r[c-1].evaluate(e);const u=Js(i,s),p=na.interpolationFactor(this.interpolation,s,i[u],i[u+1]),_=r[u].evaluate(e),g=r[u+1].evaluate(e);return"interpolate"===this.operator?Qs[this.type.kind.toLowerCase()](_,g,p):"interpolate-hcl"===this.operator?Bo.reverse(Bo.interpolate(Bo.forward(_),Bo.forward(g),p)):ms.reverse(ms.interpolate(ms.forward(_),ms.forward(g),p))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function Xa(t,e,i,r){const s=r-i,c=t-i;return 0===s?0:1===e?c/s:(Math.pow(e,c)-1)/(Math.pow(e,s)-1)}var jn=na;class ra{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const s=i.expectedType;s&&"value"!==s.kind&&(r=s);const c=[];for(const p of e.slice(1)){const _=i.parse(p,1+c.length,r,void 0,{typeAnnotation:"omit"});if(!_)return null;r=r||_.type,c.push(_)}const u=s&&c.some(p=>no(s,p.type));return new ra(u?mt:r,c)}evaluate(e){let i,r=null,s=0;for(const c of this.args){if(s++,r=c.evaluate(e),r&&r instanceof j&&!r.available&&(i||(i=r),r=null,s===this.args.length))return i;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ha=ra;class oa{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let c=1;c<e.length-1;c+=2){const u=e[c];if("string"!=typeof u)return i.error(`Expected string, but found ${typeof u} instead.`,c);if(/[^a-zA-Z0-9_]/.test(u))return i.error("Variable names must contain only alphanumeric characters or '_'.",c);const p=i.parse(e[c+1],c+1);if(!p)return null;r.push([u,p])}const s=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return s?new oa(r,s):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var dc=oa;class Ya{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Ne),s=i.parse(e[2],2,bi(i.expectedType||mt));return r&&s?new Ya(s.type.itemType,r,s):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new fi(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new fi(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new fi(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var pc=Ya;class sa{constructor(e,i){this.type=gt,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,mt),s=i.parse(e[2],2,mt);return r&&s?ro(r.type,[gt,bt,Ne,vi,mt])?new sa(r,s):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!oo(i,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(nt(i))} instead.`);if(!oo(r,["string","array"]))throw new fi(`Expected second argument to be of type array or string, but found ${Qt(nt(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var fc=sa;class aa{constructor(e,i,r){this.type=Ne,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,mt),s=i.parse(e[2],2,mt);if(!r||!s)return null;if(!ro(r.type,[gt,bt,Ne,vi,mt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(r.type)} instead`);if(4===e.length){const c=i.parse(e[3],3,Ne);return c?new aa(r,s,c):null}return new aa(r,s)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!oo(i,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(nt(i))} instead.`);if(!oo(r,["string","array"]))throw new fi(`Expected second argument to be of type array or string, but found ${Qt(nt(r))} instead.`);if(this.fromIndex){const s=this.fromIndex.evaluate(e);return r.indexOf(i,s)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Oh=aa;class Ja{constructor(e,i,r,s,c,u){this.inputType=e,this.type=i,this.input=r,this.cases=s,this.outputs=c,this.otherwise=u}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,s;i.expectedType&&"value"!==i.expectedType.kind&&(s=i.expectedType);const c={},u=[];for(let g=2;g<e.length-1;g+=2){let v=e[g];const w=e[g+1];Array.isArray(v)||(v=[v]);const T=i.concat(g);if(0===v.length)return T.error("Expected at least one branch label.");for(const A of v){if("number"!=typeof A&&"string"!=typeof A)return T.error("Branch labels must be numbers or strings.");if("number"==typeof A&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return T.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof A&&Math.floor(A)!==A)return T.error("Numeric branch labels must be integer values.");if(r){if(T.checkSubtype(r,nt(A)))return null}else r=nt(A);if(void 0!==c[String(A)])return T.error("Branch labels must be unique.");c[String(A)]=u.length}const I=i.parse(w,g,s);if(!I)return null;s=s||I.type,u.push(I)}const p=i.parse(e[1],1,mt);if(!p)return null;const _=i.parse(e[e.length-1],e.length-1,s);return _?"value"!==p.type.kind&&i.concat(1).checkSubtype(r,p.type)?null:new Ja(r,s,p,c,u,_):null}evaluate(e){const i=this.input.evaluate(e);return(nt(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],s={};for(const u of i){const p=s[this.cases[u]];void 0===p?(s[this.cases[u]]=r.length,r.push([this.cases[u],[u]])):r[p][1].push(u)}const c=u=>"number"===this.inputType.kind?Number(u):u;for(const[u,p]of r)e.push(1===p.length?c(p[0]):p.map(c)),e.push(this.outputs[u].serialize());return e.push(this.otherwise.serialize()),e}}var Rh=Ja;class Fo{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&"value"!==i.expectedType.kind&&(r=i.expectedType);const s=[];for(let u=1;u<e.length-1;u+=2){const p=i.parse(e[u],u,gt);if(!p)return null;const _=i.parse(e[u+1],u+1,r);if(!_)return null;s.push([p,_]),r=r||_.type}const c=i.parse(e[e.length-1],e.length-1,r);return c?new Fo(r,s,c):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var mc=Fo;class _s{constructor(e,i,r,s){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,mt),s=i.parse(e[2],2,Ne);if(!r||!s)return null;if(!ro(r.type,[bi(mt),bt,mt]))return i.error(`Expected first argument to be of type array or string, but found ${Qt(r.type)} instead`);if(4===e.length){const c=i.parse(e[3],3,Ne);return c?new _s(r.type,r,s,c):null}return new _s(r.type,r,s)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!oo(i,["string","array"]))throw new fi(`Expected first argument to be of type array or string, but found ${Qt(nt(i))} instead.`);if(this.endIndex){const s=this.endIndex.evaluate(e);return i.slice(r,s)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Bh=_s;function _c(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gc(t,e,i,r){return 0===r.compare(e,i)}function po(t,e,i){const r="=="!==t&&"!="!==t;return class zf{constructor(c,u,p){this.type=gt,this.lhs=c,this.rhs=u,this.collator=p,this.hasUntypedArgument="value"===c.type.kind||"value"===u.type.kind}static parse(c,u){if(3!==c.length&&4!==c.length)return u.error("Expected two or three arguments.");const p=c[0];let _=u.parse(c[1],1,mt);if(!_)return null;if(!_c(p,_.type))return u.concat(1).error(`"${p}" comparisons are not supported for type '${Qt(_.type)}'.`);let g=u.parse(c[2],2,mt);if(!g)return null;if(!_c(p,g.type))return u.concat(2).error(`"${p}" comparisons are not supported for type '${Qt(g.type)}'.`);if(_.type.kind!==g.type.kind&&"value"!==_.type.kind&&"value"!==g.type.kind)return u.error(`Cannot compare types '${Qt(_.type)}' and '${Qt(g.type)}'.`);r&&("value"===_.type.kind&&"value"!==g.type.kind?_=new pn(g.type,[_]):"value"!==_.type.kind&&"value"===g.type.kind&&(g=new pn(_.type,[g])));let v=null;if(4===c.length){if("string"!==_.type.kind&&"string"!==g.type.kind&&"value"!==_.type.kind&&"value"!==g.type.kind)return u.error("Cannot use collator to compare non-string types.");if(v=u.parse(c[3],3,io),!v)return null}return new zf(_,g,v)}evaluate(c){const u=this.lhs.evaluate(c),p=this.rhs.evaluate(c);if(r&&this.hasUntypedArgument){const _=nt(u),g=nt(p);if(_.kind!==g.kind||"string"!==_.kind&&"number"!==_.kind)throw new fi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${_.kind}, ${g.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const _=nt(u),g=nt(p);if("string"!==_.kind||"string"!==g.kind)return e(c,u,p)}return this.collator?i(c,u,p,this.collator.evaluate(c)):e(c,u,p)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(u=>{c.push(u.serialize())}),c}}}const yc=po("==",function(t,e,i){return e===i},gc),xc=po("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!gc(0,e,i,r)}),Ka=po("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),Fh=po(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),Uh=po("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),Zh=po(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class Qa{constructor(e,i,r,s,c,u){this.type=bt,this.number=e,this.locale=i,this.currency=r,this.unit=s,this.minFractionDigits=c,this.maxFractionDigits=u}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const r=i.parse(e[1],1,Ne);if(!r)return null;const s=e[2];if("object"!=typeof s||Array.isArray(s))return i.error("NumberFormat options argument must be an object.");let c=null;if(s.locale&&(c=i.parse(s.locale,1,bt),!c))return null;let u=null;if(s.currency&&(u=i.parse(s.currency,1,bt),!u))return null;let p=null;if(s.unit&&(p=i.parse(s.unit,1,bt),!p))return null;let _=null;if(s["min-fraction-digits"]&&(_=i.parse(s["min-fraction-digits"],1,Ne),!_))return null;let g=null;return s["max-fraction-digits"]&&(g=i.parse(s["max-fraction-digits"],1,Ne),!g)?null:new Qa(r,c,u,p,_,g)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class el{constructor(e){this.type=Ne,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?i.error(`Expected argument of type string or array, but found ${Qt(r.type)} instead.`):new el(r):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new fi(`Expected value to be of type string or array, but found ${Qt(nt(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const vc={"==":yc,"!=":xc,">":Fh,"<":Ka,">=":Zh,"<=":Uh,array:pn,at:pc,boolean:pn,case:mc,coalesce:Ha,collator:Gs,format:zr,image:lo,in:fc,"index-of":Oh,interpolate:jn,"interpolate-hcl":jn,"interpolate-lab":jn,length:el,let:dc,literal:Cn,match:Rh,number:pn,"number-format":Qa,object:pn,slice:Bh,step:Ks,string:pn,"to-boolean":Vn,"to-color":Vn,"to-number":Vn,"to-string":Vn,var:ja,within:Va};function bc(t,[e,i,r,s]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const c=s?s.evaluate(t):1,u=ce(e,i,r,c);if(u)throw new fi(u);return new ri(e/255*c,i/255*c,r/255*c,c)}function tl(t,e){return t in e}function la(t,e){const i=e[t];return void 0===i?null:i}function Gn(t){return{type:t}}kr.register(vc,{error:[{kind:"error"},[bt],(t,[e])=>{throw new fi(e.evaluate(t))}],typeof:[bt,[mt],(t,[e])=>Qt(nt(e.evaluate(t)))],"to-rgba":[bi(Ne,4),[rn],(t,[e])=>e.evaluate(t).toArray()],rgb:[rn,[Ne,Ne,Ne],bc],rgba:[rn,[Ne,Ne,Ne,Ne],bc],has:{type:gt,overloads:[[[bt],(t,[e])=>tl(e.evaluate(t),t.properties())],[[bt,or],(t,[e,i])=>tl(e.evaluate(t),i.evaluate(t))]]},get:{type:mt,overloads:[[[bt],(t,[e])=>la(e.evaluate(t),t.properties())],[[bt,or],(t,[e,i])=>la(e.evaluate(t),i.evaluate(t))]]},"feature-state":[mt,[bt],(t,[e])=>la(e.evaluate(t),t.featureState||{})],properties:[or,[],t=>t.properties()],"geometry-type":[bt,[],t=>t.geometryType()],id:[mt,[],t=>t.id()],zoom:[Ne,[],t=>t.globals.zoom],pitch:[Ne,[],t=>t.globals.pitch||0],"distance-from-center":[Ne,[],t=>t.distanceFromCenter()],"heatmap-density":[Ne,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ne,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Ne,[],t=>t.globals.skyRadialProgress||0],accumulated:[mt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Ne,Gn(Ne),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[Ne,Gn(Ne),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:Ne,overloads:[[[Ne,Ne],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Ne],(t,[e])=>-e.evaluate(t)]]},"/":[Ne,[Ne,Ne],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Ne,[Ne,Ne],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Ne,[],()=>Math.LN2],pi:[Ne,[],()=>Math.PI],e:[Ne,[],()=>Math.E],"^":[Ne,[Ne,Ne],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Ne,[Ne],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ne,[Ne],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ne,[Ne],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ne,[Ne],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ne,[Ne],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ne,[Ne],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ne,[Ne],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ne,[Ne],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ne,[Ne],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ne,[Ne],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ne,Gn(Ne),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Ne,Gn(Ne),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Ne,[Ne],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ne,[Ne],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ne,[Ne],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ne,[Ne],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[gt,[bt,mt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[gt,[mt],(t,[e])=>t.id()===e.value],"filter-type-==":[gt,[bt],(t,[e])=>t.geometryType()===e.value],"filter-<":[gt,[bt,mt],(t,[e,i])=>{const r=t.properties()[e.value],s=i.value;return typeof r==typeof s&&r<s}],"filter-id-<":[gt,[mt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[gt,[bt,mt],(t,[e,i])=>{const r=t.properties()[e.value],s=i.value;return typeof r==typeof s&&r>s}],"filter-id->":[gt,[mt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[gt,[bt,mt],(t,[e,i])=>{const r=t.properties()[e.value],s=i.value;return typeof r==typeof s&&r<=s}],"filter-id-<=":[gt,[mt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[gt,[bt,mt],(t,[e,i])=>{const r=t.properties()[e.value],s=i.value;return typeof r==typeof s&&r>=s}],"filter-id->=":[gt,[mt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[gt,[mt],(t,[e])=>e.value in t.properties()],"filter-has-id":[gt,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[gt,[bi(bt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[gt,[bi(mt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[gt,[bt,bi(mt)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[gt,[bt,bi(mt)],(t,[e,i])=>function(r,s,c,u){for(;c<=u;){const p=c+u>>1;if(s[p]===r)return!0;s[p]>r?u=p-1:c=p+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:gt,overloads:[[[gt,gt],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Gn(gt),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:gt,overloads:[[[gt,gt],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Gn(gt),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[gt,[gt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[gt,[bt],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[bt,[bt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[bt,[bt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[bt,Gn(mt),(t,e)=>e.map(i=>Dt(i.evaluate(t))).join("")],"resolved-locale":[bt,[io],(t,[e])=>e.evaluate(t).resolvedLocale()]});var gs=vc;function wc(t){return{result:"success",value:t}}function sn(t){return{result:"error",value:t}}function fo(t){return"data-driven"===t["property-type"]}function mo(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function il(t){return!!t.expression&&t.expression.interpolated}function Lt(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function ys(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Nh(t){return t}function ca(t,e){const i="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],s=r||!(r||void 0!==t.property),c=t.type||(il(e)?"exponential":"interval");if(i&&((t=pi({},t)).stops&&(t.stops=t.stops.map(g=>[g[0],ri.parse(g[1])])),t.default=ri.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!uc[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let u,p,_;if("exponential"===c)u=rl;else if("interval"===c)u=Tc;else if("categorical"===c){u=nl,p=Object.create(null);for(const g of t.stops)p[g[0]]=g[1];_=typeof t.stops[0][0]}else{if("identity"!==c)throw new Error(`Unknown function type "${c}"`);u=ol}if(r){const g={},v=[];for(let I=0;I<t.stops.length;I++){const A=t.stops[I],k=A[0].zoom;void 0===g[k]&&(g[k]={zoom:k,type:t.type,property:t.property,default:t.default,stops:[]},v.push(k)),g[k].stops.push([A[0].value,A[1]])}const w=[];for(const I of v)w.push([g[I].zoom,ca(g[I],e)]);const T={name:"linear"};return{kind:"composite",interpolationType:T,interpolationFactor:jn.interpolationFactor.bind(void 0,T),zoomStops:w.map(I=>I[0]),evaluate:({zoom:I},A)=>rl({stops:w,base:t.base},e,I).evaluate(I,A)}}if(s){const g="exponential"===c?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:g,interpolationFactor:jn.interpolationFactor.bind(void 0,g),zoomStops:t.stops.map(v=>v[0]),evaluate:({zoom:v})=>u(t,e,v,p,_)}}return{kind:"source",evaluate(g,v){const w=v&&v.properties?v.properties[t.property]:void 0;return void 0===w?Uo(t.default,e.default):u(t,e,w,p,_)}}}function Uo(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function nl(t,e,i,r,s){return Uo(typeof i===s?r[i]:void 0,t.default,e.default)}function Tc(t,e,i){if("number"!==Lt(i))return Uo(t.default,e.default);const r=t.stops.length;if(1===r||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const s=Js(t.stops.map(c=>c[0]),i);return t.stops[s][1]}function rl(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==Lt(i))return Uo(t.default,e.default);const s=t.stops.length;if(1===s||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[s-1][0])return t.stops[s-1][1];const c=Js(t.stops.map(v=>v[0]),i),u=function(v,w,T,I){const A=I-T,k=v-T;return 0===A?0:1===w?k/A:(Math.pow(w,k)-1)/(Math.pow(w,A)-1)}(i,r,t.stops[c][0],t.stops[c+1][0]),p=t.stops[c][1],_=t.stops[c+1][1];let g=Qs[e.type]||Nh;if(t.colorSpace&&"rgb"!==t.colorSpace){const v=uc[t.colorSpace];g=(w,T)=>v.reverse(v.interpolate(v.forward(w),v.forward(T),u))}return"function"==typeof p.evaluate?{evaluate(...v){const w=p.evaluate.apply(void 0,v),T=_.evaluate.apply(void 0,v);if(void 0!==w&&void 0!==T)return g(w,T,u)}}:g(p,_,u)}function ol(t,e,i){return"color"===e.type?i=ri.parse(i):"formatted"===e.type?i=C.fromString(i.toString()):"resolvedImage"===e.type?i=j.fromString(i.toString()):Lt(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Uo(i,t.default,e.default)}class ha{constructor(e,i){var r;this.expression=e,this._warningHistory={},this._evaluator=new ls,this._defaultValue=i?"color"===(r=i).type&&(ys(r.default)||Array.isArray(r.default))?new ri(0,0,0,0):"color"===r.type?ri.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,r,s,c,u,p,_){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=s||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=u,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=_||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,s,c,u,p,_){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=u||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=_||null;try{const g=this.expression.evaluate(this._evaluator);if(null==g||"number"==typeof g&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new fi(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function xs(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in gs}function Dr(t,e){const i=new uo(gs,[],e?function(s){const c={color:rn,string:bt,number:Ne,enum:bt,boolean:gt,formatted:sr,resolvedImage:Nn};return"array"===s.type?bi(c[s.value]||mt,s.length):c[s.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?wc(new ha(r,e)):sn(i.errors)}class Pr{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!Xs(i.expression)}evaluateWithoutErrorHandling(e,i,r,s,c,u){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,s,c,u)}evaluate(e,i,r,s,c,u){return this._styleExpression.evaluate(e,i,r,s,c,u)}}class ua{constructor(e,i,r,s){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent="camera"!==e&&!Xs(i.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,i,r,s,c,u){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,s,c,u)}evaluate(e,i,r,s,c,u){return this._styleExpression.evaluate(e,i,r,s,c,u)}interpolationFactor(e,i,r){return this.interpolationType?jn.interpolationFactor(this.interpolationType,e,i,r):0}}function sl(t,e){if("error"===(t=Dr(t,e)).result)return t;const i=t.value.expression,r=Oo(i);if(!r&&!fo(e))return sn([new Ht("","data expressions not supported")]);const s=ps(i,["zoom","pitch","distance-from-center"]);if(!s&&!mo(e))return sn([new Ht("","zoom expressions not supported")]);const c=vs(i);return c||s?c instanceof Ht?sn([c]):c instanceof jn&&!il(e)?sn([new Ht("",'"interpolate" expressions cannot be used with this property')]):wc(c?new ua(r?"camera":"composite",t.value,c.labels,c instanceof jn?c.interpolation:void 0):new Pr(r?"constant":"source",t.value)):sn([new Ht("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zo{constructor(e,i){this._parameters=e,this._specification=i,pi(this,ca(this._parameters,this._specification))}static deserialize(e){return new Zo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function vs(t){let e=null;if(t instanceof dc)e=vs(t.result);else if(t instanceof Ha){for(const i of t.args)if(e=vs(i),e)break}else(t instanceof Ks||t instanceof jn)&&t.input instanceof kr&&"zoom"===t.input.name&&(e=t);return e instanceof Ht||t.eachChild(i=>{const r=vs(i);r instanceof Ht?e=r:!e&&r?e=new Ht("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Ht("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Ge{constructor(e,i,r,s){this.message=(e?`${e}: `:"")+r,s&&(this.identifier=s),null!=i&&i.__line__&&(this.line=i.__line__)}}function fn(t){const e=t.key,i=t.value,r=t.valueSpec||{},s=t.objectElementValidators||{},c=t.style,u=t.styleSpec;let p=[];const _=Lt(i);if("object"!==_)return[new Ge(e,i,`object expected, ${_} found`)];for(const g in i){const v=g.split(".")[0];let T;s[v]?T=s[v]:r[v]?T=Pi:s["*"]?T=s["*"]:r["*"]&&(T=Pi),T?p=p.concat(T({key:(e&&`${e}.`)+g,value:i[g],valueSpec:r[v]||r["*"],style:c,styleSpec:u,object:i,objectKey:g},i)):p.push(new Ge(e,i[g],`unknown property "${g}"`))}for(const g in r)s[g]||r[g].required&&void 0===r[g].default&&void 0===i[g]&&p.push(new Ge(e,i,`missing required property "${g}"`));return p}function bs(t){const e=t.value,i=t.valueSpec,r=t.style,s=t.styleSpec,c=t.key,u=t.arrayElementValidator||Pi;if("array"!==Lt(e))return[new Ge(c,e,`array expected, ${Lt(e)} found`)];if(i.length&&e.length!==i.length)return[new Ge(c,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Ge(c,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let p={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};s.$version<7&&(p.function=i.function),"object"===Lt(i.value)&&(p=i.value);let _=[];for(let g=0;g<e.length;g++)_=_.concat(u({array:e,arrayIndex:g,value:e[g],valueSpec:p,style:r,styleSpec:s,key:`${c}[${g}]`}));return _}function Ec(t){const e=t.key,i=t.value,r=t.valueSpec;let s=Lt(i);if("number"===s&&i!=i&&(s="NaN"),"number"!==s)return[new Ge(e,i,`number expected, ${s} found`)];if("minimum"in r){let c=r.minimum;if("array"===Lt(r.minimum)&&(c=r.minimum[t.arrayIndex]),i<c)return[new Ge(e,i,`${i} is less than the minimum value ${c}`)]}if("maximum"in r){let c=r.maximum;if("array"===Lt(r.maximum)&&(c=r.maximum[t.arrayIndex]),i>c)return[new Ge(e,i,`${i} is greater than the maximum value ${c}`)]}return[]}function Mc(t){const e=t.valueSpec,i=ii(t.value.type);let r,s,c,u={};const p="categorical"!==i&&void 0===t.value.property,_=!p,g="array"===Lt(t.value.stops)&&"array"===Lt(t.value.stops[0])&&"object"===Lt(t.value.stops[0][0]),v=fn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(I){if("identity"===i)return[new Ge(I.key,I.value,'identity function may not have a "stops" property')];let A=[];const k=I.value;return A=A.concat(bs({key:I.key,value:k,valueSpec:I.valueSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:w})),"array"===Lt(k)&&0===k.length&&A.push(new Ge(I.key,k,"array must have at least one stop")),A},default:function(I){return Pi({key:I.key,value:I.value,valueSpec:e,style:I.style,styleSpec:I.styleSpec})}}});return"identity"===i&&p&&v.push(new Ge(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||v.push(new Ge(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!il(t.valueSpec)&&v.push(new Ge(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(_&&!fo(t.valueSpec)?v.push(new Ge(t.key,t.value,"property functions not supported")):p&&!mo(t.valueSpec)&&v.push(new Ge(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!g||void 0!==t.value.property||v.push(new Ge(t.key,t.value,'"property" property is required')),v;function w(I){let A=[];const k=I.value,L=I.key;if("array"!==Lt(k))return[new Ge(L,k,`array expected, ${Lt(k)} found`)];if(2!==k.length)return[new Ge(L,k,`array length 2 expected, length ${k.length} found`)];if(g){if("object"!==Lt(k[0]))return[new Ge(L,k,`object expected, ${Lt(k[0])} found`)];if(void 0===k[0].zoom)return[new Ge(L,k,"object stop key must have zoom")];if(void 0===k[0].value)return[new Ge(L,k,"object stop key must have value")];const W=ii(k[0].zoom);if("number"!=typeof W)return[new Ge(L,k[0].zoom,"stop zoom values must be numbers")];if(c&&c>W)return[new Ge(L,k[0].zoom,"stop zoom values must appear in ascending order")];W!==c&&(c=W,s=void 0,u={}),A=A.concat(fn({key:`${L}[0]`,value:k[0],valueSpec:{zoom:{}},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{zoom:Ec,value:T}}))}else A=A.concat(T({key:`${L}[0]`,value:k[0],valueSpec:{},style:I.style,styleSpec:I.styleSpec},k));return xs(un(k[1]))?A.concat([new Ge(`${L}[1]`,k[1],"expressions are not allowed in function stops.")]):A.concat(Pi({key:`${L}[1]`,value:k[1],valueSpec:e,style:I.style,styleSpec:I.styleSpec}))}function T(I,A){const k=Lt(I.value),L=ii(I.value),W=null!==I.value?I.value:A;if(r){if(k!==r)return[new Ge(I.key,W,`${k} stop domain type must match previous stop domain type ${r}`)]}else r=k;if("number"!==k&&"string"!==k&&"boolean"!==k&&"number"!=typeof L&&"string"!=typeof L&&"boolean"!=typeof L)return[new Ge(I.key,W,"stop domain value must be a number, string, or boolean")];if("number"!==k&&"categorical"!==i){let J=`number expected, ${k} found`;return fo(e)&&void 0===i&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ge(I.key,W,J)]}return"categorical"!==i||"number"!==k||"number"==typeof L&&isFinite(L)&&Math.floor(L)===L?"categorical"!==i&&"number"===k&&"number"==typeof L&&"number"==typeof s&&void 0!==s&&L<s?[new Ge(I.key,W,"stop domain values must appear in ascending order")]:(s=L,"categorical"===i&&L in u?[new Ge(I.key,W,"stop domain values must be unique")]:(u[L]=!0,[])):[new Ge(I.key,W,`integer expected, found ${String(L)}`)]}}function No(t){const e=("property"===t.expressionContext?sl:Dr)(un(t.value),t.valueSpec);if("error"===e.result)return e.value.map(r=>new Ge(`${t.key}${r.key}`,t.value,r.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new Ge(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Xs(i))return[new Ge(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Cc(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!ps(i,["zoom","feature-state"]))return[new Ge(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Oo(i))return[new Ge(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cc(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const s of e.valueSpec.expression.parameters)i.delete(s);if(0===i.size)return[];const r=[];return t instanceof kr&&i.has(t.name)?[new Ge(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(s=>{r.push(...Cc(s,e))}),r)}function da(t){const e=t.key,i=t.value,r=t.valueSpec,s=[];return Array.isArray(r.values)?-1===r.values.indexOf(ii(i))&&s.push(new Ge(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(ii(i))&&s.push(new Ge(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),s}function Vo(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Vo(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function _o(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Vo(t)||(t=Go(t));const i=t;let r=!0;try{r=function(g){if(!jo(g))return g;let v=un(g);return ws(v),v=Wi(v),v}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const s=be[`filter_${e}`],c=Dr(r,s);let u=null;if("error"===c.result)throw new Error(c.value.map(g=>`${g.key}: ${g.message}`).join(", "));u=(g,v,w)=>c.value.evaluate(g,v,{},w);let p=null,_=null;if(r!==i){const g=Dr(i,s);if("error"===g.result)throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,w,T,I,A)=>g.value.evaluate(v,w,{},T,void 0,void 0,I,A),_=!Oo(g.value.expression)}return{filter:u,dynamicFilter:p||void 0,needGeometry:Ic(r),needFeature:!!_}}function Wi(t){if(!Array.isArray(t))return t;const e=function(i){if(Vh.has(i[0]))for(let r=1;r<i.length;r++)if(jo(i[r]))return!0;return i}(t);return!0===e?e:e.map(i=>Wi(i))}function ws(t){let e=!1;const i=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)e=e||jo(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||jo(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||jo(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)ws(t[r])}function jo(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<t.length;i++)if(jo(t[i]))return!0;return!1}const Vh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jh(t,e){return t<e?-1:t>e?1:0}function Ic(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Ic(t[e]))return!0;return!1}function Go(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?al(t[1],t[2],"=="):"!="===e?fa(al(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?al(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(Go))):"all"===e?["all"].concat(t.slice(1).map(Go)):"none"===e?["all"].concat(t.slice(1).map(Go).map(fa)):"in"===e?pa(t[1],t.slice(2)):"!in"===e?fa(pa(t[1],t.slice(2))):"has"===e?Ac(t[1]):"!has"===e?fa(Ac(t[1])):"within"!==e||t;var i}function al(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function pa(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(jh)]]:["filter-in-small",t,["literal",e]]}}function Ac(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function fa(t){return["!",t]}function Ts(t){return Vo(un(t.value))?No(pi({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Sc(t)}function Sc(t){const e=t.value,i=t.key;if("array"!==Lt(e))return[new Ge(i,e,`array expected, ${Lt(e)} found`)];const r=t.styleSpec;let s,c=[];if(e.length<1)return[new Ge(i,e,"filter array must have at least 1 element")];switch(c=c.concat(da({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),ii(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===ii(e[1])&&c.push(new Ge(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&c.push(new Ge(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(s=Lt(e[1]),"string"!==s&&c.push(new Ge(`${i}[1]`,e[1],`string expected, ${s} found`)));for(let u=2;u<e.length;u++)s=Lt(e[u]),"$type"===ii(e[1])?c=c.concat(da({key:`${i}[${u}]`,value:e[u],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&c.push(new Ge(`${i}[${u}]`,e[u],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let u=1;u<e.length;u++)c=c.concat(Sc({key:`${i}[${u}]`,value:e[u],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":s=Lt(e[1]),2!==e.length?c.push(new Ge(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==s&&c.push(new Ge(`${i}[1]`,e[1],`string expected, ${s} found`));break;case"within":s=Lt(e[1]),2!==e.length?c.push(new Ge(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==s&&c.push(new Ge(`${i}[1]`,e[1],`object expected, ${s} found`))}return c}function ll(t,e){const i=t.key,r=t.style,s=t.styleSpec,c=t.value,u=t.objectKey,p=s[`${e}_${t.layerType}`];if(!p)return[];const _=u.match(/^(.*)-transition$/);if("paint"===e&&_&&p[_[1]]&&p[_[1]].transition)return Pi({key:i,value:c,valueSpec:s.transition,style:r,styleSpec:s});const g=t.valueSpec||p[u];if(!g)return[new Ge(i,c,`unknown property "${u}"`)];let v;if("string"===Lt(c)&&fo(g)&&!g.tokens&&(v=/^{([^}]+)}$/.exec(c)))return[new Ge(i,c,`"${u}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(v[1])} }\`.`)];const w=[];return"symbol"===t.layerType&&("text-field"===u&&r&&!r.glyphs&&w.push(new Ge(i,c,'use of "text-field" requires a style "glyphs" property')),"text-font"===u&&ys(un(c))&&"identity"===ii(c.type)&&w.push(new Ge(i,c,'"text-font" does not support identity functions'))),w.concat(Pi({key:t.key,value:c,valueSpec:g,style:r,styleSpec:s,expressionContext:"property",propertyType:e,propertyKey:u}))}function cl(t){return ll(t,"paint")}function zc(t){return ll(t,"layout")}function ma(t){let e=[];const i=t.value,r=t.key,s=t.style,c=t.styleSpec;i.type||i.ref||e.push(new Ge(r,i,'either "type" or "ref" is required'));let u=ii(i.type);const p=ii(i.ref);if(i.id){const _=ii(i.id);for(let g=0;g<t.arrayIndex;g++){const v=s.layers[g];ii(v.id)===_&&e.push(new Ge(r,i.id,`duplicate layer id "${i.id}", previously used at line ${v.id.__line__}`))}}if("ref"in i){let _;["type","source","source-layer","filter","layout"].forEach(g=>{g in i&&e.push(new Ge(r,i[g],`"${g}" is prohibited for ref layers`))}),s.layers.forEach(g=>{ii(g.id)===p&&(_=g)}),_?_.ref?e.push(new Ge(r,i.ref,"ref cannot reference another ref layer")):u=ii(_.type):"string"==typeof p&&e.push(new Ge(r,i.ref,`ref layer "${p}" not found`))}else if("background"!==u&&"sky"!==u)if(i.source){const _=s.sources&&s.sources[i.source],g=_&&ii(_.type);_?"vector"===g&&"raster"===u?e.push(new Ge(r,i.source,`layer "${i.id}" requires a raster source`)):"raster"===g&&"raster"!==u?e.push(new Ge(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==g||i["source-layer"]?"raster-dem"===g&&"hillshade"!==u?e.push(new Ge(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==u||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===g&&_.lineMetrics||e.push(new Ge(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ge(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Ge(r,i.source,`source "${i.source}" not found`))}else e.push(new Ge(r,i,'missing required property "source"'));return e=e.concat(fn({key:r,value:i,valueSpec:c.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pi({key:`${r}.type`,value:i.type,valueSpec:c.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:_=>Ts(pi({layerType:u},_)),layout:_=>fn({layer:i,key:_.key,value:_.value,valueSpec:{},style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":g=>zc(pi({layerType:u},g))}}),paint:_=>fn({layer:i,key:_.key,value:_.value,valueSpec:{},style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":g=>cl(pi({layerType:u},g))}})}})),e}function cr(t){const e=t.value,i=t.key,r=Lt(e);return"string"!==r?[new Ge(i,e,`string expected, ${r} found`)]:[]}const hl={promoteId:function({key:t,value:e}){if("string"===Lt(e))return cr({key:t,value:e});{const i=[];for(const r in e)i.push(...cr({key:`${t}.${r}`,value:e[r]}));return i}}};function kc(t){const e=t.value,i=t.key,r=t.styleSpec,s=t.style;if(!e.type)return[new Ge(i,e,'"type" is required')];const c=ii(e.type);let u;switch(c){case"vector":case"raster":case"raster-dem":return u=fn({key:i,value:e,valueSpec:r[`source_${c.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:hl}),u;case"geojson":if(u=fn({key:i,value:e,valueSpec:r.source_geojson,style:s,styleSpec:r,objectElementValidators:hl}),e.cluster)for(const p in e.clusterProperties){const[_,g]=e.clusterProperties[p],v="string"==typeof _?[_,["accumulated"],["get",p]]:_;u.push(...No({key:`${i}.${p}.map`,value:g,expressionContext:"cluster-map"})),u.push(...No({key:`${i}.${p}.reduce`,value:v,expressionContext:"cluster-reduce"}))}return u;case"video":return fn({key:i,value:e,valueSpec:r.source_video,style:s,styleSpec:r});case"image":return fn({key:i,value:e,valueSpec:r.source_image,style:s,styleSpec:r});case"canvas":return[new Ge(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return da({key:`${i}.type`,value:e.type,valueSpec:{values:Dc(r)},style:s,styleSpec:r})}}function Dc(t){return t.source.reduce((e,i)=>{const r=t[i];return"enum"===r.type.type&&(e=e.concat(Object.keys(r.type.values))),e},[])}function Pc(t){const e=t.value,i=t.styleSpec,r=i.light,s=t.style;let c=[];const u=Lt(e);if(void 0===e)return c;if("object"!==u)return c=c.concat([new Ge("light",e,`object expected, ${u} found`)]),c;for(const p in e){const _=p.match(/^(.*)-transition$/);c=c.concat(_&&r[_[1]]&&r[_[1]].transition?Pi({key:p,value:e[p],valueSpec:i.transition,style:s,styleSpec:i}):r[p]?Pi({key:p,value:e[p],valueSpec:r[p],style:s,styleSpec:i}):[new Ge(p,e[p],`unknown property "${p}"`)])}return c}function _a(t){const e=t.value,i=t.key,r=t.style,s=t.styleSpec,c=s.terrain;let u=[];const p=Lt(e);if(void 0===e)return u;if("object"!==p)return u=u.concat([new Ge("terrain",e,`object expected, ${p} found`)]),u;for(const _ in e){const g=_.match(/^(.*)-transition$/);u=u.concat(g&&c[g[1]]&&c[g[1]].transition?Pi({key:_,value:e[_],valueSpec:s.transition,style:r,styleSpec:s}):c[_]?Pi({key:_,value:e[_],valueSpec:c[_],style:r,styleSpec:s}):[new Ge(_,e[_],`unknown property "${_}"`)])}if(e.source){const _=r.sources&&r.sources[e.source],g=_&&ii(_.type);_?"raster-dem"!==g&&u.push(new Ge(i,e.source,`terrain cannot be used with a source of type ${String(g)}, it only be used with a "raster-dem" source type`)):u.push(new Ge(i,e.source,`source "${e.source}" not found`))}else u.push(new Ge(i,e,'terrain is missing required property "source"'));return u}function Lc(t){const e=t.value,i=t.style,r=t.styleSpec,s=r.fog;let c=[];const u=Lt(e);if(void 0===e)return c;if("object"!==u)return c=c.concat([new Ge("fog",e,`object expected, ${u} found`)]),c;for(const p in e){const _=p.match(/^(.*)-transition$/);c=c.concat(_&&s[_[1]]&&s[_[1]].transition?Pi({key:p,value:e[p],valueSpec:r.transition,style:i,styleSpec:r}):s[p]?Pi({key:p,value:e[p],valueSpec:s[p],style:i,styleSpec:r}):[new Ge(p,e[p],`unknown property "${p}"`)])}return c}const Oc={"*":()=>[],array:bs,boolean:function(t){const e=t.value,i=t.key,r=Lt(e);return"boolean"!==r?[new Ge(i,e,`boolean expected, ${r} found`)]:[]},number:Ec,color:function(t){const e=t.key,i=t.value,r=Lt(i);return"string"!==r?[new Ge(e,i,`color expected, ${r} found`)]:null===so(i)?[new Ge(e,i,`color expected, "${i}" found`)]:[]},enum:da,filter:Ts,function:Mc,layer:ma,object:fn,source:kc,light:Pc,terrain:_a,fog:Lc,string:cr,formatted:function(t){return 0===cr(t).length?[]:No(t)},resolvedImage:function(t){return 0===cr(t).length?[]:No(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,s=t.style;let c=[];const u=Lt(e);if("object"===u)for(const p in e)c=c.concat(Pi({key:p,value:e[p],valueSpec:r[p],style:s,styleSpec:i}));else"string"!==u&&(c=c.concat([new Ge("projection",e,`object or string expected, ${u} found`)]));return c}};function Pi(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&ys(ii(e))?Mc(t):i.expression&&xs(un(e))?No(t):i.type&&Oc[i.type]?Oc[i.type](t):fn(pi({},t,{valueSpec:i.type?r[i.type]:i}))}function Gh(t){const e=t.value,i=t.key,r=cr(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new Ge(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new Ge(i,e,'"glyphs" url must include a "{range}" token'))),r}function ul(t,e=be){return hr(Pi({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Gh,"*":()=>[]}}))}const qh=t=>hr(cl(t)),$h=t=>hr(zc(t));function hr(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Rc(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new ki(new Error(r.message))),i=!0;return i}var qo=qn;function qn(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(e=s[1])+2*(i=s[2]);for(var c=0;c<this.d*this.d;c++){var u=s[3+c],p=s[3+c+1];r.push(u===p?null:s.subarray(u,p))}var _=s[3+r.length+1];this.keys=s.subarray(s[3+r.length],_),this.bboxes=s.subarray(_),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var g=0;g<this.d*this.d;g++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var v=i/e*t;this.min=-v,this.max=t+v}qn.prototype.insert=function(t,e,i,r,s){this._forEachCell(e,i,r,s,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(s)},qn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qn.prototype._insertCell=function(t,e,i,r,s,c){this.cells[s].push(c)},qn.prototype.query=function(t,e,i,r,s){var c=this.min,u=this.max;if(t<=c&&e<=c&&u<=i&&u<=r&&!s)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(t,e,i,r,this._queryCell,p,{},s),p},qn.prototype._queryCell=function(t,e,i,r,s,c,u,p){var _=this.cells[s];if(null!==_)for(var g=this.keys,v=this.bboxes,w=0;w<_.length;w++){var T=_[w];if(void 0===u[T]){var I=4*T;(p?p(v[I+0],v[I+1],v[I+2],v[I+3]):t<=v[I+2]&&e<=v[I+3]&&i>=v[I+0]&&r>=v[I+1])?(u[T]=!0,c.push(g[T])):u[T]=!1}}},qn.prototype._forEachCell=function(t,e,i,r,s,c,u,p){for(var _=this._convertToCellCoord(t),g=this._convertToCellCoord(e),v=this._convertToCellCoord(i),w=this._convertToCellCoord(r),T=_;T<=v;T++)for(var I=g;I<=w;I++){var A=this.d*I+T;if((!p||p(this._convertFromCellCoord(T),this._convertFromCellCoord(I),this._convertFromCellCoord(T+1),this._convertFromCellCoord(I+1)))&&s.call(this,t,e,i,r,A,c,u,p))return}},qn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},qn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},qn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var s=new Int32Array(e+i+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var c=e,u=0;u<t.length;u++){var p=t[u];s[3+u]=c,s.set(p,c),c+=p.length}return s[3+t.length]=c,s.set(this.keys,c),s[3+t.length+1]=c+=this.keys.length,s.set(this.bboxes,c),c+=this.bboxes.length,s.buffer};const ga={};function $e(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ga[e]={klass:t,omit:i.omit||[]}}$e(Object,"Object"),qo.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},qo.deserialize=function(t){return new qo(t.buffer)},Object.defineProperty(qo,"name",{value:"Grid"}),$e(qo,"Grid"),$e(ri,"Color"),$e(Error,"Error"),$e(eo,"AJAXError"),$e(j,"ResolvedImage"),$e(Zo,"StylePropertyFunction"),$e(ha,"StyleExpression",{omit:["_evaluator"]}),$e(ua,"ZoomDependentExpression"),$e(Pr,"ZoomConstantExpression"),$e(kr,"CompoundExpression",{omit:["_evaluate"]});for(const t in gs)ga[gs[t]._classRegistryKey]||$e(gs[t],`Expression${t}`);function Bc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Fc(t){return Se.ImageBitmap&&t instanceof Se.ImageBitmap}function Lr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Bc(t)||Fc(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof Se.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Lr(r,e));return i}if("object"==typeof t){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const s=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const c in t)t.hasOwnProperty(c)&&(ga[r].omit.indexOf(c)>=0||(s[c]=Lr(t[c],e)));t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(s.$name=r),s}throw new Error("can't serialize object of type "+typeof t)}function Es(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Bc(t)||Fc(t)||ArrayBuffer.isView(t)||t instanceof Se.ImageData)return t;if(Array.isArray(t))return t.map(Es);if("object"==typeof t){const e=t.$name||"Object",{klass:i}=ga[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const s of Object.keys(t))"$name"!==s&&(r[s]=Es(t[s]));return r}throw new Error("can't deserialize object of type "+typeof t)}const dl=t=>t>=1536&&t<=1791,Uc=t=>t>=1872&&t<=1919,pl=t=>t>=2208&&t<=2303,fl=t=>t>=11904&&t<=12031,ml=t=>t>=12032&&t<=12255,_l=t=>t>=12272&&t<=12287,$o=t=>t>=12288&&t<=12351,Ms=t=>t>=12352&&t<=12447,ya=t=>t>=12448&&t<=12543,Zc=t=>t>=12544&&t<=12591,gl=t=>t>=12704&&t<=12735,Nc=t=>t>=12736&&t<=12783,Vc=t=>t>=12784&&t<=12799,jc=t=>t>=12800&&t<=13055,Gc=t=>t>=13056&&t<=13311,qc=t=>t>=13312&&t<=19903,yl=t=>t>=19968&&t<=40959,$c=t=>t>=40960&&t<=42127,Wc=t=>t>=42128&&t<=42191,xl=t=>t>=44032&&t<=55215,Cs=t=>t>=63744&&t<=64255,l=t=>t>=64336&&t<=65023,n=t=>t>=65040&&t<=65055,o=t=>t>=65072&&t<=65103,h=t=>t>=65104&&t<=65135,d=t=>t>=65136&&t<=65279,f=t=>t>=65280&&t<=65519;function y(t){for(const e of t)if(M(e.charCodeAt(0)))return!0;return!1}function x(t){for(const e of t)if(!b(e.charCodeAt(0)))return!1;return!0}function b(t){return!(dl(t)||Uc(t)||pl(t)||l(t)||d(t))}function M(t){return!(746!==t&&747!==t&&(t<4352||!(gl(t)||Zc(t)||o(t)&&!(t>=65097&&t<=65103)||Cs(t)||Gc(t)||fl(t)||Nc(t)||!(!$o(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||qc(t)||yl(t)||jc(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||xl(t)||Ms(t)||_l(t)||(e=>e>=12688&&e<=12703)(t)||ml(t)||Vc(t)||ya(t)&&12540!==t||!(!f(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!h(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||n(t)||(e=>e>=19904&&e<=19967)(t)||$c(t)||Wc(t))));var e}function E(t){return!(M(t)||(e=t,(i=e)>=128&&i<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(i=>i>=8192&&i<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&9251!==e||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||$o(e)||ya(e)||(i=>i>=57344&&i<=63743)(e)||o(e)||h(e)||f(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,i}function z(t){return t>=1424&&t<=2303||l(t)||d(t)}function P(t,e){return!(!e&&z(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=t,i>=6016&&i<=6143));var i}function U(t){for(const e of t)if(z(e.charCodeAt(0)))return!0;return!1}const F="deferred",Z="loading",O="loaded";let R=null,q="unavailable",N=null;const H=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(q="error"),R&&R(t)};function te(){Q.fire(new Ei("pluginStateChange",{pluginStatus:q,pluginURL:N}))}const Q=new Ut,re=function(){return q},me=function(){if(q!==F||!N)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");q=Z,te(),N&&Fn({url:N},t=>{t?H(t):(q=O,te())})},de={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>q===O||null!=de.applyArabicShaping,isLoading:()=>q===Z,setState(t){q=t.pluginStatus,N=t.pluginURL},isParsed:()=>null!=de.applyArabicShaping&&null!=de.processBidirectionalText&&null!=de.processStyledBidirectionalText,getPluginURL:()=>N};class oe{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,r){for(const s of i)if(!P(s.charCodeAt(0),r))return!1;return!0}(e,de.isLoaded())}}class Oe{constructor(e,i){this.property=e,this.value=i,this.expression=function(r,s){if(ys(r))return new Zo(r,s);if(xs(r)){const c=sl(r,s);if("error"===c.result)throw new Error(c.value.map(u=>`${u.key}: ${u.message}`).join(", "));return c.value}{let c=r;return"string"==typeof r&&"color"===s.type&&(c=ri.parse(r)),{kind:"constant",evaluate:()=>c}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class he{constructor(e){this.property=e,this.value=new Oe(e,void 0)}transitioned(e,i){return new ge(this.property,this.value,i,ni({},e.transition,this.transition),e.now)}untransitioned(){return new ge(this.property,this.value,null,{},0)}}class Te{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Zi(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new he(this._values[e].property)),this._values[e].value=new Oe(this._values[e].property,null===i?void 0:Zi(i))}getTransition(e){return Zi(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new he(this._values[e].property)),this._values[e].transition=Zi(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);void 0!==r&&(e[i]=r);const s=this.getTransition(i);void 0!==s&&(e[`${i}-transition`]=s)}return e}transitioned(e,i){const r=new De(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].transitioned(e,i._values[s]);return r}untransitioned(){const e=new De(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ge{constructor(e,i,r,s,c){const u=s.delay||0,p=s.duration||0;c=c||0,this.property=e,this.value=i,this.begin=c+u,this.end=this.begin+p,e.specification.transition&&(s.delay||s.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const s=e.now||0,c=this.value.possiblyEvaluate(e,i,r),u=this.prior;if(u){if(s>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(s<this.begin)return u.possiblyEvaluate(e,i,r);{const p=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(u.possiblyEvaluate(e,i,r),c,Ao(p))}}return c}}class De{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const s=new Re(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].possiblyEvaluate(e,i,r);return s}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ve{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Zi(this._values[e].value)}setValue(e,i){this._values[e]=new Oe(this._values[e].property,null===i?void 0:Zi(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);void 0!==r&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const s=new Re(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].possiblyEvaluate(e,i,r);return s}}class Ie{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,r,s){return this.property.evaluate(this.value,this.parameters,e,i,r,s)}}class Re{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class se{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const s=Qs[this.specification.type];return s?s(e,i,r):e}}class _e{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,s){return new Ie(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},r,s)}:e.expression,i)}interpolate(e,i,r){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new Ie(this,{kind:"constant",value:void 0},e.parameters);const s=Qs[this.specification.type];return s?new Ie(this,{kind:"constant",value:s(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,s,c,u){return"constant"===e.kind?e.value:e.evaluate(i,r,s,c,u)}}class Xe{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,s){return!!e.expression.evaluate(i,null,{},r,s)}interpolate(){return!1}}class Qe{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new oe(0,{});for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new Oe(s,void 0),u=this.defaultTransitionablePropertyValues[r]=new he(s);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate(i)}}}function He(t,e){return 256*(t=_t(Math.floor(t),0,255))+_t(Math.floor(e),0,255)}$e(_e,"DataDrivenProperty"),$e(se,"DataConstantProperty"),$e(Xe,"ColorRampProperty");const st={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dt{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class et{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function qe(t,e=1){let i=0,r=0;return{members:t.map(s=>{const c=st[s.type].BYTES_PER_ELEMENT,u=i=Rt(i,Math.max(e,c)),p=s.components||1;return r=Math.max(r,c),i+=c*p,{name:s.name,type:s.type,components:p,offset:u}}),size:Rt(i,Math.max(r,e)),alignment:e}}function Rt(t,e){return Math.ceil(t/e)*e}class kt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const s=2*e;return this.int16[s+0]=i,this.int16[s+1]=r,e}}kt.prototype.bytesPerElement=4,$e(kt,"StructArrayLayout2i4");class Gt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const c=3*e;return this.int16[c+0]=i,this.int16[c+1]=r,this.int16[c+2]=s,e}}Gt.prototype.bytesPerElement=6,$e(Gt,"StructArrayLayout3i6");class Zt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,s)}emplace(e,i,r,s,c){const u=4*e;return this.int16[u+0]=i,this.int16[u+1]=r,this.int16[u+2]=s,this.int16[u+3]=c,e}}Zt.prototype.bytesPerElement=8,$e(Zt,"StructArrayLayout4i8");class Xi extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,r,s,c,u,p)}emplace(e,i,r,s,c,u,p,_){const g=6*e,v=12*e,w=3*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.uint8[v+4]=s,this.uint8[v+5]=c,this.uint8[v+6]=u,this.uint8[v+7]=p,this.float32[w+2]=_,e}}Xi.prototype.bytesPerElement=12,$e(Xi,"StructArrayLayout2i4ub1f12");class an extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,s)}emplace(e,i,r,s,c){const u=4*e;return this.float32[u+0]=i,this.float32[u+1]=r,this.float32[u+2]=s,this.float32[u+3]=c,e}}an.prototype.bytesPerElement=16,$e(an,"StructArrayLayout4f16");class Vi extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,s,c)}emplace(e,i,r,s,c,u){const p=6*e,_=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=r,this.uint16[p+2]=s,this.uint16[p+3]=c,this.float32[_+2]=u,e}}Vi.prototype.bytesPerElement=12,$e(Vi,"StructArrayLayout4ui1f12");class $n extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,s)}emplace(e,i,r,s,c){const u=4*e;return this.uint16[u+0]=i,this.uint16[u+1]=r,this.uint16[u+2]=s,this.uint16[u+3]=c,e}}$n.prototype.bytesPerElement=8,$e($n,"StructArrayLayout4ui8");class Yt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,s,c,u)}emplace(e,i,r,s,c,u,p){const _=6*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.int16[_+2]=s,this.int16[_+3]=c,this.int16[_+4]=u,this.int16[_+5]=p,e}}Yt.prototype.bytesPerElement=12,$e(Yt,"StructArrayLayout6i12");class qt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,u,p,_,g,v,w,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,r,s,c,u,p,_,g,v,w,T)}emplace(e,i,r,s,c,u,p,_,g,v,w,T,I){const A=12*e;return this.int16[A+0]=i,this.int16[A+1]=r,this.int16[A+2]=s,this.int16[A+3]=c,this.uint16[A+4]=u,this.uint16[A+5]=p,this.uint16[A+6]=_,this.uint16[A+7]=g,this.int16[A+8]=v,this.int16[A+9]=w,this.int16[A+10]=T,this.int16[A+11]=I,e}}qt.prototype.bytesPerElement=24,$e(qt,"StructArrayLayout4i4ui4i24");class St extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,s,c,u)}emplace(e,i,r,s,c,u,p){const _=10*e,g=5*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.int16[_+2]=s,this.float32[g+2]=c,this.float32[g+3]=u,this.float32[g+4]=p,e}}St.prototype.bytesPerElement=20,$e(St,"StructArrayLayout3i3f20");class ci extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ci.prototype.bytesPerElement=4,$e(ci,"StructArrayLayout1ul4");class Li extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,u,p,_,g,v,w,T,I){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,r,s,c,u,p,_,g,v,w,T,I)}emplace(e,i,r,s,c,u,p,_,g,v,w,T,I,A){const k=20*e,L=10*e;return this.int16[k+0]=i,this.int16[k+1]=r,this.int16[k+2]=s,this.int16[k+3]=c,this.int16[k+4]=u,this.float32[L+3]=p,this.float32[L+4]=_,this.float32[L+5]=g,this.float32[L+6]=v,this.int16[k+14]=w,this.uint32[L+8]=T,this.uint16[k+18]=I,this.uint16[k+19]=A,e}}Li.prototype.bytesPerElement=40,$e(Li,"StructArrayLayout5i4f1i1ul2ui40");class $t extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,r,s,c,u,p)}emplace(e,i,r,s,c,u,p,_){const g=8*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.int16[g+2]=s,this.int16[g+4]=c,this.int16[g+5]=u,this.int16[g+6]=p,this.int16[g+7]=_,e}}$t.prototype.bytesPerElement=16,$e($t,"StructArrayLayout3i2i2i16");class ji extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,s,c)}emplace(e,i,r,s,c,u){const p=4*e,_=8*e;return this.float32[p+0]=i,this.float32[p+1]=r,this.float32[p+2]=s,this.int16[_+6]=c,this.int16[_+7]=u,e}}ji.prototype.bytesPerElement=16,$e(ji,"StructArrayLayout2f1f2i16");class Is extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,s)}emplace(e,i,r,s,c){const u=12*e,p=3*e;return this.uint8[u+0]=i,this.uint8[u+1]=r,this.float32[p+1]=s,this.float32[p+2]=c,e}}Is.prototype.bytesPerElement=12,$e(Is,"StructArrayLayout2ub2f12");class ur extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const c=3*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=s,e}}ur.prototype.bytesPerElement=12,$e(ur,"StructArrayLayout3f12");class Oi extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const c=3*e;return this.uint16[c+0]=i,this.uint16[c+1]=r,this.uint16[c+2]=s,e}}Oi.prototype.bytesPerElement=6,$e(Oi,"StructArrayLayout3ui6");class mn extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,u,p,_,g,v,w,T,I,A,k,L,W,J,$,Y,ee){const K=this.length;return this.resize(K+1),this.emplace(K,e,i,r,s,c,u,p,_,g,v,w,T,I,A,k,L,W,J,$,Y,ee)}emplace(e,i,r,s,c,u,p,_,g,v,w,T,I,A,k,L,W,J,$,Y,ee,K){const fe=30*e,pe=15*e,we=60*e;return this.int16[fe+0]=i,this.int16[fe+1]=r,this.int16[fe+2]=s,this.float32[pe+2]=c,this.float32[pe+3]=u,this.uint16[fe+8]=p,this.uint16[fe+9]=_,this.uint32[pe+5]=g,this.uint32[pe+6]=v,this.uint32[pe+7]=w,this.uint16[fe+16]=T,this.uint16[fe+17]=I,this.uint16[fe+18]=A,this.float32[pe+10]=k,this.float32[pe+11]=L,this.uint8[we+48]=W,this.uint8[we+49]=J,this.uint8[we+50]=$,this.uint32[pe+13]=Y,this.int16[fe+28]=ee,this.uint8[we+58]=K,e}}mn.prototype.bytesPerElement=60,$e(mn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Wn extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,u,p,_,g,v,w,T,I,A,k,L,W,J,$,Y,ee,K,fe,pe,we,Pe,ye,Ee,Me,ze){const Le=this.length;return this.resize(Le+1),this.emplace(Le,e,i,r,s,c,u,p,_,g,v,w,T,I,A,k,L,W,J,$,Y,ee,K,fe,pe,we,Pe,ye,Ee,Me,ze)}emplace(e,i,r,s,c,u,p,_,g,v,w,T,I,A,k,L,W,J,$,Y,ee,K,fe,pe,we,Pe,ye,Ee,Me,ze,Le){const xe=38*e,Fe=19*e;return this.int16[xe+0]=i,this.int16[xe+1]=r,this.int16[xe+2]=s,this.float32[Fe+2]=c,this.float32[Fe+3]=u,this.int16[xe+8]=p,this.int16[xe+9]=_,this.int16[xe+10]=g,this.int16[xe+11]=v,this.int16[xe+12]=w,this.int16[xe+13]=T,this.uint16[xe+14]=I,this.uint16[xe+15]=A,this.uint16[xe+16]=k,this.uint16[xe+17]=L,this.uint16[xe+18]=W,this.uint16[xe+19]=J,this.uint16[xe+20]=$,this.uint16[xe+21]=Y,this.uint16[xe+22]=ee,this.uint16[xe+23]=K,this.uint16[xe+24]=fe,this.uint16[xe+25]=pe,this.uint16[xe+26]=we,this.uint16[xe+27]=Pe,this.uint16[xe+28]=ye,this.uint32[Fe+15]=Ee,this.float32[Fe+16]=Me,this.float32[Fe+17]=ze,this.float32[Fe+18]=Le,e}}Wn.prototype.bytesPerElement=76,$e(Wn,"StructArrayLayout3i2f6i15ui1ul3f76");class Xn extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Xn.prototype.bytesPerElement=4,$e(Xn,"StructArrayLayout1f4");class As extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,s,c)}emplace(e,i,r,s,c,u){const p=5*e;return this.float32[p+0]=i,this.float32[p+1]=r,this.float32[p+2]=s,this.float32[p+3]=c,this.float32[p+4]=u,e}}As.prototype.bytesPerElement=20,$e(As,"StructArrayLayout5f20");class Wo extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,s)}emplace(e,i,r,s,c){const u=6*e;return this.uint32[3*e+0]=i,this.uint16[u+2]=r,this.uint16[u+3]=s,this.uint16[u+4]=c,e}}Wo.prototype.bytesPerElement=12,$e(Wo,"StructArrayLayout1ul3ui12");class Hn extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const s=2*e;return this.uint16[s+0]=i,this.uint16[s+1]=r,e}}Hn.prototype.bytesPerElement=4,$e(Hn,"StructArrayLayout2ui4");class vl extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}vl.prototype.bytesPerElement=2,$e(vl,"StructArrayLayout1ui2");class Xc extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const s=2*e;return this.float32[s+0]=i,this.float32[s+1]=r,e}}Xc.prototype.bytesPerElement=8,$e(Xc,"StructArrayLayout2f8");class Ku extends dt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ku.prototype.size=40;class Wh extends Li{get(e){return new Ku(this,e)}}$e(Wh,"CollisionBoxArray");class Qu extends dt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Qu.prototype.size=60;class ed extends mn{get(e){return new Qu(this,e)}}$e(ed,"PlacedSymbolArray");class td extends dt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}td.prototype.size=76;class id extends Wn{get(e){return new td(this,e)}}$e(id,"SymbolInstanceArray");class nd extends Xn{getoffsetX(e){return this.float32[1*e+0]}}$e(nd,"GlyphOffsetArray");class rd extends kt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}$e(rd,"SymbolLineVertexArray");class od extends dt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}od.prototype.size=12;class sd extends Wo{get(e){return new od(this,e)}}$e(sd,"FeatureIndexArray");class ad extends Hn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}$e(ad,"FillExtrusionCentroidArray");const kf=qe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Df=qe([{name:"a_dash",components:4,type:"Uint16"}]);var xa={exports:{}},hd=function(t,e){var i,r,s,c,u,p,_,g;for(r=t.length-(i=3&t.length),s=e,u=3432918353,p=461845907,g=0;g<r;)_=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24,++g,s=27492+(65535&(c=5*(65535&(s=(s^=_=(65535&(_=(_=(65535&_)*u+(((_>>>16)*u&65535)<<16)&4294967295)<<15|_>>>17))*p+(((_>>>16)*p&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(_=0,i){case 3:_^=(255&t.charCodeAt(g+2))<<16;case 2:_^=(255&t.charCodeAt(g+1))<<8;case 1:s^=_=(65535&(_=(_=(65535&(_^=255&t.charCodeAt(g)))*u+(((_>>>16)*u&65535)<<16)&4294967295)<<15|_>>>17))*p+(((_>>>16)*p&65535)<<16)&4294967295}return s^=t.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0},Pf=function(t,e){for(var i,r=t.length,s=e^r,c=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24))+((1540483477*(i>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++c;switch(r){case 3:s^=(255&t.charCodeAt(c+2))<<16;case 2:s^=(255&t.charCodeAt(c+1))<<8;case 1:s=1540483477*(65535&(s^=255&t.charCodeAt(c)))+((1540483477*(s>>>16)&65535)<<16)}return s=1540483477*(65535&(s^=s>>>13))+((1540483477*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0};xa.exports=hd,xa.exports.murmur3=hd,xa.exports.murmur2=Pf;class Hc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,r,s){this.ids.push(ud(e)),this.positions.push(i,r,s)}getPositions(e){const i=ud(e);let r=0,s=this.ids.length-1;for(;r<s;){const u=r+s>>1;this.ids[u]>=i?s=u:r=u+1}const c=[];for(;this.ids[r]===i;)c.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return c}static serialize(e,i){const r=new Float64Array(e.ids),s=new Uint32Array(e.positions);return Xh(r,s,0,r.length-1),i&&i.push(r.buffer,s.buffer),{ids:r,positions:s}}static deserialize(e){const i=new Hc;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function ud(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:xa.exports(String(t))}function Xh(t,e,i,r){for(;i<r;){const s=t[i+r>>1];let c=i-1,u=r+1;for(;;){do{c++}while(t[c]<s);do{u--}while(t[u]>s);if(c>=u)break;Yc(t,c,u),Yc(e,3*c,3*u),Yc(e,3*c+1,3*u+1),Yc(e,3*c+2,3*u+2)}u-i<r-u?(Xh(t,e,i,u),i=u+1):(Xh(t,e,u+1,r),r=u)}}function Yc(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}$e(Hc,"FeaturePositionMap");class go{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Jc extends go{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class dd extends go{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class pd extends go{constructor(e){super(e),this.current=ri.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Lf=new Float32Array(16),Of=new Float32Array(9),Rf=new Float32Array(4);function Hh(t){return[He(255*t.r,255*t.g),He(255*t.b,255*t.a)]}class bl{constructor(e,i,r){this.value=e,this.uniformNames=i.map(s=>`u_${s}`),this.type=r}setUniform(e,i,r,s,c){i.set(e,c,s.constantOr(this.value))}getBinding(e,i){return"color"===this.type?new pd(e):new Jc(e)}}class va{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,r,s,c){const u="u_pattern"===c||"u_dash"===c?this.pattern:"u_pixel_ratio"===c?this.pixelRatio:null;u&&i.set(e,c,u)}getBinding(e,i){return"u_pattern"===i||"u_dash"===i?new dd(e):new Jc(e)}}class yo{constructor(e,i,r,s){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(c=>({name:`a_${c}`,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,i,r,s,c,u){const p=this.paintVertexArray.length,_=this.expression.evaluate(new oe(0),i,{},c,s,u);this.paintVertexArray.resize(e),this._setPaintValue(p,e,_)}updatePaintArray(e,i,r,s,c){const u=this.expression.evaluate({zoom:0},r,s,void 0,c);this._setPaintValue(e,i,u)}_setPaintValue(e,i,r){if("color"===this.type){const s=Hh(r);for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,s[0],s[1])}else{for(let s=e;s<i;s++)this.paintVertexArray.emplace(s,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dr{constructor(e,i,r,s,c,u){this.expression=e,this.uniformNames=i.map(p=>`u_${p}_t`),this.type=r,this.useIntegerZoom=s,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,r,s,c,u){const p=this.expression.evaluate(new oe(this.zoom),i,{},c,s,u),_=this.expression.evaluate(new oe(this.zoom+1),i,{},c,s,u),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,p,_)}updatePaintArray(e,i,r,s,c){const u=this.expression.evaluate({zoom:this.zoom},r,s,void 0,c),p=this.expression.evaluate({zoom:this.zoom+1},r,s,void 0,c);this._setPaintValue(e,i,u,p)}_setPaintValue(e,i,r,s){if("color"===this.type){const c=Hh(r),u=Hh(s);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,c[0],c[1],u[0],u[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,r,s);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,s,c){const u=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=_t(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);i.set(e,c,p)}getBinding(e,i){return new Jc(e)}}class Xo{constructor(e,i,r,s,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=("array"===r?Df:kf).members;for(let u=0;u<i.length;++u);this.paintVertexArray=new s}populatePaintArray(e,i,r){const s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(s,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,s,c,u){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],u)}_setPaintValues(e,i,r,s){if(!s||!r)return;const c=s[r];if(!c)return;const{tl:u,br:p,pixelRatio:_}=c;for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,u[0],u[1],p[0],p[1],_)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ho{constructor(e,i,r=(()=>!0)){this.binders={},this._buffers=[];const s=[];for(const c in e.paint._values){if(!r(c))continue;const u=e.paint.get(c);if(!(u instanceof Ie&&fo(u.property.specification)))continue;const p=Ff(c,e.type),_=u.value,g=u.property.specification.type,v=u.property.useIntegerZoom,w="line-dasharray"===c||c.endsWith("pattern"),T="line-dasharray"===c&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==_.kind||T)if("source"===_.kind||T||w){const I=fd(c,g,"source");this.binders[c]=w?new Xo(_,p,g,I,e.id):new yo(_,p,g,I),s.push(`/a_${c}`)}else{const I=fd(c,g,"composite");this.binders[c]=new dr(_,p,g,v,i,I),s.push(`/z_${c}`)}else this.binders[c]=w?new va(_.value,p):new bl(_.value,p,g),s.push(`/u_${c}`)}this.cacheKey=s.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof yo||i instanceof dr?i.maxValue:0}populatePaintArrays(e,i,r,s,c,u){for(const p in this.binders){const _=this.binders[p];(_ instanceof yo||_ instanceof dr||_ instanceof Xo)&&_.populatePaintArray(e,i,r,s,c,u)}}setConstantPatternPositions(e){for(const i in this.binders){const r=this.binders[i];r instanceof va&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,i,r,s,c,u){let p=!1;for(const _ in e){const g=i.getPositions(_);for(const v of g){const w=r.feature(v.index);for(const T in this.binders){const I=this.binders[T];if((I instanceof yo||I instanceof dr||I instanceof Xo)&&!0===I.expression.isStateDependent){const A=s.paint.get(T);I.expression=A.value,I.updatePaintArray(v.start,v.end,w,e[_],c,u),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof bl||r instanceof va)&&e.push(...r.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof yo||r instanceof dr||r instanceof Xo)for(let s=0;s<r.paintVertexAttributes.length;s++)e.push(r.paintVertexAttributes[s].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof bl||r instanceof va||r instanceof dr)for(const s of r.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof bl||s instanceof va||s instanceof dr)for(const c of s.uniformNames)i.push({name:c,property:r,binding:s.getBinding(e,c)})}return i}setUniforms(e,i,r,s,c){for(const{name:u,property:p,binding:_}of r)this.binders[p].setUniform(e,_,c,s.get(p),u)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof yo||i instanceof dr||i instanceof Xo)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof yo||r instanceof dr||r instanceof Xo)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof yo||i instanceof dr||i instanceof Xo)&&i.destroy()}}}class Ss{constructor(e,i,r=(()=>!0)){this.programConfigurations={};for(const s of e)this.programConfigurations[s.id]=new Ho(s,i,r);this.needsUpload=!1,this._featureMap=new Hc,this._bufferOffset=0}populatePaintArrays(e,i,r,s,c,u,p){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,i,s,c,u,p);void 0!==i.id&&this._featureMap.add(i.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,s,c){for(const u of r)this.needsUpload=this.programConfigurations[u.id].updatePaintArrays(e,this._featureMap,i,u,s,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Bf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ff(t,e){return Bf[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Uf={"line-pattern":{source:Vi,composite:Vi},"fill-pattern":{source:Vi,composite:Vi},"fill-extrusion-pattern":{source:Vi,composite:Vi},"line-dasharray":{source:$n,composite:$n}},Zf={color:{source:Xc,composite:an},number:{source:Xn,composite:Xc}};function fd(t,e,i){const r=Uf[t];return r&&r[i]||Zf[e][i]}$e(bl,"ConstantBinder"),$e(va,"PatternConstantBinder"),$e(yo,"SourceExpressionBinder"),$e(Xo,"PatternCompositeBinder"),$e(dr,"CompositeExpressionBinder"),$e(Ho,"ProgramConfiguration",{omit:["_buffers"]}),$e(Ss,"ProgramConfigurationSet");const Kc="-transition";class pr extends Ut{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new ve(i.layout)),i.paint)){this._transitionablePaint=new Te(i.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Re(i.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,r={}){null!=i&&this._validate($h,`layers.${this.id}.layout.${e}`,e,i,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return Ui(e,Kc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,r={}){if(null!=i&&this._validate(qh,`layers.${this.id}.paint.${e}`,e,i,r))return!1;if(Ui(e,Kc))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const s=this._transitionablePaint._values[e],c=s.value.isDataDriven(),u=s.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const p=this._transitionablePaint._values[e].value,_=p.isDataDriven(),g=Ui(e,"pattern")||"line-dasharray"===e;return _||c||g||this._handleOverridablePaintPropertyUpdate(e,u,p)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Yr(e,(i,r)=>!(void 0===i||"layout"===r&&!Object.keys(i).length||"paint"===r&&!Object.keys(i).length))}_validate(e,i,r,s,c={}){return(!c||!1!==c.validate)&&Rc(this,e.call(ul,{key:i,layerType:this.type,objectKey:r,value:s,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ie&&fo(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=_o(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Nf=qe([{name:"a_pos",components:2,type:"Int16"}],4),Vf=qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class gi{constructor(e=[]){this.segments=e}prepareSegment(e,i,r,s){let c=this.segments[this.segments.length-1];return e>gi.MAX_VERTEX_ARRAY_LENGTH&&ti(`Max vertices per segment is ${gi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>gi.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==s)&&(c={vertexOffset:i.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==s&&(c.sortKey=s),this.segments.push(c)),c}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,s){return new gi([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:s,vaos:{},sortKey:0}])}}gi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e(gi,"SegmentVector");var lt=8192;class Yo{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof It?new It(e.lng,e.lat):It.convert(e),this}setSouthWest(e){return this._sw=e instanceof It?new It(e.lng,e.lat):It.convert(e),this}extend(e){const i=this._sw,r=this._ne;let s,c;if(e instanceof It)s=e,c=e;else{if(!(e instanceof Yo))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Yo.convert(e)):this.extend(It.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(It.convert(e)):this;if(s=e._sw,c=e._ne,!s||!c)return this}return i||r?(i.lng=Math.min(s.lng,i.lng),i.lat=Math.min(s.lat,i.lat),r.lng=Math.max(c.lng,r.lng),r.lat=Math.max(c.lat,r.lat)):(this._sw=new It(s.lng,s.lat),this._ne=new It(c.lng,c.lat)),this}getCenter(){return new It((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new It(this.getWest(),this.getNorth())}getSouthEast(){return new It(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=It.convert(e);let s=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&s}static convert(e){return!e||e instanceof Yo?e:new Yo(e)}}const Qc=6371008.8;class It{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new It(tr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,s=e.lat*i,c=Math.sin(r)*Math.sin(s)+Math.cos(r)*Math.cos(s)*Math.cos((e.lng-this.lng)*i);return Qc*Math.acos(Math.min(c,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new Yo(new It(this.lng-r,this.lat-i),new It(this.lng+r,this.lat+i))}static convert(e){if(e instanceof It)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new It(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new It(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const md=2*Math.PI*Qc;function Yh(t){return md*Math.cos(t*Math.PI/180)}function Or(t){return(180+t)/360}function Rr(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Yn(t,e){return t/Yh(e)}function In(t){return 360*t-180}function Ri(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function _d(t,e){return t*Yh(Ri(e))}const Br=85.051129;function gd(t){return 1/Math.cos(t*Math.PI/180)}class ba{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=It.convert(e);return new ba(Or(r.lng),Rr(r.lat),Yn(i,r.lat))}toLngLat(){return new It(In(this.x),Ri(this.y))}toAltitude(){return _d(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/md*gd(Ri(this.y))}}function Jh(t,e,i,r,s,c,u,p,_){const g=(e+r)/2,v=(i+s)/2,w=new Be(g,v);p(w),function(T,I,A,k,L,W){const J=A-L,$=k-W;return Math.abs((k-I)*J-(A-T)*$)/Math.hypot(J,$)}(w.x,w.y,c.x,c.y,u.x,u.y)>=_?(Jh(t,e,i,g,v,c,w,p,_),Jh(t,g,v,r,s,w,u,p,_)):t.push(u)}function yd(t,e,i){let r=t[0],s=r.x,c=r.y;e(r);const u=[r];for(let p=1;p<t.length;p++){const _=t[p],{x:g,y:v}=_;e(_),Jh(u,s,c,g,v,r,_,e,i),s=g,c=v,r=_}return u}function Kh(t,e,i,r){if(r(e,i)){const s=e.add(i)._mult(.5);Kh(t,e,s,r),Kh(t,s,i,r)}else t.push(i)}function jf(t,e){let i=t[0];const r=[i];for(let s=1;s<t.length;s++){const c=t[s];Kh(r,i,c,e),i=c}return r}const Qh=Math.pow(2,14)-1,xd=-Qh-1;function Gf(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=_t(i,xd,Qh),t.y=_t(r,xd,Qh),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&ti("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function xo(t,e,i){const r=t.loadGeometry(),s=t.extent,c=lt/s;if(e&&i&&i.projection.isReprojectedInTileSpace){const u=1<<e.z,{scale:p,x:_,y:g,projection:v}=i,w=T=>{const I=In((e.x+T.x/s)/u),A=Ri((e.y+T.y/s)/u),k=v.project(I,A);T.x=(k.x*p-_)*s,T.y=(k.y*p-g)*s};for(let T=0;T<r.length;T++)if(1!==t.type)r[T]=yd(r[T],w,1);else{const I=[];for(const A of r[T])A.x<0||A.x>=s||A.y<0||A.y>=s||(w(A),I.push(A));r[T]=I}}for(const u of r)for(const p of u)Gf(p,c);return r}function zs(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?xo(t):[]}}function eh(t,e,i,r,s){t.emplaceBack(2*e+(r+1)/2,2*i+(s+1)/2)}function th(t,e,i){t.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class eu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new kt,this.indexArray=new Oi,this.segments=new gi,this.programConfigurations=new Ss(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,s){const c=this.layers[0],u=[];let p=null;"circle"===c.type&&(p=c.layout.get("circle-sort-key"));for(const{feature:g,id:v,index:w,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,A=zs(g,I);if(!this.layers[0]._featureFilter.filter(new oe(this.zoom),A,r))continue;const k=p?p.evaluate(A,{},r):void 0,L={id:v,properties:g.properties,type:g.type,sourceLayerIndex:T,index:w,geometry:I?A.geometry:xo(g,r,s),patterns:{},sortKey:k};u.push(L)}p&&u.sort((g,v)=>g.sortKey-v.sortKey);let _=null;"globe"===s.projection.name&&(this.globeExtVertexArray=new Yt,_=s.projection);for(const g of u){const{geometry:v,index:w,sourceLayerIndex:T}=g,I=e[w].feature;this.addFeature(g,v,w,i.availableImages,r,_),i.featureIndex.insert(I,v,w,T,this.index)}}update(e,i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Vf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,s,c,u){for(const p of i)for(const _ of p){const g=_.x,v=_.y;if(g<0||g>=lt||v<0||v>=lt)continue;if(u){const I=u.projectTilePoint(g,v,c),A=u.upVector(c,g,v),k=this.globeExtVertexArray;th(k,I,A),th(k,I,A),th(k,I,A),th(k,I,A)}const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),T=w.vertexLength;eh(this.layoutVertexArray,g,v,-1,-1),eh(this.layoutVertexArray,g,v,1,-1),eh(this.layoutVertexArray,g,v,1,1),eh(this.layoutVertexArray,g,v,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},s,c)}}function vd(t,e){for(let i=0;i<t.length;i++)if(ks(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ks(t,e[i]))return!0;return!!tu(t,e)}function qf(t,e,i){return!!ks(t,e)||!!iu(e,t,i)}function bd(t,e){if(1===t.length)return Td(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let s=0;s<r.length;s++)if(ks(t,r[s]))return!0}for(let i=0;i<t.length;i++)if(Td(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(tu(t,e[i]))return!0;return!1}function $f(t,e,i){if(t.length>1){if(tu(t,e))return!0;for(let r=0;r<e.length;r++)if(iu(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(iu(t[r],e,i))return!0;return!1}function tu(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],s=t[i+1];for(let c=0;c<e.length-1;c++)if(Wf(r,s,e[c],e[c+1]))return!0}return!1}function Wf(t,e,i,r){return qi(t,i,r)!==qi(e,i,r)&&qi(t,e,i)!==qi(t,e,r)}function iu(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let s=1;s<e.length;s++)if(wd(t,e[s-1],e[s])<r)return!0;return!1}function wd(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const s=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(s<0?e:s>1?i:i.sub(e)._mult(s)._add(e))}function Td(t,e){let i,r,s,c=!1;for(let u=0;u<t.length;u++){i=t[u];for(let p=0,_=i.length-1;p<i.length;_=p++)r=i[p],s=i[_],r.y>e.y!=s.y>e.y&&e.x<(s.x-r.x)*(e.y-r.y)/(s.y-r.y)+r.x&&(c=!c)}return c}function ks(t,e){let i=!1;for(let r=0,s=t.length-1;r<t.length;s=r++){const c=t[r],u=t[s];c.y>e.y!=u.y>e.y&&e.x<(u.x-c.x)*(e.y-c.y)/(u.y-c.y)+c.x&&(i=!i)}return i}function Ed(t,e,i,r,s){for(const u of t)if(e<=u.x&&i<=u.y&&r>=u.x&&s>=u.y)return!0;const c=[new Be(e,i),new Be(e,s),new Be(r,s),new Be(r,i)];if(t.length>2)for(const u of c)if(ks(t,u))return!0;for(let u=0;u<t.length-1;u++)if(Xf(t[u],t[u+1],c))return!0;return!1}function Xf(t,e,i){const r=i[0],s=i[2];if(t.x<r.x&&e.x<r.x||t.x>s.x&&e.x>s.x||t.y<r.y&&e.y<r.y||t.y>s.y&&e.y>s.y)return!1;const c=qi(t,e,i[0]);return c!==qi(t,e,i[1])||c!==qi(t,e,i[2])||c!==qi(t,e,i[3])}function wa(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function ih(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Md(t,e,i,r,s){if(!e[0]&&!e[1])return t;const c=Be.convert(e)._mult(s);"viewport"===i&&c._rotate(-r);const u=[];for(let p=0;p<t.length;p++)u.push(t[p].sub(c));return u}function Cd(t,e,i,r){const s=Be.convert(t)._mult(r);return"viewport"===e&&s._rotate(-i),s}$e(eu,"CircleBucket",{omit:["layers"]});const Hf=new Qe({"circle-sort-key":new _e(be.layout_circle["circle-sort-key"])});var Yf={paint:new Qe({"circle-radius":new _e(be.paint_circle["circle-radius"]),"circle-color":new _e(be.paint_circle["circle-color"]),"circle-blur":new _e(be.paint_circle["circle-blur"]),"circle-opacity":new _e(be.paint_circle["circle-opacity"]),"circle-translate":new se(be.paint_circle["circle-translate"]),"circle-translate-anchor":new se(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new se(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new se(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _e(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _e(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _e(be.paint_circle["circle-stroke-opacity"])}),layout:Hf},nh=1e-6,_n=typeof Float32Array<"u"?Float32Array:Array;function Id(){var t=new _n(9);return _n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Ad(t,e,i){var r=e[0],s=e[1],c=e[2],u=e[3],p=e[4],_=e[5],g=e[6],v=e[7],w=e[8],T=i[0],I=i[1],A=i[2],k=i[3],L=i[4],W=i[5],J=i[6],$=i[7],Y=i[8];return t[0]=T*r+I*u+A*g,t[1]=T*s+I*p+A*v,t[2]=T*c+I*_+A*w,t[3]=k*r+L*u+W*g,t[4]=k*s+L*p+W*v,t[5]=k*c+L*_+W*w,t[6]=J*r+$*u+Y*g,t[7]=J*s+$*p+Y*v,t[8]=J*c+$*_+Y*w,t}function fr(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nu(t,e){var i=e[0],r=e[1],s=e[2],c=e[3],u=e[4],p=e[5],_=e[6],g=e[7],v=e[8],w=e[9],T=e[10],I=e[11],A=e[12],k=e[13],L=e[14],W=e[15],J=i*p-r*u,$=i*_-s*u,Y=i*g-c*u,ee=r*_-s*p,K=r*g-c*p,fe=s*g-c*_,pe=v*k-w*A,we=v*L-T*A,Pe=v*W-I*A,ye=w*L-T*k,Ee=w*W-I*k,Me=T*W-I*L,ze=J*Me-$*Ee+Y*ye+ee*Pe-K*we+fe*pe;return ze?(t[0]=(p*Me-_*Ee+g*ye)*(ze=1/ze),t[1]=(s*Ee-r*Me-c*ye)*ze,t[2]=(k*fe-L*K+W*ee)*ze,t[3]=(T*K-w*fe-I*ee)*ze,t[4]=(_*Pe-u*Me-g*we)*ze,t[5]=(i*Me-s*Pe+c*we)*ze,t[6]=(L*Y-A*fe-W*$)*ze,t[7]=(v*fe-T*Y+I*$)*ze,t[8]=(u*Ee-p*Pe+g*pe)*ze,t[9]=(r*Pe-i*Ee-c*pe)*ze,t[10]=(A*K-k*Y+W*J)*ze,t[11]=(w*Y-v*K-I*J)*ze,t[12]=(p*we-u*ye-_*pe)*ze,t[13]=(i*ye-r*we+s*pe)*ze,t[14]=(k*$-A*ee-L*J)*ze,t[15]=(v*ee-w*$+T*J)*ze,t):null}function Ds(t,e,i){var r=e[0],s=e[1],c=e[2],u=e[3],p=e[4],_=e[5],g=e[6],v=e[7],w=e[8],T=e[9],I=e[10],A=e[11],k=e[12],L=e[13],W=e[14],J=e[15],$=i[0],Y=i[1],ee=i[2],K=i[3];return t[0]=$*r+Y*p+ee*w+K*k,t[1]=$*s+Y*_+ee*T+K*L,t[2]=$*c+Y*g+ee*I+K*W,t[3]=$*u+Y*v+ee*A+K*J,t[4]=($=i[4])*r+(Y=i[5])*p+(ee=i[6])*w+(K=i[7])*k,t[5]=$*s+Y*_+ee*T+K*L,t[6]=$*c+Y*g+ee*I+K*W,t[7]=$*u+Y*v+ee*A+K*J,t[8]=($=i[8])*r+(Y=i[9])*p+(ee=i[10])*w+(K=i[11])*k,t[9]=$*s+Y*_+ee*T+K*L,t[10]=$*c+Y*g+ee*I+K*W,t[11]=$*u+Y*v+ee*A+K*J,t[12]=($=i[12])*r+(Y=i[13])*p+(ee=i[14])*w+(K=i[15])*k,t[13]=$*s+Y*_+ee*T+K*L,t[14]=$*c+Y*g+ee*I+K*W,t[15]=$*u+Y*v+ee*A+K*J,t}function wl(t,e,i){var r,s,c,u,p,_,g,v,w,T,I,A,k=i[0],L=i[1],W=i[2];return e===t?(t[12]=e[0]*k+e[4]*L+e[8]*W+e[12],t[13]=e[1]*k+e[5]*L+e[9]*W+e[13],t[14]=e[2]*k+e[6]*L+e[10]*W+e[14],t[15]=e[3]*k+e[7]*L+e[11]*W+e[15]):(s=e[1],c=e[2],u=e[3],p=e[4],_=e[5],g=e[6],v=e[7],w=e[8],T=e[9],I=e[10],A=e[11],t[0]=r=e[0],t[1]=s,t[2]=c,t[3]=u,t[4]=p,t[5]=_,t[6]=g,t[7]=v,t[8]=w,t[9]=T,t[10]=I,t[11]=A,t[12]=r*k+p*L+w*W+e[12],t[13]=s*k+_*L+T*W+e[13],t[14]=c*k+g*L+I*W+e[14],t[15]=u*k+v*L+A*W+e[15]),t}function Ps(t,e,i){var r=i[0],s=i[1],c=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ru(t,e,i){var r=Math.sin(i),s=Math.cos(i),c=e[4],u=e[5],p=e[6],_=e[7],g=e[8],v=e[9],w=e[10],T=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*s+g*r,t[5]=u*s+v*r,t[6]=p*s+w*r,t[7]=_*s+T*r,t[8]=g*s-c*r,t[9]=v*s-u*r,t[10]=w*s-p*r,t[11]=T*s-_*r,t}function rh(t,e,i){var r=Math.sin(i),s=Math.cos(i),c=e[0],u=e[1],p=e[2],_=e[3],g=e[8],v=e[9],w=e[10],T=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s-g*r,t[1]=u*s-v*r,t[2]=p*s-w*r,t[3]=_*s-T*r,t[8]=c*r+g*s,t[9]=u*r+v*s,t[10]=p*r+w*s,t[11]=_*r+T*s,t}function Sd(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zd(t,e,i){var r,s,c,u=i[0],p=i[1],_=i[2],g=Math.hypot(u,p,_);return g<nh?null:(u*=g=1/g,p*=g,_*=g,r=Math.sin(e),s=Math.cos(e),t[0]=u*u*(c=1-s)+s,t[1]=p*u*c+_*r,t[2]=_*u*c-p*r,t[3]=0,t[4]=u*p*c-_*r,t[5]=p*p*c+s,t[6]=_*p*c+u*r,t[7]=0,t[8]=u*_*c+p*r,t[9]=p*_*c-u*r,t[10]=_*_*c+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Jf=Ds;function ou(){var t=new _n(3);return _n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function kd(t){var e=new _n(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Tl(t){return Math.hypot(t[0],t[1],t[2])}function Ta(t,e,i){var r=new _n(3);return r[0]=t,r[1]=e,r[2]=i,r}function vo(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function su(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Dd(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function El(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function Ml(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function An(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Cl(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Hi(t,e){var i=e[0],r=e[1],s=e[2],c=i*i+r*r+s*s;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t}function Jn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function au(t,e,i){var r=e[0],s=e[1],c=e[2],u=i[0],p=i[1],_=i[2];return t[0]=s*_-c*p,t[1]=c*u-r*_,t[2]=r*p-s*u,t}function hi(t,e,i){var r=e[0],s=e[1],c=e[2],u=i[3]*r+i[7]*s+i[11]*c+i[15];return t[0]=(i[0]*r+i[4]*s+i[8]*c+i[12])/(u=u||1),t[1]=(i[1]*r+i[5]*s+i[9]*c+i[13])/u,t[2]=(i[2]*r+i[6]*s+i[10]*c+i[14])/u,t}function Pd(t,e,i){var r=i[0],s=i[1],c=i[2],u=e[0],p=e[1],_=e[2],g=s*_-c*p,v=c*u-r*_,w=r*p-s*u,T=s*w-c*v,I=c*g-r*w,A=r*v-s*g,k=2*i[3];return v*=k,w*=k,I*=2,A*=2,t[0]=u+(g*=k)+(T*=2),t[1]=p+v+I,t[2]=_+w+A,t}var Il,mr=su,Kf=Dd,Qf=Tl;function Ld(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Od(t,e){var i=e[0],r=e[1],s=e[2],c=e[3],u=i*i+r*r+s*s+c*c;return u>0&&(u=1/Math.sqrt(u)),t[0]=i*u,t[1]=r*u,t[2]=s*u,t[3]=c*u,t}function Ls(t,e,i){var r=e[0],s=e[1],c=e[2],u=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*c+i[12]*u,t[1]=i[1]*r+i[5]*s+i[9]*c+i[13]*u,t[2]=i[2]*r+i[6]*s+i[10]*c+i[14]*u,t[3]=i[3]*r+i[7]*s+i[11]*c+i[15]*u,t}function Rd(){var t=new _n(4);return _n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Bd(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Fd(t,e,i){i*=.5;var r=e[0],s=e[1],c=e[2],u=e[3],p=Math.sin(i),_=Math.cos(i);return t[0]=r*_+u*p,t[1]=s*_+c*p,t[2]=c*_-s*p,t[3]=u*_-r*p,t}function Ud(t,e,i){i*=.5;var r=e[0],s=e[1],c=e[2],u=e[3],p=Math.sin(i),_=Math.cos(i);return t[0]=r*_-c*p,t[1]=s*_+u*p,t[2]=c*_+r*p,t[3]=u*_-s*p,t}ou(),Il=new _n(4),_n!=Float32Array&&(Il[0]=0,Il[1]=0,Il[2]=0,Il[3]=0);var em=Od;ou(),Ta(1,0,0),Ta(0,1,0),Rd(),Rd(),Id();class lu{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const s=Jn(i,this.dir);if(Math.abs(s)<1e-6)return!1;const c=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/s;return r[0]=this.pos[0]+this.dir[0]*c,r[1]=this.pos[1]+this.dir[1]*c,r[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,i,r){if(k=(I=this.pos)[0],L=I[1],W=I[2],J=(A=e)[0],$=A[1],Y=A[2],Math.abs(k-J)<=nh*Math.max(1,Math.abs(k),Math.abs(J))&&Math.abs(L-$)<=nh*Math.max(1,Math.abs(L),Math.abs($))&&Math.abs(W-Y)<=nh*Math.max(1,Math.abs(W),Math.abs(Y))||0===i)return r[0]=r[1]=r[2]=0,!1;var I,A,k,L,W,J,$,Y;const[s,c,u]=this.dir,p=this.pos[0]-e[0],_=this.pos[1]-e[1],g=this.pos[2]-e[2],v=s*s+c*c+u*u,w=2*(p*s+_*c+g*u),T=w*w-4*v*(p*p+_*_+g*g-i*i);if(T<0){const I=Math.max(-w/2,0),A=p+s*I,k=_+c*I,L=g+u*I,W=Math.hypot(A,k,L);return r[0]=A*i/W,r[1]=k*i/W,r[2]=L*i/W,!1}{const I=(-w-Math.sqrt(T))/(2*v);if(I<0){const A=Math.hypot(p,_,g);return r[0]=p*i/A,r[1]=_*i/A,r[2]=g*i/A,!1}return r[0]=p+s*I,r[1]=_+c*I,r[2]=g+u*I,!0}}}class cu{constructor(e,i,r,s,c){this.TL=e,this.TR=i,this.BR=r,this.BL=s,this.horizon=c}static fromInvProjectionMatrix(e,i,r){const s=[-1,1,1],c=[1,1,1],u=[1,-1,1],p=[-1,-1,1],_=hi(s,s,e),g=hi(c,c,e),v=hi(u,u,e),w=hi(p,p,e);return new cu(_,g,v,w,i/r)}}class hu{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,r,s){const c=Math.pow(2,r),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const g=Ls([],_,e),v=1/g[3]/i*c;return(w=g)[0]=(T=g)[0]*(I=[v,v,s?1/g[3]:v,v])[0],w[1]=T[1]*I[1],w[2]=T[2]*I[2],w[3]=T[3]*I[3],w;var w,T,I}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const g=Hi([],au([],mr([],u[_[0]],u[_[1]]),mr([],u[_[2]],u[_[1]]))),v=-Jn(g,u[_[1]]);return g.concat(v)});return new hu(u,p)}}class Yi{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const s of e)El(i,i,s),Ml(r,r,s);return new Yi(i,r)}static applyTransform(e,i){const r=e.getCorners();for(let s=0;s<r.length;++s)hi(r[s],r[s],i);return Yi.fromPoints(r)}constructor(e,i){this.min=e,this.max=i,this.center=An([],vo([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=kd(this.min),s=kd(this.max);for(let c=0;c<i.length;c++)r[c]=i[c]?this.min[c]:this.center[c],s[c]=i[c]?this.center[c]:this.max[c];return s[2]=this.max[2],new Yi(r,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let r=!0;for(let s=0;s<e.planes.length;s++){const c=e.planes[s];let u=0;for(let p=0;p<i.length;p++)u+=Jn(c,i[p])+c[3]>=0;if(0===u)return 0;u!==i.length&&(r=!1)}if(r)return 2;for(let s=0;s<3;s++){let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let p=0;p<e.points.length;p++){const _=e.points[p][s]-this.min[s];c=Math.min(c,_),u=Math.max(u,_)}if(u<0||c>this.max[s]-this.min[s])return 0}return 1}}function Zd(t,e,i,r,s,c,u,p,_){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(_*=t.pixelToTileUnitsFactor);const g=t.tileID.canonical,v=i.projection.upVectorScale(g,i.center.lat,i.worldSize).metersToTile;for(const w of e)for(const T of w){const I=T.add(p),A=s&&i.elevation?i.elevation.exaggeration()*s.getElevationAt(I.x,I.y,!0):0,k=i.projection.projectTilePoint(I.x,I.y,g);if(A>0){const $=i.projection.upVector(g,I.x,I.y);k.x+=$[0]*v*A,k.y+=$[1]*v*A,k.z+=$[2]*v*A}const L=c?I:tm(k.x,k.y,k.z,r),W=c?t.tilespaceRays.map($=>nm($,A)):t.queryGeometry.screenGeometry,J=Ls([],[k.x,k.y,k.z,1],r);if(!u&&c?_*=J[3]/i.cameraToCenterDistance:u&&!c&&(_*=i.cameraToCenterDistance/J[3]),c){const $=Ri((T.y/lt+g.y)/(1<<g.z));_/=i.projection.pixelsPerMeter($,1)/Yn(1,$)}if(qf(W,L,_))return!0}return!1}function tm(t,e,i,r){const s=Ls([],[t,e,i,1],r);return new Be(s[0]/s[3],s[1]/s[3])}const Nd=Ta(0,0,0),im=Ta(0,0,1);function nm(t,e){const i=ou();return Nd[2]=e,t.intersectsPlane(Nd,im,i),new Be(i[0],i[1])}class Vd extends eu{}function jd(t,{width:e,height:i},r,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*i*r)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=s,t}function Gd(t,e,i){const{width:r,height:s}=e;r===t.width&&s===t.height||(uu(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,s)},i),t.width=r,t.height=s,t.data=e.data)}function uu(t,e,i,r,s,c){if(0===s.width||0===s.height)return e;if(s.width>t.width||s.height>t.height||i.x>t.width-s.width||i.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||r.x>e.width-s.width||r.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const u=t.data,p=e.data;for(let _=0;_<s.height;_++){const g=((i.y+_)*t.width+i.x)*c,v=((r.y+_)*e.width+r.x)*c;for(let w=0;w<s.width*c;w++)p[v+w]=u[g+w]}return e}$e(Vd,"HeatmapBucket",{omit:["layers"]});class bo{constructor(e,i){jd(this,e,1,i)}resize(e){Gd(this,new bo(e),1)}clone(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,s,c){uu(e,i,r,s,c,1)}}class gn{constructor(e,i){jd(this,e,4,i)}resize(e){Gd(this,new gn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new gn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,s,c){uu(e,i,r,s,c,4)}}$e(bo,"AlphaImage"),$e(gn,"RGBAImage");var rm={paint:new Qe({"heatmap-radius":new _e(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _e(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new se(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xe(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new se(be.paint_heatmap["heatmap-opacity"])})};function du(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,s=t.image||new gn({width:i,height:r}),c=(u,p,_)=>{e[t.evaluationKey]=_;const g=t.expression.evaluate(e);s.data[u+p+0]=Math.floor(255*g.r/g.a),s.data[u+p+1]=Math.floor(255*g.g/g.a),s.data[u+p+2]=Math.floor(255*g.b/g.a),s.data[u+p+3]=Math.floor(255*g.a)};if(t.clips)for(let u=0,p=0;u<r;++u,p+=4*i)for(let _=0,g=0;_<i;_++,g+=4){const v=_/(i-1),{start:w,end:T}=t.clips[u];c(p,g,w*(1-v)+T*v)}else for(let u=0,p=0;u<i;u++,p+=4)c(0,p,u/(i-1));return s}var om={paint:new Qe({"hillshade-illumination-direction":new se(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new se(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new se(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new se(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new se(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new se(be.paint_hillshade["hillshade-accent-color"])})};const sm=qe([{name:"a_pos",components:2,type:"Int16"}],4),{members:am}=sm;var Al={exports:{}};function oh(t,e,i){i=i||2;var r,s,c,u,p,_,g,v=e&&e.length,w=v?e[0]*i:t.length,T=qd(t,0,w,i,!0),I=[];if(!T||T.next===T.prev)return I;if(v&&(T=function(k,L,W,J){var $,Y,ee,K=[];for($=0,Y=L.length;$<Y;$++)(ee=qd(k,L[$]*J,$<Y-1?L[$+1]*J:k.length,J,!1))===ee.next&&(ee.steiner=!0),K.push(mm(ee));for(K.sort(dm),$=0;$<K.length;$++)W=pm(K[$],W);return W}(t,e,T,i)),t.length>80*i){r=c=t[0],s=u=t[1];for(var A=i;A<w;A+=i)(p=t[A])<r&&(r=p),(_=t[A+1])<s&&(s=_),p>c&&(c=p),_>u&&(u=_);g=0!==(g=Math.max(c-r,u-s))?32767/g:0}return Sl(T,I,i,r,s,g,0),I}function qd(t,e,i,r,s){var c,u;if(s===mu(t,e,i,r)>0)for(c=e;c<i;c+=r)u=Xd(c,t[c],t[c+1],u);else for(c=i-r;c>=e;c-=r)u=Xd(c,t[c],t[c+1],u);return u&&sh(u,u.next)&&(kl(u),u=u.next),u}function Os(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!sh(r,r.next)&&0!==mi(r.prev,r,r.next))r=r.next;else{if(kl(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function Sl(t,e,i,r,s,c,u){if(t){!u&&c&&function(v,w,T,I){var A=v;do{0===A.z&&(A.z=pu(A.x,A.y,w,T,I)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next}while(A!==v);A.prevZ.nextZ=null,A.prevZ=null,function(k){var L,W,J,$,Y,ee,K,fe,pe=1;do{for(W=k,k=null,Y=null,ee=0;W;){for(ee++,J=W,K=0,L=0;L<pe&&(K++,J=J.nextZ);L++);for(fe=pe;K>0||fe>0&&J;)0!==K&&(0===fe||!J||W.z<=J.z)?($=W,W=W.nextZ,K--):($=J,J=J.nextZ,fe--),Y?Y.nextZ=$:k=$,$.prevZ=Y,Y=$;W=J}Y.nextZ=null,pe*=2}while(ee>1)}(A)}(t,r,s,c);for(var p,_,g=t;t.prev!==t.next;)if(p=t.prev,_=t.next,c?cm(t,r,s,c):lm(t))e.push(p.i/i|0),e.push(t.i/i|0),e.push(_.i/i|0),kl(t),t=_.next,g=_.next;else if((t=_)===g){u?1===u?Sl(t=hm(Os(t),e,i),e,i,r,s,c,2):2===u&&um(t,e,i,r,s,c):Sl(Os(t),e,i,r,s,c,1);break}}}function lm(t){var e=t.prev,i=t,r=t.next;if(mi(e,i,r)>=0)return!1;for(var s=e.x,c=i.x,u=r.x,p=e.y,_=i.y,g=r.y,v=s<c?s<u?s:u:c<u?c:u,w=p<_?p<g?p:g:_<g?_:g,T=s>c?s>u?s:u:c>u?c:u,I=p>_?p>g?p:g:_>g?_:g,A=r.next;A!==e;){if(A.x>=v&&A.x<=T&&A.y>=w&&A.y<=I&&Ea(s,p,c,_,u,g,A.x,A.y)&&mi(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function cm(t,e,i,r){var s=t.prev,c=t,u=t.next;if(mi(s,c,u)>=0)return!1;for(var p=s.x,_=c.x,g=u.x,v=s.y,w=c.y,T=u.y,I=p<_?p<g?p:g:_<g?_:g,A=v<w?v<T?v:T:w<T?w:T,k=p>_?p>g?p:g:_>g?_:g,L=v>w?v>T?v:T:w>T?w:T,W=pu(I,A,e,i,r),J=pu(k,L,e,i,r),$=t.prevZ,Y=t.nextZ;$&&$.z>=W&&Y&&Y.z<=J;){if($.x>=I&&$.x<=k&&$.y>=A&&$.y<=L&&$!==s&&$!==u&&Ea(p,v,_,w,g,T,$.x,$.y)&&mi($.prev,$,$.next)>=0||($=$.prevZ,Y.x>=I&&Y.x<=k&&Y.y>=A&&Y.y<=L&&Y!==s&&Y!==u&&Ea(p,v,_,w,g,T,Y.x,Y.y)&&mi(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;$&&$.z>=W;){if($.x>=I&&$.x<=k&&$.y>=A&&$.y<=L&&$!==s&&$!==u&&Ea(p,v,_,w,g,T,$.x,$.y)&&mi($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;Y&&Y.z<=J;){if(Y.x>=I&&Y.x<=k&&Y.y>=A&&Y.y<=L&&Y!==s&&Y!==u&&Ea(p,v,_,w,g,T,Y.x,Y.y)&&mi(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function hm(t,e,i){var r=t;do{var s=r.prev,c=r.next.next;!sh(s,c)&&$d(s,r,r.next,c)&&zl(s,c)&&zl(c,s)&&(e.push(s.i/i|0),e.push(r.i/i|0),e.push(c.i/i|0),kl(r),kl(r.next),r=t=c),r=r.next}while(r!==t);return Os(r)}function um(t,e,i,r,s,c){var u=t;do{for(var p=u.next.next;p!==u.prev;){if(u.i!==p.i&&_m(u,p)){var _=Wd(u,p);return u=Os(u,u.next),_=Os(_,_.next),Sl(u,e,i,r,s,c,0),void Sl(_,e,i,r,s,c,0)}p=p.next}u=u.next}while(u!==t)}function dm(t,e){return t.x-e.x}function pm(t,e){var i=function(s,c){var u,p=c,_=s.x,g=s.y,v=-1/0;do{if(g<=p.y&&g>=p.next.y&&p.next.y!==p.y){var w=p.x+(g-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(w<=_&&w>v&&(v=w,u=p.x<p.next.x?p:p.next,w===_))return u}p=p.next}while(p!==c);if(!u)return null;var T,I=u,A=u.x,k=u.y,L=1/0;p=u;do{_>=p.x&&p.x>=A&&_!==p.x&&Ea(g<k?_:v,g,A,k,g<k?v:_,g,p.x,p.y)&&(T=Math.abs(g-p.y)/(_-p.x),zl(p,s)&&(T<L||T===L&&(p.x>u.x||p.x===u.x&&fm(u,p)))&&(u=p,L=T)),p=p.next}while(p!==I);return u}(t,e);if(!i)return e;var r=Wd(i,t);return Os(r,r.next),Os(i,i.next)}function fm(t,e){return mi(t.prev,t,e.prev)<0&&mi(e.next,t,t.next)<0}function pu(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function mm(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Ea(t,e,i,r,s,c,u,p){return(s-u)*(e-p)>=(t-u)*(c-p)&&(t-u)*(r-p)>=(i-u)*(e-p)&&(i-u)*(c-p)>=(s-u)*(r-p)}function _m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var s=i;do{if(s.i!==i.i&&s.next.i!==i.i&&s.i!==r.i&&s.next.i!==r.i&&$d(s,s.next,i,r))return!0;s=s.next}while(s!==i);return!1}(t,e)&&(zl(t,e)&&zl(e,t)&&function(i,r){var s=i,c=!1,u=(i.x+r.x)/2,p=(i.y+r.y)/2;do{s.y>p!=s.next.y>p&&s.next.y!==s.y&&u<(s.next.x-s.x)*(p-s.y)/(s.next.y-s.y)+s.x&&(c=!c),s=s.next}while(s!==i);return c}(t,e)&&(mi(t.prev,t,e.prev)||mi(t,e.prev,e))||sh(t,e)&&mi(t.prev,t,t.next)>0&&mi(e.prev,e,e.next)>0)}function mi(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function sh(t,e){return t.x===e.x&&t.y===e.y}function $d(t,e,i,r){var s=lh(mi(t,e,i)),c=lh(mi(t,e,r)),u=lh(mi(i,r,t)),p=lh(mi(i,r,e));return s!==c&&u!==p||!(0!==s||!ah(t,i,e))||!(0!==c||!ah(t,r,e))||!(0!==u||!ah(i,t,r))||!(0!==p||!ah(i,e,r))}function ah(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function lh(t){return t>0?1:t<0?-1:0}function zl(t,e){return mi(t.prev,t,t.next)<0?mi(t,e,t.next)>=0&&mi(t,t.prev,e)>=0:mi(t,e,t.prev)<0||mi(t,t.next,e)<0}function Wd(t,e){var i=new fu(t.i,t.x,t.y),r=new fu(e.i,e.x,e.y),s=t.next,c=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,c.next=r,r.prev=c,r}function Xd(t,e,i,r){var s=new fu(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function kl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function fu(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function mu(t,e,i,r){for(var s=0,c=e,u=i-r;c<i;c+=r)s+=(t[u]-t[c])*(t[c+1]+t[u+1]),u=c;return s}function gm(t,e,i,r,s){Hd(t,e,i||0,r||t.length-1,s||ym)}function Hd(t,e,i,r,s){for(;r>i;){if(r-i>600){var c=r-i+1,u=e-i+1,p=Math.log(c),_=.5*Math.exp(2*p/3),g=.5*Math.sqrt(p*_*(c-_)/c)*(u-c/2<0?-1:1);Hd(t,e,Math.max(i,Math.floor(e-u*_/c+g)),Math.min(r,Math.floor(e+(c-u)*_/c+g)),s)}var v=t[e],w=i,T=r;for(Dl(t,i,e),s(t[r],v)>0&&Dl(t,i,r);w<T;){for(Dl(t,w,T),w++,T--;s(t[w],v)<0;)w++;for(;s(t[T],v)>0;)T--}0===s(t[i],v)?Dl(t,i,T):Dl(t,++T,r),T<=e&&(i=T+1),e<=T&&(r=T-1)}}function Dl(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function ym(t,e){return t<e?-1:t>e?1:0}function _u(t,e){const i=t.length;if(i<=1)return[t];const r=[];let s,c;for(let u=0;u<i;u++){const p=Mt(t[u]);0!==p&&(t[u].area=Math.abs(p),void 0===c&&(c=p<0),c===p<0?(s&&r.push(s),s=[t[u]]):s.push(t[u]))}if(s&&r.push(s),e>1)for(let u=0;u<r.length;u++)r[u].length<=e||(gm(r[u],e,1,r[u].length-1,xm),r[u]=r[u].slice(0,e));return r}function xm(t,e){return e.area-t.area}function gu(t,e,i){const r=i.patternDependencies;let s=!1;for(const c of e){const u=c.paint.get(`${t}-pattern`);u.isConstant()||(s=!0);const p=u.constantOr(null);p&&(s=!0,r[p]=!0)}return s}function yu(t,e,i,r,s){const c=s.patternDependencies;for(const u of e){const p=u.paint.get(`${t}-pattern`).value;if("constant"!==p.kind){let _=p.evaluate({zoom:r},i,{},s.availableImages);_=_&&_.name?_.name:_,c[_]=!0,i.patterns[u.id]=_}}return i}Al.exports=oh,Al.exports.default=oh,oh.deviation=function(t,e,i,r){var s=e&&e.length,c=Math.abs(mu(t,0,s?e[0]*i:t.length,i));if(s)for(var u=0,p=e.length;u<p;u++)c-=Math.abs(mu(t,e[u]*i,u<p-1?e[u+1]*i:t.length,i));var _=0;for(u=0;u<r.length;u+=3){var g=r[u]*i,v=r[u+1]*i,w=r[u+2]*i;_+=Math.abs((t[g]-t[w])*(t[v+1]-t[g+1])-(t[g]-t[v])*(t[w+1]-t[g+1]))}return 0===c&&0===_?0:Math.abs((_-c)/c)},oh.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var c=0;c<t[s].length;c++)for(var u=0;u<e;u++)i.vertices.push(t[s][c][u]);s>0&&i.holes.push(r+=t[s-1].length)}return i};class ch{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new kt,this.indexArray=new Oi,this.indexArray2=new Hn,this.programConfigurations=new Ss(e.layers,e.zoom),this.segments=new gi,this.segments2=new gi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,s){this.hasPattern=gu("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),u=[];for(const{feature:p,id:_,index:g,sourceLayerIndex:v}of e){const w=this.layers[0]._featureFilter.needGeometry,T=zs(p,w);if(!this.layers[0]._featureFilter.filter(new oe(this.zoom),T,r))continue;const I=c?c.evaluate(T,{},r,i.availableImages):void 0,A={id:_,properties:p.properties,type:p.type,sourceLayerIndex:v,index:g,geometry:w?T.geometry:xo(p,r,s),patterns:{},sortKey:I};u.push(A)}c&&u.sort((p,_)=>p.sortKey-_.sortKey);for(const p of u){const{geometry:_,index:g,sourceLayerIndex:v}=p;if(this.hasPattern){const w=yu("fill",this.layers,p,this.zoom,i);this.patternFeatures.push(w)}else this.addFeature(p,_,g,r,{},i.availableImages);i.featureIndex.insert(e[g].feature,_,g,v,this.index)}}update(e,i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,s)}addFeatures(e,i,r,s,c){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,am),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,s,c,u=[]){for(const p of _u(i,500)){let _=0;for(const A of p)_+=A.length;const g=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),v=g.vertexLength,w=[],T=[];for(const A of p){if(0===A.length)continue;A!==p[0]&&T.push(w.length/2);const k=this.segments2.prepareSegment(A.length,this.layoutVertexArray,this.indexArray2),L=k.vertexLength;this.layoutVertexArray.emplaceBack(A[0].x,A[0].y),this.indexArray2.emplaceBack(L+A.length-1,L),w.push(A[0].x),w.push(A[0].y);for(let W=1;W<A.length;W++)this.layoutVertexArray.emplaceBack(A[W].x,A[W].y),this.indexArray2.emplaceBack(L+W-1,L+W),w.push(A[W].x),w.push(A[W].y);k.vertexLength+=A.length,k.primitiveLength+=A.length}const I=Al.exports(w,T);for(let A=0;A<I.length;A+=3)this.indexArray.emplaceBack(v+I[A],v+I[A+1],v+I[A+2]);g.vertexLength+=_,g.primitiveLength+=I.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,u,s)}}$e(ch,"FillBucket",{omit:["layers","patternFeatures"]});const vm=new Qe({"fill-sort-key":new _e(be.layout_fill["fill-sort-key"])});var bm={paint:new Qe({"fill-antialias":new se(be.paint_fill["fill-antialias"]),"fill-opacity":new _e(be.paint_fill["fill-opacity"]),"fill-color":new _e(be.paint_fill["fill-color"]),"fill-outline-color":new _e(be.paint_fill["fill-outline-color"]),"fill-translate":new se(be.paint_fill["fill-translate"]),"fill-translate-anchor":new se(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new _e(be.paint_fill["fill-pattern"])}),layout:vm};const wm=qe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Tm=qe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Em=qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Mm}=wm;var hh={},Cm=Be,Yd=Ma;function Ma(t,e,i,r,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=s,t.readFields(Im,this,e)}function Im(t,e,i){1==t?e.id=i.readVarint():2==t?function(r,s){for(var c=r.readVarint()+r.pos;r.pos<c;){var u=s._keys[r.readVarint()],p=s._values[r.readVarint()];s.properties[u]=p}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function Am(t){for(var e,i,r=0,s=0,c=t.length,u=c-1;s<c;u=s++)r+=((i=t[u]).x-(e=t[s]).x)*(e.y+i.y);return r}Ma.types=["Unknown","Point","LineString","Polygon"],Ma.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,s=0,c=0,u=0,p=[];t.pos<i;){if(s<=0){var _=t.readVarint();r=7&_,s=_>>3}if(s--,1===r||2===r)c+=t.readSVarint(),u+=t.readSVarint(),1===r&&(e&&p.push(e),e=[]),e.push(new Cm(c,u));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&p.push(e),p},Ma.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,s=0,c=0,u=1/0,p=-1/0,_=1/0,g=-1/0;t.pos<e;){if(r<=0){var v=t.readVarint();i=7&v,r=v>>3}if(r--,1===i||2===i)(s+=t.readSVarint())<u&&(u=s),s>p&&(p=s),(c+=t.readSVarint())<_&&(_=c),c>g&&(g=c);else if(7!==i)throw new Error("unknown command "+i)}return[u,_,p,g]},Ma.prototype.toGeoJSON=function(t,e,i){var r,s,c=this.extent*Math.pow(2,i),u=this.extent*t,p=this.extent*e,_=this.loadGeometry(),g=Ma.types[this.type];function v(I){for(var A=0;A<I.length;A++){var k=I[A];I[A]=[360*(k.x+u)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(k.y+p)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var w=[];for(r=0;r<_.length;r++)w[r]=_[r][0];v(_=w);break;case 2:for(r=0;r<_.length;r++)v(_[r]);break;case 3:for(_=function(I){var A=I.length;if(A<=1)return[I];for(var k,L,W=[],J=0;J<A;J++){var $=Am(I[J]);0!==$&&(void 0===L&&(L=$<0),L===$<0?(k&&W.push(k),k=[I[J]]):k.push(I[J]))}return k&&W.push(k),W}(_),r=0;r<_.length;r++)for(s=0;s<_[r].length;s++)v(_[r][s])}1===_.length?_=_[0]:g="Multi"+g;var T={type:"Feature",geometry:{type:g,coordinates:_},properties:this.properties};return"id"in this&&(T.id=this.id),T};var Sm=Yd,Jd=Kd;function Kd(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(zm,this,e),this.length=this._features.length}function zm(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(r){for(var s=null,c=r.readVarint()+r.pos;r.pos<c;){var u=r.readVarint()>>3;s=1===u?r.readString():2===u?r.readFloat():3===u?r.readDouble():4===u?r.readVarint64():5===u?r.readVarint():6===u?r.readSVarint():7===u?r.readBoolean():null}return s}(i))}Kd.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Sm(this._pbf,e,this.extent,this._keys,this._values)};var km=Jd;function Dm(t,e,i){if(3===t){var r=new km(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var xu=hh.VectorTile=function(t,e){this.layers=t.readFields(Dm,{},e)},uh=hh.VectorTileFeature=Yd;function dh(t,e,i,r){const s=[],c=0===r?(u,p,_,g,v,w)=>{u.push(new Be(w,_+(w-p)/(g-p)*(v-_)))}:(u,p,_,g,v,w)=>{u.push(new Be(p+(w-_)/(v-_)*(g-p),w))};for(const u of t){const p=[];for(const _ of u){if(_.length<=2)continue;const g=[];for(let T=0;T<_.length-1;T++){const I=_[T].x,A=_[T].y,k=_[T+1].x,L=_[T+1].y,W=0===r?I:A,J=0===r?k:L;W<e?J>e&&c(g,I,A,k,L,e):W>i?J<i&&c(g,I,A,k,L,i):g.push(_[T]),J<e&&W>=e&&c(g,I,A,k,L,e),J>i&&W<=i&&c(g,I,A,k,L,i)}let v=_[_.length-1];const w=0===r?v.x:v.y;w>=e&&w<=i&&g.push(v),g.length&&(v=g[g.length-1],g[0].x===v.x&&g[0].y===v.y||g.push(g[0]),p.push(g))}p.length&&s.push(p)}return s}hh.VectorTileLayer=Jd;const Pm=uh.types,Lm=Math.pow(2,13);function Pl(t,e,i,r,s,c,u,p){t.emplaceBack((e<<1)+u,(i<<1)+c,(Math.floor(r*Lm)<<1)+s,Math.round(p))}function Ll(t,e,i){t.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class Qd{constructor(){this.acc=new Be(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Be(e.x,e.y),this.max=new Be(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,s=this.max;e.x<r.x?r.x=e.x:e.x>s.x&&(s.x=e.x),e.y<r.y?r.y=e.y:e.y>s.y&&(s.y=e.y),((0===e.x||e.x===lt)&&e.x===i.x)!=((0===e.y||e.y===lt)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,At(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>lt!=e.x>lt&&this.addBorderIntersection(1,At(i.y,e.y,(lt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,At(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>lt!=e.y>lt&&this.addBorderIntersection(3,At(i.x,e.x,(lt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((i,r)=>i+r.edges,0);return 0!==e?this.acc.div(e)._round():new Be(0,0)}span(){return new Be(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Ol{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Zt,this.centroidVertexArray=new ad,this.indexArray=new Oi,this.programConfigurations=new Ss(e.layers,e.zoom),this.segments=new gi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,r,s){this.features=[],this.hasPattern=gu("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(c){const u=Math.exp(Math.PI*(1-c.y/(1<<c.z)*2));return 80150034*u/(u*u+1)/lt/(1<<c.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:u,index:p,sourceLayerIndex:_}of e){const g=this.layers[0]._featureFilter.needGeometry,v=zs(c,g);if(!this.layers[0]._featureFilter.filter(new oe(this.zoom),v,r))continue;const w={id:u,sourceLayerIndex:_,index:p,geometry:g?v.geometry:xo(c,r,s),properties:c.properties,type:c.type,patterns:{}},T=this.layoutVertexArray.length;this.hasPattern?this.features.push(yu("fill-extrusion",this.layers,w,this.zoom,i)):this.addFeature(w,w.geometry,p,r,{},i.availableImages,s),i.featureIndex.insert(c,w.geometry,p,_,this.index,T)}this.sortBorders()}addFeatures(e,i,r,s,c){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,i,r,s,c)}this.sortBorders()}update(e,i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Em.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Tm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,s,c,u,p){const _=[new Be(0,0),new Be(lt,lt)],g=p.projection,v="globe"===g.name,w=this.enableTerrain&&!v?new Qd:null,T="Polygon"===Pm[e.type];v&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Yt);const I=_u(i,500);for(let W=I.length-1;W>=0;W--){const J=I[W];(0===J.length||(A=J[0]).every($=>$.x<=0)||A.every($=>$.x>=lt)||A.every($=>$.y<=0)||A.every($=>$.y>=lt))&&I.splice(W,1)}var A;let k;if(v)k=sp(I,_,s);else{k=[];for(const W of I)k.push({polygon:W,bounds:_})}const L=T?this.edgeRadius:0;for(const{polygon:W,bounds:J}of k){let $=0,Y=0;for(const K of W)T&&!K[0].equals(K[K.length-1])&&K.push(K[0]),Y+=T?K.length-1:K.length;const ee=this.segments.prepareSegment((T?5:4)*Y,this.layoutVertexArray,this.indexArray);if(T){const K=[],fe=[];$=ee.vertexLength;for(const we of W){let Pe,ye;we.length&&we!==W[0]&&fe.push(K.length/2),Pe=we[1].sub(we[0])._perp()._unit();for(let Ee=1;Ee<we.length;Ee++){const Me=we[Ee],ze=we[Ee===we.length-1?1:Ee+1];let{x:Le,y:xe}=Me;if(L){ye=ze.sub(Me)._perp()._unit();const Fe=Pe.add(ye)._unit(),it=L*Math.min(4,1/(Pe.x*Fe.x+Pe.y*Fe.y));Le+=it*Fe.x,xe+=it*Fe.y,Pe=ye}Pl(this.layoutVertexArray,Le,xe,0,0,1,1,0),ee.vertexLength++,K.push(Me.x,Me.y),v&&Ll(this.layoutVertexExtArray,g.projectTilePoint(Le,xe,s),g.upVector(s,Le,xe))}}const pe=Al.exports(K,fe);for(let we=0;we<pe.length;we+=3)this.indexArray.emplaceBack($+pe[we],$+pe[we+2],$+pe[we+1]),ee.primitiveLength++}for(const K of W){w&&K.length&&w.startRing(K[0]);let fe,pe,we,Pe=K.length>4&&np(K[K.length-2],K[0],K[1]),ye=L?Om(K[K.length-2],K[0],K[1],L):0;pe=K[1].sub(K[0])._perp()._unit();let Ee=!0;for(let Me=1,ze=0;Me<K.length;Me++){let Le=K[Me-1],xe=K[Me];const Fe=K[Me===K.length-1?1:Me+1];if(w&&T&&w.currentPolyCount.top++,ip(xe,Le,J)){L&&(pe=Fe.sub(xe)._perp()._unit(),Ee=!Ee);continue}w&&w.append(xe,Le);const it=xe.sub(Le)._perp(),Ve=it.x/(Math.abs(it.x)+Math.abs(it.y)),Ye=it.y>0?1:0,Ue=Le.dist(xe);if(ze+Ue>32768&&(ze=0),L){we=Fe.sub(xe)._perp()._unit();let yt=tp(Le,xe,Fe,ep(pe,we),L);isNaN(yt)&&(yt=0);const at=xe.sub(Le)._unit();Le=Le.add(at.mult(ye))._round(),xe=xe.add(at.mult(-yt))._round(),ye=yt,pe=we}const rt=ee.vertexLength,wt=K.length>4&&np(Le,xe,Fe);let xt=rp(ze,Pe,Ee);if(Pl(this.layoutVertexArray,Le.x,Le.y,Ve,Ye,0,0,xt),Pl(this.layoutVertexArray,Le.x,Le.y,Ve,Ye,0,1,xt),ze+=Ue,xt=rp(ze,wt,!Ee),Pe=wt,Pl(this.layoutVertexArray,xe.x,xe.y,Ve,Ye,0,0,xt),Pl(this.layoutVertexArray,xe.x,xe.y,Ve,Ye,0,1,xt),ee.vertexLength+=4,this.indexArray.emplaceBack(rt+0,rt+1,rt+2),this.indexArray.emplaceBack(rt+1,rt+3,rt+2),ee.primitiveLength+=2,L){const yt=$+(1===Me?K.length-2:Me-2),at=1===Me?$:yt+1;if(this.indexArray.emplaceBack(rt+1,yt,rt+3),this.indexArray.emplaceBack(yt,at,rt+3),ee.primitiveLength+=2,void 0===fe&&(fe=rt),!ip(Fe,K[Me],J)){const Bt=Me===K.length-1?fe:ee.vertexLength;this.indexArray.emplaceBack(rt+2,rt+3,Bt),this.indexArray.emplaceBack(rt+3,Bt+1,Bt),this.indexArray.emplaceBack(rt+3,at,Bt+1),ee.primitiveLength+=3}Ee=!Ee}if(v){const yt=this.layoutVertexExtArray,at=g.projectTilePoint(Le.x,Le.y,s),Bt=g.projectTilePoint(xe.x,xe.y,s),ht=g.upVector(s,Le.x,Le.y),Tt=g.upVector(s,xe.x,xe.y);Ll(yt,at,ht),Ll(yt,at,ht),Ll(yt,Bt,Tt),Ll(yt,Bt,Tt)}}T&&($+=K.length-1)}}if(w&&w.polyCount.length>0){if(w.borders){w.vertexArrayOffset=this.centroidVertexArray.length;const W=w.borders,J=this.featuresOnBorder.push(w)-1;for(let $=0;$<4;$++)W[$][0]!==Number.MAX_VALUE&&this.borders[$].push(J)}this.encodeCentroid(w.borders?void 0:w.centroid(),w)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,u,s)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,i,r=!0){let s,c;if(e)if(0!==e.y){const p=i.span()._mult(this.tileToMeter);s=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(p.x/10)),c=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(p.y/10))}else s=Math.ceil(7*(e.x+450)),c=0;else s=0,c=+r;let u=r?this.centroidVertexArray.length:i.vertexArrayOffset;for(const p of i.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*p.edges+p.top);for(let _=0;_<p.top;_++)this.centroidVertexArray.emplace(u++,s,c);for(let _=0;_<2*p.edges;_++)this.centroidVertexArray.emplace(u++,0,c),this.centroidVertexArray.emplace(u++,s,c)}}}function ep(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function Om(t,e,i,r){const s=e.sub(t)._perp()._unit(),c=i.sub(e)._perp()._unit();return tp(t,e,i,ep(s,c),r)}function tp(t,e,i,r,s){const c=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,s*c/r)}function ip(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function np(t,e,i){if(t.x<0||t.x>=lt||e.x<0||e.x>=lt||i.x<0||i.x>=lt)return!1;const r=i.sub(e),s=r.perp(),c=t.sub(e);return(r.x*c.x+r.y*c.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(c.x*c.x+c.y*c.y))>-.866&&s.x*c.x+s.y*c.y<0}function rp(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function op(){const t=Math.PI/32,e=Math.tan(t),i=Qc;return i*Math.sqrt(1+2*e*e)-i}function sp(t,e,i){const r=1<<i.z,s=In(i.x/r),c=In((i.x+1)/r),u=Ri(i.y/r),p=Ri((i.y+1)/r);return function(_,g,v,w,T=0,I){const A=[];if(!_.length||!v||!w)return A;const k=(K,fe)=>{for(const pe of K)A.push({polygon:pe,bounds:fe})},L=Math.ceil(Math.log2(v)),W=Math.ceil(Math.log2(w)),J=L-W,$=[];for(let K=0;K<Math.abs(J);K++)$.push(J>0?0:1);for(let K=0;K<Math.min(L,W);K++)$.push(0),$.push(1);let Y=_;if(Y=dh(Y,g[0].y-T,g[1].y+T,1),Y=dh(Y,g[0].x-T,g[1].x+T,0),!Y.length)return A;const ee=[];for($.length?ee.push({polygons:Y,bounds:g,depth:0}):k(Y,g);ee.length;){const K=ee.pop(),fe=K.depth,pe=$[fe],we=K.bounds[0],Pe=K.bounds[1],ye=0===pe?we.x:we.y,Ee=0===pe?Pe.x:Pe.y,Me=I?I(pe,ye,Ee):.5*(ye+Ee),ze=dh(K.polygons,ye-T,Me+T,pe),Le=dh(K.polygons,Me-T,Ee+T,pe);if(ze.length){const xe=[we,new Be(0===pe?Me:Pe.x,1===pe?Me:Pe.y)];$.length>fe+1?ee.push({polygons:ze,bounds:xe,depth:fe+1}):k(ze,xe)}if(Le.length){const xe=[new Be(0===pe?Me:we.x,1===pe?Me:we.y),Pe];$.length>fe+1?ee.push({polygons:Le,bounds:xe,depth:fe+1}):k(Le,xe)}}return A}(t,e,Math.ceil((c-s)/11.25),Math.ceil((u-p)/11.25),1,(_,g,v)=>{if(0===_)return.5*(g+v);{const w=Ri((i.y+g/lt)/r);return(Rr(.5*(Ri((i.y+v/lt)/r)+w))*r-i.y)*lt}})}$e(Ol,"FillExtrusionBucket",{omit:["layers","features"]}),$e(Qd,"PartMetadata");const Rm=new Qe({"fill-extrusion-edge-radius":new se(be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Bm={paint:new Qe({"fill-extrusion-opacity":new se(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _e(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new se(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new se(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _e(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _e(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _e(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new se(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new se(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new se(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Rm};function ap(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class ph{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=Rl(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=(u=this.y,p=this.z,_=ap(256*(c=this.x),256*(u=Math.pow(2,p)-u-1),p),g=ap(256*(c+1),256*(u+1),p),_[0]+","+_[1]+","+g[0]+","+g[1]),s=function(c,u,p){let _,g="";for(let v=c;v>0;v--)_=1<<v-1,g+=(u&_?1:0)+(p&_?2:0);return g}(this.z,this.x,this.y);var c,u,p,_,g;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class lp{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Rl(e,i.z,i.z,i.x,i.y)}}class Ji{constructor(e,i,r,s,c){this.overscaledZ=e,this.wrap=i,this.canonical=new ph(r,+s,+c),this.key=0===i&&e===r?this.canonical.key:Rl(i,e,r,s,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Ji(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ji(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Rl(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Rl(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Ji(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,s=2*this.canonical.y;return[new Ji(i,this.wrap,i,r,s),new Ji(i,this.wrap,i,r+1,s),new Ji(i,this.wrap,i,r,s+1),new Ji(i,this.wrap,i,r+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ji(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ji(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Rl(t,e,i,r,s){const c=1<<Math.min(i,22);let u=c*(s%c)+r%c;return t&&i<22&&(u+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*u+i)+(e-i)}$e(ph,"CanonicalTileID"),$e(Ji,"OverscaledTileID",{omit:["projMatrix"]});class Ca extends Be{constructor(e,i,r){super(e,i),this.z=r}}function Bl(t,e){return t.x*e.x+t.y*e.y}function cp(t,e){if(1===t.length){let i=0;const r=e[i++];let s;for(;!s||r.equals(s);)if(s=e[i++],!s)return 1/0;for(;i<e.length;i++){const c=e[i],u=t[0],p=s.sub(r),_=c.sub(r),g=u.sub(r),v=Bl(p,p),w=Bl(p,_),T=Bl(_,_),I=Bl(g,p),A=Bl(g,_),k=v*T-w*w,L=(T*I-w*A)/k,W=(v*A-w*I)/k,J=r.z*(1-L-W)+s.z*L+c.z*W;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function hp(t,e,i,r,s,c,u,p){const _=u*s.getElevationAt(t,e,!0,!0),g=0!==c[0],v=g?0===c[1]?u*(c[0]/7-450):u*function(w,T,I){const A=Math.floor(T[0]/8),k=Math.floor(T[1]/8),L=10*(T[0]-8*A),W=10*(T[1]-8*k),J=w.getElevationAt(A,k,!0,!0),$=w.getMeterToDEM(I),Y=Math.floor(.5*(L*$-1)),ee=Math.floor(.5*(W*$-1)),K=w.tileCoordToPixel(A,k),fe=2*Y+1,pe=2*ee+1,we=(it=fe,Ve=pe,[(Le=w).getElevationAtPixel(xe=K.x-Y,Fe=K.y-ee,!0),Le.getElevationAtPixel(xe+Ve,Fe,!0),Le.getElevationAtPixel(xe,Fe+Ve,!0),Le.getElevationAtPixel(xe+it,Fe+Ve,!0)]),Pe=Math.abs(we[0]-we[1]),ye=Math.abs(we[2]-we[3]),Ee=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),Me=Math.min(.25,.5*$*(Pe+ye)/fe),ze=Math.min(.25,.5*$*Ee/pe);var Le,xe,Fe,it,Ve;return J+Math.max(Me*L,ze*W)}(s,c,p):_;return{base:_+(0===i)?-1:i,top:g?Math.max(v+r,_+i+2):_+r}}const Fm=qe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Um}=Fm,Zm=qe([{name:"a_packed",components:4,type:"Float32"}]),{members:Nm}=Zm,Vm=uh.types,jm=Math.cos(Math.PI/180*37.5);class fh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Xi,this.layoutVertexArray2=new an,this.indexArray=new Oi,this.programConfigurations=new Ss(e.layers,e.zoom),this.segments=new gi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,s){this.hasPattern=gu("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),u=[];for(const{feature:v,id:w,index:T,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,k=zs(v,A);if(!this.layers[0]._featureFilter.filter(new oe(this.zoom),k,r))continue;const L=c?c.evaluate(k,{},r):void 0,W={id:w,properties:v.properties,type:v.type,sourceLayerIndex:I,index:T,geometry:A?k.geometry:xo(v,r,s),patterns:{},sortKey:L};u.push(W)}c&&u.sort((v,w)=>v.sortKey-w.sortKey);const{lineAtlas:p,featureIndex:_}=i,g=this.addConstantDashes(p);for(const v of u){const{geometry:w,index:T,sourceLayerIndex:I}=v;if(g&&this.addFeatureDashes(v,p),this.hasPattern){const A=yu("line",this.layers,v,this.zoom,i);this.patternFeatures.push(A)}else this.addFeature(v,w,T,r,p.positions,i.availableImages);_.insert(e[T].feature,w,T,I,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const s=r.paint.get("line-dasharray").value,c=r.layout.get("line-cap").value;if("constant"!==s.kind||"constant"!==c.kind)i=!0;else{const u=c.value,p=s.value;if(!p)continue;e.addDash(p,u)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,u=s.layout.get("line-cap").value;if("constant"===c.kind&&"constant"===u.kind)continue;let p,_;if("constant"===c.kind){if(p=c.value,!p)continue}else p=c.evaluate({zoom:r},e);_="constant"===u.kind?u.value:u.evaluate({zoom:r},e),i.addDash(p,_),e.patterns[s.id]=i.getKey(p,_)}}update(e,i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,s)}addFeatures(e,i,r,s,c){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Nm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Um),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,s,c,u){const p=this.layers[0].layout,_=p.get("line-join").evaluate(e,{}),g=p.get("line-cap").evaluate(e,{}),v=p.get("line-miter-limit"),w=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const T of i)this.addLine(T,e,_,g,v,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,u,s)}addLine(e,i,r,s,c,u){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let W=0;W<e.length-1;W++)this.totalDistance+=e[W].dist(e[W+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const p="Polygon"===Vm[i.type];let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let g=0;for(;g<_-1&&e[g].equals(e[g+1]);)g++;if(_<(p?3:2))return;"bevel"===r&&(c=1.05);const v=this.overscaling<=16?122880/(512*this.overscaling):0,w=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let T,I,A,k,L;this.e1=this.e2=-1,p&&(T=e[_-2],L=e[g].sub(T)._unit()._perp());for(let W=g;W<_;W++){if(A=W===_-1?p?e[g+1]:void 0:e[W+1],A&&e[W].equals(A))continue;L&&(k=L),T&&(I=T),T=e[W],L=A?A.sub(T)._unit()._perp():k,k=k||L;let J=k.add(L);0===J.x&&0===J.y||J._unit();const $=k.x*L.x+k.y*L.y,Y=J.x*L.x+J.y*L.y,ee=0!==Y?1/Y:1/0,K=2*Math.sqrt(2-2*Y),fe=Y<jm&&I&&A,pe=k.x*L.y-k.y*L.x>0;if(fe&&W>g){const ye=T.dist(I);if(ye>2*v){const Ee=T.sub(T.sub(I)._mult(v/ye)._round());this.updateDistance(I,Ee),this.addCurrentVertex(Ee,k,0,0,w),I=Ee}}const we=I&&A;let Pe=we?r:p?"butt":s;if(we&&"round"===Pe&&(ee<u?Pe="miter":ee<=2&&(Pe="fakeround")),"miter"===Pe&&ee>c&&(Pe="bevel"),"bevel"===Pe&&(ee>2&&(Pe="flipbevel"),ee<c&&(Pe="miter")),I&&this.updateDistance(I,T),"miter"===Pe)J._mult(ee),this.addCurrentVertex(T,J,0,0,w);else if("flipbevel"===Pe){if(ee>100)J=L.mult(-1);else{const ye=ee*k.add(L).mag()/k.sub(L).mag();J._perp()._mult(ye*(pe?-1:1))}this.addCurrentVertex(T,J,0,0,w),this.addCurrentVertex(T,J.mult(-1),0,0,w)}else if("bevel"===Pe||"fakeround"===Pe){const ye=-Math.sqrt(ee*ee-1),Ee=pe?ye:0,Me=pe?0:ye;if(I&&this.addCurrentVertex(T,k,Ee,Me,w),"fakeround"===Pe){const ze=Math.round(180*K/Math.PI/20);for(let Le=1;Le<ze;Le++){let xe=Le/ze;if(.5!==xe){const it=xe-.5;xe+=xe*it*(xe-1)*((1.0904+$*($*(3.55645-1.43519*$)-3.2452))*it*it+(.848013+$*(.215638*$-1.06021)))}const Fe=L.sub(k)._mult(xe)._add(k)._unit()._mult(pe?-1:1);this.addHalfVertex(T,Fe.x,Fe.y,!1,pe,0,w)}}A&&this.addCurrentVertex(T,L,-Ee,-Me,w)}else if("butt"===Pe)this.addCurrentVertex(T,J,0,0,w);else if("square"===Pe){const ye=I?1:-1;I||this.addCurrentVertex(T,J,ye,ye,w),this.addCurrentVertex(T,J,0,0,w),I&&this.addCurrentVertex(T,J,ye,ye,w)}else"round"===Pe&&(I&&(this.addCurrentVertex(T,k,0,0,w),this.addCurrentVertex(T,k,1,1,w,!0)),A&&(this.addCurrentVertex(T,L,-1,-1,w,!0),this.addCurrentVertex(T,L,0,0,w)));if(fe&&W<_-1){const ye=T.dist(A);if(ye>2*v){const Ee=T.add(A.sub(T)._mult(v/ye)._round());this.updateDistance(T,Ee),this.addCurrentVertex(Ee,L,0,0,w),T=Ee}}}}addCurrentVertex(e,i,r,s,c,u=!1){const p=i.y*s-i.x,_=-i.y-i.x*s;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,u,!1,r,c),this.addHalfVertex(e,p,_,u,!0,-s,c)}addHalfVertex({x:e,y:i},r,s,c,u,p,_){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(i<<1)+(u?1:0),Math.round(63*r)+128,Math.round(63*s)+128,1+(0===p?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const g=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,g),_.primitiveLength++),u?this.e2=g:this.e1=g}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}$e(fh,"LineBucket",{omit:["layers","patternFeatures"]});const Gm=new Qe({"line-cap":new _e(be.layout_line["line-cap"]),"line-join":new _e(be.layout_line["line-join"]),"line-miter-limit":new se(be.layout_line["line-miter-limit"]),"line-round-limit":new se(be.layout_line["line-round-limit"]),"line-sort-key":new _e(be.layout_line["line-sort-key"])});var up={paint:new Qe({"line-opacity":new _e(be.paint_line["line-opacity"]),"line-color":new _e(be.paint_line["line-color"]),"line-translate":new se(be.paint_line["line-translate"]),"line-translate-anchor":new se(be.paint_line["line-translate-anchor"]),"line-width":new _e(be.paint_line["line-width"]),"line-gap-width":new _e(be.paint_line["line-gap-width"]),"line-offset":new _e(be.paint_line["line-offset"]),"line-blur":new _e(be.paint_line["line-blur"]),"line-dasharray":new _e(be.paint_line["line-dasharray"]),"line-pattern":new _e(be.paint_line["line-pattern"]),"line-gradient":new Xe(be.paint_line["line-gradient"]),"line-trim-offset":new se(be.paint_line["line-trim-offset"])}),layout:Gm};const dp=new class extends _e{possiblyEvaluate(t,e){return e=new oe(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=ni({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(up.paint.properties["line-width"].specification);function pp(t,e){return e>0?e+2*t:t}dp.useIntegerZoom=!0;const qm=qe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$m=qe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Wm=qe([{name:"a_projected_pos",components:4,type:"Float32"}],4);qe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xm=qe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Hm=qe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fp=qe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ym=qe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);qe([{name:"triangle",components:3,type:"Uint16"}]),qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),qe([{type:"Float32",name:"offsetX"}]),qe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Bi=24;const Fr=128;function vu(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new oe(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:r,interpolationType:s}=i;let c=0;for(;c<r.length&&r[c]<=t;)c++;c=Math.max(0,c-1);let u=c;for(;u<r.length&&r[u]<t+1;)u++;u=Math.min(r.length-1,u);const p=r[c],_=r[u];return"composite"===i.kind?{kind:"composite",minZoom:p,maxZoom:_,interpolationType:s}:{kind:"camera",minZoom:p,maxZoom:_,minSize:i.evaluate(new oe(p)),maxSize:i.evaluate(new oe(_)),interpolationType:s}}}function mh(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:s}){return"source"===t.kind?r/Fr:"composite"===t.kind?At(r/Fr,s/Fr,i):e}function Ia(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:s,minZoom:c,maxZoom:u}=t,p=s?_t(jn.interpolationFactor(s,e,c,u),0,1):0;"camera"===t.kind?r=At(t.minSize,t.maxSize,p):i=p}return{uSizeT:i,uSize:r}}var Jm=Object.freeze({__proto__:null,getSizeData:vu,evaluateSizeForFeature:mh,evaluateSizeForZoom:Ia,SIZE_PACK_FACTOR:Fr});function Km(t,e,i){return t.sections.forEach(r=>{r.text=function(s,c,u){const p=c.layout.get("text-transform").evaluate(u,{});return"uppercase"===p?s=s.toLocaleUpperCase():"lowercase"===p&&(s=s.toLocaleLowerCase()),de.applyArabicShaping&&(s=de.applyArabicShaping(s)),s}(r.text,e,i)}),t}const Fl={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Qm(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function e_(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Ul=Wt,mp=function(t,e,i,r,s){var c,u,p=8*s-r-1,_=(1<<p)-1,g=_>>1,v=-7,w=i?s-1:0,T=i?-1:1,I=t[e+w];for(w+=T,c=I&(1<<-v)-1,I>>=-v,v+=p;v>0;c=256*c+t[e+w],w+=T,v-=8);for(u=c&(1<<-v)-1,c>>=-v,v+=r;v>0;u=256*u+t[e+w],w+=T,v-=8);if(0===c)c=1-g;else{if(c===_)return u?NaN:1/0*(I?-1:1);u+=Math.pow(2,r),c-=g}return(I?-1:1)*u*Math.pow(2,c-r)},_p=function(t,e,i,r,s,c){var u,p,_,g=8*c-s-1,v=(1<<g)-1,w=v>>1,T=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,I=r?0:c-1,A=r?1:-1,k=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(p=isNaN(e)?1:0,u=v):(u=Math.floor(Math.log(e)/Math.LN2),e*(_=Math.pow(2,-u))<1&&(u--,_*=2),(e+=u+w>=1?T/_:T*Math.pow(2,1-w))*_>=2&&(u++,_/=2),u+w>=v?(p=0,u=v):u+w>=1?(p=(e*_-1)*Math.pow(2,s),u+=w):(p=e*Math.pow(2,w-1)*Math.pow(2,s),u=0));s>=8;t[i+I]=255&p,I+=A,p/=256,s-=8);for(u=u<<s|p,g+=s;g>0;t[i+I]=255&u,I+=A,u/=256,g-=8);t[i+I-A]|=128*k};function Wt(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Wt.Varint=0,Wt.Fixed64=1,Wt.Bytes=2,Wt.Fixed32=5;var bu=4294967296,gp=1/bu,yp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function wo(t){return t.type===Wt.Bytes?t.readVarint()+t.pos:t.pos+1}function xp(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var s=i.pos-1;s>=t;s--)i.buf[s+r]=i.buf[s]}function t_(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function i_(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function n_(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function r_(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function o_(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function s_(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function a_(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function l_(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function c_(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function _h(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Sa(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function vp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function h_(t,e,i){e.glyphs=[],1===t&&i.readMessage(u_,e)}function u_(t,e,i){if(3===t){const{id:r,bitmap:s,width:c,height:u,left:p,top:_,advance:g}=i.readMessage(d_,{});e.glyphs.push({id:r,bitmap:new bo({width:c+6,height:u+6},s),metrics:{width:c,height:u,left:p,top:_,advance:g}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function d_(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function wu(t){let e=0,i=0;for(const u of t)e+=u.w*u.h,i=Math.max(i,u.w);t.sort((u,p)=>p.h-u.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let s=0,c=0;for(const u of t)for(let p=r.length-1;p>=0;p--){const _=r[p];if(!(u.w>_.w||u.h>_.h)){if(u.x=_.x,u.y=_.y,c=Math.max(c,u.y+u.h),s=Math.max(s,u.x+u.w),u.w===_.w&&u.h===_.h){const g=r.pop();p<r.length&&(r[p]=g)}else u.h===_.h?(_.x+=u.w,_.w-=u.w):u.w===_.w?(_.y+=u.h,_.h-=u.h):(r.push({x:_.x+u.w,y:_.y,w:_.w-u.w,h:u.h}),_.y+=u.h,_.h-=u.h);break}}return{w:s,h:c,fill:e/(s*c)||0}}Wt.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),s=r>>3,c=this.pos;this.type=7&r,t(s,e,this),this.pos===c&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=_h(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=vp(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_h(this.buf,this.pos)+_h(this.buf,this.pos+4)*bu;return this.pos+=8,t},readSFixed64:function(){var t=_h(this.buf,this.pos)+vp(this.buf,this.pos+4)*bu;return this.pos+=8,t},readFloat:function(){var t=mp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=mp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(s,c,u){var p,_,g=u.buf;if(p=(112&(_=g[u.pos++]))>>4,_<128||(p|=(127&(_=g[u.pos++]))<<3,_<128)||(p|=(127&(_=g[u.pos++]))<<10,_<128)||(p|=(127&(_=g[u.pos++]))<<17,_<128)||(p|=(127&(_=g[u.pos++]))<<24,_<128)||(p|=(1&(_=g[u.pos++]))<<31,_<128))return function Aa(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(s,p,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&yp?yp.decode(this.buf.subarray(e,t)):function(i,r,s){for(var c="",u=r;u<s;){var p,_,g,v=i[u],w=null,T=v>239?4:v>223?3:v>191?2:1;if(u+T>s)break;1===T?v<128&&(w=v):2===T?128==(192&(p=i[u+1]))&&(w=(31&v)<<6|63&p)<=127&&(w=null):3===T?(_=i[u+2],128==(192&(p=i[u+1]))&&128==(192&_)&&((w=(15&v)<<12|(63&p)<<6|63&_)<=2047||w>=55296&&w<=57343)&&(w=null)):4===T&&(_=i[u+2],g=i[u+3],128==(192&(p=i[u+1]))&&128==(192&_)&&128==(192&g)&&((w=(15&v)<<18|(63&p)<<12|(63&_)<<6|63&g)<=65535||w>=1114112)&&(w=null)),null===w?(w=65533,T=1):w>65535&&(w-=65536,c+=String.fromCharCode(w>>>10&1023|55296),w=56320|1023&w),c+=String.fromCharCode(w),u+=T}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Wt.Bytes)return t.push(this.readVarint(e));var i=wo(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Wt.Bytes)return t.push(this.readSVarint());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Wt.Bytes)return t.push(this.readBoolean());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Wt.Bytes)return t.push(this.readFloat());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Wt.Bytes)return t.push(this.readDouble());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Wt.Bytes)return t.push(this.readFixed32());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Wt.Bytes)return t.push(this.readSFixed32());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Wt.Bytes)return t.push(this.readFixed64());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Wt.Bytes)return t.push(this.readSFixed64());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Wt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Wt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Wt.Fixed32)this.pos+=4;else{if(e!==Wt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Sa(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Sa(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Sa(this.buf,-1&t,this.pos),Sa(this.buf,Math.floor(t*gp),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Sa(this.buf,-1&t,this.pos),Sa(this.buf,Math.floor(t*gp),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,s,c,p;if(e>=0?(r=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,s=s+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),c=r,(p=i).buf[p.pos++]=127&c|128,c>>>=7,p.buf[p.pos++]=127&c|128,c>>>=7,p.buf[p.pos++]=127&c|128,c>>>=7,p.buf[p.pos++]=127&c|128,p.buf[p.pos]=127&(c>>>=7),function(c,u){var p=(7&c)<<4;u.buf[u.pos++]|=p|((c>>>=3)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c)))))}(s,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,s,c){for(var u,p,_=0;_<s.length;_++){if((u=s.charCodeAt(_))>55295&&u<57344){if(!p){u>56319||_+1===s.length?(r[c++]=239,r[c++]=191,r[c++]=189):p=u;continue}if(u<56320){r[c++]=239,r[c++]=191,r[c++]=189,p=u;continue}u=p-55296<<10|u-56320|65536,p=null}else p&&(r[c++]=239,r[c++]=191,r[c++]=189,p=null);u<128?r[c++]=u:(u<2048?r[c++]=u>>6|192:(u<65536?r[c++]=u>>12|224:(r[c++]=u>>18|240,r[c++]=u>>12&63|128),r[c++]=u>>6&63|128),r[c++]=63&u|128)}return c}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&xp(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),_p(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),_p(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&xp(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Wt.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,t_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,i_,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,o_,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,n_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,r_,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,s_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,a_,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,l_,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,c_,e)},writeBytesField:function(t,e){this.writeTag(t,Wt.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Wt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Wt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Wt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Wt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Wt.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Wt.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Wt.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Wt.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Wt.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};class Tu{constructor(e,{pixelRatio:i,version:r,stretchX:s,stretchY:c,content:u}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=s,this.stretchY=c,this.content=u,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class bp{constructor(e,i){const r={},s={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,r,c),this.addImages(i,s,c);const{w:u,h:p}=wu(c),_=new gn({width:u||1,height:p||1});for(const g in e){const v=e[g],w=r[g].paddedRect;gn.copy(v.data,_,{x:0,y:0},{x:w.x+1,y:w.y+1},v.data)}for(const g in i){const v=i[g],w=s[g].paddedRect,T=w.x+1,I=w.y+1,A=v.data.width,k=v.data.height;gn.copy(v.data,_,{x:0,y:0},{x:T,y:I},v.data),gn.copy(v.data,_,{x:0,y:k-1},{x:T,y:I-1},{width:A,height:1}),gn.copy(v.data,_,{x:0,y:0},{x:T,y:I+k},{width:A,height:1}),gn.copy(v.data,_,{x:A-1,y:0},{x:T-1,y:I},{width:1,height:k}),gn.copy(v.data,_,{x:0,y:0},{x:T+A,y:I},{width:1,height:k})}this.image=_,this.iconPositions=r,this.patternPositions=s}addImages(e,i,r){for(const s in e){const c=e[s],u={x:0,y:0,w:c.data.width+2,h:c.data.height+2};r.push(u),i[s]=new Tu(u,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),i),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[s,c]=e.tl;r.update(i.data,void 0,{x:s,y:c})}}$e(Tu,"ImagePosition"),$e(bp,"ImageAtlas");const Sn={horizontal:1,vertical:2,horizontalOnly:3};class Zl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new Zl;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new Zl;return i.imageName=e,i}}class za{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new za;for(let s=0;s<e.sections.length;s++){const c=e.sections[s];c.image?r.addImageSection(c):r.addTextSection(c,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,r){let s="";for(let c=0;c<i.length;c++){const u=i.charCodeAt(c+1)||null,p=i.charCodeAt(c-1)||null;s+=!r&&(u&&E(u)&&!Fl[i[c+1]]||p&&E(p)&&!Fl[i[c-1]])||!Fl[i[c]]?i[c]:Fl[i[c]]}return s}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&gh[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&gh[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new za;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Zl.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void ti("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Zl.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ti("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Eu(t,e,i,r,s,c,u,p,_,g,v,w,T,I,A){const k=za.fromFeature(t,s);w===Sn.vertical&&k.verticalizePunctuation(T);let L=[];const W=function(K,fe,pe,we,Pe,ye){if(!K)return[];const Ee=[],Me=function(Fe,it,Ve,Ye,Ue,rt){let wt=0;for(let xt=0;xt<Fe.length();xt++){const yt=Fe.getSection(xt);wt+=wp(Fe.getCharCode(xt),yt,Ye,Ue,it,rt)}return wt/Math.max(1,Math.ceil(wt/Ve))}(K,fe,pe,we,Pe,ye),ze=K.text.indexOf("\u200b")>=0;let Le=0;for(let Fe=0;Fe<K.length();Fe++){const it=K.getSection(Fe),Ve=K.getCharCode(Fe);if(gh[Ve]||(Le+=wp(Ve,it,we,Pe,fe,ye)),Fe<K.length()-1){const Ye=!((xe=Ve)<11904||!(gl(xe)||Zc(xe)||o(xe)||Cs(xe)||Gc(xe)||fl(xe)||Nc(xe)||$o(xe)||qc(xe)||yl(xe)||jc(xe)||f(xe)||Ms(xe)||_l(xe)||ml(xe)||Vc(xe)||ya(xe)||n(xe)||Wc(xe)||$c(xe)));(p_[Ve]||Ye||it.imageName)&&Ee.push(Ep(Fe+1,Le,Me,Ee,f_(Ve,K.getCharCode(Fe+1),Ye&&ze),!1))}}var xe;return Mp(Ep(K.length(),Le,Me,Ee,0,!0))}(k,g,c,e,r,I),{processBidirectionalText:J,processStyledBidirectionalText:$}=de;if(J&&1===k.sections.length){const K=J(k.toString(),W);for(const fe of K){const pe=new za;pe.text=fe,pe.sections=k.sections;for(let we=0;we<fe.length;we++)pe.sectionIndex.push(0);L.push(pe)}}else if($){const K=$(k.text,k.sectionIndex,W);for(const fe of K){const pe=new za;pe.text=fe[0],pe.sectionIndex=fe[1],pe.sections=k.sections,L.push(pe)}}else L=function(K,fe){const pe=[],we=K.text;let Pe=0;for(const ye of fe)pe.push(K.substring(Pe,ye)),Pe=ye;return Pe<we.length&&pe.push(K.substring(Pe,we.length)),pe}(k,W);const Y=[],ee={positionedLines:Y,text:k.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:w,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(K,fe,pe,we,Pe,ye,Ee,Me,ze,Le,xe,Fe){let it=0,Ve=0,Ye=0;const Ue="right"===Me?1:"left"===Me?0:.5;let rt=!1;for(const ht of Pe){const Tt=ht.getSections();for(const Nt of Tt){if(Nt.imageName)continue;const Jt=fe[Nt.fontStack];if(Jt&&(rt=void 0!==Jt.ascender&&void 0!==Jt.descender,!rt))break}if(!rt)break}let wt=0;for(const ht of Pe){ht.trim();const Tt=ht.getMaxScale(),Nt=(Tt-1)*Bi,Jt={positionedGlyphs:[],lineOffset:0};K.positionedLines[wt]=Jt;const Xt=Jt.positionedGlyphs;let Kt=0;if(!ht.length()){Ve+=ye,++wt;continue}let ei=0,si=0;for(let Ft=0;Ft<ht.length();Ft++){const yi=ht.getSection(Ft),_i=ht.getSectionIndex(Ft),zt=ht.getCharCode(Ft);let oi=yi.scale,wi=null,Vt=null,ui=null,Gi=Bi,Ai=0;const Si=!(ze===Sn.horizontal||!xe&&!M(zt)||xe&&(gh[zt]||(xt=zt,dl(xt)||Uc(xt)||pl(xt)||l(xt)||d(xt))));if(yi.imageName){const Ki=we[yi.imageName];if(!Ki)continue;ui=yi.imageName,K.iconsInText=K.iconsInText||!0,Vt=Ki.paddedRect;const zi=Ki.displaySize;oi=oi*Bi/Fe,wi={width:zi[0],height:zi[1],left:1,top:-3,advance:Si?zi[1]:zi[0],localGlyph:!1},Ai=rt?-wi.height*oi:Tt*Bi-17-zi[1]*oi,Gi=wi.advance;const Mo=(Si?zi[0]:zi[1])*oi-Bi*Tt;Mo>0&&Mo>Kt&&(Kt=Mo)}else{const Ki=pe[yi.fontStack];if(!Ki)continue;Ki[zt]&&(Vt=Ki[zt]);const zi=fe[yi.fontStack];if(!zi)continue;const Mo=zi.glyphs[zt];if(!Mo)continue;if(wi=Mo.metrics,Gi=8203!==zt?Bi:0,rt){const Ua=void 0!==zi.ascender?Math.abs(zi.ascender):0,Kl=void 0!==zi.descender?Math.abs(zi.descender):0,Ql=(Ua+Kl)*oi;ei<Ql&&(ei=Ql,si=(Ua-Kl)/2*oi),Ai=-Ua*oi}else Ai=(Tt-oi)*Bi-17}Si?(K.verticalizable=!0,Xt.push({glyph:zt,imageName:ui,x:it,y:Ve+Ai,vertical:Si,scale:oi,localGlyph:wi.localGlyph,fontStack:yi.fontStack,sectionIndex:_i,metrics:wi,rect:Vt}),it+=Gi*oi+Le):(Xt.push({glyph:zt,imageName:ui,x:it,y:Ve+Ai,vertical:Si,scale:oi,localGlyph:wi.localGlyph,fontStack:yi.fontStack,sectionIndex:_i,metrics:wi,rect:Vt}),it+=wi.advance*oi+Le)}0!==Xt.length&&(Ye=Math.max(it-Le,Ye),rt?Cp(Xt,Ue,Kt,si,ye*Tt/2):Cp(Xt,Ue,Kt,0,ye/2)),it=0;const Ii=ye*Tt+Kt;Jt.lineOffset=Math.max(Kt,Nt),Ve+=Ii,++wt}var xt;const yt=Ve,{horizontalAlign:at,verticalAlign:Bt}=Mu(Ee);(function(ht,Tt,Nt,Jt,Xt,Kt){const ei=(Tt-Nt)*Xt,si=-Kt*Jt;for(const Ii of ht)for(const Ft of Ii.positionedGlyphs)Ft.x+=ei,Ft.y+=si})(K.positionedLines,Ue,at,Bt,Ye,yt),K.top+=-Bt*yt,K.bottom=K.top+yt,K.left+=-at*Ye,K.right=K.left+Ye,K.hasBaseline=rt}(ee,e,i,r,L,u,p,_,w,g,T,A),!function(K){for(const fe of K)if(0!==fe.positionedGlyphs.length)return!1;return!0}(Y)&&ee}const gh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},p_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wp(t,e,i,r,s,c){if(e.imageName){const u=r[e.imageName];return u?u.displaySize[0]*e.scale*Bi/c+s:0}{const u=i[e.fontStack],p=u&&u.glyphs[t];return p?p.metrics.advance*e.scale+s:0}}function Tp(t,e,i,r){const s=Math.pow(t-e,2);return r?t<e?s/2:2*s:s+Math.abs(i)*i}function f_(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Ep(t,e,i,r,s,c){let u=null,p=Tp(e,i,s,c);for(const _ of r){const g=Tp(e-_.x,i,s,c)+_.badness;g<=p&&(u=_,p=g)}return{index:t,x:e,priorBreak:u,badness:p}}function Mp(t){return t?Mp(t.priorBreak).concat(t.index):[]}function Mu(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Cp(t,e,i,r,s){if(!(e||i||r||s))return;const c=t.length-1,u=t[c],p=(u.x+u.metrics.advance*u.scale)*e;for(let _=0;_<=c;_++)t[_].x-=p,t[_].y+=i+r+s}function m_(t,e,i){const{horizontalAlign:r,verticalAlign:s}=Mu(i),c=e[0]-t.displaySize[0]*r,u=e[1]-t.displaySize[1]*s;return{image:t,top:u,bottom:u+t.displaySize[1],left:c,right:c+t.displaySize[0]}}function Ip(t,e,i,r,s,c){const u=t.image;let p;if(u.content){const L=u.content,W=u.pixelRatio||1;p=[L[0]/W,L[1]/W,u.displaySize[0]-L[2]/W,u.displaySize[1]-L[3]/W]}const _=e.left*c,g=e.right*c;let v,w,T,I;"width"===i||"both"===i?(I=s[0]+_-r[3],w=s[0]+g+r[1]):(I=s[0]+(_+g-u.displaySize[0])/2,w=I+u.displaySize[0]);const A=e.top*c,k=e.bottom*c;return"height"===i||"both"===i?(v=s[1]+A-r[0],T=s[1]+k+r[2]):(v=s[1]+(A+k-u.displaySize[1])/2,T=v+u.displaySize[1]),{image:u,top:v,right:w,bottom:T,left:I,collisionPadding:p}}class To extends Be{constructor(e,i,r,s,c){super(e,i),this.angle=s,this.z=r,void 0!==c&&(this.segment=c)}clone(){return new To(this.x,this.y,this.z,this.angle,this.segment)}}function Ap(t,e,i,r,s){if(void 0===e.segment)return!0;let c=e,u=e.segment+1,p=0;for(;p>-i/2;){if(u--,u<0)return!1;p-=t[u].dist(c),c=t[u]}p+=t[u].dist(t[u+1]),u++;const _=[];let g=0;for(;p<i/2;){const v=t[u],w=t[u+1];if(!w)return!1;let T=t[u-1].angleTo(v)-v.angleTo(w);for(T=Math.abs((T+3*Math.PI)%(2*Math.PI)-Math.PI),_.push({distance:p,angleDelta:T}),g+=T;p-_[0].distance>r;)g-=_.shift().angleDelta;if(g>s)return!1;u++,p+=v.dist(w)}return!0}function Sp(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function zp(t,e,i){return t?.6*e*i:0}function kp(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function __(t,e,i,r,s,c){const u=zp(i,s,c),p=kp(i,r)*c;let _=0;const g=Sp(t)/2;for(let v=0;v<t.length-1;v++){const w=t[v],T=t[v+1],I=w.dist(T);if(_+I>g){const A=(g-_)/I,k=At(w.x,T.x,A),L=At(w.y,T.y,A),W=new To(k,L,0,T.angleTo(w),v);return!u||Ap(t,W,p,u,e)?W:void 0}_+=I}}function g_(t,e,i,r,s,c,u,p,_){const g=zp(r,c,u),v=kp(r,s),w=v*u,T=0===t[0].x||t[0].x===_||0===t[0].y||t[0].y===_;return e-w<e/4&&(e=w+e/4),Dp(t,T?e/2*p%e:(v/2+2*c)*u*p%e,e,g,i,w,T,!1,_)}function Dp(t,e,i,r,s,c,u,p,_){const g=c/2,v=Sp(t);let w=0,T=e-i,I=[];for(let A=0;A<t.length-1;A++){const k=t[A],L=t[A+1],W=k.dist(L),J=L.angleTo(k);for(;T+i<w+W;){T+=i;const $=(T-w)/W,Y=At(k.x,L.x,$),ee=At(k.y,L.y,$);if(Y>=0&&Y<_&&ee>=0&&ee<_&&T-g>=0&&T+g<=v){const K=new To(Y,ee,0,J,A);K._round(),r&&!Ap(t,K,c,r,s)||I.push(K)}}w+=W}return p||I.length||u||(I=Dp(t,w/2,i,r,s,c,u,!0,_)),I}function Pp(t,e,i,r,s){const c=[];for(let u=0;u<t.length;u++){const p=t[u];let _;for(let g=0;g<p.length-1;g++){let v=p[g],w=p[g+1];v.x<e&&w.x<e||(v.x<e?v=new Be(e,v.y+(e-v.x)/(w.x-v.x)*(w.y-v.y))._round():w.x<e&&(w=new Be(e,v.y+(e-v.x)/(w.x-v.x)*(w.y-v.y))._round()),v.y<i&&w.y<i||(v.y<i?v=new Be(v.x+(i-v.y)/(w.y-v.y)*(w.x-v.x),i)._round():w.y<i&&(w=new Be(v.x+(i-v.y)/(w.y-v.y)*(w.x-v.x),i)._round()),v.x>=r&&w.x>=r||(v.x>=r?v=new Be(r,v.y+(r-v.x)/(w.x-v.x)*(w.y-v.y))._round():w.x>=r&&(w=new Be(r,v.y+(r-v.x)/(w.x-v.x)*(w.y-v.y))._round()),v.y>=s&&w.y>=s||(v.y>=s?v=new Be(v.x+(s-v.y)/(w.y-v.y)*(w.x-v.x),s)._round():w.y>=s&&(w=new Be(v.x+(s-v.y)/(w.y-v.y)*(w.x-v.x),s)._round()),_&&v.equals(_[_.length-1])||(_=[v],c.push(_)),_.push(w)))))}}return c}$e(To,"Anchor");const Nl=1e20;function Lp(t,e,i,r,s,c,u,p,_){for(let g=e;g<e+r;g++)Op(t,i*c+g,c,s,u,p,_);for(let g=i;g<i+s;g++)Op(t,g*c+e,1,r,u,p,_)}function Op(t,e,i,r,s,c,u){c[0]=0,u[0]=-Nl,u[1]=Nl,s[0]=t[e];for(let p=1,_=0,g=0;p<r;p++){s[p]=t[e+p*i];const v=p*p;do{const w=c[_];g=(s[p]-s[w]+v-w*w)/(p-w)/2}while(g<=u[_]&&--_>-1);_++,c[_]=p,u[_]=g,u[_+1]=Nl}for(let p=0,_=0;p<r;p++){for(;u[_+1]<p;)_++;const g=c[_],v=p-g;t[e+p*i]=s[g]+v*v}}const Cu={none:0,ideographs:1,all:2};class ka{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const r=[];for(const s in e)for(const c of e[s])r.push({stack:s,id:c});zn(r,({stack:s,id:c},u)=>{let p=this.entries[s];p||(p=this.entries[s]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=p.glyphs[c];if(void 0!==_)return void u(null,{stack:s,id:c,glyph:_});if(_=this._tinySDF(p,s,c),_)return p.glyphs[c]=_,void u(null,{stack:s,id:c,glyph:_});const g=Math.floor(c/256);if(256*g>65535)return void u(new Error("glyphs > 65535 not supported"));if(p.ranges[g])return void u(null,{stack:s,id:c,glyph:_});let v=p.requests[g];v||(v=p.requests[g]=[],ka.loadGlyphRange(s,g,this.url,this.requestManager,(w,T)=>{if(T){p.ascender=T.ascender,p.descender=T.descender;for(const I in T.glyphs)this._doesCharSupportLocalGlyph(+I)||(p.glyphs[+I]=T.glyphs[+I]);p.ranges[g]=!0}for(const I of v)I(w,T);delete p.requests[g]})),v.push((w,T)=>{w?u(w):T&&u(null,{stack:s,id:c,glyph:T.glyphs[c]||null})})},(s,c)=>{if(s)i(s);else if(c){const u={};for(const{stack:p,id:_,glyph:g}of c)void 0===u[p]&&(u[p]={}),void 0===u[p].glyphs&&(u[p].glyphs={}),u[p].glyphs[_]=g&&{id:g.id,bitmap:g.bitmap.clone(),metrics:g.metrics},u[p].ascender=this.entries[p].ascender,u[p].descender=this.entries[p].descender;i(null,u)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Cu.none&&(this.localGlyphMode===Cu.all?!!this.localFontFamily:!!this.localFontFamily&&(yl(e)||xl(e)||Ms(e)||ya(e)||$o(e)))}_tinySDF(e,i,r){const s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(r))return;let c=e.tinySDF;if(!c){let k="400";/bold/i.test(i)?k="900":/medium/i.test(i)?k="500":/light/i.test(i)&&(k="200"),c=e.tinySDF=new ka.TinySDF({fontFamily:s,fontWeight:k,fontSize:48,buffer:6,radius:16}),c.fontWeight=k}if(this.localGlyphs[c.fontWeight][r])return this.localGlyphs[c.fontWeight][r];const u=String.fromCharCode(r),{data:p,width:_,height:g,glyphWidth:v,glyphHeight:w,glyphLeft:T,glyphTop:I,glyphAdvance:A}=c.draw(u);return this.localGlyphs[c.fontWeight][r]={id:r,bitmap:new bo({width:_,height:g},p),metrics:{width:v/2,height:w/2,left:T/2,top:I/2-27,advance:A/2,localGlyph:!0}}}}function Rp(t,e,i,r){const s=[],c=t.image,u=c.pixelRatio,p=c.paddedRect.w-2,_=c.paddedRect.h-2,g=t.right-t.left,v=t.bottom-t.top,w=c.stretchX||[[0,p]],T=c.stretchY||[[0,_]],I=(ye,Ee)=>ye+Ee[1]-Ee[0],A=w.reduce(I,0),k=T.reduce(I,0),L=p-A,W=_-k;let J=0,$=A,Y=0,ee=k,K=0,fe=L,pe=0,we=W;if(c.content&&r){const ye=c.content;J=yh(w,0,ye[0]),Y=yh(T,0,ye[1]),$=yh(w,ye[0],ye[2]),ee=yh(T,ye[1],ye[3]),K=ye[0]-J,pe=ye[1]-Y,fe=ye[2]-ye[0]-$,we=ye[3]-ye[1]-ee}const Pe=(ye,Ee,Me,ze)=>{const Le=xh(ye.stretch-J,$,g,t.left),xe=vh(ye.fixed-K,fe,ye.stretch,A),Fe=xh(Ee.stretch-Y,ee,v,t.top),it=vh(Ee.fixed-pe,we,Ee.stretch,k),Ve=xh(Me.stretch-J,$,g,t.left),Ye=vh(Me.fixed-K,fe,Me.stretch,A),Ue=xh(ze.stretch-Y,ee,v,t.top),rt=vh(ze.fixed-pe,we,ze.stretch,k),wt=new Be(Le,Fe),xt=new Be(Ve,Fe),yt=new Be(Ve,Ue),at=new Be(Le,Ue),Bt=new Be(xe/u,it/u),ht=new Be(Ye/u,rt/u),Tt=e*Math.PI/180;if(Tt){const Xt=Math.sin(Tt),Kt=Math.cos(Tt),ei=[Kt,-Xt,Xt,Kt];wt._matMult(ei),xt._matMult(ei),at._matMult(ei),yt._matMult(ei)}const Nt=ye.stretch+ye.fixed,Jt=Ee.stretch+Ee.fixed;return{tl:wt,tr:xt,bl:at,br:yt,tex:{x:c.paddedRect.x+1+Nt,y:c.paddedRect.y+1+Jt,w:Me.stretch+Me.fixed-Nt,h:ze.stretch+ze.fixed-Jt},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bt,pixelOffsetBR:ht,minFontScaleX:fe/u/g,minFontScaleY:we/u/v,isSDF:i}};if(r&&(c.stretchX||c.stretchY)){const ye=Bp(w,L,A),Ee=Bp(T,W,k);for(let Me=0;Me<ye.length-1;Me++){const ze=ye[Me],Le=ye[Me+1];for(let xe=0;xe<Ee.length-1;xe++)s.push(Pe(ze,Ee[xe],Le,Ee[xe+1]))}}else s.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:_+1}));return s}function yh(t,e,i){let r=0;for(const s of t)r+=Math.max(e,Math.min(i,s[1]))-Math.max(e,Math.min(i,s[0]));return r}function Bp(t,e,i){const r=[{fixed:-1,stretch:0}];for(const[s,c]of t){const u=r[r.length-1];r.push({fixed:s-u.stretch,stretch:u.stretch}),r.push({fixed:s-u.stretch,stretch:u.stretch+(c-s)})}return r.push({fixed:e+1,stretch:i}),r}function xh(t,e,i,r){return t/e*i+r}function vh(t,e,i,r){return t-e*i/r}function y_(t,e,i,r){const s=e+t.positionedLines[r].lineOffset;return 0===r?i+s/2:i+(s+(e+t.positionedLines[r-1].lineOffset))/2}ka.loadGlyphRange=function(t,e,i,r,s){const c=256*e,u=c+255,p=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${c}-${u}`),Ni.Glyphs);Fn(p,(_,g)=>{if(_)s(_);else if(g){const v={},w=new Ul(g).readFields(h_,{});for(const T of w.glyphs)v[T.id]=T;s(null,{glyphs:v,ascender:w.ascender,descender:w.descender})}})},ka.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:c="normal",fontStyle:u="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const p=this.size=t+4*e,_=this._createCanvas(p),g=this.ctx=_.getContext("2d",{willReadFrequently:!0});g.font=`${u} ${c} ${t}px ${s}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:c}=this.ctx.measureText(t),u=Math.ceil(i),p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-s))),_=Math.min(this.size-this.buffer,u+Math.ceil(r)),g=p+2*this.buffer,v=_+2*this.buffer,w=Math.max(g*v,0),T=new Uint8ClampedArray(w),I={data:T,width:g,height:v,glyphWidth:p,glyphHeight:_,glyphTop:u,glyphLeft:0,glyphAdvance:e};if(0===p||0===_)return I;const{ctx:A,buffer:k,gridInner:L,gridOuter:W}=this;A.clearRect(k,k,p,_),A.fillText(t,k,k+u);const J=A.getImageData(k,k,p,_);W.fill(Nl,0,w),L.fill(0,0,w);for(let $=0;$<_;$++)for(let Y=0;Y<p;Y++){const ee=J.data[4*($*p+Y)+3]/255;if(0===ee)continue;const K=($+k)*g+Y+k;if(1===ee)W[K]=0,L[K]=Nl;else{const fe=.5-ee;W[K]=fe>0?fe*fe:0,L[K]=fe<0?fe*fe:0}}Lp(W,0,0,g,v,g,this.f,this.v,this.z),Lp(L,k,k,p,_,g,this.f,this.v,this.z);for(let $=0;$<w;$++){const Y=Math.sqrt(W[$])-Math.sqrt(L[$]);T[$]=Math.round(255-255*(Y/this.radius+this.cutoff))}return I}};class x_{constructor(e=[],i=v_){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:r}=this,s=i[e];for(;e>0;){const c=e-1>>1,u=i[c];if(r(s,u)>=0)break;i[e]=u,e=c}i[e]=s}_down(e){const{data:i,compare:r}=this,s=this.length>>1,c=i[e];for(;e<s;){let u=1+(e<<1),p=i[u];const _=u+1;if(_<this.length&&r(i[_],p)<0&&(u=_,p=i[_]),r(p,c)>=0)break;i[e]=p,e=u}i[e]=c}}function v_(t,e){return t<e?-1:t>e?1:0}function b_(t,e=1,i=!1){let r=1/0,s=1/0,c=-1/0,u=-1/0;const p=t[0];for(let I=0;I<p.length;I++){const A=p[I];(!I||A.x<r)&&(r=A.x),(!I||A.y<s)&&(s=A.y),(!I||A.x>c)&&(c=A.x),(!I||A.y>u)&&(u=A.y)}const _=Math.min(c-r,u-s);let g=_/2;const v=new x_([],w_);if(0===_)return new Be(r,s);for(let I=r;I<c;I+=_)for(let A=s;A<u;A+=_)v.push(new Da(I+g,A+g,g,t));let w=function(I){let A=0,k=0,L=0;const W=I[0];for(let J=0,$=W.length,Y=$-1;J<$;Y=J++){const ee=W[J],K=W[Y],fe=ee.x*K.y-K.x*ee.y;k+=(ee.x+K.x)*fe,L+=(ee.y+K.y)*fe,A+=3*fe}return new Da(k/A,L/A,0,I)}(t),T=v.length;for(;v.length;){const I=v.pop();(I.d>w.d||!w.d)&&(w=I,i&&console.log("found best %d after %d probes",Math.round(1e4*I.d)/1e4,T)),I.max-w.d<=e||(g=I.h/2,v.push(new Da(I.p.x-g,I.p.y-g,g,t)),v.push(new Da(I.p.x+g,I.p.y-g,g,t)),v.push(new Da(I.p.x-g,I.p.y+g,g,t)),v.push(new Da(I.p.x+g,I.p.y+g,g,t)),T+=4)}return i&&(console.log(`num probes: ${T}`),console.log(`best distance: ${w.d}`)),w.p}function w_(t,e){return e.max-t.max}function Da(t,e,i,r){this.p=new Be(t,e),this.h=i,this.d=function(s,c){let u=!1,p=1/0;for(let _=0;_<c.length;_++){const g=c[_];for(let v=0,w=g.length,T=w-1;v<w;T=v++){const I=g[v],A=g[T];I.y>s.y!=A.y>s.y&&s.x<(A.x-I.x)*(s.y-I.y)/(A.y-I.y)+I.x&&(u=!u),p=Math.min(p,wd(s,I,A))}}return(u?1:-1)*Math.sqrt(p)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const Iu=Number.POSITIVE_INFINITY,T_=Math.sqrt(2);function Fp(t,[e,i]){let r=0,s=0;if(i===Iu){e<0&&(e=0);const c=e/T_;switch(t){case"top-right":case"top-left":s=c-7;break;case"bottom-right":case"bottom-left":s=7-c;break;case"bottom":s=7-e;break;case"top":s=e-7}switch(t){case"top-right":case"bottom-right":r=-c;break;case"top-left":case"bottom-left":r=c;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":s=i-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-i}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,s]}function E_(t,e,i,r,s,c,u,p,_,g){t.createArrays(),t.tilePixelRatio=lt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const v=t.layers[0].layout,w=t.layers[0]._unevaluatedLayout._values,T={};if("composite"===t.textSizeData.kind){const{minZoom:k,maxZoom:L}=t.textSizeData;T.compositeTextSizes=[w["text-size"].possiblyEvaluate(new oe(k),p),w["text-size"].possiblyEvaluate(new oe(L),p)]}if("composite"===t.iconSizeData.kind){const{minZoom:k,maxZoom:L}=t.iconSizeData;T.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new oe(k),p),w["icon-size"].possiblyEvaluate(new oe(L),p)]}T.layoutTextSize=w["text-size"].possiblyEvaluate(new oe(_+1),p),T.layoutIconSize=w["icon-size"].possiblyEvaluate(new oe(_+1),p),T.textMaxSize=w["text-size"].possiblyEvaluate(new oe(18),p);const I="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement"),A=v.get("text-size");for(const k of t.features){const L=v.get("text-font").evaluate(k,{},p).join(","),W=A.evaluate(k,{},p),J=T.layoutTextSize.evaluate(k,{},p),$=(T.layoutIconSize.evaluate(k,{},p),{horizontal:{},vertical:void 0}),Y=k.text;let ee,K=[0,0];if(Y){const we=Y.toString(),Pe=v.get("text-letter-spacing").evaluate(k,{},p)*Bi,ye=v.get("text-line-height").evaluate(k,{},p)*Bi,Ee=x(we)?Pe:0,Me=v.get("text-anchor").evaluate(k,{},p),ze=v.get("text-variable-anchor");if(!ze){const Ve=v.get("text-radial-offset").evaluate(k,{},p);K=Ve?Fp(Me,[Ve*Bi,Iu]):v.get("text-offset").evaluate(k,{},p).map(Ye=>Ye*Bi)}let Le=I?"center":v.get("text-justify").evaluate(k,{},p);const xe="point"===v.get("symbol-placement"),Fe=xe?v.get("text-max-width").evaluate(k,{},p)*Bi:1/0,it=Ve=>{t.allowVerticalPlacement&&y(we)&&($.vertical=Eu(Y,e,i,s,L,Fe,ye,Me,Ve,Ee,K,Sn.vertical,!0,J,W))};if(!I&&ze){const Ve="auto"===Le?ze.map(Ue=>Au(Ue)):[Le];let Ye=!1;for(let Ue=0;Ue<Ve.length;Ue++){const rt=Ve[Ue];if(!$.horizontal[rt])if(Ye)$.horizontal[rt]=$.horizontal[0];else{const wt=Eu(Y,e,i,s,L,Fe,ye,"center",rt,Ee,K,Sn.horizontal,!1,J,W);wt&&($.horizontal[rt]=wt,Ye=1===wt.positionedLines.length)}}it("left")}else{if("auto"===Le&&(Le=Au(Me)),xe||v.get("text-writing-mode").indexOf("horizontal")>=0||!y(we)){const Ve=Eu(Y,e,i,s,L,Fe,ye,Me,Le,Ee,K,Sn.horizontal,!1,J,W);Ve&&($.horizontal[Le]=Ve)}it(xe?"left":Le)}}let fe=!1;if(k.icon&&k.icon.name){const we=r[k.icon.name];we&&(ee=m_(s[k.icon.name],v.get("icon-offset").evaluate(k,{},p),v.get("icon-anchor").evaluate(k,{},p)),fe=we.sdf,void 0===t.sdfIcons?t.sdfIcons=we.sdf:t.sdfIcons!==we.sdf&&ti("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==t.pixelRatio||0!==v.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const pe=Zp($.horizontal)||$.vertical;t.iconsInText||(t.iconsInText=!!pe&&pe.iconsInText),(pe||ee)&&M_(t,k,$,ee,r,T,J,0,K,fe,u,p,g)}c&&t.generateCollisionDebugBuffers(_,t.collisionBoxArray)}function Au(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function M_(t,e,i,r,s,c,u,p,_,g,v,w,T){let I=c.textMaxSize.evaluate(e,{},w);void 0===I&&(I=u);const A=t.layers[0].layout,k=A.get("icon-offset").evaluate(e,{},w),L=Zp(i.horizontal)||i.vertical,W="globe"===T.name,J=u/24,$=t.tilePixelRatio*I/24,Y=(Ee=t.overscaling,t.zoom>18&&Ee>2&&(Ee>>=1),Math.max(lt/(512*Ee),1)*A.get("symbol-spacing")),ee=A.get("text-padding")*t.tilePixelRatio,K=A.get("icon-padding")*t.tilePixelRatio,fe=vt(A.get("text-max-angle")),pe="map"===A.get("text-rotation-alignment")&&"point"!==A.get("symbol-placement"),we="map"===A.get("icon-rotation-alignment")&&"point"!==A.get("symbol-placement"),Pe=A.get("symbol-placement"),ye=Y/2;var Ee;const Me=A.get("icon-text-fit");let ze;r&&"none"!==Me&&(t.allowVerticalPlacement&&i.vertical&&(ze=Ip(r,i.vertical,Me,A.get("icon-text-fit-padding"),k,J)),L&&(r=Ip(r,L,Me,A.get("icon-text-fit-padding"),k,J)));const Le=(xe,Fe,it)=>{if(Fe.x<0||Fe.x>=lt||Fe.y<0||Fe.y>=lt)return;let Ve=null;if(W){const{x:Ye,y:Ue,z:rt}=T.projectTilePoint(Fe.x,Fe.y,it);Ve={anchor:new To(Ye,Ue,rt,0,void 0),up:T.upVector(it,Fe.x,Fe.y)}}!function(Ye,Ue,rt,wt,xt,yt,at,Bt,ht,Tt,Nt,Jt,Xt,Kt,ei,si,Ii,Ft,yi,_i,zt,oi,wi,Vt,ui){const Gi=Ye.addToLineVertexArray(Ue,wt);let Ai,Si,Ki,zi,Mo,Ua,Kl,Ql=0,Mf=0,Cf=0,If=0,qu=-1,$u=-1;const jr={};let Af=xa.exports("");const Us=rt?rt.anchor:Ue;let Wu=0,Xu=0;if(void 0===ht._unevaluatedLayout.getValue("text-radial-offset")?[Wu,Xu]=ht.layout.get("text-offset").evaluate(zt,{},ui).map(yn=>yn*Bi):(Wu=ht.layout.get("text-radial-offset").evaluate(zt,{},ui)*Bi,Xu=Iu),Ye.allowVerticalPlacement&&xt.vertical){const yn=xt.vertical;if(ei)Ua=Su(yn),Bt&&(Kl=Su(Bt));else{const xn=ht.layout.get("text-rotate").evaluate(zt,{},ui)+90;Ki=bh(Tt,Us,Ue,Nt,Jt,Xt,yn,Kt,xn,si),Bt&&(zi=bh(Tt,Us,Ue,Nt,Jt,Xt,Bt,Ft,xn))}}if(yt){const yn=ht.layout.get("icon-rotate").evaluate(zt,{},ui),xn="none"!==ht.layout.get("icon-text-fit"),ec=Rp(yt,yn,wi,xn),Yu=Bt?Rp(Bt,yn,wi,xn):void 0;Si=bh(Tt,Us,Ue,Nt,Jt,Xt,yt,Ft,yn),Ql=4*ec.length;const Sf=Ye.iconSizeData;let Zs=null;"source"===Sf.kind?(Zs=[Fr*ht.layout.get("icon-size").evaluate(zt,{},ui)],Zs[0]>Jo&&ti(`${Ye.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Sf.kind&&(Zs=[Fr*oi.compositeIconSizes[0].evaluate(zt,{},ui),Fr*oi.compositeIconSizes[1].evaluate(zt,{},ui)],(Zs[0]>Jo||Zs[1]>Jo)&&ti(`${Ye.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ye.addSymbols(Ye.icon,ec,Zs,_i,yi,zt,!1,rt,Ue,Gi.lineStartIndex,Gi.lineLength,-1,Vt,ui),qu=Ye.icon.placedSymbolArray.length-1,Yu&&(Mf=4*Yu.length,Ye.addSymbols(Ye.icon,Yu,Zs,_i,yi,zt,Sn.vertical,rt,Ue,Gi.lineStartIndex,Gi.lineLength,-1,Vt,ui),$u=Ye.icon.placedSymbolArray.length-1)}for(const yn in xt.horizontal){const xn=xt.horizontal[yn];Ai||(Af=xa.exports(xn.text),ei?Mo=Su(xn):Ai=bh(Tt,Us,Ue,Nt,Jt,Xt,xn,Kt,ht.layout.get("text-rotate").evaluate(zt,{},ui),si));const ec=1===xn.positionedLines.length;if(Cf+=Up(Ye,rt,Ue,xn,at,ht,ei,zt,si,Gi,xt.vertical?Sn.horizontal:Sn.horizontalOnly,ec?Object.keys(xt.horizontal):[yn],jr,qu,oi,Vt,ui),ec)break}xt.vertical&&(If+=Up(Ye,rt,Ue,xt.vertical,at,ht,ei,zt,si,Gi,Sn.vertical,["vertical"],jr,$u,oi,Vt,ui));let ns=-1;const Hu=(yn,xn)=>yn?Math.max(yn,xn):xn;ns=Hu(Mo,ns),ns=Hu(Ua,ns),ns=Hu(Kl,ns);const ng=ns>-1?1:0;Ye.glyphOffsetArray.length>=Qo.MAX_GLYPHS&&ti("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==zt.sortKey&&Ye.addToSortKeyRanges(Ye.symbolInstances.length,zt.sortKey),Ye.symbolInstances.emplaceBack(Us.x,Us.y,Us.z,Ue.x,Ue.y,jr.right>=0?jr.right:-1,jr.center>=0?jr.center:-1,jr.left>=0?jr.left:-1,jr.vertical>=0?jr.vertical:-1,qu,$u,Af,void 0!==Ai?Ai:Ye.collisionBoxArray.length,void 0!==Ai?Ai+1:Ye.collisionBoxArray.length,void 0!==Ki?Ki:Ye.collisionBoxArray.length,void 0!==Ki?Ki+1:Ye.collisionBoxArray.length,void 0!==Si?Si:Ye.collisionBoxArray.length,void 0!==Si?Si+1:Ye.collisionBoxArray.length,zi||Ye.collisionBoxArray.length,zi?zi+1:Ye.collisionBoxArray.length,Nt,Cf,If,Ql,Mf,ng,0,Wu,Xu,ns)}(t,Fe,Ve,xe,i,r,s,ze,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ee,pe,_,0,K,we,k,e,c,g,v,w)};if("line"===Pe)for(const xe of Pp(e.geometry,0,0,lt,lt)){const Fe=g_(xe,Y,fe,i.vertical||L,r,24,$,t.overscaling,lt);for(const it of Fe)L&&C_(t,L.text,ye,it)||Le(xe,it,w)}else if("line-center"===Pe){for(const xe of e.geometry)if(xe.length>1){const Fe=__(xe,fe,i.vertical||L,r,24,$);Fe&&Le(xe,Fe,w)}}else if("Polygon"===e.type)for(const xe of _u(e.geometry,0)){const Fe=b_(xe,16);Le(xe[0],new To(Fe.x,Fe.y,0,0,void 0),w)}else if("LineString"===e.type)for(const xe of e.geometry)Le(xe,new To(xe[0].x,xe[0].y,0,0,void 0),w);else if("Point"===e.type)for(const xe of e.geometry)for(const Fe of xe)Le([Fe],new To(Fe.x,Fe.y,0,0,void 0),w)}const Jo=32640;function Up(t,e,i,r,s,c,u,p,_,g,v,w,T,I,A,k,L){const W=function(Y,ee,K,fe,pe,we,Pe,ye){const Ee=[];if(0===ee.positionedLines.length)return Ee;const Me=fe.layout.get("text-rotate").evaluate(we,{})*Math.PI/180,ze=function(Ve){const Ye=Ve[0],Ue=Ve[1],rt=Ye*Ue;return rt>0?[Ye,-Ue]:rt<0?[-Ye,Ue]:0===Ye?[Ue,Ye]:[Ue,-Ye]}(K);let Le=Math.abs(ee.top-ee.bottom);for(const Ve of ee.positionedLines)Le-=Ve.lineOffset;const xe=ee.positionedLines.length,Fe=Le/xe;let it=ee.top-K[1];for(let Ve=0;Ve<xe;++Ve){const Ye=ee.positionedLines[Ve];it=y_(ee,Fe,it,Ve);for(const Ue of Ye.positionedGlyphs){if(!Ue.rect)continue;const rt=Ue.rect||{};let wt=4,xt=!0,yt=1,at=0;if(Ue.imageName){const Vt=Pe[Ue.imageName];if(!Vt)continue;if(Vt.sdf){ti("SDF images are not supported in formatted text and will be ignored.");continue}xt=!1,yt=Vt.pixelRatio,wt=1/yt}const Bt=(pe||ye)&&Ue.vertical,ht=Ue.metrics.advance*Ue.scale/2,Tt=Ue.metrics,Nt=Ue.rect;if(null===Nt)continue;ye&&ee.verticalizable&&(at=Ue.imageName?ht-Ue.metrics.width*Ue.scale/2:0);const Jt=pe?[Ue.x+ht,Ue.y]:[0,0];let Xt=[0,0],Kt=[0,0],ei=!1;pe||(Bt?(Kt=[Ue.x+ht+ze[0],Ue.y+ze[1]-at],ei=!0):Xt=[Ue.x+ht+K[0],Ue.y+K[1]-at]);const si=Nt.w*Ue.scale/(yt*(Ue.localGlyph?2:1)),Ii=Nt.h*Ue.scale/(yt*(Ue.localGlyph?2:1));let Ft,yi,_i,zt;if(Bt){const Vt=Ue.y-it,ui=new Be(-ht,ht-Vt),Gi=-Math.PI/2,Ai=new Be(...Kt);Ft=new Be(-ht+Xt[0],Xt[1]),Ft._rotateAround(Gi,ui)._add(Ai),Ft.x+=-Vt+ht,Ft.y-=(Tt.left-wt)*Ue.scale;const Si=Ue.imageName?Tt.advance*Ue.scale:Bi*Ue.scale,Ki=String.fromCharCode(Ue.glyph);Qm(Ki)?Ft.x+=(1-wt)*Ue.scale:e_(Ki)?Ft.x+=Si-Tt.height*Ue.scale+(-wt-1)*Ue.scale:Ft.x+=Ue.imageName||Tt.width+2*wt===Nt.w&&Tt.height+2*wt===Nt.h?(Si-Ii)/2:(Si-(Tt.height+2*wt)*Ue.scale)/2,yi=new Be(Ft.x,Ft.y-si),_i=new Be(Ft.x+Ii,Ft.y),zt=new Be(Ft.x+Ii,Ft.y-si)}else{const Vt=(Tt.left-wt)*Ue.scale-ht+Xt[0],ui=(-Tt.top-wt)*Ue.scale+Xt[1],Gi=Vt+si,Ai=ui+Ii;Ft=new Be(Vt,ui),yi=new Be(Gi,ui),_i=new Be(Vt,Ai),zt=new Be(Gi,Ai)}if(Me){let Vt;Vt=pe?new Be(0,0):ei?new Be(ze[0],ze[1]):new Be(K[0],K[1]),Ft._rotateAround(Me,Vt),yi._rotateAround(Me,Vt),_i._rotateAround(Me,Vt),zt._rotateAround(Me,Vt)}const oi=new Be(0,0),wi=new Be(0,0);Ee.push({tl:Ft,tr:yi,bl:_i,br:zt,tex:rt,writingMode:ee.writingMode,glyphOffset:Jt,sectionIndex:Ue.sectionIndex,isSDF:xt,pixelOffsetTL:oi,pixelOffsetBR:wi,minFontScaleX:0,minFontScaleY:0})}}return Ee}(0,r,_,c,u,p,s,t.allowVerticalPlacement),J=t.textSizeData;let $=null;"source"===J.kind?($=[Fr*c.layout.get("text-size").evaluate(p,{},L)],$[0]>Jo&&ti(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===J.kind&&($=[Fr*A.compositeTextSizes[0].evaluate(p,{},L),Fr*A.compositeTextSizes[1].evaluate(p,{},L)],($[0]>Jo||$[1]>Jo)&&ti(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,W,$,_,u,p,v,e,i,g.lineStartIndex,g.lineLength,I,k,L);for(const Y of w)T[Y]=t.text.placedSymbolArray.length-1;return 4*W.length}function Zp(t){for(const e in t)return t[e];return null}function bh(t,e,i,r,s,c,u,p,_,g){let v=u.top,w=u.bottom,T=u.left,I=u.right;const A=u.collisionPadding;if(A&&(T-=A[0],v-=A[1],I+=A[2],w+=A[3]),_){const k=new Be(T,v),L=new Be(I,v),W=new Be(T,w),J=new Be(I,w),$=vt(_);let Y=new Be(0,0);g&&(Y=new Be(g[0],g[1])),k._rotateAround($,Y),L._rotateAround($,Y),W._rotateAround($,Y),J._rotateAround($,Y),T=Math.min(k.x,L.x,W.x,J.x),I=Math.max(k.x,L.x,W.x,J.x),v=Math.min(k.y,L.y,W.y,J.y),w=Math.max(k.y,L.y,W.y,J.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,T,v,I,w,p,r,s,c),t.length-1}function Su(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function C_(t,e,i,r){const s=t.compareText;if(e in s){const c=s[e];for(let u=c.length-1;u>=0;u--)if(r.dist(c[u])<i)return!0}else s[e]=[];return s[e].push(r),!1}const I_=qe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Np}=I_,Vp=qe([{name:"a_pos_3",components:3,type:"Int16"}]);var Vl=qe([{name:"a_pos",type:"Int16",components:2}]);const Eo=lt/Math.PI/2,zu=2*Yn(1,0)*Eo*Math.PI,La=[64,32,16],Kn=-Eo,Qn=Eo,A_=[new Yi([Kn,Kn,Kn],[Qn,Qn,Qn]),new Yi([Kn,Kn,Kn],[0,0,Qn]),new Yi([0,Kn,Kn],[Qn,0,Qn]),new Yi([Kn,0,Kn],[0,Qn,Qn]),new Yi([0,0,Kn],[Qn,Qn,Qn])];function jp(t,e,i,r=!0){const s=An([],t._camera.position,t.worldSize),c=[e,i,1,1];Ls(c,c,t.pixelMatrixInverse),Ld(c,c,1/c[3]);const u=Hi([],mr([],c,s)),p=t.globeMatrix,_=[p[12],p[13],p[14]],g=mr([],_,s),v=Tl(g),w=Hi([],g),T=t.worldSize/(2*Math.PI),I=Jn(w,u),A=Math.asin(T/v);if(A<Math.acos(I)){if(!r)return null;const Pe=[],ye=[];An(Pe,u,v/I),Hi(ye,mr(ye,Pe,g)),Hi(u,vo(u,g,An(u,ye,Math.tan(A)*v)))}const k=[];new lu(s,u).closestPointOnSphere(_,T,k);const L=Hi([],Pn(p,0)),W=Hi([],Pn(p,1)),J=Hi([],Pn(p,2)),$=Jn(L,k),Y=Jn(W,k),ee=Jn(J,k),K=di(Math.asin(-Y/T));let fe=di(Math.atan2($,ee));fe=t.center.lng+function(Pe,ye){const Ee=(ye-Pe+180)%360-180;return Ee<-180?Ee+360:Ee}(t.center.lng,fe);const pe=Or(fe),we=_t(Rr(K),0,1);return new ba(pe,we)}class S_{constructor(e,i,r){this.a=mr([],e,r),this.b=mr([],i,r),this.center=r;const s=Hi([],this.a),c=Hi([],this.b);this.angle=Math.acos(Jn(s,c))}}function ku(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,s,c,u){const p=Math.sin(c);return r*(Math.sin((1-u)*c)/p)+s*(Math.sin(u*c)/p)}(t.a[e],t.b[e],t.angle,_t(i,0,1))+t.center[e]}function Ur(t){if(t.z<=1)return A_[t.z+2*t.y+t.x];const e=Du(wh(t));return Yi.fromPoints(e)}function Rs(t,e,i){return An(t,t,1-i),Cl(t,t,e,i)}function Gp(t,e){const i=Ra(e.zoom);if(0===i)return Ur(t);const r=wh(t),s=Du(r),c=Or(r.getWest())*e.worldSize,u=Or(r.getEast())*e.worldSize,p=Rr(r.getNorth())*e.worldSize,_=Rr(r.getSouth())*e.worldSize,g=[c,p,0],v=[u,p,0],w=[c,_,0],T=[u,_,0],I=nu([],e.globeMatrix);return hi(g,g,I),hi(v,v,I),hi(w,w,I),hi(T,T,I),s[0]=Rs(s[0],w,i),s[1]=Rs(s[1],T,i),s[2]=Rs(s[2],v,i),s[3]=Rs(s[3],g,i),Yi.fromPoints(s)}function qp(t,e,i){for(const r of t)hi(r,r,e),An(r,r,i)}function wh({x:t,y:e,z:i}){const r=1/(1<<i),s=new It(In(t*r),Ri((e+1)*r)),c=new It(In((t+1)*r),Ri(e*r));return new Yo(s,c)}function Du(t){const e=vt(t.getNorth()),i=vt(t.getSouth()),r=Math.cos(e),s=Math.cos(i),c=Math.sin(e),u=Math.sin(i),p=t.getWest(),_=t.getEast();return[Oa(s,u,p),Oa(s,u,_),Oa(r,c,_),Oa(r,c,p)]}function Oa(t,e,i,r=Eo){return i=vt(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function jl(t,e,i){return Oa(Math.cos(vt(t)),Math.sin(vt(t)),e,i)}function Gl(t,e,i,r){const s=1<<i.z,c=(t/lt+i.x)/s;return jl(Ri((e/lt+i.y)/s),In(c),r)}function Th({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const $p=new Float64Array(16);function ql(t){const e=Th(t),i=Sd($p,[e,e,e]);return wl(i,i,((r=[])[0]=-(s=t.min)[0],r[1]=-s[1],r[2]=-s[2],r));var r,s}function Pu(t){const e=(r=t.min,(i=$p)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i);var i,r;const s=1/Th(t);return Ps(e,e,[s,s,s])}function Wp(t,e,i,r,s){const c=function(_){const g=lt/(2*Math.PI);return _/(2*Math.PI)/g}(i),u=[t,e,-i/(2*Math.PI)],p=fr(new Float64Array(16));return wl(p,p,u),Ps(p,p,[c,c,c]),ru(p,p,vt(-s)),rh(p,p,vt(-r)),p}function Ra(t){return Xr(5,6,t)}function Xp(t,e){const i=jl(e.lat,e.lng);return u=(s=su([],function(A){const k=jl(A._center.lat,A._center.lng);let L=au([],Ta(0,1,0),k);const W=zd([],-A.angle,k);L=hi(L,L,W),zd(W,-A._pitch,L);const J=Hi([],k);return An(J,J,A.cameraToCenterDistance/A.pixelsPerMeter*zu),hi(J,J,W),vo([],k,J)}(t),i))[0],p=s[1],_=s[2],g=(c=i)[0],v=c[1],w=c[2],I=(T=Math.sqrt(u*u+p*p+_*_)*Math.sqrt(g*g+v*v+w*w))&&Jn(s,c)/T,Math.acos(Math.min(Math.max(I,-1),1));var s,c,u,p,_,g,v,w,T,I}function Lu(t,e){return Xp(t,e)>Math.PI/2*1.01}const Hp=vt(85),k_=Math.cos(Hp),D_=Math.sin(Hp);function Yp(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,s=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),c=Math.sin(i)*s/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),u=Math.sin(t._pitch)*c+s;return Math.min(1.01*u,s*(1/t._horizonShift))}function Bs(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,s=(t.x+1)*i,c=t.y*i,u=(t.y+1)*i,p=In(r),_=In(s),g=Ri(c),v=Ri(u),w=e.project(p,g),T=e.project(_,g),I=e.project(_,v),A=e.project(p,v);let k=Math.min(w.x,T.x,I.x,A.x),L=Math.min(w.y,T.y,I.y,A.y),W=Math.max(w.x,T.x,I.x,A.x),J=Math.max(w.y,T.y,I.y,A.y);const $=i/16;function Y(K,fe,pe,we,Pe,ye){const Ee=(pe+Pe)/2,Me=(we+ye)/2,ze=e.project(In(Ee),Ri(Me)),Le=Math.max(0,k-ze.x,L-ze.y,ze.x-W,ze.y-J);k=Math.min(k,ze.x),W=Math.max(W,ze.x),L=Math.min(L,ze.y),J=Math.max(J,ze.y),Le>$&&(Y(K,ze,pe,we,Ee,Me),Y(ze,fe,Ee,Me,Pe,ye))}Y(w,T,r,c,s,c),Y(T,I,s,c,s,u),Y(I,A,s,u,r,u),Y(A,w,r,u,r,c),k-=$,L-=$,W+=$,J+=$;const ee=1/Math.max(W-k,J-L);return{scale:ee,x:k*ee,y:L*ee,x2:W*ee,y2:J*ee,projection:e}}const P_=fr(new Float32Array(16));class Ko{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new It(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return Yn(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return Yp(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,s){const c=e.horizonLineFromTop(!1),u=new Be(i,Math.max(c,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(u,s))}pointCoordinate3D(e,i,r){const s=new Be(i,r);if(e.elevation)return e.elevation.pointCoordinate(s);{const c=this.pointCoordinate(e,s.x,s.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return P_}createTileMatrix(e,i,r){let s,c,u;const p=r.canonical,_=fr(new Float64Array(16));if(this.isReprojectedInTileSpace){const g=Bs(p,this);s=1,c=g.x+r.wrap*g.scale,u=g.y,Ps(_,_,[s/g.scale,s/g.scale,e.pixelsPerMeter/i])}else s=i/e.zoomScale(p.z),c=(p.x+Math.pow(2,p.z)*r.wrap)*s,u=p.y*s;return wl(_,_,[c,u,0]),Ps(_,_,[s/lt,s/lt,1]),_}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class L_ extends Ko{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(vt(i));this.n=(s+Math.sin(vt(r)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:s,r0:c}=this,u=vt(e-this.center[0]),p=vt(i),_=Math.sqrt(s-2*r*Math.sin(p))/r;return{x:_*Math.sin(u*r),y:_*Math.cos(u*r)-c,z:0}}unproject(e,i){const{n:r,c:s,r0:c}=this,u=c+i;let p=Math.atan2(e,Math.abs(u))*Math.sign(u);u*r<0&&(p-=Math.PI*Math.sign(e)*Math.sign(u));const _=vt(this.center[0])*r;p=tr(p,-Math.PI-_,Math.PI-_);const g=_t(di(p/r)+this.center[0],-180,180),v=Math.asin(_t((s-(e*e+u*u)*r*r)/(2*r),-1,1)),w=_t(di(v),-85.051129,Br);return new It(g,w)}}const $l=1.340264,Wl=-.081106,Xl=893e-6,Hl=.003796,Eh=Math.sqrt(3)/2;class O_ extends Ko{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(Eh*Math.sin(i)),s=r*r,c=s*s*s;return{x:.5*(e*Math.cos(r)/(Eh*($l+3*Wl*s+c*(7*Xl+9*Hl*s)))/Math.PI+.5),y:1-.5*(r*($l+Wl*s+c*(Xl+Hl*s))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,s=r*r,c=s*s*s;for(let v,w,T,I=0;I<12&&(w=r*($l+Wl*s+c*(Xl+Hl*s))-i,T=$l+3*Wl*s+c*(7*Xl+9*Hl*s),v=w/T,r=_t(r-v,-Math.PI/3,Math.PI/3),s=r*r,c=s*s*s,!(Math.abs(v)<1e-12));++I);const u=Eh*e*($l+3*Wl*s+c*(7*Xl+9*Hl*s))/Math.cos(r),p=Math.asin(Math.sin(r)/Eh),_=_t(180*u/Math.PI,-180,180),g=_t(180*p/Math.PI,-85.051129,Br);return new It(_,g)}}class R_ extends Ko{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),s=_t(360*(.5-i),-85.051129,Br);return new It(r,s)}}const Ba=Math.PI/2;function Mh(t){return Math.tan((Ba+t)/2)}class B_ extends Ko{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let s=vt(i),c=vt(r);this.southernCenter=s+c<0,this.southernCenter&&(s=-s,c=-c);const u=Math.cos(s),p=Mh(s);this.n=s===c?Math.sin(s):Math.log(u/Math.cos(c))/Math.log(Mh(c)/p),this.f=u*Math.pow(Mh(s),this.n)/this.n}project(e,i){i=vt(i),this.southernCenter&&(i=-i),e=vt(e-this.center[0]);const r=1e-6,{n:s,f:c}=this;c>0?i<-Ba+r&&(i=-Ba+r):i>Ba-r&&(i=Ba-r);const u=c/Math.pow(Mh(i),s);let p=u*Math.sin(s*e),_=c-u*Math.cos(s*e);return p=.5*(p/Math.PI+.5),_=.5*(_/Math.PI+.5),{x:p,y:this.southernCenter?_:1-_,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:s}=this,c=s-i,u=Math.sign(c),p=Math.sign(r)*Math.sqrt(e*e+c*c);let _=Math.atan2(e,Math.abs(c))*u;c*r<0&&(_-=Math.PI*Math.sign(e)*u);const g=_t(di(_/r)+this.center[0],-180,180),v=_t(di(2*Math.atan(Math.pow(s/p,1/r))-Ba),-85.051129,Br);return new It(g,this.southernCenter?-v:v)}}class Jp extends Ko{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Or(e),y:Rr(i),z:0}}unproject(e,i){const r=In(e),s=Ri(i);return new It(r,s)}}const Kp=vt(Br);class F_ extends Ko{project(e,i){const r=(i=vt(i))*i,s=r*r;return{x:.5*((e=vt(e))*(.8707-.131979*r+s*(s*(.003971*r-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+s*(.028874*r-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,s=25,c=0,u=r*r;do{u=r*r;const g=u*u;c=(r*(1.007226+u*(.015085+g*(.028874*u-.044475-.005916*g)))-i)/(1.007226+u*(.045255+g*(.259866*u-.311325-.005916*11*g))),r=_t(r-c,-Kp,Kp)}while(Math.abs(c)>1e-6&&--s>0);u=r*r;const p=_t(di(e/(.8707+u*(u*(u*u*u*(.003971-.001529*u)-.013791)-.131979))),-180,180),_=di(r);return new It(p,_)}}const Qp=vt(Br);class U_ extends Ko{project(e,i){i=vt(i),e=vt(e);const r=Math.cos(i),s=2/Math.PI,c=Math.acos(r*Math.cos(e/2)),u=Math.sin(c)/c,p=.5*(e*s+2*r*Math.sin(e/2)/u)||0,_=.5*(i+Math.sin(i)/u)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(_/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,s=i=(2*(1-i)-1)*Math.PI,c=25;const u=1e-6;let p=0,_=0;do{const g=Math.cos(s),v=Math.sin(s),w=2*v*g,T=v*v,I=g*g,A=Math.cos(r/2),k=Math.sin(r/2),L=2*A*k,W=k*k,J=1-I*A*A,$=J?1/J:0,Y=J?Math.acos(g*A)*Math.sqrt(1/J):0,ee=.5*(2*Y*g*k+2*r/Math.PI)-e,K=.5*(Y*v+s)-i,fe=.5*$*(I*W+Y*g*A*T)+1/Math.PI,pe=$*(L*w/4-Y*v*k),we=.125*$*(w*k-Y*v*I*L),Pe=.5*$*(T*A+Y*W*g)+.5,ye=pe*we-Pe*fe;p=(K*pe-ee*Pe)/ye,_=(ee*we-K*fe)/ye,r=_t(r-p,-Math.PI,Math.PI),s=_t(s-_,-Qp,Qp)}while((Math.abs(p)>u||Math.abs(_)>u)&&--c>0);return new It(di(r),di(s))}}class ef extends Ko{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(vt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:s}=this;return{x:vt(e)*s*r+.5,y:-Math.sin(vt(i))/s*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:s}=this,c=-(i-.5)/r,u=_t(di((e-.5)/r)/s,-180,180),p=Math.asin(_t(c*s,-1,1)),_=_t(di(p),-85.051129,Br);return new It(u,_)}}class Z_ extends Jp{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,i,r){const s=Gl(e,i,r);return hi(s,s,ql(Ur(r))),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,i){const r=jl(i.lat,i.lng),s=Hi([],r),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Cl(r,r,s,Yn(1,0)*lt*c);const u=fr(new Float64Array(16));return Ds(u,e.pixelMatrix,e.globeMatrix),hi(r,r,u),new Be(r[0],r[1])}pixelsPerMeter(e,i){return Yn(1,0)*i}pixelSpaceConversion(e,i,r){const s=Yn(1,e)*i,c=At(Yn(1,45)*i,s,r);return this.pixelsPerMeter(e,i)/c}createTileMatrix(e,i,r){const s=Pu(Ur(r.canonical));return Ds(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,i){const{center:r}=e,s=ql(Ur(i));return rh(s,s,vt(r.lng)),ru(s,s,vt(r.lat)),Ps(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(e,i,r,s){return jp(e,i,r,!0)||new ba(0,0)}pointCoordinate3D(e,i,r){const s=this.pointCoordinate(e,i,r,0);return[s.x,s.y,s.z]}isPointAboveHorizon(e,i){return!jp(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(s,c){const u=s.cameraToCenterDistance,p=s._centerAltitude*c,_=s._camera,g=s._camera.forward(),v=vo([],An([],g,-u),[0,0,p]),w=s.worldSize/(2*Math.PI),T=[0,0,-w],I=s.width/s.height,A=Math.tan(s.fovAboveCenter),k=An([],_.up(),A),L=An([],_.right(),A*I),W=Hi([],vo([],vo([],g,k),L)),J=[];let $;if(new lu(v,W).closestPointOnSphere(T,w,J)){const Y=vo([],J,T),ee=mr([],Y,v);$=Math.cos(s.fovAboveCenter)*Tl(ee)}else{const Y=mr([],v,T),ee=mr([],T,v);Hi(ee,ee);const K=Tl(Y)-w;$=Math.sqrt(K*(K+2*w));const fe=Math.acos($/(w+K))-Math.acos(Jn(g,ee));$*=Math.cos(fe)}return 1.01*$}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Ra(e.zoom);if(r>0){const s=Yp(e,Yn(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),u=Math.max(e.width,e.height)/e.worldSize*Math.PI;return At(i,s+c*(1-Math.cos(u)),Math.pow(r,10))}return i}upVector(e,i,r){return Gl(i,r,e,1)}upVectorScale(e){return{metersToTile:zu*Th(Ur(e))}}}function tf(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Jp(t);case"equirectangular":return new R_(t);case"naturalEarth":return new F_(t);case"equalEarth":return new O_(t);case"winkelTripel":return new U_(t);case"albers":return i?new ef(t):new L_(t);case"lambertConformalConic":return i?new ef(t):new B_(t);case"globe":return new Z_(t)}throw new Error(`Invalid projection name: ${t.name}`)}const N_=uh.types,V_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ch(t,e,i,r,s,c,u,p,_,g,v,w,T){const I=p?Math.min(Jo,Math.round(p[0])):0,A=p?Math.min(Jo,Math.round(p[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*s),c,u,(I<<1)+(_?1:0),A,16*g,16*v,256*w,256*T)}function Ih(t,e,i,r,s,c,u){t.emplaceBack(e,i,r,s,c,u)}function Ah(t,e,i,r,s){t.emplaceBack(e,i,r,s),t.emplaceBack(e,i,r,s),t.emplaceBack(e,i,r,s),t.emplaceBack(e,i,r,s)}function j_(t){for(const e of t.sections)if(U(e.text))return!0;return!1}class Ou{constructor(e){this.layoutVertexArray=new qt,this.indexArray=new Oi,this.programConfigurations=e,this.segments=new gi,this.dynamicLayoutVertexArray=new an,this.opacityVertexArray=new ci,this.placedSymbolArray=new ed,this.globeExtVertexArray=new St}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,r,s){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Wm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,V_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$m.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}$e(Ou,"SymbolBuffers");class Ru{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new gi,this.collisionVertexArray=new Is,this.collisionVertexArrayExt=new ur}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Xm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Hm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}$e(Ru,"CollisionBuffers");class Qo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(u=>u.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fr([]),this.placementViewportMatrix=fr([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vu(this.zoom,i["text-size"]),this.iconSizeData=vu(this.zoom,i["icon-size"]);const r=this.layers[0].layout,s=r.get("symbol-sort-key"),c=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==c&&void 0!==s.constantOr(1),this.sortFeaturesByY=("viewport-y"===c||"auto"===c&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(u=>Sn[u]),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Ou(new Ss(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ou(new Ss(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new nd,this.lineVertexArray=new rd,this.symbolInstances=new id}calculateGlyphDependencies(e,i,r,s,c){for(let u=0;u<e.length;u++)if(i[e.charCodeAt(u)]=!0,s&&c){const p=Fl[e.charAt(u)];p&&(i[p.charCodeAt(0)]=!0)}}populate(e,i,r,s){const c=this.layers[0],u=c.layout,p="globe"===this.projection.name,_=u.get("text-font"),g=u.get("text-field"),v=u.get("icon-image"),w=("constant"!==g.value.kind||g.value.value instanceof C&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&("constant"!==_.value.kind||_.value.value.length>0),T="constant"!==v.value.kind||!!v.value.value||Object.keys(v.parameters).length>0,I=u.get("symbol-sort-key");if(this.features=[],!w&&!T)return;const A=i.iconDependencies,k=i.glyphDependencies,L=i.availableImages,W=new oe(this.zoom);for(const{feature:J,id:$,index:Y,sourceLayerIndex:ee}of e){const K=c._featureFilter.needGeometry,fe=zs(J,K);if(!c._featureFilter.filter(W,fe,r))continue;if(K||(fe.geometry=xo(J,r,s)),p&&1!==J.type&&r.z<=5){const ye=fe.geometry,Ee=.98078528056,Me=(ze,Le)=>Jn(Gl(ze.x,ze.y,r,1),Gl(Le.x,Le.y,r,1))<Ee;for(let ze=0;ze<ye.length;ze++)ye[ze]=jf(ye[ze],Me)}let pe,we;if(w){const ye=c.getValueAndResolveTokens("text-field",fe,r,L),Ee=C.factory(ye);j_(Ee)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===re()||this.hasRTLText&&de.isParsed())&&(pe=Km(Ee,c,fe))}if(T){const ye=c.getValueAndResolveTokens("icon-image",fe,r,L);we=ye instanceof j?ye:j.fromString(ye)}if(!pe&&!we)continue;const Pe=this.sortFeaturesByKey?I.evaluate(fe,{},r):void 0;if(this.features.push({id:$,text:pe,icon:we,index:Y,sourceLayerIndex:ee,geometry:fe.geometry,properties:J.properties,type:N_[J.type],sortKey:Pe}),we&&(A[we.name]=!0),pe){const ye=_.evaluate(fe,{},r).join(","),Ee="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Sn.vertical)>=0;for(const Me of pe.sections)if(Me.image)A[Me.image.name]=!0;else{const ze=y(pe.toString()),Le=Me.fontStack||ye,xe=k[Le]=k[Le]||{};this.calculateGlyphDependencies(Me.text,xe,Ee,this.allowVerticalPlacement,ze)}}}"line"===u.get("symbol-placement")&&(this.features=function(J){const $={},Y={},ee=[];let K=0;function fe(ye){ee.push(J[ye]),K++}function pe(ye,Ee,Me){const ze=Y[ye];return delete Y[ye],Y[Ee]=ze,ee[ze].geometry[0].pop(),ee[ze].geometry[0]=ee[ze].geometry[0].concat(Me[0]),ze}function we(ye,Ee,Me){const ze=$[Ee];return delete $[Ee],$[ye]=ze,ee[ze].geometry[0].shift(),ee[ze].geometry[0]=Me[0].concat(ee[ze].geometry[0]),ze}function Pe(ye,Ee,Me){const ze=Me?Ee[0][Ee[0].length-1]:Ee[0][0];return`${ye}:${ze.x}:${ze.y}`}for(let ye=0;ye<J.length;ye++){const Ee=J[ye],Me=Ee.geometry,ze=Ee.text?Ee.text.toString():null;if(!ze){fe(ye);continue}const Le=Pe(ze,Me),xe=Pe(ze,Me,!0);if(Le in Y&&xe in $&&Y[Le]!==$[xe]){const Fe=we(Le,xe,Me),it=pe(Le,xe,ee[Fe].geometry);delete $[Le],delete Y[xe],Y[Pe(ze,ee[it].geometry,!0)]=it,ee[Fe].geometry=null}else Le in Y?pe(Le,xe,Me):xe in $?we(Le,xe,Me):(fe(ye),$[Le]=K-1,Y[xe]=K-1)}return ee.filter(ye=>ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,$)=>J.sortKey-$.sortKey)}update(e,i,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,r,s),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,r,s))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=tf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:s,y:c}of i)this.lineVertexArray.emplaceBack(s,c);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,s,c,u,p,_,g,v,w,T,I,A){const k=e.indexArray,L=e.layoutVertexArray,W=e.globeExtVertexArray,J=e.segments.prepareSegment(4*i.length,L,k,this.canOverlap?u.sortKey:void 0),$=this.glyphOffsetArray.length,Y=J.vertexLength,ee=this.allowVerticalPlacement&&p===Sn.vertical?Math.PI/2:0,K=u.text&&u.text.sections;for(let pe=0;pe<i.length;pe++){const{tl:we,tr:Pe,bl:ye,br:Ee,tex:Me,pixelOffsetTL:ze,pixelOffsetBR:Le,minFontScaleX:xe,minFontScaleY:Fe,glyphOffset:it,isSDF:Ve,sectionIndex:Ye}=i[pe],Ue=J.vertexLength,rt=it[1];if(Ch(L,g.x,g.y,we.x,rt+we.y,Me.x,Me.y,r,Ve,ze.x,ze.y,xe,Fe),Ch(L,g.x,g.y,Pe.x,rt+Pe.y,Me.x+Me.w,Me.y,r,Ve,Le.x,ze.y,xe,Fe),Ch(L,g.x,g.y,ye.x,rt+ye.y,Me.x,Me.y+Me.h,r,Ve,ze.x,Le.y,xe,Fe),Ch(L,g.x,g.y,Ee.x,rt+Ee.y,Me.x+Me.w,Me.y+Me.h,r,Ve,Le.x,Le.y,xe,Fe),_){const{x:wt,y:xt,z:yt}=_.anchor,[at,Bt,ht]=_.up;Ih(W,wt,xt,yt,at,Bt,ht),Ih(W,wt,xt,yt,at,Bt,ht),Ih(W,wt,xt,yt,at,Bt,ht),Ih(W,wt,xt,yt,at,Bt,ht),Ah(e.dynamicLayoutVertexArray,wt,xt,yt,ee)}else Ah(e.dynamicLayoutVertexArray,g.x,g.y,g.z,ee);k.emplaceBack(Ue,Ue+1,Ue+2),k.emplaceBack(Ue+1,Ue+2,Ue+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(it[0]),pe!==i.length-1&&Ye===i[pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(L.length,u,u.index,{},I,A,K&&K[Ye])}const fe=_?_.anchor:g;e.placedSymbolArray.emplaceBack(fe.x,fe.y,fe.z,g.x,g.y,$,this.glyphOffsetArray.length-$,Y,v,w,g.segment,r?r[0]:0,r?r[1]:0,s[0],s[1],p,0,!1,0,T,0)}_commitLayoutVertex(e,i,r,s,c,u,p){e.emplaceBack(i,r,s,c,u,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,i,r,s,c,u,p){const _=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),g=_.vertexLength,v=p.tileAnchorX,w=p.tileAnchorY;for(let I=0;I<4;I++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,s,c,u,v,w,new Be(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,s,c,u,v,w,new Be(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,s,c,u,v,w,new Be(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,s,c,u,v,w,new Be(e.x1,e.y2)),_.vertexLength+=4;const T=r.indexArray;T.emplaceBack(g,g+1),T.emplaceBack(g+1,g+2),T.emplaceBack(g+2,g+3),T.emplaceBack(g+3,g),_.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,s,c,u){for(let p=s;p<c;p++){const _=r.get(p),g=this.getSymbolInstanceTextSize(e,u,i,p);this._addCollisionDebugVertices(_,g,this.textCollisionBox,_.projectedAnchorX,_.projectedAnchorY,_.projectedAnchorZ,u)}}_addIconDebugCollisionBoxes(e,i,r,s,c,u){for(let p=s;p<c;p++){const _=r.get(p),g=this.getSymbolInstanceIconSize(e,i,u.placedIconSymbolIndex);this._addCollisionDebugVertices(_,g,this.iconCollisionBox,_.projectedAnchorX,_.projectedAnchorY,_.projectedAnchorZ,u)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ru($t,fp.members,Hn),this.iconCollisionBox=new Ru($t,fp.members,Hn);const r=Ia(this.iconSizeData,e),s=Ia(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(s,e,i,u.textBoxStartIndex,u.textBoxEndIndex,u),this._addTextDebugCollisionBoxes(s,e,i,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._addIconDebugCollisionBoxes(r,e,i,u.iconBoxStartIndex,u.iconBoxEndIndex,u),this._addIconDebugCollisionBoxes(r,e,i,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u)}}getSymbolInstanceTextSize(e,i,r,s){const c=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:s),u=mh(this.textSizeData,e,c)/Bi;return this.tilePixelRatio*u}getSymbolInstanceIconSize(e,i,r){const s=this.icon.placedSymbolArray.get(r),c=mh(this.iconSizeData,e,s);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,i,r){e.emplaceBack(i,-r,-r),e.emplaceBack(i,r,-r),e.emplaceBack(i,r,r),e.emplaceBack(i,-r,r)}_updateTextDebugCollisionBoxes(e,i,r,s,c,u){for(let p=s;p<c;p++){const _=r.get(p),g=this.getSymbolInstanceTextSize(e,u,i,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,g,_.padding)}}_updateIconDebugCollisionBoxes(e,i,r,s,c,u){for(let p=s;p<c;p++){const _=r.get(p),g=this.getSymbolInstanceIconSize(e,i,u);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,g,_.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Ia(this.iconSizeData,e),s=Ia(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(s,e,i,u.textBoxStartIndex,u.textBoxEndIndex,u),this._updateTextDebugCollisionBoxes(s,e,i,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._updateIconDebugCollisionBoxes(r,e,i,u.iconBoxStartIndex,u.iconBoxEndIndex,u.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,i,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,s,c,u,p,_,g){const v={};if(i<r){const{x1:w,y1:T,x2:I,y2:A,padding:k,projectedAnchorX:L,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:$,tileAnchorY:Y,featureIndex:ee}=e.get(i);v.textBox={x1:w,y1:T,x2:I,y2:A,padding:k,projectedAnchorX:L,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:$,tileAnchorY:Y},v.textFeatureIndex=ee}if(s<c){const{x1:w,y1:T,x2:I,y2:A,padding:k,projectedAnchorX:L,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:$,tileAnchorY:Y,featureIndex:ee}=e.get(s);v.verticalTextBox={x1:w,y1:T,x2:I,y2:A,padding:k,projectedAnchorX:L,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:$,tileAnchorY:Y},v.verticalTextFeatureIndex=ee}if(u<p){const{x1:w,y1:T,x2:I,y2:A,padding:k,projectedAnchorX:L,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:$,tileAnchorY:Y,featureIndex:ee}=e.get(u);v.iconBox={x1:w,y1:T,x2:I,y2:A,padding:k,projectedAnchorX:L,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:$,tileAnchorY:Y},v.iconFeatureIndex=ee}if(_<g){const{x1:w,y1:T,x2:I,y2:A,padding:k,projectedAnchorX:L,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:$,tileAnchorY:Y,featureIndex:ee}=e.get(_);v.verticalIconBox={x1:w,y1:T,x2:I,y2:A,padding:k,projectedAnchorX:L,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:$,tileAnchorY:Y},v.verticalIconFeatureIndex=ee}return v}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),s=r.vertexStartIndex+4*r.numGlyphs;for(let c=r.vertexStartIndex;c<s;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),s=[],c=[],u=[];for(let p=0;p<this.symbolInstances.length;++p){u.push(p);const _=this.symbolInstances.get(p);s.push(0|Math.round(i*_.tileAnchorX+r*_.tileAnchorY)),c.push(_.featureIndex)}return u.sort((p,_)=>s[p]-s[_]||c[_]-c[p]),u}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:u,verticalPlacedTextSymbolIndex:p,placedIconSymbolIndex:_,verticalPlacedIconSymbolIndex:g}=r;s>=0&&this.addIndicesForPlacedSymbol(this.text,s),c>=0&&c!==s&&this.addIndicesForPlacedSymbol(this.text,c),u>=0&&u!==c&&u!==s&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&this.addIndicesForPlacedSymbol(this.icon,_),g>=0&&this.addIndicesForPlacedSymbol(this.icon,g)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}$e(Qo,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Qo.MAX_GLYPHS=65535,Qo.addDynamicAttributes=Ah;const G_=new Qe({"symbol-placement":new se(be.layout_symbol["symbol-placement"]),"symbol-spacing":new se(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new se(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _e(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new se(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new se(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new se(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new se(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new se(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new _e(be.layout_symbol["icon-size"]),"icon-text-fit":new se(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new se(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new _e(be.layout_symbol["icon-image"]),"icon-rotate":new _e(be.layout_symbol["icon-rotate"]),"icon-padding":new se(be.layout_symbol["icon-padding"]),"icon-keep-upright":new se(be.layout_symbol["icon-keep-upright"]),"icon-offset":new _e(be.layout_symbol["icon-offset"]),"icon-anchor":new _e(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new se(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new se(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new se(be.layout_symbol["text-rotation-alignment"]),"text-field":new _e(be.layout_symbol["text-field"]),"text-font":new _e(be.layout_symbol["text-font"]),"text-size":new _e(be.layout_symbol["text-size"]),"text-max-width":new _e(be.layout_symbol["text-max-width"]),"text-line-height":new _e(be.layout_symbol["text-line-height"]),"text-letter-spacing":new _e(be.layout_symbol["text-letter-spacing"]),"text-justify":new _e(be.layout_symbol["text-justify"]),"text-radial-offset":new _e(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new se(be.layout_symbol["text-variable-anchor"]),"text-anchor":new _e(be.layout_symbol["text-anchor"]),"text-max-angle":new se(be.layout_symbol["text-max-angle"]),"text-writing-mode":new se(be.layout_symbol["text-writing-mode"]),"text-rotate":new _e(be.layout_symbol["text-rotate"]),"text-padding":new se(be.layout_symbol["text-padding"]),"text-keep-upright":new se(be.layout_symbol["text-keep-upright"]),"text-transform":new _e(be.layout_symbol["text-transform"]),"text-offset":new _e(be.layout_symbol["text-offset"]),"text-allow-overlap":new se(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new se(be.layout_symbol["text-ignore-placement"]),"text-optional":new se(be.layout_symbol["text-optional"])});var Bu={paint:new Qe({"icon-opacity":new _e(be.paint_symbol["icon-opacity"]),"icon-color":new _e(be.paint_symbol["icon-color"]),"icon-halo-color":new _e(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new _e(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _e(be.paint_symbol["icon-halo-blur"]),"icon-translate":new se(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new se(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new _e(be.paint_symbol["text-opacity"]),"text-color":new _e(be.paint_symbol["text-color"],{runtimeType:rn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new _e(be.paint_symbol["text-halo-color"]),"text-halo-width":new _e(be.paint_symbol["text-halo-width"]),"text-halo-blur":new _e(be.paint_symbol["text-halo-blur"]),"text-translate":new se(be.paint_symbol["text-translate"]),"text-translate-anchor":new se(be.paint_symbol["text-translate-anchor"])}),layout:G_};class nf{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:vi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e(nf,"FormatSectionOverride",{omit:["defaultValue"]});class Sh extends pr{constructor(e){super(e,Bu)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const s=[];for(const c of r)s.indexOf(c)<0&&s.push(c);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,s){const c=this.layout.get(e).evaluate(i,{},r,s),u=this._unevaluatedLayout._values[e];return u.isDataDriven()||xs(u.value)||!c?c:(p=i.properties,c.replace(/{([^{}]+)}/g,(g,v)=>v in p?String(p[v]):""));var p}createBucket(e){return new Qo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Bu.paint.overridableProperties){if(!Sh.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new nf(i),s=new ha(r,i.property.specification);let c=null;c="constant"===i.value.kind||"source"===i.value.kind?new Pr("source",s):new ua("composite",s,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Ie(i.property,c,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&Sh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),s=Bu.paint.properties[i];let c=!1;const u=p=>{for(const _ of p)if(s.overrides&&s.overrides.hasOverride(_))return void(c=!0)};if("constant"===r.value.kind&&r.value.value instanceof C)u(r.value.value.sections);else if("source"===r.value.kind){const p=g=>{c||(g instanceof Cn&&nt(g.value)===sr?u(g.value.sections):g instanceof zr?u(g.sections):g.eachChild(p))},_=r.value;_._styleExpression&&p(_._styleExpression.expression)}return c}getProgramConfiguration(e){return new Ho(this,e)}}var q_={paint:new Qe({"background-color":new se(be.paint_background["background-color"]),"background-pattern":new se(be.paint_background["background-pattern"]),"background-opacity":new se(be.paint_background["background-opacity"])})},$_={paint:new Qe({"raster-opacity":new se(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new se(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new se(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new se(be.paint_raster["raster-brightness-max"]),"raster-saturation":new se(be.paint_raster["raster-saturation"]),"raster-contrast":new se(be.paint_raster["raster-contrast"]),"raster-resampling":new se(be.paint_raster["raster-resampling"]),"raster-fade-duration":new se(be.paint_raster["raster-fade-duration"])})};class W_ extends pr{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var X_={paint:new Qe({"sky-type":new se(be.paint_sky["sky-type"]),"sky-atmosphere-sun":new se(be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new se(be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new se(be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new se(be.paint_sky["sky-gradient-radius"]),"sky-gradient":new Xe(be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new se(be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new se(be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new se(be.paint_sky["sky-opacity"])})};function Fu(t,e,i){const r=[0,0,1],s=Bd([]);return Ud(s,s,i?-vt(t)+Math.PI:vt(t)),Fd(s,s,-vt(e)),Pd(r,r,s),Hi(r,r)}const H_={circle:class extends pr{constructor(t){super(t,Yf)}createBucket(t){return new eu(t)}queryRadius(t){const e=t;return wa("circle-radius",this,e)+wa("circle-stroke-width",this,e)+ih(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,s,c,u,p){const _=Cd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),g=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Zd(t,r,c,u,p,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),_,g)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Ho(this,t)}},heatmap:class extends pr{createBucket(t){return new Vd(t)}constructor(t){super(t,rm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=du({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return wa("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,s,c,u,p){const _=this.paint.get("heatmap-radius").evaluate(e,i);return Zd(t,r,c,u,p,!0,!0,new Be(0,0),_)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Ho(this,t)}},hillshade:class extends pr{constructor(t){super(t,om)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends pr{constructor(t){super(t,bm)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Ho(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ch(t)}queryRadius(){return ih(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,s,c){return!t.queryGeometry.isAboveHorizon&&bd(Md(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends pr{constructor(t){super(t,Bm)}createBucket(t){return new Ol(t)}queryRadius(){return ih(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Ho(this,t)}queryIntersectsFeature(t,e,i,r,s,c,u,p,_){const g=Cd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(e,i),w=this.paint.get("fill-extrusion-base").evaluate(e,i),T=[0,0],I=p&&c.elevation,A=c.elevation?c.elevation.exaggeration():1,k=t.tile.getBucket(this);if(I&&k instanceof Ol){const Y=k.centroidVertexArray,ee=_+1;ee<Y.length&&(T[0]=Y.geta_centroid_pos0(ee),T[1]=Y.geta_centroid_pos1(ee))}if(0===T[0]&&1===T[1])return!1;"globe"===c.projection.name&&(r=sp([r],[new Be(0,0),new Be(lt,lt)],t.tileID.canonical).map(Y=>Y.polygon).flat());const L=I?p:null,[W,J]=(ee=r,K=w,fe=v,pe=g,we=u,Pe=L,ye=T,Ee=A,Me=c.center.lat,"globe"===(Y=c).projection.name?function(Le,xe,Fe,it,Ve,Ye,Ue,rt,wt,xt,yt){const at=[],Bt=[],ht=Le.projection.upVectorScale(yt,Le.center.lat,Le.worldSize).metersToTile,Tt=[0,0,0,1],Nt=[0,0,0,1],Jt=(Kt,ei,si,Ii)=>{Kt[0]=ei,Kt[1]=si,Kt[2]=Ii,Kt[3]=1},Xt=op();Fe>0&&(Fe+=Xt),it+=Xt;for(const Kt of xe){const ei=[],si=[];for(const Ii of Kt){const Ft=Ii.x+Ve.x,yi=Ii.y+Ve.y,_i=Le.projection.projectTilePoint(Ft,yi,yt),zt=Le.projection.upVector(yt,Ii.x,Ii.y);let oi=Fe,wi=it;if(Ue){const Vt=hp(Ft,yi,Fe,it,Ue,rt,wt,xt);oi+=Vt.base,wi+=Vt.top}0!==Fe?Jt(Tt,_i.x+zt[0]*ht*oi,_i.y+zt[1]*ht*oi,_i.z+zt[2]*ht*oi):Jt(Tt,_i.x,_i.y,_i.z),Jt(Nt,_i.x+zt[0]*ht*wi,_i.y+zt[1]*ht*wi,_i.z+zt[2]*ht*wi),hi(Tt,Tt,Ye),hi(Nt,Nt,Ye),ei.push(new Ca(Tt[0],Tt[1],Tt[2])),si.push(new Ca(Nt[0],Nt[1],Nt[2]))}at.push(ei),Bt.push(si)}return[at,Bt]}(Y,ee,K,fe,pe,we,Pe,ye,Ee,Me,t.tileID.canonical):Pe?function(Le,xe,Fe,it,Ve,Ye,Ue,rt,wt){const xt=[],yt=[],at=[0,0,0,1];for(const Bt of Le){const ht=[],Tt=[];for(const Nt of Bt){const Jt=Nt.x+it.x,Xt=Nt.y+it.y,Kt=hp(Jt,Xt,xe,Fe,Ye,Ue,rt,wt);at[0]=Jt,at[1]=Xt,at[2]=Kt.base,at[3]=1,Ls(at,at,Ve),at[3]=Math.max(at[3],1e-5);const ei=new Ca(at[0]/at[3],at[1]/at[3],at[2]/at[3]);at[0]=Jt,at[1]=Xt,at[2]=Kt.top,at[3]=1,Ls(at,at,Ve),at[3]=Math.max(at[3],1e-5);const si=new Ca(at[0]/at[3],at[1]/at[3],at[2]/at[3]);ht.push(ei),Tt.push(si)}xt.push(ht),yt.push(Tt)}return[xt,yt]}(ee,K,fe,pe,we,Pe,ye,Ee,Me):function(Le,xe,Fe,it,Ve){const Ye=[],Ue=[],rt=Ve[8]*xe,wt=Ve[9]*xe,xt=Ve[10]*xe,yt=Ve[11]*xe,at=Ve[8]*Fe,Bt=Ve[9]*Fe,ht=Ve[10]*Fe,Tt=Ve[11]*Fe;for(const Nt of Le){const Jt=[],Xt=[];for(const Kt of Nt){const ei=Kt.x+it.x,si=Kt.y+it.y,Ii=Ve[0]*ei+Ve[4]*si+Ve[12],Ft=Ve[1]*ei+Ve[5]*si+Ve[13],yi=Ve[2]*ei+Ve[6]*si+Ve[14],_i=Ve[3]*ei+Ve[7]*si+Ve[15],zt=Ii+rt,oi=Ft+wt,wi=yi+xt,Vt=Math.max(_i+yt,1e-5),ui=Ii+at,Gi=Ft+Bt,Ai=yi+ht,Si=Math.max(_i+Tt,1e-5);Jt.push(new Ca(zt/Vt,oi/Vt,wi/Vt)),Xt.push(new Ca(ui/Si,Gi/Si,Ai/Si))}Ye.push(Jt),Ue.push(Xt)}return[Ye,Ue]}(ee,K,fe,pe,we)),$=t.queryGeometry;var Y,ee,K,fe,pe,we,Pe,ye,Ee,Me;return function(Y,ee,K){let fe=1/0;bd(K,ee)&&(fe=cp(K,ee[0]));for(let pe=0;pe<ee.length;pe++){const we=ee[pe],Pe=Y[pe];for(let ye=0;ye<we.length-1;ye++){const Ee=we[ye],Me=[Ee,we[ye+1],Pe[ye+1],Pe[ye],Ee];vd(K,Me)&&(fe=Math.min(fe,cp(K,Me)))}}return fe!==1/0&&fe}(W,J,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},line:class extends pr{constructor(t){super(t,up),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ks,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=dp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new fh(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Ho(this,t)}queryRadius(t){const e=t,i=pp(wa("line-width",this,e),wa("line-gap-width",this,e)),r=wa("line-offset",this,e);return i/2+Math.abs(r)+ih(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,s,c){if(t.queryGeometry.isAboveHorizon)return!1;const u=Md(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),p=t.pixelToTileUnitsFactor/2*pp(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),_=this.paint.get("line-offset").evaluate(e,i);return _&&(r=function(g,v){const w=[],T=new Be(0,0);for(let I=0;I<g.length;I++){const A=g[I],k=[];for(let L=0;L<A.length;L++){const J=A[L],$=A[L+1],Y=0===L?T:J.sub(A[L-1])._unit()._perp(),ee=L===A.length-1?T:$.sub(J)._unit()._perp(),K=Y._add(ee)._unit();K._mult(1/(K.x*ee.x+K.y*ee.y)),k.push(K._mult(v)._add(J))}w.push(k)}return w}(r,_*t.pixelToTileUnitsFactor)),function(g,v,w){for(let T=0;T<v.length;T++){const I=v[T];if(g.length>=3)for(let A=0;A<I.length;A++)if(ks(g,I[A]))return!0;if($f(g,I,w))return!0}return!1}(u,r,p)}isTileClipped(){return!0}},symbol:Sh,background:class extends pr{constructor(t){super(t,q_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends pr{constructor(t){super(t,$_)}getProgramIds(){return["raster"]}},sky:class extends pr{constructor(t){super(t,X_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=du({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),s=!r,c=t.style.light,u=c.properties.get("position");return s&&"viewport"===c.properties.get("anchor")&&ti("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?Fu(u.azimuthal,90-u.polar,e):Fu(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return Fu(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class Yl{constructor(e,i,r,s){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,s)}update(e,i,r){const{width:s,height:c}=e,{context:u}=this,{gl:p}=u,{HTMLImageElement:_,HTMLCanvasElement:g,HTMLVideoElement:v,ImageData:w,ImageBitmap:T}=Se;if(p.bindTexture(p.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!i||!1!==i.premultiply)),r||this.size&&this.size[0]===s&&this.size[1]===c){const{x:I,y:A}=r||{x:0,y:0};e instanceof _||e instanceof g||e instanceof v||e instanceof w||T&&e instanceof T?p.texSubImage2D(p.TEXTURE_2D,0,I,A,p.RGBA,p.UNSIGNED_BYTE,e):p.texSubImage2D(p.TEXTURE_2D,0,I,A,s,c,p.RGBA,p.UNSIGNED_BYTE,e.data)}else this.size=[s,c],e instanceof _||e instanceof g||e instanceof v||e instanceof w||T&&e instanceof T?p.texImage2D(p.TEXTURE_2D,0,this.format,this.format,p.UNSIGNED_BYTE,e):p.texImage2D(p.TEXTURE_2D,0,this.format,s,c,0,this.format,p.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i){const{context:r}=this,{gl:s}=r;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.filter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?e===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Y_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class J_{constructor(){this.tasks={},this.taskQueue=[],kn(["process"],this),this.invoker=new Y_(this.process),this.nextId=0}add(e,i){const r=this.nextId++,s=function({type:c,isSymbolTile:u,zoom:p}){return p=p||0,"message"===c?0:"maybePrepare"!==c||u?"parseTile"!==c||u?"parseTile"===c&&u?300-p:"maybePrepare"===c&&u?400-p:500:200-p:100-p}(i);if(0===s){en();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:i,priority:s,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){en();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let s=0;s<this.taskQueue.length;s++){const c=this.tasks[this.taskQueue[s]];c.priority<i&&(i=c.priority,e=s)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class rf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const K_=["tile","layer","source","sourceLayer","state"];class of{constructor(e,i,r,s,c){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=s,this.properties=e.properties,this.id=c}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const i of K_)void 0!==this[i]&&(e[i]=this[i]);return e}}const es=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,s=0,c=0,u=0,p=0;for(1&e?s=c=u=32:i=r=p=32;(e>>=1)>1;){const g=i+s>>1,v=r+c>>1;1&e?(s=i,c=r,i=u,r=p):(i=s,r=c,s=u,c=p),u=g,p=v}const _=4*t;es[_+0]=i,es[_+1]=r,es[_+2]=s,es[_+3]=c}const Nr=new Uint16Array(2178),ts=new Uint8Array(1089),zh=new Uint16Array(1089);function sf(t){return 0===t?-.03125:32===t?.03125:0}var af=qe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const lf={type:2,extent:lt,loadGeometry:()=>[[new Be(0,0),new Be(8193,0),new Be(8193,8193),new Be(0,8193),new Be(0,0)]]};class Uu{constructor(e,i,r,s,c){this.tileID=e,this.uid=Hr(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,this.expiredRequestCount=0,this.state="loading",s&&s.transform&&(this.projection=s.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<We.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Bs(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,c){const u={};if(!c)return u;for(const p of s){const _=p.layerIds.map(g=>c.getLayer(g)).filter(Boolean);if(0!==_.length){p.layers=_,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(g=>_.filter(v=>v.id===g)[0]));for(const g of _)u[g.id]=p}}return u}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const s in this.buckets){const c=this.buckets[s];if(c instanceof Qo){if(this.hasSymbolBuckets=!0,!r)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const s in this.buckets){const c=this.buckets[s];if(c instanceof Qo&&c.hasRTLText){this.hasRTLText=!0,de.isLoading()||de.isLoaded()||"deferred"!==re()||me();break}}this.queryPadding=0;for(const s in this.buckets){const c=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(s).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Wh}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const s=this.buckets[r];s.uploadPending()&&s.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Yl(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Yl(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Yl(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,r,s,c,u,p,_){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:s,pixelPosMatrix:p,transform:u,params:c,tileTransform:this.tileTransform},e,i,r):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const s=r.loadVTLayers(),c=i?i.sourceLayer:"",u=s._geojsonTileLayer||s[c];if(!u)return;const p=_o(i&&i.filter),{z:_,x:g,y:v}=this.tileID.canonical,w={z:_,x:g,y:v};for(let T=0;T<u.length;T++){const I=u.feature(T);if(p.needGeometry){const L=zs(I,!0);if(!p.filter(new oe(this.tileID.overscaledZ),L,this.tileID.canonical))continue}else if(!p.filter(new oe(this.tileID.overscaledZ),I))continue;const A=r.getId(I,c),k=new of(I,_,g,v,A);k.tile=w,e.push(k)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const r=tn(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let s=!1;if(this.expirationTime>r)s=!1;else if(i)if(this.expirationTime<i)s=!0;else{const c=this.expirationTime-i;c?this.expirationTime=r+Math.max(c,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const r=this.latestFeatureIndex.loadVTLayers(),s=i.style.listImages();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const u=this.buckets[c],p=u.layers[0].sourceLayer||"_geojsonTileLayer",_=r[p],g=e[p];if(!_||!g||0===Object.keys(g).length)continue;if(u.update(g,_,s,this.imageAtlas&&this.imageAtlas.patternPositions||{}),u instanceof fh||u instanceof ch){const w=i.style._getSourceCache(u.layers[0].source);i._terrain&&i._terrain.enabled&&w&&u.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(w.id,this.tileID)}const v=i&&i.style&&i.style.getLayer(c);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(u)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<We.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=We.now()+e}setTexture(e,i){const r=i.context,s=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Yl(r,e,s.RGBA,{useMipmap:!0}),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,i){const r={};for(const s of i)r[s]=!0;this.dependencies[e]=r}hasDependency(e,i){for(const r of e){const s=this.dependencies[r];if(s)for(const c of i)if(s[c])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const r=xo(lf,this.tileID.canonical,this.tileTransform)[0],s=new kt,c=new vl;for(let u=0;u<r.length;u++){const{x:p,y:_}=r[u];s.emplaceBack(p,_),c.emplaceBack(u)}c.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(s,Vl.members),this._tileDebugSegments=gi.simpleSegment(0,0,s.length,c.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const r=xo(lf,this.tileID.canonical,this.tileTransform)[0];let s,c;if(this.isRaster){const u=function(p,_){const g=Bs(p,_),v=Math.pow(2,p.z);for(let L=0;L<33;L++)for(let W=0;W<33;W++){const J=In((p.x+(W+sf(W))/32)/v),$=Ri((p.y+(L+sf(L))/32)/v),Y=_.project(J,$),ee=33*L+W;Nr[2*ee+0]=Math.round((Y.x*g.scale-g.x)*lt),Nr[2*ee+1]=Math.round((Y.y*g.scale-g.y)*lt)}ts.fill(0),zh.fill(0);for(let L=2045;L>=0;L--){const W=4*L,J=es[W+0],$=es[W+1],Y=es[W+2],ee=es[W+3],K=J+Y>>1,fe=$+ee>>1,pe=K+fe-$,we=fe+J-K,Pe=33*$+J,ye=33*ee+Y,Ee=33*fe+K,Me=Math.hypot((Nr[2*Pe+0]+Nr[2*ye+0])/2-Nr[2*Ee+0],(Nr[2*Pe+1]+Nr[2*ye+1])/2-Nr[2*Ee+1])>=16;ts[Ee]=ts[Ee]||(Me?1:0),L<1022&&(ts[Ee]=ts[Ee]||ts[33*($+we>>1)+(J+pe>>1)]||ts[33*(ee+we>>1)+(Y+pe>>1)])}const w=new Zt,T=new Oi;let I=0;function A(L,W){const J=33*W+L;return 0===zh[J]&&(w.emplaceBack(Nr[2*J+0],Nr[2*J+1],L*lt/32,W*lt/32),zh[J]=++I),zh[J]-1}function k(L,W,J,$,Y,ee){const K=L+J>>1,fe=W+$>>1;if(Math.abs(L-Y)+Math.abs(W-ee)>1&&ts[33*fe+K])k(Y,ee,L,W,K,fe),k(J,$,Y,ee,K,fe);else{const pe=A(L,W),we=A(J,$),Pe=A(Y,ee);T.emplaceBack(pe,we,Pe)}}return k(0,0,32,32,32,0),k(32,32,0,0,0,32),{vertices:w,indices:T}}(this.tileID.canonical,i);s=u.vertices,c=u.indices}else{s=new Zt,c=new Oi;for(const{x:p,y:_}of r)s.emplaceBack(p,_,0,0);const u=Al.exports(s.int16,void 0,4);for(let p=0;p<u.length;p+=3)c.emplaceBack(u[p],u[p+1],u[p+2])}this._tileBoundsBuffer=e.createVertexBuffer(s,af.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(c),this._tileBoundsSegments=gi.simpleSegment(0,0,s.length,c.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||"globe"!==r.name||i.freezeTileCoverage)return;const s=this.tileID.canonical,c=ql(Gp(s,i)),u=Ra(i.zoom);let p;u>0&&(p=nu(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,s,i,c,p,u),this._makeGlobeTileDebugTextBuffer(e,s,i,c,p,u)}_globePoint(e,i,r,s,c,u,p){let _=Gl(e,i,r);if(u){const g=1<<r.z,v=Or(s.center.lng),w=Rr(s.center.lat),T=(r.x+.5)/g-v;let I=0;T>.5?I=-1:T<-.5&&(I=1);let A=(e/lt+r.x)/g+I,k=(i/lt+r.y)/g;A=(A-v)*s._pixelsPerMercatorPixel+v,k=(k-w)*s._pixelsPerMercatorPixel+w;const L=[A*s.worldSize,k*s.worldSize,0];hi(L,L,u),_=Rs(_,L,p)}return hi(_,_,c)}_makeGlobeTileDebugBorderBuffer(e,i,r,s,c,u){const p=new kt,_=new vl,g=new Gt,v=(T,I,A,k,L)=>{const W=(A-T)/(L-1),J=(k-I)/(L-1),$=p.length;for(let Y=0;Y<L;Y++){const ee=T+Y*W,K=I+Y*J;p.emplaceBack(ee,K);const fe=this._globePoint(ee,K,i,r,s,c,u);g.emplaceBack(fe[0],fe[1],fe[2]),_.emplaceBack($+Y)}},w=lt;v(0,0,w,0,16),v(w,0,w,w,16),v(w,w,0,w,16),v(0,w,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(_),this._tileDebugBuffer=e.createVertexBuffer(p,Vl.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(g,Vp.members),this._tileDebugSegments=gi.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugTextBuffer(e,i,r,s,c,u){const p=new kt,_=new Oi,g=new Gt,v=25;_.reserve(32),p.reserve(v),g.reserve(v);const w=(T,I)=>v*T+I;for(let T=0;T<v;T++){const I=2048*T;for(let A=0;A<v;A++){const k=2048*A;p.emplaceBack(k,I);const L=this._globePoint(k,I,i,r,s,c,u);g.emplaceBack(L[0],L[1],L[2])}}for(let T=0;T<4;T++)for(let I=0;I<4;I++){const A=w(T,I),k=w(T,I+1),L=w(T+1,I),W=w(T+1,I+1);_.emplaceBack(A,k,L),_.emplaceBack(L,k,W)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(_),this._tileDebugTextBuffer=e.createVertexBuffer(p,Vl.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(g,Vp.members),this._tileDebugTextSegments=gi.simpleSegment(0,0,v,32)}}class Q_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const s=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},ni(this.stateChanges[e][s],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const c in this.state[e])c!==s&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][s]){this.deletedStates[e][s]={};for(const c in this.state[e][s])r[c]||(this.deletedStates[e][s][c]=null)}else for(const c in r)this.deletedStates[e]&&this.deletedStates[e][s]&&null===this.deletedStates[e][s][c]&&delete this.deletedStates[e][s][c]}removeFeatureState(e,i,r){if(null===this.deletedStates[e])return;const s=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==i)null!==this.deletedStates[e][s]&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][r]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][s])for(r in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][r]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),s=ni({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const c=this.deletedStates[e][i];if(null===c)return{};for(const u in c)delete s[u]}return s}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const r={};for(const s in this.stateChanges){this.state[s]=this.state[s]||{};const c={};for(const u in this.stateChanges[s])this.state[s][u]||(this.state[s][u]={}),ni(this.state[s][u],this.stateChanges[s][u]),c[u]=this.state[s][u];r[s]=c}for(const s in this.deletedStates){this.state[s]=this.state[s]||{};const c={};if(null===this.deletedStates[s])for(const u in this.state[s])c[u]={},this.state[s][u]={};else for(const u in this.deletedStates[s]){if(null===this.deletedStates[s][u])this.state[s][u]={};else for(const p of Object.keys(this.deletedStates[s][u]))delete this.state[s][u][p];c[u]=this.state[s][u]}r[s]=r[s]||{},ni(r[s],c)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const s in e)e[s].setFeatureState(r,i)}}class cf{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function hf(t,e,i,r){let s=0,c=Number.MAX_VALUE;for(let u=0;u<3;u++)if(Math.abs(r[u])<1e-15){if(i[u]<t[u]||i[u]>e[u])return null}else{const p=1/r[u];let _=(t[u]-i[u])*p,g=(e[u]-i[u])*p;if(_>g){const v=_;_=g,g=v}if(_>s&&(s=_),g<c&&(c=g),s>c)return null}return s}function uf(t,e,i,r,s,c,u,p,_,g,v){const w=r-t,T=s-e,I=c-i,A=u-t,k=p-e,L=_-i,W=v[1]*L-v[2]*k,J=v[2]*A-v[0]*L,$=v[0]*k-v[1]*A,Y=w*W+T*J+I*$;if(Math.abs(Y)<1e-15)return null;const ee=1/Y,K=g[0]-t,fe=g[1]-e,pe=g[2]-i,we=(K*W+fe*J+pe*$)*ee;if(we<0||we>1)return null;const Pe=fe*I-pe*T,ye=pe*w-K*I,Ee=K*T-fe*w,Me=(v[0]*Pe+v[1]*ye+v[2]*Ee)*ee;return Me<0||we+Me>1?null:(A*Pe+k*ye+L*Ee)*ee}function df(t,e,i){return(t-e)/(i-e)}function pf(t,e,i,r,s,c,u,p,_){const g=1<<i,v=c-r,w=u-s,T=(t+1)/g*v+r,I=(e+0)/g*w+s,A=(e+1)/g*w+s;p[0]=(t+0)/g*v+r,p[1]=I,_[0]=T,_[1]=A}class ff{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(c){const u=Math.ceil(Math.log2(c.dim/8)),p=[];let _=Math.ceil(Math.pow(2,u));const g=1/_,v=(I,A,k,L,W)=>{const J=L?1:0,$=(I+1)*k-J,Y=A*k,ee=(A+1)*k-J;W[0]=I*k,W[1]=Y,W[2]=$,W[3]=ee};let w=new cf(_);const T=[];for(let I=0;I<_*_;I++){v(I%_,Math.floor(I/_),g,!1,T);const A=is(T[0],T[1],c),k=is(T[2],T[1],c),L=is(T[2],T[3],c),W=is(T[0],T[3],c);w.minimums.push(Math.min(A,k,L,W)),w.maximums.push(Math.max(A,k,L,W)),w.leaves.push(1)}for(p.push(w),_/=2;_>=1;_/=2){const I=p[p.length-1];w=new cf(_);for(let A=0;A<_*_;A++){v(A%_,Math.floor(A/_),2,!0,T);const k=I.getElevation(T[0],T[1]),L=I.getElevation(T[2],T[1]),W=I.getElevation(T[2],T[3]),J=I.getElevation(T[0],T[3]),$=I.isLeaf(T[0],T[1]),Y=I.isLeaf(T[2],T[1]),ee=I.isLeaf(T[2],T[3]),K=I.isLeaf(T[0],T[3]),fe=Math.min(k.min,L.min,W.min,J.min),pe=Math.max(k.max,L.max,W.max,J.max),we=$&&Y&&ee&&K;w.maximums.push(pe),w.minimums.push(fe),w.leaves.push(pe-fe<=5&&we?1:0)}p.push(w)}return p}(this.dem),r=i.length-1,s=i[r];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,s,c,u,p=1){return hf([e,i,-100],[r,s,this.maximums[0]*p],c,u)}raycast(e,i,r,s,c,u,p=1){if(!this.nodeCount)return null;const _=this.raycastRoot(e,i,r,s,c,u,p);if(null==_)return null;const g=[],v=[],w=[],T=[],I=[{idx:0,t:_,nodex:0,nodey:0,depth:0}];for(;I.length>0;){const{idx:A,t:k,nodex:L,nodey:W,depth:J}=I.pop();if(this.leaves[A]){pf(L,W,J,e,i,r,s,w,T);const Y=1<<J,ee=(L+0)/Y,K=(L+1)/Y,fe=(W+0)/Y,pe=(W+1)/Y,we=is(ee,fe,this.dem)*p,Pe=is(K,fe,this.dem)*p,ye=is(K,pe,this.dem)*p,Ee=is(ee,pe,this.dem)*p,Me=uf(w[0],w[1],we,T[0],w[1],Pe,T[0],T[1],ye,c,u),ze=uf(T[0],T[1],ye,w[0],T[1],Ee,w[0],w[1],we,c,u),Le=Math.min(null!==Me?Me:Number.MAX_VALUE,null!==ze?ze:Number.MAX_VALUE);if(Le!==Number.MAX_VALUE)return Le;{const xe=Cl([],c,u,k);if(mf(we,Pe,Ee,ye,df(xe[0],w[0],T[0]),df(xe[1],w[1],T[1]))>=xe[2])return k}continue}let $=0;for(let Y=0;Y<this._siblingOffset.length;Y++){pf((L<<1)+this._siblingOffset[Y][0],(W<<1)+this._siblingOffset[Y][1],J+1,e,i,r,s,w,T),w[2]=-100,T[2]=this.maximums[this.childOffsets[A]+Y]*p;const ee=hf(w,T,c,u);if(null!=ee){const K=ee;g[Y]=K;let fe=!1;for(let pe=0;pe<$&&!fe;pe++)K>=g[v[pe]]&&(v.splice(pe,0,Y),fe=!0);fe||(v[$]=Y),$++}}for(let Y=0;Y<$;Y++){const ee=v[Y];I.push({idx:this.childOffsets[A]+ee,t:g[ee],nodex:(L<<1)+this._siblingOffset[ee][0],nodey:(W<<1)+this._siblingOffset[ee][1],depth:J+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,s,c){if(1===e[s].isLeaf(i,r))return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const u=s-1,p=e[u];let _=0,g=0;for(let v=0;v<this._siblingOffset.length;v++){const w=2*i+this._siblingOffset[v][0],T=2*r+this._siblingOffset[v][1],I=p.getElevation(w,T),A=p.isLeaf(w,T),k=this._addNode(I.min,I.max,A);A&&(_|=1<<v),g||(g=k)}for(let v=0;v<this._siblingOffset.length;v++)_&1<<v||this._construct(e,2*i+this._siblingOffset[v][0],2*r+this._siblingOffset[v][1],u,g+v)}}function mf(t,e,i,r,s,c){return At(At(t,i,c),At(e,r,c),s)}function is(t,e,i){const r=i.dim,s=_t(t*r-.5,0,r-1),c=_t(e*r-.5,0,r-1),u=Math.floor(s),p=Math.floor(c),_=Math.min(u+1,r-1),g=Math.min(p+1,r-1);return mf(i.get(u,p),i.get(_,p),i.get(u,g),i.get(_,g),s-u,c-p)}const _f={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class kh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,s=!1,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return ti(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const u=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=r||"mapbox",this.borderReady=s,!s){for(let _=0;_<u;_++)p[this._idx(-1,_)]=p[this._idx(0,_)],p[this._idx(u,_)]=p[this._idx(u-1,_)],p[this._idx(_,-1)]=p[this._idx(_,0)],p[this._idx(_,u)]=p[this._idx(_,u-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(u,-1)]=p[this._idx(u-1,0)],p[this._idx(-1,u)]=p[this._idx(0,u-1)],p[this._idx(u,u)]=p[this._idx(u-1,u-1)],c&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new ff(this)}get(e,i,r=!1){r&&(e=_t(e,-1,this.dim),i=_t(i,-1,this.dim));const s=4*this._idx(e,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[s],this.pixels[s+1],this.pixels[s+2])}static getUnpackVector(e){return _f[e]}get unpackVector(){return _f[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,r){return(256*e*256+256*i+r)/10-1e4}_unpackTerrarium(e,i,r){return 256*e+i+r/256-32768}static pack(e,i){const r=[0,0,0,0],s=kh.getUnpackVector(i);let c=Math.floor((e+s[3])/s[2]);return r[2]=c%256,c=Math.floor(c/256),r[1]=c%256,c=Math.floor(c/256),r[0]=c,r}getPixels(){return new gn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=i*this.dim,c=i*this.dim+this.dim,u=r*this.dim,p=r*this.dim+this.dim;switch(i){case-1:s=c-1;break;case 1:c=s+1}switch(r){case-1:u=p-1;break;case 1:p=u+1}const _=-i*this.dim,g=-r*this.dim;for(let v=u;v<p;v++)for(let w=s;w<c;w++){const T=4*this._idx(w,v),I=4*this._idx(w+_,v+g);this.pixels[T+0]=e.pixels[I+0],this.pixels[T+1]=e.pixels[I+1],this.pixels[T+2]=e.pixels[I+2],this.pixels[T+3]=e.pixels[I+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}$e(kh,"DEMData"),$e(ff,"DemMinMaxQuadTree",{omit:["dem"]});class eg{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){const s=e.wrapped().key;void 0===this.data[s]&&(this.data[s]=[]);const c={value:i,timeout:void 0};if(void 0!==r&&(c.timeout=setTimeout(()=>{this.remove(e,c)},r)),this.data[s].push(c),this.order.push(s),this.order.length>this.max){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const r=e.wrapped().key,s=void 0===i?0:this.data[r].indexOf(i),c=this.data[r][s];return this.data[r].splice(s,1),c.timeout&&clearTimeout(c.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(c.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const r in this.data)for(const s of this.data[r])e(s.value)||i.push(s);for(const r of i)this.remove(r.value.tileID,r)}}class Fa{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}Fa.ReadOnly=!1,Fa.ReadWrite=!0,Fa.disabled=new Fa(519,Fa.ReadOnly,[0,1]);class Nu{constructor(e,i,r,s,c,u){this.test=e,this.ref=i,this.mask=r,this.fail=s,this.depthFail=c,this.pass=u}}Nu.disabled=new Nu({func:519,mask:0},0,0,7680,7680,7680);class Vr{constructor(e,i,r){this.blendFunction=e,this.blendColor=i,this.mask=r}}Vr.Replace=[1,0],Vr.disabled=new Vr(Vr.Replace,ri.transparent,[!1,!1,!1,!1]),Vr.unblended=new Vr(Vr.Replace,ri.transparent,[!0,!0,!0,!0]),Vr.alphaBlended=new Vr([1,771],ri.transparent,[!0,!0,!0,!0]);class _r{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}_r.disabled=new _r(!1,1029,2305),_r.backCCW=new _r(!0,1029,2305),_r.backCW=new _r(!0,1029,2304),_r.frontCW=new _r(!0,1028,2304),_r.frontCCW=new _r(!0,1028,2305);class Fs extends Ut{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",s=>{"source"===s.dataType&&"metadata"===s.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===s.dataType&&"content"===s.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new eg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Q_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return ir(this._tiles).map(e=>e.tileID).sort(gf).map(e=>e.key)}getRenderableIds(e){const i=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&i.push(this._tiles[r]);return e?i.sort((r,s)=>{const c=r.tileID,u=s.tileID,p=new Be(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),_=new Be(u.canonical.x,u.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-u.overscaledZ||_.y-p.y||_.x-p.x}).map(r=>r.tileID.key):i.map(r=>r.tileID).sort(gf).map(r=>r.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(e,i,r,s){if(s)if(e.state="errored",404!==s.status)this._source.fire(new ki(s,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=We.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ei("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let s=0;s<i.length;s++){const c=i[s];if(e.neighboringTiles&&e.neighboringTiles[c]){const u=this.getTileByID(c);r(e,u),r(u,e)}}function r(s,c){if(!s.dem||s.dem.borderReady)return;s.needsHillshadePrepare=!0,s.needsDEMTextureUpload=!0;let u=c.tileID.canonical.x-s.tileID.canonical.x;const p=c.tileID.canonical.y-s.tileID.canonical.y,_=Math.pow(2,s.tileID.canonical.z),g=c.tileID.key;0===u&&0===p||Math.abs(p)>1||(Math.abs(u)>1&&(1===Math.abs(u+_)?u+=_:1===Math.abs(u-_)&&(u-=_)),c.dem&&s.dem&&(s.dem.backfillBorder(c.dem,u,p),s.neighboringTiles&&s.neighboringTiles[g]&&(s.neighboringTiles[g].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,s){for(const c in this._tiles){let u=this._tiles[c];if(s[c]||!u.hasData()||u.tileID.overscaledZ<=i||u.tileID.overscaledZ>r)continue;let p=u.tileID;for(;u&&u.tileID.overscaledZ>i+1;){const g=u.tileID.scaledTo(u.tileID.overscaledZ-1);u=this._tiles[g.key],u&&u.hasData()&&(p=g)}let _=p;for(;_.overscaledZ>i;)if(_=_.scaledTo(_.overscaledZ-1),e[_.key]){s[p.key]=p;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){const s=e.scaledTo(r),c=this._getLoadedTile(s);if(c)return c}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const r=Math.ceil(e.width/i)+1,s=Math.ceil(e.height/i)+1,c=Math.floor(r*s*5),u="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,c):c,p="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const r={};for(const s in this._tiles){const c=this._tiles[s];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+i),r[c.tileID.key]=c}this._tiles=r;for(const s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(const s in this._tiles)this._setTileReloadTimer(+s,this._tiles[s])}}update(e,i,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let s;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new Ji(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(s=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(s=s.filter(p=>this._source.hasTile(p)))):s=[];const c=this._updateRetainedTiles(s);if(yf(this._source.type)&&0!==s.length){const p={},_={},g=Object.keys(c);for(const w of g){const T=c[w],I=this._tiles[w];if(!I||I.fadeEndTime&&I.fadeEndTime<=We.now())continue;const A=this.findLoadedParent(T,Math.max(T.overscaledZ-Fs.maxOverzooming,this._source.minzoom));A&&(this._addTile(A.tileID),p[A.tileID.key]=A.tileID),_[w]=T}const v=s[s.length-1].overscaledZ;for(const w in this._tiles){const T=this._tiles[w];if(c[w]||!T.hasData())continue;let I=T.tileID;for(;I.overscaledZ>v;){I=I.scaledTo(I.overscaledZ-1);const A=this._tiles[I.key];if(A&&A.hasData()&&_[I.key]){c[w]=T.tileID;break}}}for(const w in p)c[w]||(this._coveredTiles[w]=!0,c[w]=p[w])}for(const p in c)this._tiles[p].clearFadeHold();const u=function(p,_){const g=[];for(const v in p)v in _||g.push(v);return g}(this._tiles,c);for(const p of u){const _=this._tiles[p];_.hasSymbolBuckets&&!_.holdingForFade()?_.setHoldDuration(this.map._fadeDuration):_.hasSymbolBuckets&&!_.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const r={},s=e.reduce((g,v)=>Math.min(g,v.overscaledZ),1/0),c=e[0].overscaledZ,u=Math.max(c-Fs.maxOverzooming,this._source.minzoom),p=Math.max(c+Fs.maxUnderzooming,this._source.minzoom),_={};for(const g of e){const v=this._addTile(g);i[g.key]=g,v.hasData()||s<this._source.maxzoom&&(_[g.key]=g)}this._retainLoadedChildren(_,s,p,i);for(const g of e){let v=this._tiles[g.key];if(v.hasData())continue;if(g.canonical.z>=this._source.maxzoom){const T=g.children(this._source.maxzoom)[0],I=this.getTile(T);if(I&&I.hasData()){i[T.key]=T;continue}}else{const T=g.children(this._source.maxzoom);if(i[T[0].key]&&i[T[1].key]&&i[T[2].key]&&i[T[3].key])continue}let w=v.wasRequested();for(let T=g.overscaledZ-1;T>=u;--T){const I=g.scaledTo(T);if(r[I.key]||(r[I.key]=!0,v=this.getTile(I),!v&&w&&(v=this._addTile(I)),v&&(i[I.key]=I,w=v.wasRequested(),v.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let r,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){r=this._loadedParentTiles[s.key];break}i.push(s.key);const c=s.scaledTo(s.overscaledZ-1);if(r=this._getLoadedTile(c),r)break;s=c}for(const c of i)this._loadedParentTiles[c]=r}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=!!i;if(!r){const s=this.map?this.map.painter:null;i=new Uu(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,s,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new Ei("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const s=[],c=this.transform;if(!c)return s;const u="globe"===c.projection.name,p=Or(c.center.lng);for(const _ in this._tiles){const g=this._tiles[_];if(r&&g.clearQueryDebugViz(),g.holdingForFade())continue;let v;if(u){const w=g.tileID.canonical;if(0===w.z){const T=[Math.abs(_t(p,...Jl(w,-1))-p),Math.abs(_t(p,...Jl(w,1))-p)];v=[0,2*T.indexOf(Math.min(...T))-1]}else{const T=[Math.abs(_t(p,...Jl(w,-1))-p),Math.abs(_t(p,...Jl(w,0))-p),Math.abs(_t(p,...Jl(w,1))-p)];v=[T.indexOf(Math.min(...T))-1]}}else v=[0];for(const w of v){const T=e.containsTile(g,c,i,w);T&&s.push(T)}}return s}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of i)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(yf(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=We.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){const s=this._tiles[e];s&&s.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(const r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(e,i){const r=new Map,s=Array.isArray(e)?e:[e],c=this.map.painter.terrain,u=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const p of s){const _=p.coveringTiles({tileSize:u,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const g of _)r.set(g.key,g);this.usedForTerrain&&p.updateElevation(!1)}zn(Array.from(r.values()),(p,_)=>{const g=new Uu(p,this._source.tileSize*p.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(g,v=>{"raster-dem"===this._source.type&&g.dem&&this._backfillDEM(g),_(v,g)})},i)}}function gf(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function yf(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Jl(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Fs.maxOverzooming=10,Fs.maxUnderzooming=3;class Dh{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const s=r||e.findDEMTileFor(i);if(!s||!s.dem)return;const c=s.dem,u=s.tileID,p=1<<i.canonical.z-u.canonical.z;return new Dh(s,s.tileSize/lt/p,[(i.canonical.x/p-u.canonical.x)*c.dim,(i.canonical.y/p-u.canonical.y)*c.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(r);return new Be(s,c)}getElevationAt(e,i,r,s){const c=e*this._scale+this._offset[0],u=i*this._scale+this._offset[1],p=Math.floor(c),_=Math.floor(u),g=this._dem;return s=!!s,r?At(At(g.get(p,_,s),g.get(p,_+1,s),u-_),At(g.get(p+1,_,s),g.get(p+1,_+1,s),u-_),c-p):g.get(p,_,s)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Yn(1,e)*this._dem.stride}}class xf{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new qo(lt,16,0),this.featureIndexArray=new sd,this.promoteId=i}insert(e,i,r,s,c,u=0){const p=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,s,c,u);const _=this.grid;for(let g=0;g<i.length;g++){const v=i[g],w=[1/0,1/0,-1/0,-1/0];for(let T=0;T<v.length;T++){const I=v[T];w[0]=Math.min(w[0],I.x),w[1]=Math.min(w[1],I.y),w[2]=Math.max(w[2],I.x),w[3]=Math.max(w[3],I.y)}w[0]<lt&&w[1]<lt&&w[2]>=0&&w[3]>=0&&_.insert(p,w[0],w[1],w[2],w[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new xu(new Ul(this.rawTileData)).layers,this.sourceLayerCoder=new rf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,s){this.loadVTLayers();const c=e.params||{},u=_o(c.filter),p=e.tileResult,_=e.transform,g=p.bufferedTilespaceBounds,v=this.grid.query(g.min.x,g.min.y,g.max.x,g.max.y,(A,k,L,W)=>Ed(p.bufferedTilespaceGeometry,A,k,L,W));v.sort(tg);let w=null;_.elevation&&v.length>0&&(w=Dh.create(_.elevation,this.tileID));const T={};let I;for(let A=0;A<v.length;A++){const k=v[A];if(k===I)continue;I=k;const L=this.featureIndexArray.get(k);let W=null;this.loadMatchingFeature(T,L,u,c.layers,c.availableImages,i,r,s,(J,$,Y,ee=0)=>(W||(W=xo(J,this.tileID.canonical,e.tileTransform)),$.queryIntersectsFeature(p,J,Y,W,this.z,e.transform,e.pixelPosMatrix,w,ee)))}return T}loadMatchingFeature(e,i,r,s,c,u,p,_,g){const{featureIndex:v,bucketIndex:w,sourceLayerIndex:T,layoutVertexArrayOffset:I}=i,A=this.bucketLayerIDs[w];if(s&&!function(J,$){for(let Y=0;Y<J.length;Y++)if($.indexOf(J[Y])>=0)return!0;return!1}(s,A))return;const k=this.sourceLayerCoder.decode(T),L=this.vtLayers[k].feature(v);if(r.needGeometry){const J=zs(L,!0);if(!r.filter(new oe(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!r.filter(new oe(this.tileID.overscaledZ),L))return;const W=this.getId(L,k);for(let J=0;J<A.length;J++){const $=A[J];if(s&&s.indexOf($)<0)continue;const Y=u[$];if(!Y)continue;let ee={};void 0!==W&&_&&(ee=_.getState(Y.sourceLayer||"_geojsonTileLayer",W));const K=ni({},p[$]);K.paint=vf(K.paint,Y.paint,L,ee,c),K.layout=vf(K.layout,Y.layout,L,ee,c);const fe=!g||g(L,Y,ee,I);if(!fe)continue;const pe=new of(L,this.z,this.x,this.y,W);pe.layer=K;let we=e[$];void 0===we&&(we=e[$]=[]),we.push({featureIndex:v,feature:pe,intersectionZ:fe})}}lookupSymbolFeatures(e,i,r,s,c,u,p,_){const g={};this.loadVTLayers();const v=_o(c);for(const w of e)this.loadMatchingFeature(g,{bucketIndex:r,sourceLayerIndex:s,featureIndex:w,layoutVertexArrayOffset:0},v,u,p,_,i);return g}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const s=this.sourceLayerCoder.decode(r),c=this.vtFeatures[s];if(c[i])return c[i];const u=this.vtLayers[s].feature(i);return c[i]=u,u}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const s="string"==typeof this.promoteId?this.promoteId:this.promoteId[i];null!=s&&(r=e.properties[s]),"boolean"==typeof r&&(r=Number(r))}return r}}function vf(t,e,i,r,s){return Dn(t,(c,u)=>{const p=e instanceof Re?e.get(u):null;return p&&p.evaluate?p.evaluate(i,r,s):p})}function tg(t,e){return e-t}$e(xf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class bf{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new bo({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=hn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const s=[];let c=e.length%2==1?-e[e.length-1]*r:0,u=e[0]*r,p=!0;s.push({left:c,right:u,isDash:p,zeroLength:0===e[0]});let _=e[0];for(let g=1;g<e.length;g++){p=!p;const v=e[g];c=_*r,_+=v,u=_*r,s.push({left:c,right:u,isDash:p,zeroLength:0===v})}return s}addRoundDash(e,i,r){const s=i/2;for(let c=-r;c<=r;c++){const u=this.width*(this.nextRow+r+c);let p=0,_=e[p];for(let g=0;g<this.width;g++){g/_.right>1&&(_=e[++p]);const v=Math.abs(g-_.left),w=Math.abs(g-_.right),T=Math.min(v,w);let I;const A=c/r*(s+1);if(_.isDash){const k=s-Math.abs(A);I=Math.sqrt(T*T+k*k)}else I=s-Math.sqrt(T*T+A*A);this.image.data[u+g]=Math.max(0,Math.min(255,I+128))}}}addRegularDash(e,i){for(let _=e.length-1;_>=0;--_){const g=e[_],v=e[_+1];g.zeroLength?e.splice(_,1):v&&v.isDash===g.isDash&&(v.left=g.left,e.splice(_,1))}const r=e[0],s=e[e.length-1];r.isDash===s.isDash&&(r.left=s.left-this.width,s.right=r.right+this.width);const c=this.width*this.nextRow;let u=0,p=e[u];for(let _=0;_<this.width;_++){_/p.right>1&&(p=e[++u]);const g=Math.abs(_-p.left),v=Math.abs(_-p.right),w=Math.min(g,v);this.image.data[c+_]=Math.max(0,Math.min(255,(p.isDash?w:-w)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const s="round"===i,c=s?7:0,u=2*c+1;if(this.nextRow+u>this.height)return ti("LineAtlas out of space"),null;0===e.length&&e.push(1);let p=0;for(let v=0;v<e.length;v++)e[v]<0&&(ti("Negative value is found in line dasharray, replacing values with 0"),e[v]=0),p+=e[v];if(0!==p){const v=this.width/p,w=this.getDashRanges(e,this.width,v);s?this.addRoundDash(w,v,c):this.addRegularDash(w,"square"===i?.5*v:0)}const _=this.nextRow+c;this.nextRow+=u;const g={tl:[_,c],br:[p,0]};return this.positions[r]=g,g}}$e(bf,"LineAtlas");class wf{constructor(e){const i={},r=[];for(const p in e){const _=e[p],g=i[p]={};for(const v in _.glyphs){const w=_.glyphs[+v];if(!w||0===w.bitmap.width||0===w.bitmap.height)continue;const T=w.metrics.localGlyph?2:1,I={x:0,y:0,w:w.bitmap.width+2*T,h:w.bitmap.height+2*T};r.push(I),g[v]=I}}const{w:s,h:c}=wu(r),u=new bo({width:s||1,height:c||1});for(const p in e){const _=e[p];for(const g in _.glyphs){const v=_.glyphs[+g];if(!v||0===v.bitmap.width||0===v.bitmap.height)continue;const w=i[p][g],T=v.metrics.localGlyph?2:1;bo.copy(v.bitmap,u,{x:0,y:0},{x:w.x+T,y:w.y+T},v.bitmap)}}this.image=u,this.positions=i}}$e(wf,"GlyphAtlas");class ig{constructor(e){this.tileID=new Ji(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Bs(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,r,s,c){this.status="parsing",this.data=e,this.collisionBoxArray=new Wh;const u=new rf(Object.keys(e.layers).sort()),p=new xf(this.tileID,this.promoteId);p.bucketLayerIDs=[];const _={},g=new bf(256,256),v={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:g,availableImages:r},w=i.familiesBySource[this.source];for(const ee in w){const K=e.layers[ee];if(!K)continue;let fe=!1,pe=!1;for(const ye of w[ee])"symbol"===ye[0].type?fe=!0:pe=!0;if(!0===this.isSymbolTile&&!fe||!1===this.isSymbolTile&&!pe)continue;1===K.version&&ti(`Vector tile source "${this.source}" layer "${ee}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const we=u.encode(ee),Pe=[];for(let ye=0;ye<K.length;ye++){const Ee=K.feature(ye),Me=p.getId(Ee,ee);Pe.push({feature:Ee,id:Me,index:ye,sourceLayerIndex:we})}for(const ye of w[ee]){const Ee=ye[0];void 0!==this.isSymbolTile&&"symbol"===Ee.type!==this.isSymbolTile||Ee.minzoom&&this.zoom<Math.floor(Ee.minzoom)||Ee.maxzoom&&this.zoom>=Ee.maxzoom||"none"!==Ee.visibility&&(Gu(ye,this.zoom,r),(_[Ee.id]=Ee.createBucket({index:p.bucketLayerIDs.length,layers:ye,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:we,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate(Pe,v,this.tileID.canonical,this.tileTransform),p.bucketLayerIDs.push(ye.map(Me=>Me.id)))}}let T,I,A,k;g.trim();const L={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},W=Dn(v.glyphDependencies,ee=>Object.keys(ee).map(Number));Object.keys(W).length?s.send("getGlyphs",{uid:this.uid,stacks:W},(ee,K)=>{T||(T=ee,I=K,Y.call(this))},void 0,!1,L):I={};const J=Object.keys(v.iconDependencies);J.length?s.send("getImages",{icons:J,source:this.source,tileID:this.tileID,type:"icons"},(ee,K)=>{T||(T=ee,A=K,Y.call(this))},void 0,!1,L):A={};const $=Object.keys(v.patternDependencies);function Y(){if(T)return c(T);if(I&&A&&k){const ee=new wf(I),K=new bp(A,k);for(const fe in _){const pe=_[fe];pe instanceof Qo?(Gu(pe.layers,this.zoom,r),E_(pe,I,ee.positions,A,K.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):pe.hasPattern&&(pe instanceof fh||pe instanceof ch||pe instanceof Ol)&&(Gu(pe.layers,this.zoom,r),pe.addFeatures(v,this.tileID.canonical,K.patternPositions,r,this.tileTransform))}this.status="done",c(null,{buckets:ir(_).filter(fe=>!fe.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ee.image,lineAtlas:g,imageAtlas:K,glyphMap:this.returnDependencies?I:null,iconMap:this.returnDependencies?A:null,glyphPositions:this.returnDependencies?ee.positions:null})}}$.length?s.send("getImages",{icons:$,source:this.source,tileID:this.tileID,type:"patterns"},(ee,K)=>{T||(T=ee,k=K,Y.call(this))},void 0,!1,L):k={},Y.call(this)}}function Gu(t,e,i){const r=new oe(e);for(const s of t)s.recalculate(r,i)}class Tf{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,s){const c=this.entries[e]=this.entries[e]||{callbacks:[]};if(c.result){const[u,p]=c.result;return this.scheduler?this.scheduler.add(()=>{s(u,p)},i):s(u,p),()=>{}}return c.callbacks.push(s),c.cancel||(c.cancel=r((u,p)=>{c.result=[u,p];for(const _ of c.callbacks)this.scheduler?this.scheduler.add(()=>{_(u,p)},i):_(u,p);setTimeout(()=>delete this.entries[e],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(u=>u!==s),c.callbacks.length||(c.cancel(),delete this.entries[e]))}}}function Ef(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},s=>{const c=Fn(t.request,(u,p,_,g)=>{u?s(u):p&&s(null,{vectorTile:i?void 0:new xu(new Ul(p)),rawData:p,cacheControl:_,expires:g})});return()=>{c.cancel(),s()}},e)}a.ARRAY_TYPE=_n,a.AUTH_ERR_MSG=Ir,a.Aabb=Yi,a.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},kn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=en()?t:Se,this.scheduler=new J_}send(t,e,i,r,s=!1,c){const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=c,this.callbacks[u]=i);const p=vr(this.globalScope)?void 0:[];return this.target.postMessage({id:u,type:t,hasCallback:!!i,targetMapId:r,mustQueue:s,sourceMapId:this.mapId,data:Lr(e,p)},p),{cancel:()=>{i&&delete this.callbacks[u],this.target.postMessage({id:u,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r.cancel()}else if(e.mustQueue||en()){const r=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),r&&r.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Es(e.error)):i(null,Es(e.data)))}else{const i=vr(this.globalScope)?void 0:[],r=e.hasCallback?(c,u)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:c?Lr(c):null,data:Lr(u,i)},i)}:c=>{},s=Es(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,s,r);else if(this.parent.getWorkerSource){const c=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,c[0],s.source)[c[1]](s,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=ph,a.Color=ri,a.ColorMode=Vr,a.CullFaceMode=_r,a.DEMData=kh,a.DataConstantProperty=se,a.DedupedRequest=Tf,a.DepthMode=Fa,a.EXTENT=lt,a.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,s=Math.floor(t.x),c=Math.floor((t.x-s)*r),u=Math.floor(t.y*r),p=this.findDEMTileFor(new Ji(i,s,i,c,u));return!(!p||!p.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const r=this._source();if(!r||t.y<0||t.y>1)return e;const s=r.getSource().maxzoom,c=1<<s,u=Math.floor(t.x),p=t.x-u,_=new Ji(s,u,s,Math.floor(p*c),Math.floor(t.y*c)),g=this.findDEMTileFor(_);if(!g||!g.dem)return e;const v=g.dem,w=1<<g.tileID.canonical.z,T=(p*w-g.tileID.canonical.x)*v.dim,I=(t.y*w-g.tileID.canonical.y)*v.dim,A=Math.floor(T),k=Math.floor(I);return(i?this.exaggeration():1)*At(At(v.get(A,k),v.get(A,k+1),I-k),At(v.get(A+1,k),v.get(A+1,k+1),I-k),T-A)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new ba(t.wrap+(t.canonical.x+e/lt)/r,(t.canonical.y+i/lt)/r))}getAtTileOffsetFunc(t,e,i,r){return s=>{const c=this.getAtTileOffset(t,s.x,s.y),u=r.upVector(t.canonical,s.x,s.y);return An(u,u,c*r.upVectorScale(t.canonical,e,i).metersToTile),u}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const s=Dh.create(this,t,r);return!!s&&(e.forEach(c=>{c[2]=this.exaggeration()*s.getElevationAt(c[0],c[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,s=1<<t.canonical.z-r.canonical.z;let c=t.canonical.x/s-r.canonical.x,u=t.canonical.y/s-r.canonical.y,p=0;for(let _=0;_<t.canonical.z-r.canonical.z&&!i.leaves[p];_++){c*=2,u*=2;const g=2*Math.floor(u)+Math.floor(c);p=i.childOffsets[p]+g,c%=1,u%=1}return{min:this.exaggeration()*i.minimums[p],max:this.exaggeration()*i.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=ki,a.EvaluationParameters=oe,a.Event=Ei,a.Evented=Ut,a.FillExtrusionBucket=Ol,a.Frustum=hu,a.FrustumCorners=cu,a.GLOBE_METERS_TO_ECEF=zu,a.GLOBE_RADIUS=Eo,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=6,a.GLOBE_ZOOM_THRESHOLD_MIN=5,a.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new kt,i=new Oi,r=65;for(let s=0;s<r;s++)for(let c=0;c<r;c++)e.emplaceBack(c,s);this._gridSegments=[];for(let s=0,c=0;s<La.length;s++){const u=La[s];for(let _=0;_<u;_++)for(let g=0;g<64;g++){const v=_*r+g;i.emplaceBack(v+1,v,v+r),i.emplaceBack(v+r,v+r+1,v+1)}const p=64*u*2;this._gridSegments.push(gi.simpleSegment(0,c,(u+1)*r,p)),c+=p}this._gridBuffer=t.createVertexBuffer(e,Vl.members),this._gridIndexBuffer=t.createIndexBuffer(i,!0)}_createPoles(t){const e=new Oi;for(let s=0;s<=64;s++)e.emplaceBack(0,s+1,s+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new As,r=new As;this._poleSegments=[];for(let s=0,c=0;s<5;s++){const u=360/(1<<s);i.emplaceBack(0,-Eo,0,.5,0),r.emplaceBack(0,-Eo,0,.5,1);for(let p=0;p<=64;p++){const _=p/64,g=At(0,u,_),[v,w,T]=Oa(k_,D_,g,Eo);i.emplaceBack(v,w,T,_,0),r.emplaceBack(v,w,T,_,1)}this._poleSegments.push(gi.simpleSegment(c,0,66,64)),c+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Np,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,Np,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new Hn,r=64,s=r+1;this._wireframeSegments=[];for(let c=0,u=0;c<La.length;c++){const p=La[c];for(let g=0;g<p;g++)for(let v=0;v<r;v++){const w=g*s+v;i.emplaceBack(w,w+1),i.emplaceBack(w,w+s),i.emplaceBack(w,w+s+1)}const _=p*r*3;this._wireframeSegments.push(gi.simpleSegment(0,u,(p+1)*s,_)),u+=_}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},a.GlyphManager=ka,a.ImagePosition=Tu,a.LivePerformanceUtils=Ze,a.LngLat=It,a.LngLatBounds=Yo,a.LocalGlyphMode=Cu,a.MAX_MERCATOR_LATITUDE=Br,a.MercatorCoordinate=ba,a.ONE_EM=Bi,a.OverscaledTileID=Ji,a.PerformanceMarkers=Ce,a.Properties=Qe,a.RGBAImage=gn,a.Ray=lu,a.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",cn,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!$i(t))return t;const i=nn(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!$i(t))return t;const i=nn(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!$i(t))return t;const s=nn(t);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),i&&s.params.push(`language=${i}`),r&&s.params.push(`worldview=${r}`),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const s=nn(t);return $i(t)?(s.path=`/styles/v1${s.path}/sprite${e}${i}`,this._makeAPIURL(s,this._customAccessToken||r)):(s.path+=`${e}${i}`,Zn(s))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!$i(t))return t;const r=nn(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==r.authority&&512===i?"@2x":""}${ut.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${pt.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${pt.TILE_URL_VERSION}${r.path}`);const s=this._customAccessToken||function(c){for(const u of c){const p=u.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(r.params)||pt.ACCESS_TOKEN;return pt.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,s)}canonicalizeTileURL(t,e){const i=nn(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${pt.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${pt.TILE_URL_VERSION}/`,"")}`;let s=i.params;return e&&(s=s.filter(c=>!c.match(/^access_token=/))),s.length&&(r+=`?${s.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&$i(e),r=[];for(const s of t.tiles||[])Un(s)?r.push(this.canonicalizeTileURL(s,i)):r.push(s);return r}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=nn(pt.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const s=t.params.indexOf("secure");s>=0&&t.params.splice(s,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!pt.REQUIRE_ACCESS_TOKEN)return Zn(t);if(e=e||pt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(s=>-1===s.indexOf("access_token")),t.params.push(`access_token=${e||""}`),Zn(t)}},a.ResourceType=Ni,a.SegmentVector=gi,a.SourceCache=Fs,a.StencilMode=Nu,a.StructArrayLayout1ui2=vl,a.StructArrayLayout2f1f2i16=ji,a.StructArrayLayout2i4=kt,a.StructArrayLayout2ui4=Hn,a.StructArrayLayout3f12=ur,a.StructArrayLayout3ui6=Oi,a.StructArrayLayout4i8=Zt,a.StructArrayLayout5f20=As,a.Texture=Yl,a.Tile=Uu,a.Transitionable=Te,a.Uniform1f=Jc,a.Uniform1i=class extends go{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends go{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},a.Uniform3f=class extends go{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},a.Uniform4f=dd,a.UniformColor=pd,a.UniformMatrix2f=class extends go{constructor(t){super(t),this.current=Rf}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},a.UniformMatrix3f=class extends go{constructor(t){super(t),this.current=Of}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},a.UniformMatrix4f=class extends go{constructor(t){super(t),this.current=Lf}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},a.UnwrappedTileID=lp,a.ValidationError=Ge,a.VectorTileFeature=uh,a.VectorTileWorkerSource=class extends Ut{constructor(t,e,i,r,s){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=s||Ef,this.loading={},this.loaded={},this.deduped=new Tf(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,r=t&&t.request,s=r&&r.collectResourceTiming,c=this.loading[i]=new ig(t);c.abort=this.loadVectorData(t,(u,p)=>{const _=!this.loading[i];if(delete this.loading[i],_||u||!p)return c.status="done",_||(this.loaded[i]=c),e(u);const g=p.rawData,v={};p.expires&&(v.expires=p.expires),p.cacheControl&&(v.cacheControl=p.cacheControl),c.vectorTile=p.vectorTile||new xu(new Ul(g));const w=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(T,I)=>{if(T||!I)return e(T);const A={};if(s){const k=Ke(r);k.length>0&&(A.resourceTiming=JSON.parse(JSON.stringify(k)))}e(null,ni({rawTileData:g.slice(0)},I,v,A))})};this.isSpriteLoaded?w():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(w,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):w()}),this.loaded=this.loaded||{},this.loaded[i]=c})}reloadTile(t,e){const i=this.loaded,r=t.uid,s=this;if(i&&i[r]){const c=i[r];c.showCollisionBoxes=t.showCollisionBoxes,c.enableTerrain=!!t.enableTerrain,c.projection=t.projection,c.tileTransform=Bs(t.tileID.canonical,t.projection);const u=(p,_)=>{const g=c.reloadCallback;g&&(delete c.reloadCallback,c.parse(c.vectorTile,s.layerIndex,this.availableImages,s.actor,g)),e(p,_)};"parsing"===c.status?c.reloadCallback=u:"done"===c.status&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,u):u())}}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},a.WritingMode=Sn,a.add=vo,a.addDynamicAttributes=Ah,a.adjoint=function(t,e){var i=e[0],r=e[1],s=e[2],c=e[3],u=e[4],p=e[5],_=e[6],g=e[7],v=e[8];return t[0]=u*v-p*g,t[1]=s*g-r*v,t[2]=r*p-s*u,t[3]=p*_-c*v,t[4]=i*v-s*_,t[5]=s*c-i*p,t[6]=c*g-u*_,t[7]=r*_-i*g,t[8]=i*u-r*c,t},a.asyncAll=zn,a.bezier=$r,a.bindAll=kn,a.boundsAttributes=af,a.bufferConvexPolygon=function(t,e){const i=[];for(let r=0;r<t.length;r++){const s=tr(r-1,-1,t.length-1),c=tr(r+1,-1,t.length-1),u=t[r],p=t[c],_=t[s].sub(u).unit(),g=p.sub(u).unit(),v=g.angleWithSep(_.x,_.y),w=_.add(g).unit().mult(-1*e/Math.sin(v/2));i.push(u.add(w))}return i},a.cacheEntryPossiblyAdded=function(t){Er++,Er>Kr&&(t.getActor().send("enforceCacheSizeLimit",wr),Er=0)},a.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:r}=t.point,s=Wp(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Ds(s,s,Pu(Ur(e)))},a.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:r,lat:s}=t._center;return Wp(e,i,t.worldSize,r,s)},a.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/Yn(1,t.center.lat),r=fr(new Float64Array(16));return wl(r,r,[t.point.x,t.point.y,0]),Ps(r,r,[i,i,e]),Float32Array.from(r)},a.circumferenceAtLatitude=Yh,a.clamp=_t,a.clearTileCache=function(t){if(!Tr())return;const e=Se.caches.delete(br);t&&e.catch(t).then(()=>t())},a.clipLine=Pp,a.clone=function(t){var e=new _n(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.clone$1=Zi,a.collisionCircleLayout=Ym,a.config=pt,a.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},a.create=function(){var t=new _n(16);return _n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},a.create$1=Id,a.createExpression=Dr,a.createLayout=qe,a.createStyleLayer=function(t){return"custom"===t.type?new W_(t):new H_[t.type](t)},a.cross=au,a.degToRad=vt,a.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},a.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},a.dot=Jn,a.earthRadius=Qc,a.ease=Wr,a.easeCubicInOut=Ao,a.ecefToLatLng=function([t,e,i]){const r=Math.hypot(t,e,i),s=Math.atan2(t,i),c=.5*Math.PI-Math.acos(-e/r);return new It(di(s),di(c))},a.emitValidationErrors=Rc,a.endsWith=Ui,a.enforceCacheSizeLimit=function(t){On(),Ti&&Ti.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},a.evaluateSizeForFeature=mh,a.evaluateSizeForZoom=Ia,a.evaluateVariableOffset=Fp,a.evented=Q,a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},a.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},a.exported=We,a.exported$1=ut,a.extend=ni,a.extend$1=pi,a.fillExtrusionHeightLift=op,a.filterObject=Yr,a.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},a.fromQuat=function(t,e){var i=e[0],r=e[1],s=e[2],c=e[3],u=i+i,p=r+r,_=s+s,g=i*u,v=r*u,w=r*p,T=s*u,I=s*p,A=s*_,k=c*u,L=c*p,W=c*_;return t[0]=1-w-A,t[1]=v+W,t[2]=T-L,t[3]=0,t[4]=v-W,t[5]=1-g-A,t[6]=I+k,t[7]=0,t[8]=T+L,t[9]=I-k,t[10]=1-g-w,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromScaling=Sd,a.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return rs[e]},a.getAABBPointSquareDist=function(t,e,i){let r=0;for(let s=0;s<2;++s){const c=i?i[s]:0;t[s]>c&&(r+=(t[s]-c)*(t[s]-c)),e[s]<c&&(r+=(c-e[s])*(c-e[s]))}return r},a.getAnchorAlignment=Mu,a.getAnchorJustification=Au,a.getBounds=function(t){let e=1/0,i=1/0,r=-1/0,s=-1/0;for(const c of t)e=Math.min(e,c.x),i=Math.min(i,c.y),r=Math.max(r,c.x),s=Math.max(s,c.y);return{min:new Be(e,i),max:new Be(r,s)}},a.getColumn=Pn,a.getGridMatrix=function(t,e,i,r){const s=e.getNorth(),c=e.getSouth(),u=e.getWest(),p=e.getEast(),_=1<<t.z,g=p-u,v=s-c,w=g/64,T=-v/La[i],I=[0,w,0,T,0,0,s,u,0];if(t.z>0){const A=180/r;Ad(I,I,[A/g+1,0,0,0,A/v+1,0,-.5*A/w,.5*A/T,1])}return I[2]=_,I[5]=t.x,I[8]=t.y,I},a.getImage=Cr,a.getJSON=function(t,e){return Bn(ni(t,{type:"json"}),e)},a.getLatitudinalLod=function(t){const e=80.051129;t=_t(t,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(vt(t))),3);return Math.round(i*(La.length-1))},a.getMapSessionAPI=ne,a.getPerformanceMeasurement=Ke,a.getProjection=tf,a.getRTLTextPluginStatus=re,a.getReferrer=Rn,a.getTilePoint=function(t,{x:e,y:i},r=0){return new Be(((e-r)*t.scale-t.x)*lt,(i*t.scale-t.y)*lt)},a.getTileVec3=function(t,e,i=0){return Ta(((e.x-i)*t.scale-t.x)*lt,(e.y*t.scale-t.y)*lt,_d(e.z,e.y))},a.getVideo=function(t,e){const i=Se.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let r=0;r<t.length;r++){const s=Se.document.createElement("source");li(t[r])||(i.crossOrigin="Anonymous"),s.src=t[r],i.appendChild(s)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=fr(new Float64Array(16));return Ds(i,t.pixelMatrix,t.globeMatrix),hi(e,e,i),new Be(e[0],e[1])},a.globeDenormalizeECEF=Pu,a.globeECEFOrigin=function(t,e){const i=[0,0,0];return hi(i,i,ql(Ur(e.canonical))),hi(i,i,t),i},a.globeNormalizeECEF=ql,a.globePixelsToTileUnits=function(t,e){return lt/(512*Math.pow(2,t))*Th(Ur(e))},a.globePoleMatrixForTile=function(t,e,i){const r=fr(new Float64Array(16)),s=(e/(1<<t)-.5)*Math.PI*2;return rh(r,i.globeMatrix,s),Float32Array.from(r)},a.globeTileBounds=Ur,a.globeTiltAtLngLat=Xp,a.globeToMercatorTransition=Ra,a.globeUseCustomAntiAliasing=function(t,e,i){const r=Ra(i.zoom),s=t.style.map._antialias,c=!!e.extStandardDerivatives,u=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===r&&!s&&!u&&c},a.identity=fr,a.identity$1=Bd,a.invert=nu,a.isFullscreen=function(){return!!Se.document.fullscreenElement||!!Se.document.webkitFullscreenElement},a.isLngLatBehindGlobe=Lu,a.isMapAuthenticated=function(t){return ue.has(t)},a.isMapboxURL=$i,a.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!vr(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Ri,a.latLngToECEF=jl,a.len=Qf,a.length=Tl,a.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},a.lngFromMercatorX=In,a.loadVectorTile=Ef,a.makeRequest=Bn,a.mapValue=function(t,e,i,r,s){return _t((t-e)/(i-e)*(s-r)+r,r,s)},a.mercatorScale=gd,a.mercatorXfromLng=Or,a.mercatorYfromLat=Rr,a.mercatorZfromAltitude=Yn,a.mul=Jf,a.mul$1=Kf,a.multiply=Ds,a.multiply$1=Ad,a.multiply$2=Dd,a.nextPowerOfTwo=hn,a.normalize=Hi,a.normalize$1=em,a.normalize$2=Od,a.number=At,a.ortho=function(t,e,i,r,s,c,u){var p=1/(e-i),_=1/(r-s),g=1/(c-u);return t[0]=-2*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*g,t[11]=0,t[12]=(e+i)*p,t[13]=(s+r)*_,t[14]=(u+c)*g,t[15]=1,t},a.pbf=Ul,a.perspective=function(t,e,i,r,s){var c,u=1/Math.tan(e/2);return t[0]=u/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(t[10]=(s+r)*(c=1/(r-s)),t[14]=2*s*r*c):(t[10]=-1,t[14]=-2*r),t},a.pick=function(t,e){const i={};for(let r=0;r<e.length;r++){const s=e[r];s in t&&(i[s]=t[s])}return i},a.plugin=de,a.pointGeometry=Be,a.polesInViewport=function(t){const e=fr(new Float64Array(16));Ds(e,t.pixelMatrix,t.globeMatrix);const i=[0,Kn,0],r=[0,Qn,0];return hi(i,i,e),hi(r,r,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Lu(t,new It(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Lu(t,new It(t.center.lat,-90))]},a.polygonContainsPoint=ks,a.polygonIntersectsBox=Ed,a.polygonIntersectsPolygon=vd,a.polygonizeBounds=function(t,e,i=0,r=!0){const s=new Be(i,i),c=t.sub(s),u=e.add(s),p=[c,new Be(u.x,c.y),u,new Be(c.x,u.y)];return r&&p.push(c.clone()),p},a.posAttributes=Vl,a.postMapLoadEvent=X,a.postPerformanceEvent=le,a.postTurnstileEvent=D,a.potpack=wu,a.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},a.radToDeg=di,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(t){return t({pluginStatus:q,pluginURL:N}),Q.on("pluginStateChange",t),t},a.removeAuthState=function(t){ue.delete(t)},a.renderColorRamp=du,a.resample=yd,a.rotateX=ru,a.rotateX$1=Fd,a.rotateY=rh,a.rotateY$1=Ud,a.rotateZ=function(t,e,i){var r=Math.sin(i),s=Math.cos(i),c=e[0],u=e[1],p=e[2],_=e[3],g=e[4],v=e[5],w=e[6],T=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s+g*r,t[1]=u*s+v*r,t[2]=p*s+w*r,t[3]=_*s+T*r,t[4]=g*s-c*r,t[5]=v*s-u*r,t[6]=w*s-p*r,t[7]=T*s-_*r,t},a.rotateZ$1=function(t,e,i){i*=.5;var r=e[0],s=e[1],c=e[2],u=e[3],p=Math.sin(i),_=Math.cos(i);return t[0]=r*_+s*p,t[1]=s*_-r*p,t[2]=c*_+u*p,t[3]=u*_-c*p,t},a.scale=Ps,a.scale$1=Ld,a.scale$2=An,a.scaleAndAdd=Cl,a.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},a.setCacheLimits=function(t,e){wr=t,Kr=e},a.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},a.setRTLTextPlugin=function(t,e,i=!1){if(q===F||q===Z||q===O)throw new Error("setRTLTextPlugin cannot be called multiple times.");N=We.resolveURL(t),q=F,R=e,te(),i||me()},a.smoothstep=Xr,a.spec=be,a.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},a.storeAuthState=function(t,e){e?ue.add(t):ue.delete(t)},a.sub=mr,a.subtract=su,a.symbolSize=Jm,a.tileAABB=function(t,e,i,r,s,c,u,p,_){if("globe"===_.name)return function z_(t,e,i){const r=e/t.worldSize,s=t.globeMatrix;if(i.z<=1){const pe=Ur(i).getCorners();return qp(pe,s,r),Yi.fromPoints(pe)}const c=wh(i),u=Du(c);qp(u,s,r);const p=Number.MAX_VALUE,_=[-p,-p,-p],g=[p,p,p];if(c.contains(t.center)){for(const Pe of u)El(g,g,Pe),Ml(_,_,Pe);_[2]=0;const pe=t.point,we=[pe.x*r,pe.y*r,0];return El(g,g,we),Ml(_,_,we),new Yi(g,_)}const v=[s[12]*r,s[13]*r,s[14]*r],w=c.getCenter(),T=_t(t.center.lat,-85.051129,Br),I=_t(w.lat,-85.051129,Br),A=Or(t.center.lng),k=Rr(T);let L=A-Or(w.lng);const W=k-Rr(I);L>.5?L-=1:L<-.5&&(L+=1);let J=0;Math.abs(L)>Math.abs(W)?J=L>=0?1:3:(J=W>=0?0:2,Cl(v,v,[s[4]*r,s[5]*r,s[6]*r],-Math.sin(vt(W>=0?c.getSouth():c.getNorth()))*Eo));const $=u[J],Y=u[(J+1)%4],ee=new S_($,Y,v),K=[ku(ee,0)||$[0],ku(ee,1)||$[1],ku(ee,2)||$[2]],fe=Ra(t.zoom);if(fe>0){const pe=function({x:Pe,y:ye,z:Ee},Me,ze,Le,xe){const Fe=1/(1<<Ee);let it=Pe*Fe,Ve=it+Fe,Ye=ye*Fe,Ue=Ye+Fe,rt=0;const wt=(it+Ve)/2-Le;return wt>.5?rt=-1:wt<-.5&&(rt=1),it=((it+rt)*Me-(Le*=Me))*ze+Le,Ve=((Ve+rt)*Me-Le)*ze+Le,Ye=(Ye*Me-(xe*=Me))*ze+xe,Ue=(Ue*Me-xe)*ze+xe,[[it,Ue,0],[Ve,Ue,0],[Ve,Ye,0],[it,Ye,0]]}(i,e,t._pixelsPerMercatorPixel,A,k);for(let Pe=0;Pe<u.length;Pe++)Rs(u[Pe],pe[Pe],fe);const we=vo([],pe[J],pe[(J+1)%4]);An(we,we,.5),Rs(K,we,fe)}for(const pe of u)El(g,g,pe),Ml(_,_,pe);return g[2]=Math.min($[2],Y[2]),El(g,g,K),Ml(_,_,K),new Yi(g,_)}(t,e,new ph(i,r,s));const g=Bs({z:i,x:r,y:s},_);return new Yi([(c+g.x/g.scale)*e,e*(g.y/g.scale),u],[(c+g.x2/g.scale)*e,e*(g.y2/g.scale),p])},a.tileCornersToBounds=wh,a.tileTransform=Bs,a.transformMat3=function(t,e,i){var r=e[0],s=e[1],c=e[2];return t[0]=r*i[0]+s*i[3]+c*i[6],t[1]=r*i[1]+s*i[4]+c*i[7],t[2]=r*i[2]+s*i[5]+c*i[8],t},a.transformMat4=hi,a.transformMat4$1=Ls,a.transformQuat=Pd,a.transitionTileAABBinECEF=Gp,a.translate=wl,a.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},a.triggerPluginCompletionEvent=H,a.uniqueId=Hr,a.updateGlobeVertexNormal=function(t,e,i,r,s){const c=5*e+2;t.float32[c+0]=i,t.float32[c+1]=r,t.float32[c+2]=s},a.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFilter=t=>hr(Ts(t)),a.validateFog=t=>hr(Lc(t)),a.validateLayer=t=>hr(ma(t)),a.validateLight=t=>hr(Pc(t)),a.validateSource=t=>hr(kc(t)),a.validateStyle=ul,a.validateTerrain=t=>hr(_a(t)),a.values=ir,a.vectorTile=hh,a.version=vn,a.warnOnce=ti,a.window=Se,a.wrap=tr}),ln(0,function(a){function Se(G){if("number"==typeof G||"boolean"==typeof G||"string"==typeof G||null==G)return JSON.stringify(G);if(Array.isArray(G)){let D="[";for(const V of G)D+=`${Se(V)},`;return`${D}]`}let S="{";for(const D of Object.keys(G).sort())S+=`${D}:${Se(G[D])},`;return`${S}}`}function vn(G){let S="";for(const D of a.refProperties)S+=`/${Se(G[D])}`;return S}class Qi{constructor(S){this.keyCache={},S&&this.replace(S)}replace(S){this._layerConfigs={},this._layers={},this.update(S,[])}update(S,D){for(const X of S)this._layerConfigs[X.id]=X,(this._layers[X.id]=a.createStyleLayer(X)).compileFilter(),this.keyCache[X.id]&&delete this.keyCache[X.id];for(const X of D)delete this.keyCache[X],delete this._layerConfigs[X],delete this._layers[X];this.familiesBySource={};const V=function(X,ie){const le={};for(let ne=0;ne<X.length;ne++){const ue=ie&&ie[X[ne].id]||vn(X[ne]);ie&&(ie[X[ne].id]=ue);let Ce=le[ue];Ce||(Ce=le[ue]=[]),Ce.push(X[ne])}const ae=[];for(const ne in le)ae.push(le[ne]);return ae}(a.values(this._layerConfigs),this.keyCache);for(const X of V){const ie=X.map(Ze=>this._layers[Ze.id]),le=ie[0];if("none"===le.visibility)continue;const ae=le.source||"";let ne=this.familiesBySource[ae];ne||(ne=this.familiesBySource[ae]={});const ue=le.sourceLayer||"_geojsonTileLayer";let Ce=ne[ue];Ce||(Ce=ne[ue]=[]),Ce.push(ie)}}}class pt{loadTile(S,D){const{uid:V,encoding:X,rawImageData:ie,padding:le,buildQuadTree:ae}=S,ne=a.window.ImageBitmap&&ie instanceof a.window.ImageBitmap?this.getImageData(ie,le):ie;D(null,new a.DEMData(V,ne,X,le<1,ae))}getImageData(S,D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(S.width,S.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=S.width,this.offscreenCanvas.height=S.height,this.offscreenCanvasContext.drawImage(S,0,0,S.width,S.height);const V=this.offscreenCanvasContext.getImageData(-D,-D,S.width+2*D,S.height+2*D);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),V}}var ut=function G(S,D){var V,X=S&&S.type;if("FeatureCollection"===X)for(V=0;V<S.features.length;V++)G(S.features[V],D);else if("GeometryCollection"===X)for(V=0;V<S.geometries.length;V++)G(S.geometries[V],D);else if("Feature"===X)G(S.geometry,D);else if("Polygon"===X)xi(S.coordinates,D);else if("MultiPolygon"===X)for(V=0;V<S.coordinates.length;V++)xi(S.coordinates[V],D);return S};function xi(G,S){if(0!==G.length){Mi(G[0],S);for(var D=1;D<G.length;D++)Mi(G[D],!S)}}function Mi(G,S){for(var D=0,V=0,X=0,ie=G.length,le=ie-1;X<ie;le=X++){var ae=(G[X][0]-G[le][0])*(G[le][1]+G[X][1]),ne=D+ae;V+=Math.abs(D)>=Math.abs(ae)?D-ne+ae:ae-ne+D,D=ne}D+V>=0!=!!S&&G.reverse()}const bn=a.VectorTileFeature.prototype.toGeoJSON;class Gr{constructor(S){this._feature=S,this.extent=a.EXTENT,this.type=S.type,this.properties=S.tags,"id"in S&&!isNaN(S.id)&&(this.id=parseInt(S.id,10))}loadGeometry(){if(1===this._feature.type){const S=[];for(const D of this._feature.geometry)S.push([new a.pointGeometry(D[0],D[1])]);return S}{const S=[];for(const D of this._feature.geometry){const V=[];for(const X of D)V.push(new a.pointGeometry(X[0],X[1]));S.push(V)}return S}}toGeoJSON(S,D,V){return bn.call(this,S,D,V)}}class qr{constructor(S){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=S.length,this._features=S}feature(S){return new Gr(this._features[S])}}var cn={exports:{}},gr=a.pointGeometry,yr=a.vectorTile.VectorTileFeature,Be=Fi;function Fi(G,S){this.options=S||{},this.features=G,this.length=G.length}function wn(G,S){this.id="number"==typeof G.id?G.id:void 0,this.type=G.type,this.rawGeometry=1===G.type?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=S||4096}Fi.prototype.feature=function(G){return new wn(this.features[G],this.options.extent)},wn.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var S=0;S<G.length;S++){for(var D=G[S],V=[],X=0;X<D.length;X++)V.push(new gr(D[X][0],D[X][1]));this.geometry.push(V)}return this.geometry},wn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,S=1/0,D=-1/0,V=1/0,X=-1/0,ie=0;ie<G.length;ie++)for(var le=G[ie],ae=0;ae<le.length;ae++){var ne=le[ae];S=Math.min(S,ne.x),D=Math.max(D,ne.x),V=Math.min(V,ne.y),X=Math.max(X,ne.y)}return[S,V,D,X]},wn.prototype.toGeoJSON=yr.prototype.toGeoJSON;var Io=a.pbf,vt=Be;function di(G){var S=new Io;return function(D,V){for(var X in D.layers)V.writeMessage(3,rs,D.layers[X])}(G,S),S.finish()}function rs(G,S){var D;S.writeVarintField(15,G.version||1),S.writeStringField(1,G.name||""),S.writeVarintField(5,G.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<G.length;D++)V.feature=G.feature(D),S.writeMessage(2,Ao,V);var X=V.keys;for(D=0;D<X.length;D++)S.writeStringField(3,X[D]);var ie=V.values;for(D=0;D<ie.length;D++)S.writeMessage(4,tr,ie[D])}function Ao(G,S){var D=G.feature;void 0!==D.id&&S.writeVarintField(1,D.id),S.writeMessage(2,$r,G),S.writeVarintField(3,D.type),S.writeMessage(4,Xr,D)}function $r(G,S){var D=G.feature,V=G.keys,X=G.values,ie=G.keycache,le=G.valuecache;for(var ae in D.properties){var ne=D.properties[ae],ue=ie[ae];if(null!==ne){void 0===ue&&(V.push(ae),ie[ae]=ue=V.length-1),S.writeVarint(ue);var Ce=typeof ne;"string"!==Ce&&"boolean"!==Ce&&"number"!==Ce&&(ne=JSON.stringify(ne));var Ze=Ce+":"+ne,ke=le[Ze];void 0===ke&&(X.push(ne),le[Ze]=ke=X.length-1),S.writeVarint(ke)}}}function Wr(G,S){return(S<<3)+(7&G)}function _t(G){return G<<1^G>>31}function Xr(G,S){for(var D=G.loadGeometry(),V=G.type,X=0,ie=0,le=D.length,ae=0;ae<le;ae++){var ne=D[ae],ue=1;1===V&&(ue=ne.length),S.writeVarint(Wr(1,ue));for(var Ce=3===V?ne.length-1:ne.length,Ze=0;Ze<Ce;Ze++){1===Ze&&1!==V&&S.writeVarint(Wr(2,Ce-1));var ke=ne[Ze].x-X,tt=ne[Ze].y-ie;S.writeVarint(_t(ke)),S.writeVarint(_t(tt)),X+=ke,ie+=tt}3===V&&S.writeVarint(Wr(7,1))}}function tr(G,S){var D=typeof G;"string"===D?S.writeStringField(1,G):"boolean"===D?S.writeBooleanField(7,G):"number"===D&&(G%1!=0?S.writeDoubleField(3,G):G<0?S.writeSVarintField(6,G):S.writeVarintField(5,G))}function zn(G,S,D,V,X,ie){if(X-V<=D)return;const le=V+X>>1;ir(G,S,le,V,X,ie%2),zn(G,S,D,V,le-1,ie+1),zn(G,S,D,le+1,X,ie+1)}function ir(G,S,D,V,X,ie){for(;X>V;){if(X-V>600){const ue=X-V+1,Ce=D-V+1,Ze=Math.log(ue),ke=.5*Math.exp(2*Ze/3),tt=.5*Math.sqrt(Ze*ke*(ue-ke)/ue)*(Ce-ue/2<0?-1:1);ir(G,S,D,Math.max(V,Math.floor(D-Ce*ke/ue+tt)),Math.min(X,Math.floor(D+(ue-Ce)*ke/ue+tt)),ie)}const le=S[2*D+ie];let ae=V,ne=X;for(ni(G,S,V,D),S[2*X+ie]>le&&ni(G,S,V,X);ae<ne;){for(ni(G,S,ae,ne),ae++,ne--;S[2*ae+ie]<le;)ae++;for(;S[2*ne+ie]>le;)ne--}S[2*V+ie]===le?ni(G,S,V,ne):(ne++,ni(G,S,ne,X)),ne<=D&&(V=ne+1),D<=ne&&(X=ne-1)}}function ni(G,S,D,V){xr(G,D,V),xr(S,2*D,2*V),xr(S,2*D+1,2*V+1)}function xr(G,S,D){const V=G[S];G[S]=G[D],G[D]=V}function Hr(G,S,D,V){const X=G-D,ie=S-V;return X*X+ie*ie}cn.exports=di,cn.exports.fromVectorTileJs=di,cn.exports.fromGeojsonVt=function(G,S){S=S||{};var D={};for(var V in G)D[V]=new vt(G[V].features,S),D[V].name=V,D[V].version=S.version,D[V].extent=S.extent;return di({layers:D})},cn.exports.GeoJSONWrapper=vt;const Tn=G=>G[0],hn=G=>G[1];class nr{constructor(S,D=Tn,V=hn,X=64,ie=Float64Array){this.nodeSize=X,this.points=S;const le=S.length<65536?Uint16Array:Uint32Array,ae=this.ids=new le(S.length),ne=this.coords=new ie(2*S.length);for(let ue=0;ue<S.length;ue++)ae[ue]=ue,ne[2*ue]=D(S[ue]),ne[2*ue+1]=V(S[ue]);zn(ae,ne,X,0,ae.length-1,0)}range(S,D,V,X){return function(ie,le,ae,ne,ue,Ce,Ze){const ke=[0,ie.length-1,0],tt=[];let Ke,Je;for(;ke.length;){const ot=ke.pop(),ft=ke.pop(),ct=ke.pop();if(ft-ct<=Ze){for(let jt=ct;jt<=ft;jt++)Ke=le[2*jt],Je=le[2*jt+1],Ke>=ae&&Ke<=ue&&Je>=ne&&Je<=Ce&&tt.push(ie[jt]);continue}const We=Math.floor((ct+ft)/2);Ke=le[2*We],Je=le[2*We+1],Ke>=ae&&Ke<=ue&&Je>=ne&&Je<=Ce&&tt.push(ie[We]);const Ct=(ot+1)%2;(0===ot?ae<=Ke:ne<=Je)&&(ke.push(ct),ke.push(We-1),ke.push(Ct)),(0===ot?ue>=Ke:Ce>=Je)&&(ke.push(We+1),ke.push(ft),ke.push(Ct))}return tt}(this.ids,this.coords,S,D,V,X,this.nodeSize)}within(S,D,V){return function(X,ie,le,ae,ne,ue){const Ce=[0,X.length-1,0],Ze=[],ke=ne*ne;for(;Ce.length;){const tt=Ce.pop(),Ke=Ce.pop(),Je=Ce.pop();if(Ke-Je<=ue){for(let Ct=Je;Ct<=Ke;Ct++)Hr(ie[2*Ct],ie[2*Ct+1],le,ae)<=ke&&Ze.push(X[Ct]);continue}const ot=Math.floor((Je+Ke)/2),ft=ie[2*ot],ct=ie[2*ot+1];Hr(ft,ct,le,ae)<=ke&&Ze.push(X[ot]);const We=(tt+1)%2;(0===tt?le-ne<=ft:ae-ne<=ct)&&(Ce.push(Je),Ce.push(ot-1),Ce.push(We)),(0===tt?le+ne>=ft:ae+ne>=ct)&&(Ce.push(ot+1),Ce.push(Ke),Ce.push(We))}return Ze}(this.ids,this.coords,S,D,V,this.nodeSize)}}const kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},Ui=Math.fround||(Dn=new Float32Array(1),G=>(Dn[0]=+G,Dn[0]));var Dn;class Yr{constructor(S){this.options=En(Object.create(kn),S),this.trees=new Array(this.options.maxZoom+1)}load(S){const{log:D,minZoom:V,maxZoom:X,nodeSize:ie}=this.options;D&&console.time("total time");const le=`prepare ${S.length} points`;D&&console.time(le),this.points=S;let ae=[];for(let ne=0;ne<S.length;ne++)S[ne].geometry&&ae.push(So(S[ne],ne));this.trees[X+1]=new nr(ae,vr,Jr,ie,Float32Array),D&&console.timeEnd(le);for(let ne=X;ne>=V;ne--){const ue=+Date.now();ae=this._cluster(ae,ne),this.trees[ne]=new nr(ae,vr,Jr,ie,Float32Array),D&&console.log("z%d: %d clusters in %dms",ne,ae.length,+Date.now()-ue)}return D&&console.timeEnd("total time"),this}getClusters(S,D){let V=((S[0]+180)%360+360)%360-180;const X=Math.max(-90,Math.min(90,S[1]));let ie=180===S[2]?180:((S[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,S[3]));if(S[2]-S[0]>=360)V=-180,ie=180;else if(V>ie){const Ce=this.getClusters([V,X,180,le],D),Ze=this.getClusters([-180,X,ie,le],D);return Ce.concat(Ze)}const ae=this.trees[this._limitZoom(D)],ne=ae.range(Mt(V),en(le),Mt(ie),en(X)),ue=[];for(const Ce of ne){const Ze=ae.points[Ce];ue.push(Ze.numPoints?ti(Ze):this.points[Ze.index])}return ue}getChildren(S){const D=this._getOriginId(S),V=this._getOriginZoom(S),X="No cluster with the specified id.",ie=this.trees[V];if(!ie)throw new Error(X);const le=ie.points[D];if(!le)throw new Error(X);const ae=this.options.radius/(this.options.extent*Math.pow(2,V-1)),ne=ie.within(le.x,le.y,ae),ue=[];for(const Ce of ne){const Ze=ie.points[Ce];Ze.parentId===S&&ue.push(Ze.numPoints?ti(Ze):this.points[Ze.index])}if(0===ue.length)throw new Error(X);return ue}getLeaves(S,D,V){const X=[];return this._appendLeaves(X,S,D=D||10,V=V||0,0),X}getTile(S,D,V){const X=this.trees[this._limitZoom(S)],ie=Math.pow(2,S),{extent:le,radius:ae}=this.options,ne=ae/le,ue=(V-ne)/ie,Ce=(V+1+ne)/ie,Ze={features:[]};return this._addTileFeatures(X.range((D-ne)/ie,ue,(D+1+ne)/ie,Ce),X.points,D,V,ie,Ze),0===D&&this._addTileFeatures(X.range(1-ne/ie,ue,1,Ce),X.points,ie,V,ie,Ze),D===ie-1&&this._addTileFeatures(X.range(0,ue,ne/ie,Ce),X.points,-1,V,ie,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(S){let D=this._getOriginZoom(S)-1;for(;D<=this.options.maxZoom;){const V=this.getChildren(S);if(D++,1!==V.length)break;S=V[0].properties.cluster_id}return D}_appendLeaves(S,D,V,X,ie){const le=this.getChildren(D);for(const ae of le){const ne=ae.properties;if(ne&&ne.cluster?ie+ne.point_count<=X?ie+=ne.point_count:ie=this._appendLeaves(S,ne.cluster_id,V,X,ie):ie<X?ie++:S.push(ae),S.length===V)break}return ie}_addTileFeatures(S,D,V,X,ie,le){for(const ae of S){const ne=D[ae],ue=ne.numPoints;let Ce,Ze,ke;if(ue)Ce=qi(ne),Ze=ne.x,ke=ne.y;else{const Je=this.points[ne.index];Ce=Je.properties,Ze=Mt(Je.geometry.coordinates[0]),ke=en(Je.geometry.coordinates[1])}const tt={type:1,geometry:[[Math.round(this.options.extent*(Ze*ie-V)),Math.round(this.options.extent*(ke*ie-X))]],tags:Ce};let Ke;ue?Ke=ne.id:this.options.generateId?Ke=ne.index:this.points[ne.index].id&&(Ke=this.points[ne.index].id),void 0!==Ke&&(tt.id=Ke),le.features.push(tt)}}_limitZoom(S){return Math.max(this.options.minZoom,Math.min(Math.floor(+S),this.options.maxZoom+1))}_cluster(S,D){const V=[],{radius:X,extent:ie,reduce:le,minPoints:ae}=this.options,ne=X/(ie*Math.pow(2,D));for(let ue=0;ue<S.length;ue++){const Ce=S[ue];if(Ce.zoom<=D)continue;Ce.zoom=D;const Ze=this.trees[D+1],ke=Ze.within(Ce.x,Ce.y,ne),tt=Ce.numPoints||1;let Ke=tt;for(const Je of ke){const ot=Ze.points[Je];ot.zoom>D&&(Ke+=ot.numPoints||1)}if(Ke>tt&&Ke>=ae){let Je=Ce.x*tt,ot=Ce.y*tt,ft=le&&tt>1?this._map(Ce,!0):null;const ct=(ue<<5)+(D+1)+this.points.length;for(const We of ke){const Ct=Ze.points[We];if(Ct.zoom<=D)continue;Ct.zoom=D;const jt=Ct.numPoints||1;Je+=Ct.x*jt,ot+=Ct.y*jt,Ct.parentId=ct,le&&(ft||(ft=this._map(Ce,!0)),le(ft,this._map(Ct)))}Ce.parentId=ct,V.push(Zi(Je/Ke,ot/Ke,ct,Ke,ft))}else if(V.push(Ce),Ke>1)for(const Je of ke){const ot=Ze.points[Je];ot.zoom<=D||(ot.zoom=D,V.push(ot))}}return V}_getOriginId(S){return S-this.points.length>>5}_getOriginZoom(S){return(S-this.points.length)%32}_map(S,D){if(S.numPoints)return D?En({},S.properties):S.properties;const V=this.points[S.index].properties,X=this.options.map(V);return D&&X===V?En({},X):X}}function Zi(G,S,D,V,X){return{x:Ui(G),y:Ui(S),zoom:1/0,id:D,parentId:-1,numPoints:V,properties:X}}function So(G,S){const[D,V]=G.geometry.coordinates;return{x:Ui(Mt(D)),y:Ui(en(V)),zoom:1/0,index:S,parentId:-1}}function ti(G){return{type:"Feature",id:G.id,properties:qi(G),geometry:{type:"Point",coordinates:[(S=G.x,360*(S-.5)),tn(G.y)]}};var S}function qi(G){const S=G.numPoints,D=S>=1e4?`${Math.round(S/1e3)}k`:S>=1e3?Math.round(S/100)/10+"k":S;return En(En({},G.properties),{cluster:!0,cluster_id:G.id,point_count:S,point_count_abbreviated:D})}function Mt(G){return G/360+.5}function en(G){const S=Math.sin(G*Math.PI/180),D=.5-.25*Math.log((1+S)/(1-S))/Math.PI;return D<0?0:D>1?1:D}function tn(G){const S=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(S))/Math.PI-90}function En(G,S){for(const D in S)G[D]=S[D];return G}function vr(G){return G.x}function Jr(G){return G.y}function Pn(G,S,D,V){for(var X,ie=V,le=D-S>>1,ae=D-S,ne=G[S],ue=G[S+1],Ce=G[D],Ze=G[D+1],ke=S+3;ke<D;ke+=3){var tt=br(G[ke],G[ke+1],ne,ue,Ce,Ze);if(tt>ie)X=ke,ie=tt;else if(tt===ie){var Ke=Math.abs(ke-le);Ke<ae&&(X=ke,ae=Ke)}}ie>V&&(X-S>3&&Pn(G,S,X,V),G[X+2]=ie,D-X>3&&Pn(G,X,D,V))}function br(G,S,D,V,X,ie){var le=X-D,ae=ie-V;if(0!==le||0!==ae){var ne=((G-D)*le+(S-V)*ae)/(le*le+ae*ae);ne>1?(D=X,V=ie):ne>0&&(D+=le*ne,V+=ae*ne)}return(le=G-D)*le+(ae=S-V)*ae}function Ti(G,S,D,V){var X={id:void 0===G?null:G,type:S,geometry:D,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ie){var le=ie.geometry,ae=ie.type;if("Point"===ae||"MultiPoint"===ae||"LineString"===ae)Ln(ie,le);else if("Polygon"===ae||"MultiLineString"===ae)for(var ne=0;ne<le.length;ne++)Ln(ie,le[ne]);else if("MultiPolygon"===ae)for(ne=0;ne<le.length;ne++)for(var ue=0;ue<le[ne].length;ue++)Ln(ie,le[ne][ue])}(X),X}function Ln(G,S){for(var D=0;D<S.length;D+=3)G.minX=Math.min(G.minX,S[D]),G.minY=Math.min(G.minY,S[D+1]),G.maxX=Math.max(G.maxX,S[D]),G.maxY=Math.max(G.maxY,S[D+1])}function wr(G,S,D,V){if(S.geometry){var X=S.geometry.coordinates,ie=S.geometry.type,le=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2),ae=[],ne=S.id;if(D.promoteId?ne=S.properties[D.promoteId]:D.generateId&&(ne=V||0),"Point"===ie)Kr(X,ae);else if("MultiPoint"===ie)for(var ue=0;ue<X.length;ue++)Kr(X[ue],ae);else if("LineString"===ie)Tr(X,ae,le,!1);else if("MultiLineString"===ie){if(D.lineMetrics){for(ue=0;ue<X.length;ue++)Tr(X[ue],ae=[],le,!1),G.push(Ti(ne,"LineString",ae,S.properties));return}On(X,ae,le,!1)}else if("Polygon"===ie)On(X,ae,le,!0);else{if("MultiPolygon"!==ie){if("GeometryCollection"===ie){for(ue=0;ue<S.geometry.geometries.length;ue++)wr(G,{id:ne,geometry:S.geometry.geometries[ue],properties:S.properties},D,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ue=0;ue<X.length;ue++){var Ce=[];On(X[ue],Ce,le,!0),ae.push(Ce)}}G.push(Ti(ne,ie,ae,S.properties))}}function Kr(G,S){S.push(Qr(G[0])),S.push(Er(G[1])),S.push(0)}function Tr(G,S,D,V){for(var X,ie,le=0,ae=0;ae<G.length;ae++){var ne=Qr(G[ae][0]),ue=Er(G[ae][1]);S.push(ne),S.push(ue),S.push(0),ae>0&&(le+=V?(X*ue-ne*ie)/2:Math.sqrt(Math.pow(ne-X,2)+Math.pow(ue-ie,2))),X=ne,ie=ue}var Ce=S.length-3;S[2]=1,Pn(S,0,Ce,D),S[Ce+2]=1,S.size=Math.abs(le),S.start=0,S.end=S.size}function On(G,S,D,V){for(var X=0;X<G.length;X++){var ie=[];Tr(G[X],ie,D,V),S.push(ie)}}function Qr(G){return G/360+.5}function Er(G){var S=Math.sin(G*Math.PI/180),D=.5-.25*Math.log((1+S)/(1-S))/Math.PI;return D<0?0:D>1?1:D}function Ni(G,S,D,V,X,ie,le,ae){if(V/=S,ie>=(D/=S)&&le<V)return G;if(le<D||ie>=V)return null;for(var ne=[],ue=0;ue<G.length;ue++){var Ce=G[ue],Ze=Ce.geometry,ke=Ce.type,tt=0===X?Ce.minX:Ce.minY,Ke=0===X?Ce.maxX:Ce.maxY;if(tt>=D&&Ke<V)ne.push(Ce);else if(!(Ke<D||tt>=V)){var Je=[];if("Point"===ke||"MultiPoint"===ke)eo(Ze,Je,D,V,X);else if("LineString"===ke)Rn(Ze,Je,D,V,X,!1,ae.lineMetrics);else if("MultiLineString"===ke)Fn(Ze,Je,D,V,X,!1);else if("Polygon"===ke)Fn(Ze,Je,D,V,X,!0);else if("MultiPolygon"===ke)for(var ot=0;ot<Ze.length;ot++){var ft=[];Fn(Ze[ot],ft,D,V,X,!0),ft.length&&Je.push(ft)}if(Je.length){if(ae.lineMetrics&&"LineString"===ke){for(ot=0;ot<Je.length;ot++)ne.push(Ti(Ce.id,ke,Je[ot],Ce.tags));continue}"LineString"!==ke&&"MultiLineString"!==ke||(1===Je.length?(ke="LineString",Je=Je[0]):ke="MultiLineString"),"Point"!==ke&&"MultiPoint"!==ke||(ke=3===Je.length?"Point":"MultiPoint"),ne.push(Ti(Ce.id,ke,Je,Ce.tags))}}}return ne.length?ne:null}function eo(G,S,D,V,X){for(var ie=0;ie<G.length;ie+=3){var le=G[ie+X];le>=D&&le<=V&&(S.push(G[ie]),S.push(G[ie+1]),S.push(G[ie+2]))}}function Rn(G,S,D,V,X,ie,le){for(var ae,ne,ue=Bn(G),Ce=0===X?Mr:Ot,Ze=G.start,ke=0;ke<G.length-3;ke+=3){var tt=G[ke],Ke=G[ke+1],Je=G[ke+2],ot=G[ke+3],ft=G[ke+4],ct=0===X?tt:Ke,We=0===X?ot:ft,Ct=!1;le&&(ae=Math.sqrt(Math.pow(tt-ot,2)+Math.pow(Ke-ft,2))),ct<D?We>D&&(ne=Ce(ue,tt,Ke,ot,ft,D),le&&(ue.start=Ze+ae*ne)):ct>V?We<V&&(ne=Ce(ue,tt,Ke,ot,ft,V),le&&(ue.start=Ze+ae*ne)):li(ue,tt,Ke,Je),We<D&&ct>=D&&(ne=Ce(ue,tt,Ke,ot,ft,D),Ct=!0),We>V&&ct<=V&&(ne=Ce(ue,tt,Ke,ot,ft,V),Ct=!0),!ie&&Ct&&(le&&(ue.end=Ze+ae*ne),S.push(ue),ue=Bn(G)),le&&(Ze+=ae)}var jt=G.length-3;tt=G[jt],Ke=G[jt+1],Je=G[jt+2],(ct=0===X?tt:Ke)>=D&&ct<=V&&li(ue,tt,Ke,Je),jt=ue.length-3,ie&&jt>=3&&(ue[jt]!==ue[0]||ue[jt+1]!==ue[1])&&li(ue,ue[0],ue[1],ue[2]),ue.length&&S.push(ue)}function Bn(G){var S=[];return S.size=G.size,S.start=G.start,S.end=G.end,S}function Fn(G,S,D,V,X,ie){for(var le=0;le<G.length;le++)Rn(G[le],S,D,V,X,ie,!1)}function li(G,S,D,V){G.push(S),G.push(D),G.push(V)}function Mr(G,S,D,V,X,ie){var le=(ie-S)/(V-S);return G.push(ie),G.push(D+(X-D)*le),G.push(1),le}function Ot(G,S,D,V,X,ie){var le=(ie-D)/(X-D);return G.push(S+(V-S)*le),G.push(ie),G.push(1),le}function Mn(G,S){for(var D=[],V=0;V<G.length;V++){var X,ie=G[V],le=ie.type;if("Point"===le||"MultiPoint"===le||"LineString"===le)X=Cr(ie.geometry,S);else if("MultiLineString"===le||"Polygon"===le){X=[];for(var ae=0;ae<ie.geometry.length;ae++)X.push(Cr(ie.geometry[ae],S))}else if("MultiPolygon"===le)for(X=[],ae=0;ae<ie.geometry.length;ae++){for(var ne=[],ue=0;ue<ie.geometry[ae].length;ue++)ne.push(Cr(ie.geometry[ae][ue],S));X.push(ne)}D.push(Ti(ie.id,le,X,ie.tags))}return D}function Cr(G,S){var D=[];D.size=G.size,void 0!==G.start&&(D.start=G.start,D.end=G.end);for(var V=0;V<G.length;V+=3)D.push(G[V]+S,G[V+1],G[V+2]);return D}function Ir(G,S){if(G.transformed)return G;var D,V,X,ie=1<<G.z,le=G.x,ae=G.y;for(D=0;D<G.features.length;D++){var ne=G.features[D],ue=ne.geometry,Ce=ne.type;if(ne.geometry=[],1===Ce)for(V=0;V<ue.length;V+=2)ne.geometry.push($i(ue[V],ue[V+1],S,ie,le,ae));else for(V=0;V<ue.length;V++){var Ze=[];for(X=0;X<ue[V].length;X+=2)Ze.push($i(ue[V][X],ue[V][X+1],S,ie,le,ae));ne.geometry.push(Ze)}}return G.transformed=!0,G}function $i(G,S,D,V,X,ie){return[Math.round(D*(G*V-X)),Math.round(D*(S*V-ie))]}function Un(G,S,D,V,X){for(var ie=S===X.maxZoom?0:X.tolerance/((1<<S)*X.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:D,y:V,z:S,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ae=0;ae<G.length;ae++){le.numFeatures++,zo(le,G[ae],ie,X);var ne=G[ae].minX,ue=G[ae].minY,Ce=G[ae].maxX,Ze=G[ae].maxY;ne<le.minX&&(le.minX=ne),ue<le.minY&&(le.minY=ue),Ce>le.maxX&&(le.maxX=Ce),Ze>le.maxY&&(le.maxY=Ze)}return le}function zo(G,S,D,V){var X=S.geometry,ie=S.type,le=[];if("Point"===ie||"MultiPoint"===ie)for(var ae=0;ae<X.length;ae+=3)le.push(X[ae]),le.push(X[ae+1]),G.numPoints++,G.numSimplified++;else if("LineString"===ie)Ar(le,X,G,D,!1,!1);else if("MultiLineString"===ie||"Polygon"===ie)for(ae=0;ae<X.length;ae++)Ar(le,X[ae],G,D,"Polygon"===ie,0===ae);else if("MultiPolygon"===ie)for(var ne=0;ne<X.length;ne++){var ue=X[ne];for(ae=0;ae<ue.length;ae++)Ar(le,ue[ae],G,D,!0,0===ae)}if(le.length){var Ce=S.tags||null;if("LineString"===ie&&V.lineMetrics){for(var Ze in Ce={},S.tags)Ce[Ze]=S.tags[Ze];Ce.mapbox_clip_start=X.start/X.size,Ce.mapbox_clip_end=X.end/X.size}var ke={geometry:le,type:"Polygon"===ie||"MultiPolygon"===ie?3:"LineString"===ie||"MultiLineString"===ie?2:1,tags:Ce};null!==S.id&&(ke.id=S.id),G.features.push(ke)}}function Ar(G,S,D,V,X,ie){var le=V*V;if(V>0&&S.size<(X?le:V))D.numPoints+=S.length/3;else{for(var ae=[],ne=0;ne<S.length;ne+=3)(0===V||S[ne+2]>le)&&(D.numSimplified++,ae.push(S[ne]),ae.push(S[ne+1])),D.numPoints++;X&&function(ue,Ce){for(var Ze=0,ke=0,tt=ue.length,Ke=tt-2;ke<tt;Ke=ke,ke+=2)Ze+=(ue[ke]-ue[Ke])*(ue[ke+1]+ue[Ke+1]);if(Ze>0===Ce)for(ke=0,tt=ue.length;ke<tt/2;ke+=2){var Je=ue[ke],ot=ue[ke+1];ue[ke]=ue[tt-2-ke],ue[ke+1]=ue[tt-1-ke],ue[tt-2-ke]=Je,ue[tt-1-ke]=ot}}(ae,ie),G.push(ae)}}function rr(G,S){var D=(S=this.options=function(X,ie){for(var le in ie)X[le]=ie[le];return X}(Object.create(this.options),S)).debug;if(D&&console.time("preprocess data"),S.maxZoom<0||S.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(S.promoteId&&S.generateId)throw new Error("promoteId and generateId cannot be used together.");var X,ie,le,ae,ne,ue,V=function(X,ie){var le=[];if("FeatureCollection"===X.type)for(var ae=0;ae<X.features.length;ae++)wr(le,X.features[ae],ie,ae);else wr(le,"Feature"===X.type?X:{geometry:X},ie);return le}(G,S);this.tiles={},this.tileCoords=[],D&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",S.indexMaxZoom,S.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=X=V,ne=Ni(X,1,-1-(le=(ie=S).buffer/ie.extent),le,0,-1,2,ie),ue=Ni(X,1,1-le,2+le,0,-1,2,ie),(ne||ue)&&(ae=Ni(X,1,-le,1+le,0,-1,2,ie)||[],ne&&(ae=Mn(ne,1).concat(ae)),ue&&(ae=ae.concat(Mn(ue,-1)))),(V=ae).length&&this.splitTile(V,0,0,0),D&&(V.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Sr(G,S,D){return 32*((1<<G)*D+S)+G}function nn(G,S){const D=G.tileID.canonical;if(!this._geoJSONIndex)return S(null,null);const V=this._geoJSONIndex.getTile(D.z,D.x,D.y);if(!V)return S(null,null);const X=new qr(V.features);let ie=cn.exports(X);0===ie.byteOffset&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),S(null,{vectorTile:X,rawData:ie.buffer})}rr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rr.prototype.splitTile=function(G,S,D,V,X,ie,le){for(var ae=[G,S,D,V],ne=this.options,ue=ne.debug;ae.length;){V=ae.pop(),D=ae.pop(),S=ae.pop(),G=ae.pop();var Ce=1<<S,Ze=Sr(S,D,V),ke=this.tiles[Ze];if(!ke&&(ue>1&&console.time("creation"),ke=this.tiles[Ze]=Un(G,S,D,V,ne),this.tileCoords.push({z:S,x:D,y:V}),ue)){ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",S,D,V,ke.numFeatures,ke.numPoints,ke.numSimplified),console.timeEnd("creation"));var tt="z"+S;this.stats[tt]=(this.stats[tt]||0)+1,this.total++}if(ke.source=G,X){if(S===ne.maxZoom||S===X)continue;var Ke=1<<X-S;if(D!==Math.floor(ie/Ke)||V!==Math.floor(le/Ke))continue}else if(S===ne.indexMaxZoom||ke.numPoints<=ne.indexMaxPoints)continue;if(ke.source=null,0!==G.length){ue>1&&console.time("clipping");var Je,ot,ft,ct,We,Ct,jt=.5*ne.buffer/ne.extent,Ei=.5-jt,ki=.5+jt,Ut=1+jt;Je=ot=ft=ct=null,We=Ni(G,Ce,D-jt,D+ki,0,ke.minX,ke.maxX,ne),Ct=Ni(G,Ce,D+Ei,D+Ut,0,ke.minX,ke.maxX,ne),G=null,We&&(Je=Ni(We,Ce,V-jt,V+ki,1,ke.minY,ke.maxY,ne),ot=Ni(We,Ce,V+Ei,V+Ut,1,ke.minY,ke.maxY,ne),We=null),Ct&&(ft=Ni(Ct,Ce,V-jt,V+ki,1,ke.minY,ke.maxY,ne),ct=Ni(Ct,Ce,V+Ei,V+Ut,1,ke.minY,ke.maxY,ne),Ct=null),ue>1&&console.timeEnd("clipping"),ae.push(Je||[],S+1,2*D,2*V),ae.push(ot||[],S+1,2*D,2*V+1),ae.push(ft||[],S+1,2*D+1,2*V),ae.push(ct||[],S+1,2*D+1,2*V+1)}}},rr.prototype.getTile=function(G,S,D){var V=this.options,X=V.extent,ie=V.debug;if(G<0||G>24)return null;var le=1<<G,ae=Sr(G,S=(S%le+le)%le,D);if(this.tiles[ae])return Ir(this.tiles[ae],X);ie>1&&console.log("drilling down to z%d-%d-%d",G,S,D);for(var ne,ue=G,Ce=S,Ze=D;!ne&&ue>0;)ue--,Ce=Math.floor(Ce/2),Ze=Math.floor(Ze/2),ne=this.tiles[Sr(ue,Ce,Ze)];return ne&&ne.source?(ie>1&&console.log("found parent tile z%d-%d-%d",ue,Ce,Ze),ie>1&&console.time("drilling down"),this.splitTile(ne.source,ue,Ce,Ze,G,S,D),ie>1&&console.timeEnd("drilling down"),this.tiles[ae]?Ir(this.tiles[ae],X):null):null};class Zn extends a.VectorTileWorkerSource{constructor(S,D,V,X,ie){super(S,D,V,X,nn),ie&&(this.loadGeoJSON=ie)}loadData(S,D){const V=S&&S.request,X=V&&V.collectResourceTiming;this.loadGeoJSON(S,(ie,le)=>{if(ie||!le)return D(ie);if("object"!=typeof le)return D(new Error(`Input data given to '${S.source}' is not a valid GeoJSON object.`));{ut(le,!0);try{if(S.filter){const ne=a.createExpression(S.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ne.result)throw new Error(ne.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));le={type:"FeatureCollection",features:le.features.filter(Ce=>ne.value.evaluate({zoom:0},Ce))}}this._geoJSONIndex=S.cluster?new Yr(function({superclusterOptions:ne,clusterProperties:ue}){if(!ue||!ne)return ne;const Ce={},Ze={},ke={accumulated:null,zoom:0},tt={properties:null},Ke=Object.keys(ue);for(const Je of Ke){const[ot,ft]=ue[Je],ct=a.createExpression(ft),We=a.createExpression("string"==typeof ot?[ot,["accumulated"],["get",Je]]:ot);Ce[Je]=ct.value,Ze[Je]=We.value}return ne.map=Je=>{tt.properties=Je;const ot={};for(const ft of Ke)ot[ft]=Ce[ft].evaluate(ke,tt);return ot},ne.reduce=(Je,ot)=>{tt.properties=ot;for(const ft of Ke)ke.accumulated=Je[ft],Je[ft]=Ze[ft].evaluate(ke,tt)},ne}(S)).load(le.features):new rr(ne=le,S.geojsonVtOptions)}catch(ne){return D(ne)}this.loaded={};const ae={};if(X){const ne=a.getPerformanceMeasurement(V);ne&&(ae.resourceTiming={},ae.resourceTiming[S.source]=JSON.parse(JSON.stringify(ne)))}D(null,ae)}var ne})}reloadTile(S,D){const V=this.loaded;return V&&V[S.uid]?super.reloadTile(S,D):this.loadTile(S,D)}loadGeoJSON(S,D){if(S.request)a.getJSON(S.request,D);else{if("string"!=typeof S.data)return D(new Error(`Input data given to '${S.source}' is not a valid GeoJSON object.`));try{return D(null,JSON.parse(S.data))}catch{return D(new Error(`Input data given to '${S.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(S,D){try{D(null,this._geoJSONIndex.getClusterExpansionZoom(S.clusterId))}catch(V){D(V)}}getClusterChildren(S,D){try{D(null,this._geoJSONIndex.getChildren(S.clusterId))}catch(V){D(V)}}getClusterLeaves(S,D){try{D(null,this._geoJSONIndex.getLeaves(S.clusterId,S.limit,S.offset))}catch(V){D(V)}}}class to{constructor(S){this.self=S,this.actor=new a.Actor(S,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:Zn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(D,V)=>{if(this.workerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.workerSourceTypes[D]=V},this.self.registerRTLTextPlugin=D=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=D.applyArabicShaping,a.plugin.processBidirectionalText=D.processBidirectionalText,a.plugin.processStyledBidirectionalText=D.processStyledBidirectionalText}}clearCaches(S,D,V){delete this.layerIndexes[S],delete this.availableImages[S],delete this.workerSources[S],delete this.demWorkerSources[S],V()}checkIfReady(S,D,V){V()}setReferrer(S,D){this.referrer=D}spriteLoaded(S,D){this.isSpriteLoaded[S]=D;for(const V in this.workerSources[S]){const X=this.workerSources[S][V];for(const ie in X)X[ie]instanceof a.VectorTileWorkerSource&&(X[ie].isSpriteLoaded=D,X[ie].fire(new a.Event("isSpriteLoaded")))}}setImages(S,D,V){this.availableImages[S]=D;for(const X in this.workerSources[S]){const ie=this.workerSources[S][X];for(const le in ie)ie[le].availableImages=D}V()}enableTerrain(S,D,V){this.terrain=D,V()}setProjection(S,D){this.projections[S]=a.getProjection(D)}setLayers(S,D,V){this.getLayerIndex(S).replace(D),V()}updateLayers(S,D,V){this.getLayerIndex(S).update(D.layers,D.removedIds),V()}loadTile(S,D,V){const X=this.enableTerrain?a.extend({enableTerrain:this.terrain},D):D;X.projection=this.projections[S]||this.defaultProjection,this.getWorkerSource(S,D.type,D.source).loadTile(X,V)}loadDEMTile(S,D,V){const X=this.enableTerrain?a.extend({buildQuadTree:this.terrain},D):D;this.getDEMWorkerSource(S,D.source).loadTile(X,V)}reloadTile(S,D,V){const X=this.enableTerrain?a.extend({enableTerrain:this.terrain},D):D;X.projection=this.projections[S]||this.defaultProjection,this.getWorkerSource(S,D.type,D.source).reloadTile(X,V)}abortTile(S,D,V){this.getWorkerSource(S,D.type,D.source).abortTile(D,V)}removeTile(S,D,V){this.getWorkerSource(S,D.type,D.source).removeTile(D,V)}removeSource(S,D,V){if(!this.workerSources[S]||!this.workerSources[S][D.type]||!this.workerSources[S][D.type][D.source])return;const X=this.workerSources[S][D.type][D.source];delete this.workerSources[S][D.type][D.source],void 0!==X.removeSource?X.removeSource(D,V):V()}loadWorkerSource(S,D,V){try{this.self.importScripts(D.url),V()}catch(X){V(X.toString())}}syncRTLPluginState(S,D,V){try{a.plugin.setState(D);const X=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&null!=X){this.self.importScripts(X);const ie=a.plugin.isParsed();V(ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${X}`),ie)}}catch(X){V(X.toString())}}getAvailableImages(S){let D=this.availableImages[S];return D||(D=[]),D}getLayerIndex(S){let D=this.layerIndexes[S];return D||(D=this.layerIndexes[S]=new Qi),D}getWorkerSource(S,D,V){return this.workerSources[S]||(this.workerSources[S]={}),this.workerSources[S][D]||(this.workerSources[S][D]={}),this.workerSources[S][D][V]||(this.workerSources[S][D][V]=new this.workerSourceTypes[D]({send:(ie,le,ae,ne,ue,Ce)=>{this.actor.send(ie,le,ae,S,ue,Ce)},scheduler:this.actor.scheduler},this.getLayerIndex(S),this.getAvailableImages(S),this.isSpriteLoaded[S])),this.workerSources[S][D][V]}getDEMWorkerSource(S,D){return this.demWorkerSources[S]||(this.demWorkerSources[S]={}),this.demWorkerSources[S][D]||(this.demWorkerSources[S][D]=new pt),this.demWorkerSources[S][D]}enforceCacheSizeLimit(S,D){a.enforceCacheSizeLimit(D)}getWorkerPerformanceMetrics(S,D,V){V(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new to(self)),to}),ln(0,function(a){function Se(l,n){if(Array.isArray(l)){if(!Array.isArray(n)||l.length!==n.length)return!1;for(let o=0;o<l.length;o++)if(!Se(l[o],n[o]))return!1;return!0}if("object"==typeof l&&null!==l&&null!==n){if("object"!=typeof n||Object.keys(l).length!==Object.keys(n).length)return!1;for(const o in l)if(!Se(l[o],n[o]))return!1;return!0}return l===n}var vn=Qi;function Qi(l){return n=l,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,d,f=new Blob([""],{type:"text/javascript"}),y=URL.createObjectURL(f);try{d=new Worker(y),h=!0}catch{h=!1}return d&&d.terminate(),URL.revokeObjectURL(y),h}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var h=document.createElement("canvas");h.width=h.height=1;var d=h.getContext("2d");if(!d)return!1;var f=d.getImageData(0,0,1,1);return f&&f.width===h.width}()||(void 0===pt[o=n&&n.failIfMajorPerformanceCaveat]&&(pt[o]=function(h){var d,y,x,b,f=(y=h,x=document.createElement("canvas"),(b=Object.create(Qi.webGLContextAttributes)).failIfMajorPerformanceCaveat=y,x.getContext("webgl",b)||x.getContext("experimental-webgl",b));if(!f)return!1;try{d=f.createShader(f.VERTEX_SHADER)}catch{return!1}return!(!d||f.isContextLost())&&(f.shaderSource(d,"void main() {}"),f.compileShader(d),!0===f.getShaderParameter(d,f.COMPILE_STATUS))}(o)),!pt[o]||document.documentMode));var n,o}var pt={};function ut(l,n,o){const h=a.window.document.createElement(l);return void 0!==n&&(h.className=n),o&&o.appendChild(h),h}function xi(l,n,o){const h=a.window.document.createElementNS("http://www.w3.org/2000/svg",l);for(const d of Object.keys(n))h.setAttributeNS(null,d,n[d]);return o&&o.appendChild(h),h}Qi.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Mi=a.window.document&&a.window.document.documentElement.style,bn=Mi&&void 0!==Mi.userSelect?"userSelect":"WebkitUserSelect";let Gr;function qr(){Mi&&bn&&(Gr=Mi[bn],Mi[bn]="none")}function cn(){Mi&&bn&&(Mi[bn]=Gr)}function gr(l){l.preventDefault(),l.stopPropagation(),a.window.removeEventListener("click",gr,!0)}function yr(){a.window.addEventListener("click",gr,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",gr,!0)},0)}function Be(l,n){const o=l.getBoundingClientRect();return Io(l,o,n)}function Fi(l,n){const o=l.getBoundingClientRect(),h=[];for(let d=0;d<n.length;d++)h.push(Io(l,o,n[d]));return h}function wn(l){return void 0!==a.window.InstallTrigger&&2===l.button&&l.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function Io(l,n,o){const h=l.offsetWidth===n.width?1:l.offsetWidth/n.width;return new a.pointGeometry((o.clientX-n.left)*h,(o.clientY-n.top)*h)}function vt(l,n){var o=n[0],h=n[1],d=n[2],f=n[3],y=o*f-d*h;return y?(l[0]=f*(y=1/y),l[1]=-h*y,l[2]=-d*y,l[3]=o*y,l):null}function di(l){const{userImage:n}=l;return!!(n&&n.render&&n.render())&&(l.data.replace(new Uint8Array(n.data.buffer)),!0)}class rs extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:o,callback:h}of this.requestors)this._notify(o,h);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,o){this._validate(n,o)&&(this.images[n]=o)}_validate(n,o){let h=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),h=!1),h}_validateStretch(n,o){if(!n)return!0;let h=0;for(const d of n){if(d[0]<h||d[1]<d[0]||o<d[1])return!1;h=d[1]}return!0}_validateContent(n,o){return!(n&&(4!==n.length||n[0]<0||o.data.width<n[0]||n[1]<0||o.data.height<n[1]||n[2]<0||o.data.width<n[2]||n[3]<0||o.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,o){o.version=this.images[n].version+1,this.images[n]=o,this.updatedImages[n]=!0}removeImage(n){const o=this.images[n];delete this.images[n],delete this.patterns[n],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,o){let h=!0;if(!this.isLoaded())for(const d of n)this.images[d]||(h=!1);this.isLoaded()||h?this._notify(n,o):this.requestors.push({ids:n,callback:o})}_notify(n,o){const h={};for(const d of n){this.images[d]||this.fire(new a.Event("styleimagemissing",{id:d}));const f=this.images[d];f?h[d]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:!(!f.userImage||!f.userImage.render)}:a.warnOnce(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,h)}getPixelSize(){const{width:n,height:o}=this.atlasImage;return{width:n,height:o}}getPattern(n){const o=this.patterns[n],h=this.getImage(n);if(!h)return null;if(o&&o.position.version===h.version)return o.position;if(o)o.position.version=h.version;else{const d={w:h.data.width+2,h:h.data.height+2,x:0,y:0},f=new a.ImagePosition(d,h);this.patterns[n]={bin:d,position:f}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const o=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(n,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const f in this.patterns)n.push(this.patterns[f].bin);const{w:o,h}=a.potpack(n),d=this.atlasImage;d.resize({width:o||1,height:h||1});for(const f in this.patterns){const{bin:y}=this.patterns[f],x=y.x+1,b=y.y+1,M=this.images[f].data,E=M.width,z=M.height;a.RGBAImage.copy(M,d,{x:0,y:0},{x,y:b},{width:E,height:z}),a.RGBAImage.copy(M,d,{x:0,y:z-1},{x,y:b-1},{width:E,height:1}),a.RGBAImage.copy(M,d,{x:0,y:0},{x,y:b+z},{width:E,height:1}),a.RGBAImage.copy(M,d,{x:E-1,y:0},{x:x-1,y:b},{width:1,height:z}),a.RGBAImage.copy(M,d,{x:0,y:0},{x:x+E,y:b},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const o of n){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const h=this.images[o];di(h)&&this.updateImage(o,h)}}}const Ao=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(l,n){return function([o,h,d]){const f=a.degToRad(h+90),y=a.degToRad(d);return{x:o*Math.cos(f)*Math.sin(y),y:o*Math.sin(f)*Math.sin(y),z:o*Math.cos(y),azimuthal:h,polar:d}}(l.expression.evaluate(n))}interpolate(l,n,o){return{x:a.number(l.x,n.x,o),y:a.number(l.y,n.y,o),z:a.number(l.z,n.z,o),azimuthal:a.number(l.azimuthal,n.azimuthal,o),polar:a.number(l.polar,n.polar,o)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),$r="-transition";class Wr extends a.Evented{constructor(n){super(),this._transitionable=new a.Transitionable(Ao),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,o={}){if(!this._validate(a.validateLight,n,o))for(const h in n){const d=n[h];a.endsWith(h,$r)?this._transitionable.setTransition(h.slice(0,-11),d):this._transitionable.setValue(h,d)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,h){return(!h||!1!==h.validate)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const _t=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),Xr="-transition";class tr extends a.Evented{constructor(n,o){super(),this._transitionable=new a.Transitionable(_t),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(n){for(const o in n){const h=n[o];a.endsWith(o,Xr)?this._transitionable.setTransition(o.slice(0,-11),h):this._transitionable.setValue(o,h)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function zn(l,n,o,h){const d=a.smoothstep(45,65,o),[f,y]=ir(l,h),x=a.length(n);let b=1-Math.min(1,Math.exp((x-f)/(y-f)*-6));return b*=b*b,b=Math.min(1,1.00747*b),b*d*l.alpha}function ir(l,n){const o=.5/Math.tan(.5*n);return[l.range[0]+o,l.range[1]+o]}const ni=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])}),xr="-transition";class Hr extends a.Evented{constructor(n,o){super(),this._transitionable=new a.Transitionable(ni),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){const n=this._transform,o="globe"===n.projection.name,h=a.globeToMercatorTransition(n.zoom),d=this.properties.get("range"),f=[.5,3];return{range:o?[a.number(f[0],d[0],h),a.number(f[1],d[1],h)]:d,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,o={}){if(!this._validate(a.validateFog,n,o)){for(const h of Object.keys(a.spec.fog))n&&void 0===n[h]&&(n[h]=a.spec.fog[h].default);for(const h in n){const d=n[h];a.endsWith(h,xr)?this._transitionable.setTransition(h.slice(0,-11),d):this._transitionable.setValue(h,d)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:a.smoothstep(45,65,n))*o.a}getOpacityAtLatLng(n,o){return this._transform.projection.supportsFog?function(h,d,f){const y=a.MercatorCoordinate.fromLngLat(d),x=f.elevation?f.elevation.getAtPointOrZero(y):0,b=[y.x,y.y,x];return a.transformMat4(b,b,f.mercatorFogMatrix),zn(h,b,f.pitch,f._fov)}(this.state,n,o):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?ir(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,h){return(!h||!1!==h.validate)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Tn{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const h=this.workerPool.acquire(this.id);for(let d=0;d<h.length;d++){const f=new Tn.Actor(h[d],o,this.id);f.name=`Worker ${d}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,h){a.asyncAll(this.actors,(d,f)=>{d.send(n,o,f)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function hn(l,n,o){return n*(a.EXTENT/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}Tn.Actor=a.Actor;class nr{constructor(n,o,h,d){this.screenBounds=n,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(n,o){let h,d;if(n instanceof a.pointGeometry||"number"==typeof n[0]){const f=a.pointGeometry.convert(n);h=[f],d=o.isPointAboveHorizon(f)}else{const f=a.pointGeometry.convert(n[0]),y=a.pointGeometry.convert(n[1]);h=[f,y],d=a.polygonizeBounds(f,y).every(x=>o.isPointAboveHorizon(x))}return new nr(h,o.getCameraPoint(),d,o)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return a.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const o=this.screenBounds[0],h=1===this.screenBounds.length?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],d=a.polygonizeBounds(o,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<h.x?d.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?d[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(d[3]=this.cameraPoint)),a.bufferConvexPolygon(d,n)}bufferedCameraGeometryGlobe(n){const o=this.screenBounds[0],h=1===this.screenBounds.length?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],d=a.polygonizeBounds(o,h,n),f=this.cameraPoint.clone();switch(3*((f.y>o.y)+(f.y>h.y))+((f.x>o.x)+(f.x>h.x))){case 0:d[0]=f,d[4]=f.clone();break;case 1:d.splice(1,0,f);break;case 2:d[1]=f;break;case 3:d.splice(4,0,f);break;case 5:d.splice(2,0,f);break;case 6:d[3]=f;break;case 7:d.splice(3,0,f);break;case 8:d[2]=f}return d}containsTile(n,o,h,d=0){const f=n.queryPadding/o._pixelsPerMercatorPixel+1,y=h?this._bufferedCameraMercator(f,o):this._bufferedScreenMercator(f,o);let x=n.tileID.wrap+(y.unwrapped?d:0);const b=y.polygon.map(O=>a.getTilePoint(n.tileTransform,O,x));if(!a.polygonIntersectsBox(b,0,0,a.EXTENT,a.EXTENT))return;x=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?d:0);const M=this.screenGeometryMercator.polygon.map(O=>a.getTileVec3(n.tileTransform,O,x)),E=M.map(O=>new a.pointGeometry(O[0],O[1])),z=o.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),P=a.getTileVec3(n.tileTransform,z,x),U=M.map(O=>{const R=a.sub(O,O,P);return a.normalize(R,R),new a.Ray(P,R)}),F=hn(n,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:E,tilespaceRays:U,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(Z=a.getBounds(b),Z.min.x=a.clamp(Z.min.x,0,a.EXTENT),Z.min.y=a.clamp(Z.min.y,0,a.EXTENT),Z.max.x=a.clamp(Z.max.x,0,a.EXTENT),Z.max.y=a.clamp(Z.max.y,0,a.EXTENT),Z),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:F};var Z}_bufferedScreenMercator(n,o){const h=Dn(n);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let d;return d="globe"===o.projection.name?this._projectAndResample(this.bufferedScreenGeometry(n),o):{polygon:this.bufferedScreenGeometry(n).map(f=>o.pointCoordinate3D(f)),unwrapped:!0},this._screenRaycastCache[h]=d,d}}_bufferedCameraMercator(n,o){const h=Dn(n);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let d;return d="globe"===o.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),o):{polygon:this.bufferedCameraGeometry(n).map(f=>o.pointCoordinate3D(f)),unwrapped:!0},this._cameraRaycastCache[h]=d,d}}_projectAndResample(n,o){const h=function(f,y){const x=a.multiply([],y.pixelMatrix,y.globeMatrix),b=[0,-a.GLOBE_RADIUS,0,1],M=[0,a.GLOBE_RADIUS,0,1],E=[0,0,0,1];a.transformMat4$1(b,b,x),a.transformMat4$1(M,M,x),a.transformMat4$1(E,E,x);const z=new a.pointGeometry(b[0]/b[3],b[1]/b[3]),P=new a.pointGeometry(M[0]/M[3],M[1]/M[3]),U=a.polygonContainsPoint(f,z)&&b[3]<E[3],F=a.polygonContainsPoint(f,P)&&M[3]<E[3];if(!U&&!F)return null;const Z=function(re,me,de){for(let oe=1;oe<re.length;oe++){const Oe=Ui(me.pointCoordinate3D(re[oe-1]).x),he=Ui(me.pointCoordinate3D(re[oe]).x);if(de<0){if(Oe<he)return{idx:oe,t:-Oe/(he-1-Oe)}}else if(he<Oe)return{idx:oe,t:(1-Oe)/(he+1-Oe)}}return null}(f,y,U?-1:1);if(!Z)return null;const{idx:O,t:R}=Z;let q=O>1?kn(f.slice(0,O),y):[],N=O<f.length?kn(f.slice(O),y):[];q=q.map(re=>new a.pointGeometry(Ui(re.x),re.y)),N=N.map(re=>new a.pointGeometry(Ui(re.x),re.y));const H=[...q];0===H.length&&H.push(N[N.length-1]);const te=a.number(H[H.length-1].y,(0===N.length?q[0]:N[0]).y,R);let Q;return Q=U?[new a.pointGeometry(0,te),new a.pointGeometry(0,0),new a.pointGeometry(1,0),new a.pointGeometry(1,te)]:[new a.pointGeometry(1,te),new a.pointGeometry(1,1),new a.pointGeometry(0,1),new a.pointGeometry(0,te)],H.push(...Q),0===N.length?H.push(q[0]):H.push(...N),{polygon:H.map(re=>new a.MercatorCoordinate(re.x,re.y)),unwrapped:!1}}(n,o);if(h)return h;const d=function(f,y){let x=!1,b=-1/0,M=0;for(let z=0;z<f.length-1;z++)f[z].x>b&&(b=f[z].x,M=z);for(let z=0;z<f.length-1;z++){const P=(M+z)%(f.length-1),U=f[P],F=f[P+1];Math.abs(U.x-F.x)>.5&&(U.x<F.x?(U.x+=1,0===P&&(f[f.length-1].x+=1)):(F.x+=1,P+1===f.length-1&&(f[0].x+=1)),x=!0)}const E=a.mercatorXfromLng(y.center.lng);return x&&E<Math.abs(E-1)&&f.forEach(z=>{z.x-=1}),{polygon:f,unwrapped:x}}(kn(n,o).map(f=>new a.pointGeometry(Ui(f.x),f.y)),o);return{polygon:d.polygon.map(f=>new a.MercatorCoordinate(f.x,f.y)),unwrapped:d.unwrapped}}}function kn(l,n){return a.resample(l,o=>{const h=n.pointCoordinate3D(o);o.x=h.x,o.y=h.y},1/256)}function Ui(l){return l<0?1+l%1:l%1}function Dn(l){return 100*l|0}function Yr(l,n,o,h,d){const f=function(y,x){if(y)return d(y);if(x){l.url&&x.tiles&&l.tiles&&delete l.tiles;const b=a.pick(a.extend(x,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(b.vectorLayers=x.vector_layers,b.vectorLayerIds=b.vectorLayers.map(M=>M.id)),b.tiles=n.canonicalizeTileset(b,l.url),d(null,b)}};return l.url?a.getJSON(n.transformRequest(n.normalizeSourceURL(l.url,null,o,h),a.ResourceType.Source),f):a.exported.frame(()=>f(null,l))}class Zi{constructor(n,o,h){this.bounds=a.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const o=Math.pow(2,n.z),h=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*o),d=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*o),f=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*o),y=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*o);return n.x>=h&&n.x<f&&n.y>=d&&n.y<y}}class So{constructor(n,o,h){this.context=n;const d=n.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ti={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qi{constructor(n,o,h,d){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=d,this.context=n;const f=n.gl;this.buffer=f.createBuffer(),n.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,o){for(let h=0;h<this.attributes.length;h++){const d=o.attributes[this.attributes[h].name];void 0!==d&&n.enableVertexAttribArray(d)}}setVertexAttribPointers(n,o,h){for(let d=0;d<this.attributes.length;d++){const f=this.attributes[d],y=o.attributes[f.name];void 0!==y&&n.vertexAttribPointer(y,f.components,n[ti[f.type]],!1,this.itemSize,f.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Mt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class en extends Mt{getDefault(){return a.Color.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class tn extends Mt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class En extends Mt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class vr extends Mt{getDefault(){return[!0,!0,!0,!0]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Jr extends Mt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Pn extends Mt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class br extends Mt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const o=this.current;(n.func!==o.func||n.ref!==o.ref||n.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Ti extends Mt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Ln extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=n,this.dirty=!1}}class wr extends Mt{getDefault(){return[0,1]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Kr extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=n,this.dirty=!1}}class Tr extends Mt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class On extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.BLEND):o.disable(o.BLEND),this.current=n,this.dirty=!1}}class Qr extends Mt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Er extends Mt{getDefault(){return a.Color.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ni extends Mt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class eo extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=n,this.dirty=!1}}class Rn extends Mt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Bn extends Mt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class Fn extends Mt{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class li extends Mt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Mr extends Mt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ot extends Mt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Mn extends Mt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Cr extends Mt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Ir extends Mt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class $i extends Mt{getDefault(){return null}set(n){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Un extends Mt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class zo extends Mt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Ar extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class rr extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Sr extends Mt{constructor(n,o){super(n),this.context=n,this.parent=o}getDefault(){return null}}class nn extends Sr{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Zn extends Sr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class to extends Zn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class G{constructor(n,o,h,d){this.context=n,this.width=o,this.height=h;const f=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new nn(n,f),d&&(this.depthAttachment=new Zn(n,f))}destroy(){const n=this.context.gl,o=this.colorAttachment.get();if(o&&n.deleteTexture(o),this.depthAttachment){const h=this.depthAttachment.get();h&&n.deleteRenderbuffer(h)}n.deleteFramebuffer(this.framebuffer)}}class S{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new en(this),this.clearDepth=new tn(this),this.clearStencil=new En(this),this.colorMask=new vr(this),this.depthMask=new Jr(this),this.stencilMask=new Pn(this),this.stencilFunc=new br(this),this.stencilOp=new Ti(this),this.stencilTest=new Ln(this),this.depthRange=new wr(this),this.depthTest=new Kr(this),this.depthFunc=new Tr(this),this.blend=new On(this),this.blendFunc=new Qr(this),this.blendColor=new Er(this),this.blendEquation=new Ni(this),this.cullFace=new eo(this),this.cullFaceSide=new Rn(this),this.frontFace=new Bn(this),this.program=new Fn(this),this.activeTexture=new li(this),this.viewport=new Mr(this),this.bindFramebuffer=new Ot(this),this.bindRenderbuffer=new Mn(this),this.bindTexture=new Cr(this),this.bindVertexBuffer=new Ir(this),this.bindElementBuffer=new $i(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Un(this),this.pixelStoreUnpack=new zo(this),this.pixelStoreUnpackPremultiplyAlpha=new Ar(this),this.pixelStoreUnpackFlipY=new rr(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,o){return new So(this,n,o)}createVertexBuffer(n,o,h){return new qi(this,n,o,h)}createRenderbuffer(n,o,h){const d=this.gl,f=d.createRenderbuffer();return this.bindRenderbuffer.set(f),d.renderbufferStorage(d.RENDERBUFFER,n,o,h),this.bindRenderbuffer.set(null),f}createFramebuffer(n,o,h){return new G(this,n,o,h)}clear({color:n,depth:o,stencil:h}){const d=this.gl;let f=0;n&&(f|=d.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==o&&(f|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),void 0!==h&&(f|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),d.clear(f)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){Se(n.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class D extends a.Evented{constructor(n,o,h,d){super(),this.id=n,this.dispatcher=h,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},o),a.extend(this,a.pick(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yr(this._options,this.map._requestManager,null,null,(n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):o&&(a.extend(this,o),o.bounds&&(this.tileBounds=new Zi(o.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(o.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,o){const h=a.exported.devicePixelRatio>=2,d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);n.request=a.getImage(this.map._requestManager.transformRequest(d,a.ResourceType.Tile),(f,y,x,b)=>(delete n.request,n.aborted?(n.state="unloaded",o(null)):f?(n.state="errored",o(f)):y?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:x,expires:b}),n.setTexture(y,this.map.painter),n.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(n,o,h){n.setTexture(o,h)}static unloadTileData(n,o){n.texture&&o.saveTileTexture(n.texture)}abortTile(n,o){n.request&&(n.request.cancel(),delete n.request),o()}unloadTile(n,o){n.texture&&this.map.painter.saveTileTexture(n.texture),o()}hasTransition(){return!1}}let V;function X(l,n,o,h,d,f,y,x){const b=[l,o,d,n,h,f,1,1,1],M=[y,x,1],E=a.adjoint([],b),[z,P,U]=a.transformMat3(M,M,a.transpose(E,E));return a.multiply$1(b,[z,0,0,0,P,0,0,0,U],b)}class ie extends a.Evented{constructor(n,o,h,d){super(),this.id=n,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=o,this._dirty=!1}load(n,o){this._loaded=o||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(h,d)=>{if(this._imageRequest=null,this._loaded=!0,h)this.fire(new a.ErrorEvent(h));else if(d){const{HTMLImageElement:f}=a.window;this.image=d instanceof f?a.exported.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const o=n.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(h){let d=1/0,f=1/0,y=-1/0,x=-1/0;for(const z of h)d=Math.min(d,z.x),f=Math.min(f,z.y),y=Math.max(y,z.x),x=Math.max(x,z.y);const b=Math.max(y-d,x-f),M=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),E=Math.pow(2,M);return new a.CanonicalTileID(M,Math.floor((d+y)/2*E),Math.floor((f+x)/2*E))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const b in this.tiles){const M=this.tiles[b];"loaded"!==M.state&&(M.state="loaded",M.texture=this.texture)}if(this._boundsArray)return;const o=a.tileTransform(this.tileID,this.map.transform.projection),[h,d,f,y]=this.coordinates.map(b=>{const M=o.projection.project(b[0],b[1]);return a.getTilePoint(o,M)._round()});this.perspectiveTransform=function(b,M,E,z,P,U,F,Z,O,R){const q=X(0,0,b,0,0,M,b,M),N=X(E,z,P,U,F,Z,O,R);return a.multiply$1(N,a.adjoint(q,q),N),[N[6]/N[8]*b/a.EXTENT,N[7]/N[8]*M/a.EXTENT]}(this.width,this.height,h.x,h.y,d.x,d.y,y.x,y.y,f.x,f.y);const x=this._boundsArray=new a.StructArrayLayout4i8;x.emplaceBack(h.x,h.y,0,0),x.emplaceBack(d.x,d.y,a.EXTENT,0),x.emplaceBack(y.x,y.y,0,a.EXTENT),x.emplaceBack(f.x,f.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(x,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,o=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(n,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const le={vector:class extends a.Evented{constructor(l,n,o,h){if(super(),this.id=l,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(n,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(l){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=Yr(this._options,this.map._requestManager,n,o,(h,d)=>{this._tileJSONRequest=null,this._loaded=!0,h?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),o&&2!==o.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new a.ErrorEvent(h))):d&&(a.extend(this,d),d.bounds&&(this.tileBounds=new Zi(d.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(d.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(h)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const l=this.map.style._getSourceCaches(this.id);for(const n of l)n.clearTiles()})}setSourceProperty(l){l(),this.reload()}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(l,n){const o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(o,a.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(h.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state)"loading"===l.state?l.reloadCallback=n:l.request=l.actor.send("reloadTile",h,d.bind(this));else if(l.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",h,d.bind(this),void 0,!0);else{const f=a.loadVectorTile.call({deduped:this._deduped},h,(y,x)=>{y||!x?d.call(this,y):(h.data={cacheControl:x.cacheControl,expires:x.expires,rawData:x.rawData.slice(0)},l.actor&&l.actor.send("loadTile",h,d.bind(this),void 0,!0))},!0);l.request={cancel:f}}function d(f,y){return delete l.request,l.aborted?n(null):f&&404!==f.status?n(f):(y&&y.resourceTiming&&(l.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&l.setExpiryData(y),l.loadVectorData(y,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:D,"raster-dem":class extends D{constructor(l,n,o,h){super(l,n,o,h),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(l,n){const o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(d,f){d&&(l.state="errored",n(d)),f&&(l.dem=f,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",n(null))}l.request=a.getImage(this.map._requestManager.transformRequest(o,a.ResourceType.Tile),function(d,f,y,x){if(delete l.request,l.aborted)l.state="unloaded",n(null);else if(d)l.state="errored",n(d);else if(f){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:y,expires:x});const b=a.window.ImageBitmap&&f instanceof a.window.ImageBitmap&&(null==V&&(V=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.window.createImageBitmap),V),M=1-(f.width-a.prevPowerOfTwo(f.width))/2;M<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const E=b?f:a.exported.getImageData(f,M),z={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:E,encoding:this.encoding,padding:M};l.actor&&"expired"!==l.state||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",z,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const n=l.canonical,o=Math.pow(2,n.z),h=(n.x-1+o)%o,d=0===n.x?l.wrap-1:l.wrap,f=(n.x+1+o)%o,y=n.x+1===o?l.wrap+1:l.wrap,x={};return x[new a.OverscaledTileID(l.overscaledZ,d,n.z,h,n.y).key]={backfilled:!1},x[new a.OverscaledTileID(l.overscaledZ,y,n.z,f,n.y).key]={backfilled:!1},n.y>0&&(x[new a.OverscaledTileID(l.overscaledZ,d,n.z,h,n.y-1).key]={backfilled:!1},x[new a.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},x[new a.OverscaledTileID(l.overscaledZ,y,n.z,f,n.y-1).key]={backfilled:!1}),n.y+1<o&&(x[new a.OverscaledTileID(l.overscaledZ,d,n.z,h,n.y+1).key]={backfilled:!1},x[new a.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},x[new a.OverscaledTileID(l.overscaledZ,y,n.z,f,n.y+1).key]={backfilled:!1}),x}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends a.Evented{constructor(l,n,o,h){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(h),this._data=n.data,this._options=a.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*d,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*d,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},n),this}getClusterChildren(l,n){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},n),this}getClusterLeaves(l,n,o,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:n,offset:o},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const l=a.extend({},this.workerOptions),n=this._data;"string"==typeof n?(l.request=this.map._requestManager.transformRequest(a.exported.resolveURL(n),a.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(o,h)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new a.ErrorEvent(o));else{const d={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(d.resourceTiming=h.resourceTiming[this.id]),this.fire(new a.Event("data",d)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,n){const o=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(o,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,d)=>(delete l.request,l.unloadVectorData(),l.aborted?n(null):h?n(h):(l.loadVectorData(d,this.map.painter,"reloadTile"===o),n(null))),void 0,"loadTile"===o)}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ie{constructor(l,n,o,h){super(l,n,o,h),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const n of l.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.ResourceType.Source).url);a.getVideo(this.urls,(n,o)=>{this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const n=this.video.seekable;l<n.start(0)||l>n.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const l=this.map.painter.context,n=l.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(l,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ie,canvas:class extends ie{constructor(l,n,o,h){super(l,n,o,h),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(d=>!Array.isArray(d)||2!==d.length||d.some(f=>"number"!=typeof f))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends a.Evented{constructor(l,n,o,h){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=n,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Zi(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this._map=l,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:n,y:o,z:h}=l.canonical;return this._implementation.hasTile({x:n,y:o,z:h})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,n){const{x:o,y:h,z:d}=l.tileID.canonical,f=new a.window.AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:o,y:h,z:d},{signal:f.signal})).then(function(y){return delete l.request,l.aborted?(l.state="unloaded",n(null)):void 0===y?(l.state="errored",n(null)):null===y?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",n(null)):(x=y)instanceof a.window.ImageData||x instanceof a.window.HTMLCanvasElement||x instanceof a.window.ImageBitmap||x instanceof a.window.HTMLImageElement?(this.loadTileData(l,y),l.state="loaded",void n(null)):(l.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var x}.bind(this)).catch(y=>{20!==y.code&&(l.state="errored",n(y))}),l.request.cancel=()=>f.abort()}loadTileData(l,n){D.loadTileData(l,n,this._map.painter)}unloadTileData(l){D.unloadTileData(l,this._map.painter)}unloadTile(l,n){if(this.unloadTileData(l),this._implementation.unloadTile){const{x:o,y:h,z:d}=l.tileID.canonical;this._implementation.unloadTile({x:o,y:h,z:d})}n()}abortTile(l,n){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ae=function(l,n,o,h){const d=new le[n.type](l,n,o,h);if(d.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${d.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],d),d};function ne(l,n){const o=a.identity([]);return a.scale(o,o,[.5*l.width,.5*-l.height,1]),a.translate(o,o,[1,-1,0]),a.multiply(o,o,l.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(o)}function ue(l,n,o,h,d,f,y,x=!1){const b=l.tilesIn(h,y,x);b.sort(Ze);const M=[];for(const z of b)M.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(n,o,l._state,z,d,f,ne(l.transform,z.tile.tileID),x)});const E=function(z){const P={},U={};for(const F of z){const Z=F.queryResults,O=F.wrappedTileID,R=U[O]=U[O]||{};for(const q in Z){const N=Z[q],H=R[q]=R[q]||{},te=P[q]=P[q]||[];for(const Q of N)H[Q.featureIndex]||(H[Q.featureIndex]=!0,te.push(Q))}}return P}(M);for(const z in E)E[z].forEach(P=>{const U=P.feature,F=U.layer;F&&"background"!==F.type&&"sky"!==F.type&&(U.source=F.source,F["source-layer"]&&(U.sourceLayer=F["source-layer"]),U.state=void 0!==U.id?l.getFeatureState(F["source-layer"],U.id):{})});return E}function Ce(l,n){const o=l.getRenderableIds().map(f=>l.getTileByID(f)),h=[],d={};for(let f=0;f<o.length;f++){const y=o[f],x=y.tileID.canonical.key;d[x]||(d[x]=!0,y.querySourceFeatures(h,n))}return h}function Ze(l,n){const o=l.tileID,h=n.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}function ke(){return null!=Cs.workerClass?new Cs.workerClass:new a.window.Worker(Cs.workerUrl)}const tt="mapboxgl_preloaded_worker_pool";class Ke{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Ke.workerCount;)this.workers.push(new ke);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[tt]}numActive(){return Object.keys(this.active).length}}let Je;function ot(){return Je||(Je=new Ke),Je}function ft(l,n){const o={};for(const h in l)"ref"!==h&&(o[h]=l[h]);return a.refProperties.forEach(h=>{h in n&&(o[h]=n[h])}),o}function ct(l){l=l.slice();const n=Object.create(null);for(let o=0;o<l.length;o++)n[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=ft(l[o],n[l[o].ref]));return l}Ke.workerCount=2;const We={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ct(l,n,o){o.push({command:We.addSource,args:[l,n[l]]})}function jt(l,n,o){n.push({command:We.removeSource,args:[l]}),o[l]=!0}function Ei(l,n,o,h){jt(l,o,h),Ct(l,n,o)}function ki(l,n,o){let h;for(h in l[o])if(l[o].hasOwnProperty(h)&&"data"!==h&&!Se(l[o][h],n[o][h]))return!1;for(h in n[o])if(n[o].hasOwnProperty(h)&&"data"!==h&&!Se(l[o][h],n[o][h]))return!1;return!0}function Ut(l,n,o,h,d,f){let y;for(y in n=n||{},l=l||{})l.hasOwnProperty(y)&&(Se(l[y],n[y])||o.push({command:f,args:[h,y,n[y],d]}));for(y in n)n.hasOwnProperty(y)&&!l.hasOwnProperty(y)&&(Se(l[y],n[y])||o.push({command:f,args:[h,y,n[y],d]}))}function be(l){return l.id}function pi(l,n){return l[n.id]=n,l}class ii{constructor(n,o){this.reset(n,o)}reset(n,o){this.points=n||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=a.clamp(n,0,1);let o=1,h=this._distances[o];const d=n*this.paddedLength+this.padding;for(;h<d&&o<this._distances.length;)h=this._distances[++o];const f=o-1,y=this._distances[f],x=h-y,b=x>0?(d-y)/x:0;return this.points[f].mult(1-b).add(this.points[o].mult(b))}}class un{constructor(n,o,h){const d=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(n/h),this.yCellCount=Math.ceil(o/h);for(let y=0;y<this.xCellCount*this.yCellCount;y++)d.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=o,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,o,h,d,f){this._forEachCell(o,h,d,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(f)}insertCircle(n,o,h,d){this._forEachCell(o-d,h-d,o+d,h+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(o),this.circles.push(h),this.circles.push(d)}_insertBoxCell(n,o,h,d,f,y){this.boxCells[f].push(y)}_insertCircleCell(n,o,h,d,f,y){this.circleCells[f].push(y)}_query(n,o,h,d,f,y){if(h<0||n>this.width||d<0||o>this.height)return!f&&[];const x=[];if(n<=0&&o<=0&&this.width<=h&&this.height<=d){if(f)return!0;for(let b=0;b<this.boxKeys.length;b++)x.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const M=this.circles[3*b],E=this.circles[3*b+1],z=this.circles[3*b+2];x.push({key:this.circleKeys[b],x1:M-z,y1:E-z,x2:M+z,y2:E+z})}return y?x.filter(y):x}return this._forEachCell(n,o,h,d,this._queryCell,x,{hitTest:f,seenUids:{box:{},circle:{}}},y),f?x.length>0:x}_queryCircle(n,o,h,d,f){const y=n-h,x=n+h,b=o-h,M=o+h;if(x<0||y>this.width||M<0||b>this.height)return!d&&[];const E=[];return this._forEachCell(y,b,x,M,this._queryCellCircle,E,{hitTest:d,circle:{x:n,y:o,radius:h},seenUids:{box:{},circle:{}}},f),d?E.length>0:E}query(n,o,h,d,f){return this._query(n,o,h,d,!1,f)}hitTest(n,o,h,d,f){return this._query(n,o,h,d,!0,f)}hitTestCircle(n,o,h,d){return this._queryCircle(n,o,h,!0,d)}_queryCell(n,o,h,d,f,y,x,b){const M=x.seenUids,E=this.boxCells[f];if(null!==E){const P=this.bboxes;for(const U of E)if(!M.box[U]){M.box[U]=!0;const F=4*U;if(n<=P[F+2]&&o<=P[F+3]&&h>=P[F+0]&&d>=P[F+1]&&(!b||b(this.boxKeys[U]))){if(x.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[U],x1:P[F],y1:P[F+1],x2:P[F+2],y2:P[F+3]})}}}const z=this.circleCells[f];if(null!==z){const P=this.circles;for(const U of z)if(!M.circle[U]){M.circle[U]=!0;const F=3*U;if(this._circleAndRectCollide(P[F],P[F+1],P[F+2],n,o,h,d)&&(!b||b(this.circleKeys[U]))){if(x.hitTest)return y.push(!0),!0;{const Z=P[F],O=P[F+1],R=P[F+2];y.push({key:this.circleKeys[U],x1:Z-R,y1:O-R,x2:Z+R,y2:O+R})}}}}}_queryCellCircle(n,o,h,d,f,y,x,b){const M=x.circle,E=x.seenUids,z=this.boxCells[f];if(null!==z){const U=this.bboxes;for(const F of z)if(!E.box[F]){E.box[F]=!0;const Z=4*F;if(this._circleAndRectCollide(M.x,M.y,M.radius,U[Z+0],U[Z+1],U[Z+2],U[Z+3])&&(!b||b(this.boxKeys[F])))return y.push(!0),!0}}const P=this.circleCells[f];if(null!==P){const U=this.circles;for(const F of P)if(!E.circle[F]){E.circle[F]=!0;const Z=3*F;if(this._circlesCollide(U[Z],U[Z+1],U[Z+2],M.x,M.y,M.radius)&&(!b||b(this.circleKeys[F])))return y.push(!0),!0}}}_forEachCell(n,o,h,d,f,y,x,b){const M=this._convertToXCellCoord(n),E=this._convertToYCellCoord(o),z=this._convertToXCellCoord(h),P=this._convertToYCellCoord(d);for(let U=M;U<=z;U++)for(let F=E;F<=P;F++)if(f.call(this,n,o,h,d,this.xCellCount*F+U,y,x,b))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,o,h,d,f,y){const x=d-n,b=f-o,M=h+y;return M*M>x*x+b*b}_circleAndRectCollide(n,o,h,d,f,y,x){const b=(y-d)/2,M=Math.abs(n-(d+b));if(M>b+h)return!1;const E=(x-f)/2,z=Math.abs(o-(f+E));if(z>E+h)return!1;if(M<=b||z<=E)return!0;const P=M-b,U=z-E;return P*P+U*U<=h*h}}const Ns=Math.tan(85*Math.PI/180);function Ht(l,n,o,h,d,f,y){const x=a.create();if(o)if("globe"===f.name){const b=a.calculateGlobeLabelMatrix(d,n);a.multiply(x,x,b)}else{const b=vt([],y);x[0]=b[0],x[1]=b[1],x[4]=b[2],x[5]=b[3],h||a.rotateZ(x,x,d.angle)}else a.multiply(x,d.labelPlaneMatrix,l);return x}function ko(l,n,o,h,d,f,y){const x=Ht(l,n,o,h,d,f,y);return"globe"===f.name&&o||(x[2]=x[6]=x[10]=x[14]=0),x}function os(l,n,o,h,d,f,y){if(o){if("globe"===f.name){const x=Ht(l,n,o,h,d,f,y);return a.invert(x,x),a.multiply(x,l,x),x}{const x=a.clone(l),b=a.identity([]);return b[0]=y[0],b[1]=y[1],b[4]=y[2],b[5]=y[3],a.multiply(x,x,b),h||a.rotateZ(x,x,-d.angle),x}}return d.glCoordMatrix}function vi(l,n,o,h){const d=[l,n,o,1];o?a.transformMat4$1(d,d,h):Qt(d,d,h);const f=d[3];return d[0]/=f,d[1]/=f,d[2]/=f,d}function Ne(l,n){return Math.min(.5+l/n*.5,1.5)}function bt(l,n){const o=l[0]/l[3],h=l[1]/l[3];return o>=-n[0]&&o<=n[0]&&h>=-n[1]&&h<=n[1]}function gt(l,n,o,h,d,f,y,x,b,M){const E=o.transform,z=h?l.textSizeData:l.iconSizeData,P=a.evaluateSizeForZoom(z,o.transform.zoom),U="globe"===E.projection.name,F=[256/o.width*2+1,256/o.height*2+1],Z=h?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;Z.clear();let O=null;U&&(O=h?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const R=l.lineVertexArray,q=h?l.text.placedSymbolArray:l.icon.placedSymbolArray,N=o.transform.width/o.transform.height;let H,te=!1;for(let Q=0;Q<q.length;Q++){const re=q.get(Q),{numGlyphs:me,writingMode:de}=re;if(de!==a.WritingMode.vertical||te||H===a.WritingMode.horizontal||(te=!0),H=de,(re.hidden||de===a.WritingMode.vertical)&&!te){bi(me,Z);continue}te=!1;const oe=new a.pointGeometry(re.tileAnchorX,re.tileAnchorY);let{x:Oe,y:he,z:Te}=E.projection.projectTilePoint(oe.x,oe.y,M.canonical);if(b){const[Qe,He,st]=b(oe);Oe+=Qe,he+=He,Te+=st}const ge=[Oe,he,Te,1];if(a.transformMat4$1(ge,ge,n),!bt(ge,F)){bi(me,Z);continue}const De=Ne(o.transform.cameraToCenterDistance,ge[3]),ve=a.evaluateSizeForFeature(z,P,re),Ie=y?ve/De:ve*De,Re=vi(Oe,he,Te,d);if(Re[3]<=0){bi(me,Z);continue}let se={};const _e=y?null:b,Xe=mt(re,Ie,!1,x,n,d,f,l.glyphOffsetArray,R,Z,O,Re,oe,se,N,_e,E.projection,M,y);te=Xe.useVertical,_e&&Xe.needsFlipping&&(se={}),(Xe.notEnoughRoom||te||Xe.needsFlipping&&mt(re,Ie,!0,x,n,d,f,l.glyphOffsetArray,R,Z,O,Re,oe,se,N,_e,E.projection,M,y).notEnoughRoom)&&bi(me,Z)}h?(l.text.dynamicLayoutVertexBuffer.updateData(Z),O&&l.text.globeExtVertexBuffer.updateData(O)):(l.icon.dynamicLayoutVertexBuffer.updateData(Z),O&&l.icon.globeExtVertexBuffer.updateData(O))}function rn(l,n,o,h,d,f,y,x,b,M,E,z,P,U,F,Z){const{lineStartIndex:O,glyphStartIndex:R,segment:q}=x,N=R+x.numGlyphs,H=O+x.lineLength,te=n.getoffsetX(R),Q=n.getoffsetX(N-1),re=Nn(l*te,o,h,d,f,y,q,O,H,b,M,E,z,P,!0,U,F,Z);if(!re)return null;const me=Nn(l*Q,o,h,d,f,y,q,O,H,b,M,E,z,P,!0,U,F,Z);return me?{first:re,last:me}:null}function or(l,n,o,h){return l===a.WritingMode.horizontal&&Math.abs(h)>Math.abs(o)?{useVertical:!0}:l===a.WritingMode.vertical?h>0?{needsFlipping:!0}:null:0!==n&&(0===(d=o)||Math.abs(h/d)>Ns)?1===n?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null;var d}function mt(l,n,o,h,d,f,y,x,b,M,E,z,P,U,F,Z,O,R,q){const N=n/24,H=l.lineOffsetX*N,te=l.lineOffsetY*N,{lineStartIndex:Q,glyphStartIndex:re,numGlyphs:me,segment:de,writingMode:oe,flipState:Oe}=l,he=Q+l.lineLength,Te=ge=>{if(E){const[Re,se,_e]=ge.up,Xe=M.length;a.updateGlobeVertexNormal(E,Xe+0,Re,se,_e),a.updateGlobeVertexNormal(E,Xe+1,Re,se,_e),a.updateGlobeVertexNormal(E,Xe+2,Re,se,_e),a.updateGlobeVertexNormal(E,Xe+3,Re,se,_e)}const[De,ve,Ie]=ge.point;a.addDynamicAttributes(M,De,ve,Ie,ge.angle)};if(me>1){const ge=rn(N,x,H,te,o,z,P,l,b,f,U,Z,!1,O,R,q);if(!ge)return{notEnoughRoom:!0};if(h&&!o){let[De,ve,Ie]=ge.first.point,[Re,se,_e]=ge.last.point;[De,ve]=vi(De,ve,Ie,y),[Re,se]=vi(Re,se,_e,y);const Xe=or(oe,Oe,(Re-De)*F,se-ve);if(l.flipState=Xe&&Xe.needsFlipping?1:2,Xe)return Xe}Te(ge.first);for(let De=re+1;De<re+me-1;De++){const ve=Nn(N*x.getoffsetX(De),H,te,o,z,P,de,Q,he,b,f,U,Z,!1,!1,O,R,q);if(!ve)return M.length-=4*(De-re),{notEnoughRoom:!0};Te(ve)}Te(ge.last)}else{if(h&&!o){const De=vi(P.x,P.y,0,d),ve=Q+de+1,Ie=new a.pointGeometry(b.getx(ve),b.gety(ve)),Re=vi(Ie.x,Ie.y,0,d),se=Re[3]>0?Re:sr(P,Ie,De,1,d,void 0,O,R.canonical),_e=or(oe,Oe,(se[0]-De[0])*F,se[1]-De[1]);if(l.flipState=_e&&_e.needsFlipping?1:2,_e)return _e}const ge=Nn(N*x.getoffsetX(re),H,te,o,z,P,de,Q,he,b,f,U,Z,!1,!1,O,R,q);if(!ge)return{notEnoughRoom:!0};Te(ge)}return{}}function io(l,n,o,h,d){const{x:f,y,z:x}=h.projectTilePoint(l.x,l.y,n);if(!d)return vi(f,y,x,o);const[b,M,E]=d(l);return vi(f+b,y+M,x+E,o)}function sr(l,n,o,h,d,f,y,x){const b=io(l.sub(n)._unit()._add(l),x,d,y,f);return a.sub(b,o,b),a.normalize(b,b),a.scaleAndAdd(b,o,b,h)}function Nn(l,n,o,h,d,f,y,x,b,M,E,z,P,U,F,Z,O,R){const q=h?l-n:l+n;let N=q>0?1:-1,H=0;h&&(N*=-1,H=Math.PI),N<0&&(H+=Math.PI);let te=x+y+(N>0?0:1)|0,Q=d,re=d,me=0,de=0;const oe=Math.abs(q),Oe=[],he=[];let Te=f,ge=Te;const De=()=>sr(ge,Te,re,oe-me+1,E,P,Z,O.canonical);for(;me+de<=oe;){if(te+=N,te<x||te>=b)return null;if(re=Q,ge=Te,Oe.push(re),U&&he.push(ge),Te=new a.pointGeometry(M.getx(te),M.gety(te)),Q=z[te],!Q){const st=io(Te,O.canonical,E,Z,P);Q=st[3]>0?z[te]=st:De()}me+=de,de=a.distance(re,Q)}F&&P&&(z[te]&&(Q=De(),de=a.distance(re,Q)),z[te]=Q);const ve=(oe-me)/de,Ie=Te.sub(ge)._mult(ve)._add(ge),Re=a.sub([],Q,re),se=a.scaleAndAdd([],re,Re,ve);let _e=[0,0,1],Xe=Re[0],Qe=Re[1];if(R&&(_e=Z.upVector(O.canonical,Ie.x,Ie.y),0!==_e[0]||0!==_e[1]||1!==_e[2])){const st=[_e[2],0,-_e[0]],dt=a.cross([],_e,st);a.normalize(st,st),a.normalize(dt,dt),Xe=a.dot(Re,st),Qe=a.dot(Re,dt)}if(o){const st=a.cross([],_e,Re);a.normalize(st,st),a.scaleAndAdd(se,se,st,o*N)}const He=H+Math.atan2(Qe,Xe);return Oe.push(se),U&&he.push(Ie),{point:se,angle:He,path:Oe,tilePath:he,up:_e}}function bi(l,n){const o=n.length,h=o+4*l;n.resize(h),n.float32.fill(-1/0,4*o,4*h)}function Qt(l,n,o){const h=n[0],d=n[1];return l[0]=o[0]*h+o[4]*d+o[12],l[1]=o[1]*h+o[5]*d+o[13],l[3]=o[3]*h+o[7]*d+o[15],l}const dn=100;class no{constructor(n,o,h=new un(n.width+200,n.height+200,25),d=new un(n.width+200,n.height+200,25)){this.transform=n,this.grid=h,this.ignoredGrid=d,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+dn,this.screenBottomBoundary=n.height+dn,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=o}placeCollisionBox(n,o,h,d,f,y,x,b){let M=h.projectedAnchorX,E=h.projectedAnchorY,z=h.projectedAnchorZ;const P=h.elevation,U=h.tileID,F=n.getProjection();if(P&&U){const[Q,re,me]=F.upVector(U.canonical,h.tileAnchorX,h.tileAnchorY),de=F.upVectorScale(U.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;M+=Q*P*de,E+=re*P*de,z+=me*P*de}const Z=this.projectAndGetPerspectiveRatio(x,M,E,z,h.tileID,"globe"===F.name||!!P||this.transform.pitch>0,F),O=y*Z.perspectiveRatio,R=(h.x1*o+d.x-h.padding)*O+Z.point.x,q=(h.y1*o+d.y-h.padding)*O+Z.point.y,N=(h.x2*o+d.x+h.padding)*O+Z.point.x,H=(h.y2*o+d.y+h.padding)*O+Z.point.y,te=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(R,q,N,H)||!f&&this.grid.hitTest(R,q,N,H,b)||te?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[R,q,N,H],offscreen:this.isOffscreen(R,q,N,H),occluded:!1}}placeCollisionCircles(n,o,h,d,f,y,x,b,M,E,z,P,U,F,Z){const O=[],R=this.transform.elevation,q=n.getProjection(),N=R?R.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,q):null,H=new a.pointGeometry(h.tileAnchorX,h.tileAnchorY);let{x:te,y:Q,z:re}=q.projectTilePoint(H.x,H.y,Z.canonical);if(N){const[Ie,Re,se]=N(H);te+=Ie,Q+=Re,re+=se}const me="globe"===q.name,de=this.projectAndGetPerspectiveRatio(x,te,Q,re,Z,me||!!R||this.transform.pitch>0,q),{perspectiveRatio:oe}=de,Oe=(z?y/oe:y*oe)/a.ONE_EM,he=vi(te,Q,re,b),Te=de.signedDistanceFromCamera>0?rn(Oe,f,h.lineOffsetX*Oe,h.lineOffsetY*Oe,!1,he,H,h,d,b,{},R&&!z?N:null,z&&!!R,q,Z,z):null;let ge=!1,De=!1,ve=!0;if(Te&&!de.occluded){const Ie=.5*U*oe+F,Re=new a.pointGeometry(-100,-100),se=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),_e=new ii,{first:Xe,last:Qe}=Te,He=Xe.path.length;let st=[];for(let qe=He-1;qe>=1;qe--)st.push(Xe.path[qe]);for(let qe=1;qe<Qe.path.length;qe++)st.push(Qe.path[qe]);const dt=2.5*Ie;M&&(st=st.map(([qe,Rt,kt],Gt)=>(N&&!me&&(kt=N(Gt<He-1?Xe.tilePath[He-1-Gt]:Qe.tilePath[Gt-He+2])[2]),vi(qe,Rt,kt,M))),st.some(qe=>qe[3]<=0)&&(st=[]));let et=[];if(st.length>0){let qe=1/0,Rt=-1/0,kt=1/0,Gt=-1/0;for(const Zt of st)qe=Math.min(qe,Zt[0]),kt=Math.min(kt,Zt[1]),Rt=Math.max(Rt,Zt[0]),Gt=Math.max(Gt,Zt[1]);Rt>=Re.x&&qe<=se.x&&Gt>=Re.y&&kt<=se.y&&(et=[st.map(Zt=>new a.pointGeometry(Zt[0],Zt[1]))],(qe<Re.x||Rt>se.x||kt<Re.y||Gt>se.y)&&(et=a.clipLine(et,Re.x,Re.y,se.x,se.y)))}for(const qe of et){_e.reset(qe,.25*Ie);let Rt=0;Rt=_e.length<=.5*Ie?1:Math.ceil(_e.paddedLength/dt)+1;for(let kt=0;kt<Rt;kt++){const Gt=kt/Math.max(Rt-1,1),Zt=_e.lerp(Gt),Xi=Zt.x+dn,an=Zt.y+dn;O.push(Xi,an,Ie,0);const Vi=Xi-Ie,$n=an-Ie,Yt=Xi+Ie,qt=an+Ie;if(ve=ve&&this.isOffscreen(Vi,$n,Yt,qt),De=De||this.isInsideGrid(Vi,$n,Yt,qt),!o&&this.grid.hitTestCircle(Xi,an,Ie,P)&&(ge=!0,!E))return{circles:[],offscreen:!1,collisionDetected:ge,occluded:!1}}}}return{circles:!E&&ge||!De?[]:O,offscreen:ve,collisionDetected:ge,occluded:de.occluded}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const o=[];let h=1/0,d=1/0,f=-1/0,y=-1/0;for(const E of n){const z=new a.pointGeometry(E.x+dn,E.y+dn);h=Math.min(h,z.x),d=Math.min(d,z.y),f=Math.max(f,z.x),y=Math.max(y,z.y),o.push(z)}const x=this.grid.query(h,d,f,y).concat(this.ignoredGrid.query(h,d,f,y)),b={},M={};for(const E of x){const z=E.key;if(void 0===b[z.bucketInstanceId]&&(b[z.bucketInstanceId]={}),b[z.bucketInstanceId][z.featureIndex])continue;const P=[new a.pointGeometry(E.x1,E.y1),new a.pointGeometry(E.x2,E.y1),new a.pointGeometry(E.x2,E.y2),new a.pointGeometry(E.x1,E.y2)];a.polygonIntersectsPolygon(o,P)&&(b[z.bucketInstanceId][z.featureIndex]=!0,void 0===M[z.bucketInstanceId]&&(M[z.bucketInstanceId]=[]),M[z.bucketInstanceId].push(z.featureIndex))}return M}insertCollisionBox(n,o,h,d,f){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:d,collisionGroupID:f},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,o,h,d,f){const y=o?this.ignoredGrid:this.grid,x={bucketInstanceId:h,featureIndex:d,collisionGroupID:f};for(let b=0;b<n.length;b+=4)y.insertCircle(x,n[b],n[b+1],n[b+2])}projectAndGetPerspectiveRatio(n,o,h,d,f,y,x){const b=[o,h,d,1];let M=!1;d||this.transform.pitch>0?(a.transformMat4$1(b,b,n),this.fogState&&f&&"globe"!==x.name&&(M=function(U,F,Z,O,R,q){const N=q.calculateFogTileMatrix(R),H=[F,Z,O];return a.transformMat4(H,H,N),zn(U,H,q.pitch,q._fov)}(this.fogState,o,h,d,f.toUnwrapped(),this.transform)>.9)):Qt(b,b,n);const E=b[3];return{point:new a.pointGeometry((b[0]/E+1)/2*this.transform.width+dn,(-b[1]/E+1)/2*this.transform.height+dn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(x)/E*.5,1.5),signedDistanceFromCamera:E,occluded:y&&b[2]>E||M}}isOffscreen(n,o,h,d){return h<dn||n>=this.screenRightBoundary||d<dn||o>this.screenBottomBoundary}isInsideGrid(n,o,h,d){return h>=0&&n<this.gridRightBoundary&&d>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const n=a.identity([]);return a.translate(n,n,[-100,-100,0]),n}}function ro(l,n,o){const h=n.createTileMatrix(l,l.worldSize,o.toUnwrapped());return a.multiply(new Float32Array(16),l.projMatrix,h)}function oo(l,n,o){if(n.projection.name===o.projection.name)return l.projMatrix;const h=o.clone();return h.setProjection(n.projection),ro(h,n.getProjection(),l)}function so(l,n,o){return n.name===o.projection.name?l.projMatrix:ro(o,n,l)}class ss{constructor(n,o,h,d){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?o:-o))):d&&h?1:0,this.placed=h}isHidden(){return 0===this.opacity&&!this.placed}}class ar{constructor(n,o,h,d,f,y=!1){this.text=new ss(n?n.text:null,o,h,f),this.icon=new ss(n?n.icon:null,o,d,f),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ao{constructor(n,o,h,d=!1){this.text=n,this.icon=o,this.skipFade=h,this.clipped=d}}class as{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Vs{constructor(n,o,h,d,f){this.bucketInstanceId=n,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=d,this.tileID=f}}class Di{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const o=++this.maxGroupID;this.collisionGroups[n]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[n]}}function ri(l,n,o,h,d){const{horizontalAlign:f,verticalAlign:y}=a.getAnchorAlignment(l),x=-(f-.5)*n,b=-(y-.5)*o,M=a.evaluateVariableOffset(l,h);return new a.pointGeometry(x+M[0]*d,b+M[1]*d)}function B(l,n,o,h,d){const f=new a.pointGeometry(l,n);return o&&f._rotate(h?d:-d),f}class Ae{constructor(n,o,h,d,f){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new no(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Di(h),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,o,h,d){const f=h.getBucket(o),y=h.latestFeatureIndex;if(!f||!y||o.id!==f.layerIds[0])return;const x=f.layers[0].layout,b=h.collisionBoxArray,M=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),E=h.tileSize/a.EXTENT,z=h.tileID.toUnwrapped();this.transform.setProjection(f.projection);const P=(U=h.tileID,F=f.getProjection(),Z=this.transform,F.name===this.projection?Z.calculateProjMatrix(U.toUnwrapped()):ro(Z,F,U));var U,F,Z;const O="map"===x.get("text-pitch-alignment"),R="map"===x.get("text-rotation-alignment");o.compileFilter();const q=o.dynamicFilter(),N=o.dynamicFilterNeedsFeature(),H=this.transform.calculatePixelsToTileUnitsMatrix(h),te=ko(P,h.tileID.canonical,O,R,this.transform,f.getProjection(),H);let Q=null;if(O){const de=os(P,h.tileID.canonical,O,R,this.transform,f.getProjection(),H);Q=a.multiply([],this.transform.labelPlaneMatrix,de)}let re=null;q&&h.latestFeatureIndex&&(re={unwrappedTileID:z,dynamicFilter:q,dynamicFilterNeedsFeature:N,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[f.bucketInstanceId]=new Vs(f.bucketInstanceId,y,f.sourceLayerIndex,f.index,h.tileID);const me={bucket:f,layout:x,posMatrix:P,textLabelPlaneMatrix:te,labelToScreenMatrix:Q,clippingData:re,scale:M,textPixelRatio:E,holdingForFade:h.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(f.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(f.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(d)for(const de of f.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:Oe,symbolInstanceEnd:he}=de;n.push({sortKey:oe,symbolInstanceStart:Oe,symbolInstanceEnd:he,parameters:me})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:me})}attemptAnchorPlacement(n,o,h,d,f,y,x,b,M,E,z,P,U,F,Z,O,R,q){const{textOffset0:N,textOffset1:H,crossTileID:te}=P,Q=[N,H],re=ri(n,h,d,Q,f),me=this.collisionIndex.placeCollisionBox(F,f,o,B(re.x,re.y,y,x,this.transform.angle),z,b,M,E.predicate);if(O){const de=F.getSymbolInstanceIconSize(q,this.transform.zoom,P.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(F,de,O,B(re.x,re.y,y,x,this.transform.angle),z,b,M,E.predicate).box.length)return}if(me.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[te]&&this.prevPlacement.placements[te]&&this.prevPlacement.placements[te].text&&(de=this.prevPlacement.variableOffsets[te].anchor),this.variableOffsets[te]={textOffset:Q,width:h,height:d,anchor:n,textScale:f,prevAnchor:de},this.markUsedJustification(F,n,P,Z),F.allowVerticalPlacement&&(this.markUsedOrientation(F,Z,P),this.placedOrientations[te]=Z),{shift:re,placedGlyphBoxes:me}}}placeLayerBucketPart(n,o,h,d){const{bucket:f,layout:y,posMatrix:x,textLabelPlaneMatrix:b,labelToScreenMatrix:M,clippingData:E,textPixelRatio:z,holdingForFade:P,collisionBoxArray:U,partiallyEvaluatedTextSize:F,partiallyEvaluatedIconSize:Z,collisionGroup:O}=n.parameters,R=y.get("text-optional"),q=y.get("icon-optional"),N=y.get("text-allow-overlap"),H=y.get("icon-allow-overlap"),te="map"===y.get("text-rotation-alignment"),Q="map"===y.get("text-pitch-alignment"),re="none"!==y.get("icon-text-fit"),me="viewport-y"===y.get("symbol-z-order");this.transform.setProjection(f.projection);let de=N&&(H||!f.hasIconData()||q),oe=H&&(N||!f.hasTextData()||R);!f.collisionArrays&&U&&f.deserializeCollisionBoxes(U),h&&d&&f.updateCollisionDebugBuffers(this.transform.zoom,U);const Oe=(he,Te,ge)=>{const{crossTileID:De,numVerticalGlyphVertices:ve}=he;if(E){const Yt={zoom:this.transform.zoom,pitch:this.transform.pitch};let qt=null;if(E.dynamicFilterNeedsFeature){const St=this.retainedQueryData[f.bucketInstanceId];qt=E.featureIndex.loadFeature({featureIndex:he.featureIndex,bucketIndex:St.bucketIndex,sourceLayerIndex:St.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,E.dynamicFilter)(Yt,qt,this.retainedQueryData[f.bucketInstanceId].tileID.canonical,new a.pointGeometry(he.tileAnchorX,he.tileAnchorY),this.transform.calculateDistanceTileData(E.unwrappedTileID)))return this.placements[De]=new ao(!1,!1,!1,!0),void(o[De]=!0)}if(o[De])return;if(P)return void(this.placements[De]=new ao(!1,!1,!1));let Ie=!1,Re=!1,se=!0,_e=!1,Xe=!1,Qe=null,He={box:null,offscreen:null,occluded:null},st={box:null,offscreen:null,occluded:null},dt=null,et=null,qe=null,Rt=0,kt=0,Gt=0;ge.textFeatureIndex?Rt=ge.textFeatureIndex:he.useRuntimeCollisionCircles&&(Rt=he.featureIndex),ge.verticalTextFeatureIndex&&(kt=ge.verticalTextFeatureIndex);const Zt=Yt=>{Yt.tileID=this.retainedQueryData[f.bucketInstanceId].tileID;const qt=this.transform.elevation;(qt||Yt.elevation)&&(Yt.elevation=qt?qt.getAtTileOffset(Yt.tileID,Yt.tileAnchorX,Yt.tileAnchorY):0)},Xi=ge.textBox;if(Xi){Zt(Xi);const Yt=St=>{let ci=a.WritingMode.horizontal;if(f.allowVerticalPlacement&&!St&&this.prevPlacement){const Li=this.prevPlacement.placedOrientations[De];Li&&(this.placedOrientations[De]=Li,ci=Li,this.markUsedOrientation(f,ci,he))}return ci},qt=(St,ci)=>{if(f.allowVerticalPlacement&&ve>0&&ge.verticalTextBox){for(const Li of f.writingModes)if(Li===a.WritingMode.vertical?(He=ci(),st=He):He=St(),He&&He.box&&He.box.length)break}else He=St()};if(y.get("text-variable-anchor")){let St=y.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[De]){const $t=this.prevPlacement.variableOffsets[De];St.indexOf($t.anchor)>0&&(St=St.filter(ji=>ji!==$t.anchor),St.unshift($t.anchor))}const ci=($t,ji,Is)=>{const ur=f.getSymbolInstanceTextSize(F,he,this.transform.zoom,Te),Oi=($t.x2-$t.x1)*ur+2*$t.padding,mn=($t.y2-$t.y1)*ur+2*$t.padding,Wn=re&&!H?ji:null;Wn&&Zt(Wn);let Xn={box:[],offscreen:!1,occluded:!1};const As=N?2*St.length:St.length;for(let Wo=0;Wo<As;++Wo){const Hn=this.attemptAnchorPlacement(St[Wo%St.length],$t,Oi,mn,ur,te,Q,z,x,O,Wo>=St.length,he,Te,f,Is,Wn,F,Z);if(Hn&&(Xn=Hn.placedGlyphBoxes,Xn&&Xn.box&&Xn.box.length)){Ie=!0,Qe=Hn.shift;break}}return Xn};qt(()=>ci(Xi,ge.iconBox,a.WritingMode.horizontal),()=>{const $t=ge.verticalTextBox;return $t&&Zt($t),f.allowVerticalPlacement&&!(He&&He.box&&He.box.length)&&ve>0&&$t?ci($t,ge.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),He&&(Ie=He.box,se=He.offscreen,_e=He.occluded);const Li=Yt(He&&He.box);if(!Ie&&this.prevPlacement){const $t=this.prevPlacement.variableOffsets[De];$t&&(this.variableOffsets[De]=$t,this.markUsedJustification(f,$t.anchor,he,Li))}}else{const St=(ci,Li)=>{const $t=f.getSymbolInstanceTextSize(F,he,this.transform.zoom,Te),ji=this.collisionIndex.placeCollisionBox(f,$t,ci,new a.pointGeometry(0,0),N,z,x,O.predicate);return ji&&ji.box&&ji.box.length&&(this.markUsedOrientation(f,Li,he),this.placedOrientations[De]=Li),ji};qt(()=>St(Xi,a.WritingMode.horizontal),()=>{const ci=ge.verticalTextBox;return f.allowVerticalPlacement&&ve>0&&ci?(Zt(ci),St(ci,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Yt(He&&He.box&&He.box.length)}}if(dt=He,Ie=dt&&dt.box&&dt.box.length>0,se=dt&&dt.offscreen,_e=dt&&dt.occluded,he.useRuntimeCollisionCircles){const Yt=f.text.placedSymbolArray.get(he.centerJustifiedTextSymbolIndex>=0?he.centerJustifiedTextSymbolIndex:he.verticalPlacedTextSymbolIndex),qt=a.evaluateSizeForFeature(f.textSizeData,F,Yt),St=y.get("text-padding");et=this.collisionIndex.placeCollisionCircles(f,N,Yt,f.lineVertexArray,f.glyphOffsetArray,qt,x,b,M,h,Q,O.predicate,he.collisionCircleDiameter*qt/a.ONE_EM,St,this.retainedQueryData[f.bucketInstanceId].tileID),Ie=N||et.circles.length>0&&!et.collisionDetected,se=se&&et.offscreen,_e=et.occluded}if(ge.iconFeatureIndex&&(Gt=ge.iconFeatureIndex),ge.iconBox){const Yt=qt=>{Zt(qt);const St=re&&Qe?B(Qe.x,Qe.y,te,Q,this.transform.angle):new a.pointGeometry(0,0),ci=f.getSymbolInstanceIconSize(Z,this.transform.zoom,he.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(f,ci,qt,St,H,z,x,O.predicate)};st&&st.box&&st.box.length&&ge.verticalIconBox?(qe=Yt(ge.verticalIconBox),Re=qe.box.length>0):(qe=Yt(ge.iconBox),Re=qe.box.length>0),se=se&&qe.offscreen,Xe=qe.occluded}const an=R||0===he.numHorizontalGlyphVertices&&0===ve,Vi=q||0===he.numIconVertices;if(an||Vi?Vi?an||(Re=Re&&Ie):Ie=Re&&Ie:Re=Ie=Re&&Ie,Ie&&dt&&dt.box&&this.collisionIndex.insertCollisionBox(dt.box,y.get("text-ignore-placement"),f.bucketInstanceId,st&&st.box&&kt?kt:Rt,O.ID),Re&&qe&&this.collisionIndex.insertCollisionBox(qe.box,y.get("icon-ignore-placement"),f.bucketInstanceId,Gt,O.ID),et&&(Ie&&this.collisionIndex.insertCollisionCircles(et.circles,y.get("text-ignore-placement"),f.bucketInstanceId,Rt,O.ID),h)){const Yt=f.bucketInstanceId;let qt=this.collisionCircleArrays[Yt];void 0===qt&&(qt=this.collisionCircleArrays[Yt]=new as);for(let St=0;St<et.circles.length;St+=4)qt.circles.push(et.circles[St+0]),qt.circles.push(et.circles[St+1]),qt.circles.push(et.circles[St+2]),qt.circles.push(et.collisionDetected?1:0)}const $n="globe"!==f.projection.name;de=de&&($n||!_e),oe=oe&&($n||!Xe),this.placements[De]=new ao(Ie||de,Re||oe,se||f.justReloaded),o[De]=!0};if(me){const he=f.getSortedSymbolIndexes(this.transform.angle);for(let Te=he.length-1;Te>=0;--Te){const ge=he[Te];Oe(f.symbolInstances.get(ge),ge,f.collisionArrays[ge])}}else for(let he=n.symbolInstanceStart;he<n.symbolInstanceEnd;he++)Oe(f.symbolInstances.get(he),he,f.collisionArrays[he]);if(h&&f.bucketInstanceId in this.collisionCircleArrays){const he=this.collisionCircleArrays[f.bucketInstanceId];a.invert(he.invProjMatrix,x),he.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(n,o,h,d){const{leftJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:b,crossTileID:M}=h,E=a.getAnchorJustification(o),z=d===a.WritingMode.vertical?b:"left"===E?f:"center"===E?y:"right"===E?x:-1;f>=0&&(n.text.placedSymbolArray.get(f).crossTileID=z>=0&&f!==z?0:M),y>=0&&(n.text.placedSymbolArray.get(y).crossTileID=z>=0&&y!==z?0:M),x>=0&&(n.text.placedSymbolArray.get(x).crossTileID=z>=0&&x!==z?0:M),b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=z>=0&&b!==z?0:M)}markUsedOrientation(n,o,h){const d=o===a.WritingMode.horizontal||o===a.WritingMode.horizontalOnly?o:0,f=o===a.WritingMode.vertical?o:0,{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:M}=h,E=n.text.placedSymbolArray;y>=0&&(E.get(y).placedOrientation=d),x>=0&&(E.get(x).placedOrientation=d),b>=0&&(E.get(b).placedOrientation=d),M>=0&&(E.get(M).placedOrientation=f)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const d=o?o.symbolFadeChange(n):1,f=o?o.opacities:{},y=o?o.variableOffsets:{},x=o?o.placedOrientations:{};for(const b in this.placements){const M=this.placements[b],E=f[b];E?(this.opacities[b]=new ar(E,d,M.text,M.icon,null,M.clipped),h=h||M.text!==E.text.placed||M.icon!==E.icon.placed):(this.opacities[b]=new ar(null,d,M.text,M.icon,M.skipFade,M.clipped),h=h||M.text||M.icon)}for(const b in f){const M=f[b];if(!this.opacities[b]){const E=new ar(M,d,!1,!1);E.isHidden()||(this.opacities[b]=E,h=h||M.text.placed||M.icon.placed)}}for(const b in y)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=y[b]);for(const b in x)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=x[b]);h?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:n)}updateLayerOpacities(n,o){const h={};for(const d of o){const f=d.getBucket(n);f&&d.latestFeatureIndex&&n.id===f.layerIds[0]&&this.updateBucketOpacities(f,h,d.collisionBoxArray)}}updateBucketOpacities(n,o,h){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const d=n.layers[0].layout,f=!!n.layers[0].dynamicFilter(),y=new ar(null,0,!1,!1,!0),x=d.get("text-allow-overlap"),b=d.get("icon-allow-overlap"),M=d.get("text-variable-anchor"),E="map"===d.get("text-rotation-alignment"),z="map"===d.get("text-pitch-alignment"),P="none"!==d.get("icon-text-fit"),U=new ar(null,0,x&&(b||!n.hasIconData()||d.get("icon-optional")),b&&(x||!n.hasTextData()||d.get("text-optional")),!0);!n.collisionArrays&&h&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(h);const F=(O,R,q)=>{for(let N=0;N<R/4;N++)O.opacityVertexArray.emplaceBack(q)};let Z=0;for(let O=0;O<n.symbolInstances.length;O++){const R=n.symbolInstances.get(O),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:N,crossTileID:H,numIconVertices:te}=R;let Q=this.opacities[H];o[H]?Q=y:Q||(Q=U,this.opacities[H]=Q),o[H]=!0;const re=q>0||N>0,me=te>0,de=this.placedOrientations[H],oe=de===a.WritingMode.vertical,Oe=de===a.WritingMode.horizontal||de===a.WritingMode.horizontalOnly;if(!re&&!me||Q.isHidden()||Z++,re){const he=fi(Q.text);F(n.text,q,oe?lr:he),F(n.text,N,Oe?lr:he);const Te=Q.text.isHidden(),{leftJustifiedTextSymbolIndex:ge,centerJustifiedTextSymbolIndex:De,rightJustifiedTextSymbolIndex:ve,verticalPlacedTextSymbolIndex:Ie}=R,Re=n.text.placedSymbolArray,se=Te||oe?1:0;ge>=0&&(Re.get(ge).hidden=se),De>=0&&(Re.get(De).hidden=se),ve>=0&&(Re.get(ve).hidden=se),Ie>=0&&(Re.get(Ie).hidden=Te||Oe?1:0);const _e=this.variableOffsets[H];_e&&this.markUsedJustification(n,_e.anchor,R,de);const Xe=this.placedOrientations[H];Xe&&(this.markUsedJustification(n,"left",R,Xe),this.markUsedOrientation(n,Xe,R))}if(me){const he=fi(Q.icon),{placedIconSymbolIndex:Te,verticalPlacedIconSymbolIndex:ge}=R,De=n.icon.placedSymbolArray,ve=Q.icon.isHidden()?1:0;Te>=0&&(F(n.icon,te,oe?lr:he),De.get(Te).hidden=ve),ge>=0&&(F(n.icon,R.numVerticalIconVertices,Oe?lr:he),De.get(ge).hidden=ve)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const he=n.collisionArrays[O];if(he){let Te=new a.pointGeometry(0,0),ge=!0;if(he.textBox||he.verticalTextBox){if(M){const ve=this.variableOffsets[H];ve?(Te=ri(ve.anchor,ve.width,ve.height,ve.textOffset,ve.textScale),E&&Te._rotate(z?this.transform.angle:-this.transform.angle)):ge=!1}f&&(ge=!Q.clipped),he.textBox&&C(n.textCollisionBox.collisionVertexArray,Q.text.placed,!ge||oe,Te.x,Te.y),he.verticalTextBox&&C(n.textCollisionBox.collisionVertexArray,Q.text.placed,!ge||Oe,Te.x,Te.y)}const De=ge&&!(Oe||!he.verticalIconBox);he.iconBox&&C(n.iconCollisionBox.collisionVertexArray,Q.icon.placed,De,P?Te.x:0,P?Te.y:0),he.verticalIconBox&&C(n.iconCollisionBox.collisionVertexArray,Q.icon.placed,!De,P?Te.x:0,P?Te.y:0)}}}if(n.fullyClipped=0===Z,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const O=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=O.invProjMatrix,n.placementViewportMatrix=O.viewportMatrix,n.collisionCircleArray=O.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>n}setStale(){this.stale=!0}}function C(l,n,o,h,d){l.emplaceBack(n?1:0,o?1:0,h||0,d||0),l.emplaceBack(n?1:0,o?1:0,h||0,d||0),l.emplaceBack(n?1:0,o?1:0,h||0,d||0),l.emplaceBack(n?1:0,o?1:0,h||0,d||0)}const j=Math.pow(2,25),ce=Math.pow(2,24),je=Math.pow(2,17),nt=Math.pow(2,16),Dt=Math.pow(2,9),on=Math.pow(2,8),Cn=Math.pow(2,1);function fi(l){if(0===l.opacity&&!l.placed)return 0;if(1===l.opacity&&l.placed)return 4294967295;const n=l.placed?1:0,o=Math.floor(127*l.opacity);return o*j+n*ce+o*je+n*nt+o*Dt+n*on+o*Cn+n}const lr=0;class Do{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,o,h,d,f){const y=this._bucketParts;for(;this._currentTileIndex<n.length;)if(o.getBucketParts(y,d,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((x,b)=>x.sortKey-b.sortKey));this._currentPartIndex<y.length;){const x=y[this._currentPartIndex];if(o.placeLayerBucketPart(x,this._seenCrossTileIDs,h,0===x.symbolInstanceStart),this._currentPartIndex++,f())return!0}return!1}}class pn{constructor(n,o,h,d,f,y,x,b){this.placement=new Ae(n,f,y,x,b),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(n,o,h){const d=a.exported.now(),f=()=>{const y=a.exported.now()-d;return!this._forceFullPlacement&&y>2};for(;this._currentPlacementIndex>=0;){const y=o[n[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if("symbol"===y.type&&(!y.minzoom||y.minzoom<=x)&&(!y.maxzoom||y.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new Do(y)),this._inProgressLayer.continuePlacement(h[y.source],this.placement,this._showCollisionBoxes,y,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const zr=512/a.EXTENT/2;class lo{constructor(n,o,h){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let d=0;d<o.length;d++){const f=o.get(d),y=f.key;this.indexedSymbolInstances[y]||(this.indexedSymbolInstances[y]=[]),this.indexedSymbolInstances[y].push({crossTileID:f.crossTileID,coord:this.getScaledCoordinates(f,n)})}}getScaledCoordinates(n,o){const h=zr/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*a.EXTENT+n.tileAnchorX)*h),y:Math.floor((o.canonical.y*a.EXTENT+n.tileAnchorY)*h)}}findMatches(n,o,h){const d=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let f=0;f<n.length;f++){const y=n.get(f);if(y.crossTileID)continue;const x=this.indexedSymbolInstances[y.key];if(!x)continue;const b=this.getScaledCoordinates(y,o);for(const M of x)if(Math.abs(M.coord.x-b.x)<=d&&Math.abs(M.coord.y-b.y)<=d&&!h[M.crossTileID]){h[M.crossTileID]=!0,y.crossTileID=M.crossTileID;break}}}}class js{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Po{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const o=Math.round((n-this.lng)/360);if(0!==o)for(const h in this.indexes){const d=this.indexes[h],f={};for(const y in d){const x=d[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+o),f[x.tileID.key]=x}this.indexes[h]=f}this.lng=n}addBucket(n,o,h){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let f=0;f<o.symbolInstances.length;f++)o.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const d=this.usedCrossTileIDs[n.overscaledZ];for(const f in this.indexes){const y=this.indexes[f];if(Number(f)>n.overscaledZ)for(const x in y){const b=y[x];b.tileID.isChildOf(n)&&b.findMatches(o.symbolInstances,n,d)}else{const x=y[n.scaledTo(Number(f)).key];x&&x.findMatches(o.symbolInstances,n,d)}}for(let f=0;f<o.symbolInstances.length;f++){const y=o.symbolInstances.get(f);y.crossTileID||(y.crossTileID=h.generate(),d[y.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new lo(n,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(n,o){for(const h in o.indexedSymbolInstances)for(const d of o.indexedSymbolInstances[h])delete this.usedCrossTileIDs[n][d.crossTileID]}removeStaleBuckets(n){let o=!1;for(const h in this.indexes){const d=this.indexes[h];for(const f in d)n[d[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,d[f]),delete d[f],o=!0)}return o}}class Vn{constructor(){this.layerIndexes={},this.crossTileIDs=new js,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,o,h,d){let f=this.layerIndexes[n.id];void 0===f&&(f=this.layerIndexes[n.id]=new Po);let y=!1;const x={};"globe"!==d.name&&f.handleWrapJump(h);for(const b of o){const M=b.getBucket(n);M&&n.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(b.tileID,M,this.crossTileIDs)&&(y=!0),x[M.bucketInstanceId]=!0)}return f.removeStaleBuckets(x)&&(y=!0),y}pruneUnusedLayers(n){const o={};n.forEach(h=>{o[h]=!0});for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}const co=(l,n)=>a.emitValidationErrors(l,n&&n.filter(o=>"source.canvas"!==o.identifier)),ls=a.pick(We,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Lo=a.pick(We,["setCenter","setZoom","setBearing","setPitch"]),kr={version:8,layers:[],sources:{}},Gs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ci extends a.Evented{constructor(n,o={}){super(),this.map=n,this.dispatcher=new Tn(ot(),this),this.imageManager=new rs,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(n._requestManager,o.localFontFamily?a.LocalGlyphMode.all:o.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.crossTileSymbolIndex=new Vn,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const h=this;this._rtlTextPluginCallback=Ci.registerForPluginStateChange(d=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(f,y)=>{if(a.triggerPluginCompletionEvent(f),y&&y.every(x=>x))for(const x in h._sourceCaches){const b=h._sourceCaches[x],M=b.getSource().type;"vector"!==M&&"geojson"!==M||b.reload()}})}),this.on("data",d=>{if("source"!==d.dataType||"metadata"!==d.sourceDataType)return;const f=this.getSource(d.sourceId);if(f&&f.vectorLayerIds)for(const y in this._layers){const x=this._layers[y];x.source===f.id&&this._validateLayer(x)}})}loadURL(n,o={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const h="boolean"==typeof o.validate?o.validate:!a.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,o.accessToken);const d=this.map._requestManager.transformRequest(n,a.ResourceType.Style);this._request=a.getJSON(d,(f,y)=>{this._request=null,f?this.fire(new a.ErrorEvent(f)):y&&this._load(y,h)})}loadJSON(n,o={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(n,!1!==o.validate)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(kr,!1)}_updateLayerCount(n,o){const h=o?1:-1;n.is3D()&&(this._num3DLayers+=h),"circle"===n.type&&(this._numCircleLayers+=h),"symbol"===n.type&&(this._numSymbolLayers+=h)}_load(n,o){if(o&&co(this,a.validateStyle(n)))return;this._loaded=!0,this.stylesheet=a.clone$1(n),this._updateMapProjection();for(const d in n.sources)this.addSource(d,n.sources[d],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const h=ct(this.stylesheet.layers);this._order=h.map(d=>d.id),this._layers={},this._serializedLayers={};for(let d of h)d=a.createStyleLayer(d),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Wr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(o,h,d){let f,y,x;const b=a.exported.devicePixelRatio>1?"@2x":"";let M=a.getJSON(h.transformRequest(h.normalizeSpriteURL(o,b,".json"),a.ResourceType.SpriteJSON),(P,U)=>{M=null,x||(x=P,f=U,z())}),E=a.getImage(h.transformRequest(h.normalizeSpriteURL(o,b,".png"),a.ResourceType.SpriteImage),(P,U)=>{E=null,x||(x=P,y=U,z())});function z(){if(x)d(x);else if(f&&y){const P=a.exported.getImageData(y),U={};for(const F in f){const{width:Z,height:O,x:R,y:q,sdf:N,pixelRatio:H,stretchX:te,stretchY:Q,content:re}=f[F],me=new a.RGBAImage({width:Z,height:O});a.RGBAImage.copy(P,me,{x:R,y:q},{x:0,y:0},{width:Z,height:O}),U[F]={data:me,pixelRatio:H,sdf:N,stretchX:te,stretchY:Q,content:re}}d(null,U)}}return{cancel(){M&&(M.cancel(),M=null),E&&(E.cancel(),E=null)}}}(n,this.map._requestManager,(o,h)=>{if(this._spriteRequest=null,o)this.fire(new a.ErrorEvent(o));else if(h)for(const d in h)this.imageManager.addImage(d,h[d]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(n){const o=this.getSource(n.source);if(!o)return;const h=n.sourceLayer;h&&("geojson"===o.type||o.vectorLayerIds&&-1===o.vectorLayerIds.indexOf(h))&&this.fire(new a.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${o.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const o=[];for(const h of n){const d=this._layers[h];"custom"!==d.type&&o.push(d.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&Gs[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const o=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(d.length||f.length)&&this._updateWorkerLayers(d,f);for(const y in this._updatedSources){const x=this._updatedSources[y];"reload"===x?this._reloadSource(y):"clear"===x&&this._clearSource(y)}this._updateTilesForChangedImages();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const h={};for(const d in this._sourceCaches){const f=this._sourceCaches[d];h[d]=f.used,f.used=!1}for(const d of this._order){const f=this._layers[d];if(f.recalculate(n,this._availableImages),!f.isHidden(n.zoom)){const x=this._getLayerSourceCache(f);x&&(x.used=!0)}const y=this.map.painter;if(y){const x=f.getProgramIds();if(!x)continue;const b=f.getProgramConfiguration(n.zoom);for(const M of x)y.useProgram(M,b)}}for(const d in h){const f=this._sourceCaches[d];h[d]!==f.used&&f.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),co(this,a.validateStyle(n)))return!1;(n=a.clone$1(n)).layers=ct(n.layers);const o=function(d,f){if(!d)return[{command:We.setStyle,args:[f]}];let y=[];try{if(!Se(d.version,f.version))return[{command:We.setStyle,args:[f]}];Se(d.center,f.center)||y.push({command:We.setCenter,args:[f.center]}),Se(d.zoom,f.zoom)||y.push({command:We.setZoom,args:[f.zoom]}),Se(d.bearing,f.bearing)||y.push({command:We.setBearing,args:[f.bearing]}),Se(d.pitch,f.pitch)||y.push({command:We.setPitch,args:[f.pitch]}),Se(d.sprite,f.sprite)||y.push({command:We.setSprite,args:[f.sprite]}),Se(d.glyphs,f.glyphs)||y.push({command:We.setGlyphs,args:[f.glyphs]}),Se(d.transition,f.transition)||y.push({command:We.setTransition,args:[f.transition]}),Se(d.light,f.light)||y.push({command:We.setLight,args:[f.light]}),Se(d.fog,f.fog)||y.push({command:We.setFog,args:[f.fog]}),Se(d.projection,f.projection)||y.push({command:We.setProjection,args:[f.projection]});const x={},b=[];!function(z,P,U,F){let Z;for(Z in P=P||{},z=z||{})z.hasOwnProperty(Z)&&(P.hasOwnProperty(Z)||jt(Z,U,F));for(Z in P)P.hasOwnProperty(Z)&&(z.hasOwnProperty(Z)?Se(z[Z],P[Z])||("geojson"===z[Z].type&&"geojson"===P[Z].type&&ki(z,P,Z)?U.push({command:We.setGeoJSONSourceData,args:[Z,P[Z].data]}):Ei(Z,P,U,F)):Ct(Z,P,U))}(d.sources,f.sources,b,x);const M=[];d.layers&&d.layers.forEach(z=>{z.source&&x[z.source]?y.push({command:We.removeLayer,args:[z.id]}):M.push(z)});let E=d.terrain;E&&x[E.source]&&(y.push({command:We.setTerrain,args:[void 0]}),E=void 0),y=y.concat(b),Se(E,f.terrain)||y.push({command:We.setTerrain,args:[f.terrain]}),function(z,P,U){P=P||[];const F=(z=z||[]).map(be),Z=P.map(be),O=z.reduce(pi,{}),R=P.reduce(pi,{}),q=F.slice(),N=Object.create(null);let H,te,Q,re,me,de,oe;for(H=0,te=0;H<F.length;H++)Q=F[H],R.hasOwnProperty(Q)?te++:(U.push({command:We.removeLayer,args:[Q]}),q.splice(q.indexOf(Q,te),1));for(H=0,te=0;H<Z.length;H++)Q=Z[Z.length-1-H],q[q.length-1-H]!==Q&&(O.hasOwnProperty(Q)?(U.push({command:We.removeLayer,args:[Q]}),q.splice(q.lastIndexOf(Q,q.length-te),1)):te++,de=q[q.length-H],U.push({command:We.addLayer,args:[R[Q],de]}),q.splice(q.length-H,0,Q),N[Q]=!0);for(H=0;H<Z.length;H++)if(Q=Z[H],re=O[Q],me=R[Q],!N[Q]&&!Se(re,me))if(Se(re.source,me.source)&&Se(re["source-layer"],me["source-layer"])&&Se(re.type,me.type)){for(oe in Ut(re.layout,me.layout,U,Q,null,We.setLayoutProperty),Ut(re.paint,me.paint,U,Q,null,We.setPaintProperty),Se(re.filter,me.filter)||U.push({command:We.setFilter,args:[Q,me.filter]}),Se(re.minzoom,me.minzoom)&&Se(re.maxzoom,me.maxzoom)||U.push({command:We.setLayerZoomRange,args:[Q,me.minzoom,me.maxzoom]}),re)re.hasOwnProperty(oe)&&"layout"!==oe&&"paint"!==oe&&"filter"!==oe&&"metadata"!==oe&&"minzoom"!==oe&&"maxzoom"!==oe&&(0===oe.indexOf("paint.")?Ut(re[oe],me[oe],U,Q,oe.slice(6),We.setPaintProperty):Se(re[oe],me[oe])||U.push({command:We.setLayerProperty,args:[Q,oe,me[oe]]}));for(oe in me)me.hasOwnProperty(oe)&&!re.hasOwnProperty(oe)&&"layout"!==oe&&"paint"!==oe&&"filter"!==oe&&"metadata"!==oe&&"minzoom"!==oe&&"maxzoom"!==oe&&(0===oe.indexOf("paint.")?Ut(re[oe],me[oe],U,Q,oe.slice(6),We.setPaintProperty):Se(re[oe],me[oe])||U.push({command:We.setLayerProperty,args:[Q,oe,me[oe]]}))}else U.push({command:We.removeLayer,args:[Q]}),de=q[q.lastIndexOf(Q)+1],U.push({command:We.addLayer,args:[me,de]})}(M,f.layers,y)}catch(x){console.warn("Unable to compute style diff:",x),y=[{command:We.setStyle,args:[f]}]}return y}(this.serialize(),n).filter(d=>!(d.command in Lo));if(0===o.length)return!1;const h=o.filter(d=>!(d.command in ls));if(h.length>0)throw new Error(`Unimplemented: ${h.map(d=>d.command).join(", ")}.`);return o.forEach(d=>{"setTransition"!==d.command&&"setProjection"!==d.command&&this[d.command].apply(this,d.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,o){return this.getImage(n)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,o),this._afterImageUpdated(n),this)}updateImage(n,o){this.imageManager.updateImage(n,o)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,o,h={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(a.validateSource,`sources.${n}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const d=ae(n,o,this.dispatcher,this);d.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:d.serialize(),sourceId:n}));const f=y=>{const x=(y?"symbol:":"other:")+n,b=this._sourceCaches[x]=new a.SourceCache(x,d,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[n]=b,b.style=this,b.onAdd(this.map)};f(!1),"vector"!==o.type&&"geojson"!==o.type||f(!0),d.onAdd&&d.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const o=this.getSource(n);if(!o)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${d}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(n);for(const d of h)delete this._sourceCaches[d.id],delete this._updatedSources[d.id],d.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:d.getSource().id})),d.setEventedParent(null),d.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,o){this._checkLoaded(),this.getSource(n).setData(o),this._changed=!0}getSource(n){const o=this._getSourceCache(n);return o&&o.getSource()}_getSources(){const n=[];for(const o in this._otherSourceCaches){const h=this._getSourceCache(o);h&&n.push(h.getSource())}return n}addLayer(n,o,h={}){this._checkLoaded();const d=n.id;if(this.getLayer(d))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${d}" already exists on this map`)));let f;if("custom"===n.type){if(co(this,a.validateCustomStyleLayer(n)))return;f=a.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(d,n.source),n=a.clone$1(n),n=a.extend(n,{source:d})),this._validate(a.validateLayer,`layers.${d}`,n,{arrayIndex:-1},h))return;f=a.createStyleLayer(n),this._validateLayer(f),f.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[f.id]=f.serialize(),this._updateLayerCount(f,!0)}const y=o?this._order.indexOf(o):this._order.length;if(o&&-1===y)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(y,0,d),this._layerOrderChanged=!0,this._layers[d]=f;const x=this._getLayerSourceCache(f);if(this._removedLayers[d]&&f.source&&x&&"custom"!==f.type){const b=this._removedLayers[d];delete this._removedLayers[d],b.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",x.pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,o){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===o)return;const h=this._order.indexOf(n);this._order.splice(h,1);const d=o?this._order.indexOf(o):this._order.length;o&&-1===d?this.fire(new a.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(d,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const o=this._layers[n];if(!o)return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const h=this._order.indexOf(n);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=o,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const o in this._layers)if(this._layers[o].type===n)return!0;return!1}setLayerZoomRange(n,o,h){this._checkLoaded();const d=this.getLayer(n);d?d.minzoom===o&&d.maxzoom===h||(null!=o&&(d.minzoom=o),null!=h&&(d.maxzoom=h),this._updateLayer(d)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,o,h={}){this._checkLoaded();const d=this.getLayer(n);if(d){if(!Se(d.filter,o))return null==o?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(a.validateFilter,`layers.${d.id}.filter`,o,{layerType:d.type},h)||(d.filter=a.clone$1(o),this._updateLayer(d)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const o=this.getLayer(n);return o&&a.clone$1(o.filter)}setLayoutProperty(n,o,h,d={}){this._checkLoaded();const f=this.getLayer(n);f?Se(f.getLayoutProperty(o),h)||(f.setLayoutProperty(o,h,d),this._updateLayer(f)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,o){const h=this.getLayer(n);if(h)return h.getLayoutProperty(o);this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,o,h,d={}){this._checkLoaded();const f=this.getLayer(n);f?Se(f.getPaintProperty(o),h)||(f.setPaintProperty(o,h,d)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,o){const h=this.getLayer(n);return h&&h.getPaintProperty(o)}setFeatureState(n,o){this._checkLoaded();const h=n.source,d=n.sourceLayer,f=this.getSource(h);if(!f)return void this.fire(new a.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const y=f.type;if("geojson"===y&&d)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===y&&!d)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const x=this._getSourceCaches(h);for(const b of x)b.setFeatureState(d,n.id,o)}removeFeatureState(n,o){this._checkLoaded();const h=n.source,d=this.getSource(h);if(!d)return void this.fire(new a.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const f=d.type,y="vector"===f?n.sourceLayer:void 0;if("vector"===f&&!y)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const x=this._getSourceCaches(h);for(const b of x)b.removeFeatureState(y,n.id,o)}getFeatureState(n){this._checkLoaded();const o=n.source,h=n.sourceLayer,d=this.getSource(o);if(d){if("vector"!==d.type||h)return void 0===n.id&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(h,n.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const o in this._sourceCaches){const h=this._sourceCaches[o].getSource();n[h.id]||(n[h.id]=h.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},o=>void 0!==o)}_updateLayer(n){this._updatedLayers[n.id]=!0;const o=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&o&&"raster"!==o.getSource().type&&(this._updatedSources[n.source]="reload",o.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const o=y=>"fill-extrusion"===this._layers[y].type,h={},d=[];for(let y=this._order.length-1;y>=0;y--){const x=this._order[y];if(o(x)){h[x]=y;for(const b of n){const M=b[x];if(M)for(const E of M)d.push(E)}}}d.sort((y,x)=>x.intersectionZ-y.intersectionZ);const f=[];for(let y=this._order.length-1;y>=0;y--){const x=this._order[y];if(o(x))for(let b=d.length-1;b>=0;b--){const M=d[b].feature;if(h[M.layer.id]<y)break;f.push(M),d.pop()}else for(const b of n){const M=b[x];if(M)for(const E of M)f.push(E.feature)}}return f}queryRenderedFeatures(n,o,h){o&&o.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const d={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const b of o.layers){const M=this._layers[b];if(!M)return this.fire(new a.ErrorEvent(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];d[M.source]=!0}}const f=[];o.availableImages=this._availableImages;const y=o&&o.layers?o.layers.some(b=>{const M=this.getLayer(b);return M&&M.is3D()}):this.has3DLayers(),x=nr.createFromScreenPoints(n,h);for(const b in this._sourceCaches){const M=this._sourceCaches[b].getSource().id;o.layers&&!d[M]||f.push(ue(this._sourceCaches[b],this._layers,this._serializedLayers,x,o,h,y,!!this.map._showQueryGeometry))}return this.placement&&f.push(function(b,M,E,z,P,U,F){const Z={},O=U.queryRenderedSymbols(z),R=[];for(const q of Object.keys(O).map(Number))R.push(F[q]);R.sort(Ze);for(const q of R){const N=q.featureIndex.lookupSymbolFeatures(O[q.bucketInstanceId],M,q.bucketIndex,q.sourceLayerIndex,P.filter,P.layers,P.availableImages,b);for(const H in N){const te=Z[H]=Z[H]||[],Q=N[H];Q.sort((re,me)=>{const de=q.featureSortOrder;if(de){const oe=de.indexOf(re.featureIndex);return de.indexOf(me.featureIndex)-oe}return me.featureIndex-re.featureIndex});for(const re of Q)te.push(re)}}for(const q in Z)Z[q].forEach(N=>{const H=N.feature,te=E(b[q]).getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=te});return Z}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),x.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(n,o){o&&o.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const h=this._getSourceCaches(n);let d=[];for(const f of h)d=d.concat(Ce(f,o));return d}addSourceType(n,o,h){return Ci.getSourceType(n)?h(new Error(`A source type called "${n}" already exists.`)):(Ci.setSourceType(n,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:o.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(n,o={}){this._checkLoaded();const h=this.light.getLight();let d=!1;for(const y in n)if(!Se(n[y],h[y])){d=!0;break}if(!d)return;const f=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,o),this.light.updateTransitions(f)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,o=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===o){if("object"==typeof n.source){const h="terrain-dem-src";this.addSource(h,n.source),n=a.clone$1(n),n=a.extend(n,{source:h})}if(this._validate(a.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode)this._createTerrain(n,o);else{const h=this.terrain,d=h.get();for(const f of Object.keys(a.spec.terrain))!n.hasOwnProperty(f)&&a.spec.terrain[f].default&&(n[f]=a.spec.terrain[f].default);for(const f in n)if(!Se(n[f],d[f])){h.set(n),this.stylesheet.terrain=n;const y=this._setTransitionParameters({duration:0});h.updateTransitions(y);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const o=this.fog=new Hr(n,this.map.transform);this.stylesheet.fog=n;const h=this._setTransitionParameters({duration:0});o.updateTransitions(h)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,h=o.get();0===Object.keys(n).length&&o.set(n);for(const d in n)if(!Se(n[d],h[d])){o.set(n),this.stylesheet.fog=n;const f=this._setTransitionParameters({duration:0});o.updateTransitions(f);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:a.exported.now(),transition:a.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(h=>this.isLayerDraped(this._layers[h])),o=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...o)}_createTerrain(n,o){const h=this.terrain=new tr(n,o);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const d=this._setTransitionParameters({duration:0});h.updateTransitions(d)}_force3DLayerUpdate(){for(const n in this._layers){const o=this._layers[n];"fill-extrusion"===o.type&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const o=this._layers[n];"symbol"===o.type&&this._updateLayer(o)}}_validate(n,o,h,d,f={}){return(!f||!1!==f.validate)&&co(this,n.call(a.validateStyle,a.extend({key:o,style:this.serialize(),value:h,styleSpec:a.spec},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const o=this._getSourceCaches(n);for(const h of o)h.clearTiles()}_reloadSource(n){const o=this._getSourceCaches(n);for(const h of o)h.resume(),h.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const o in this._sourceCaches)this._sourceCaches[o].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const o=this._sourceCaches[n];o.resume(),o.reload()}}_updatePlacement(n,o,h,d,f=!1){let y=!1,x=!1;const b={};for(const M of this._order){const E=this._layers[M];if("symbol"!==E.type)continue;if(!b[E.source]){const P=this._getLayerSourceCache(E);if(!P)continue;b[E.source]=P.getRenderableIds(!0).map(U=>P.getTileByID(U)).sort((U,F)=>F.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(F.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(E,b[E.source],n.center.lng,n.projection);y=y||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),f=f||this._layerOrderChanged||0===h,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(f||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),n.zoom))&&(this.pauseablePlacement=new pn(n,this._order,f,o,h,d,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),x=!0),y&&this.pauseablePlacement.placement.setStale()),x||y)for(const M of this._order){const E=this._layers[M];"symbol"===E.type&&this.placement.updateLayerOpacities(E,b[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,o,h){this.imageManager.getImages(o.icons,h),this._updateTilesForChangedImages();const d=f=>{f&&f.setDependencies(o.tileID.key,o.type,o.icons)};d(this._otherSourceCaches[o.source]),d(this._symbolSourceCaches[o.source])}getGlyphs(n,o,h){this.glyphManager.getGlyphs(o.stacks,h)}getResource(n,o,h){return a.makeRequest(o,h)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const o=[];return this._otherSourceCaches[n]&&o.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&o.push(this._symbolSourceCaches[n]),o}_isSourceCacheLoaded(n){const o=this._getSourceCaches(n);return 0===o.length?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):o.every(h=>h.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ci.getSourceType=function(l){return le[l]},Ci.setSourceType=function(l,n){le[l]=n},Ci.registerForPluginStateChange=a.registerForPluginStateChange;var qs="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",cs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",tc="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ic="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",$s="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let nc={},Ws={};const hs=[];ho(qs,hs),ho(tc,hs),ho(ic,hs),ho($s,hs),nc=Pt("",tc),Ws=Pt($s,ic);const Za=Pt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),rc=qs,us="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Na={background:Pt("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Pt("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Pt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Pt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Pt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Pt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Pt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Pt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Pt("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Pt("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Pt("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Pt("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Pt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Pt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Pt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Pt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Pt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Pt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Pt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Pt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Pt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Pt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",cs),skyboxGradient:Pt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",cs),skyboxCapture:Pt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Pt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Pt("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ho(l,n){const o=l.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let h of o)if(h=h.trim(),"#"===h[0]&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const d=h.split(" ");for(const f of d)n.includes(f)||n.push(f)}}function Pt(l,n){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),d={},f=[...hs];return ho(l,f),ho(n,f),{fragmentSource:l=l.replace(o,(y,x,b,M,E)=>(d[E]=!0,"define"===x?`\n#ifndef HAS_UNIFORM_u_${E}\nvarying ${b} ${M} ${E};\n#else\nuniform ${b} ${M} u_${E};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${E}\n    ${b} ${M} ${E} = u_${E};\n#endif\n`)),vertexSource:n=n.replace(o,(y,x,b,M,E)=>{const z="float"===M?"vec2":"vec4",P=E.match(/color/)?"color":z;return d[E]?"define"===x?`\n#ifndef HAS_UNIFORM_u_${E}\nuniform lowp float u_${E}_t;\nattribute ${b} ${z} a_${E};\nvarying ${b} ${M} ${E};\n#else\nuniform ${b} ${M} u_${E};\n#endif\n`:"vec4"===P?`\n#ifndef HAS_UNIFORM_u_${E}\n    ${E} = a_${E};\n#else\n    ${b} ${M} ${E} = u_${E};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${E}\n    ${E} = unpack_mix_${P}(a_${E}, u_${E}_t);\n#else\n    ${b} ${M} ${E} = u_${E};\n#endif\n`:"define"===x?`\n#ifndef HAS_UNIFORM_u_${E}\nuniform lowp float u_${E}_t;\nattribute ${b} ${z} a_${E};\n#else\nuniform ${b} ${M} u_${E};\n#endif\n`:"vec4"===P?`\n#ifndef HAS_UNIFORM_u_${E}\n    ${b} ${M} ${E} = a_${E};\n#else\n    ${b} ${M} ${E} = u_${E};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${E}\n    ${b} ${M} ${E} = unpack_mix_${P}(a_${E}, u_${E}_t);\n#else\n    ${b} ${M} ${E} = u_${E};\n#endif\n`}),staticAttributes:h,usedDefines:f}}class oc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,o,h,d,f,y,x){this.context=n;let b=this.boundPaintVertexBuffers.length!==d.length;for(let E=0;!b&&E<d.length;E++)this.boundPaintVertexBuffers[E]!==d[E]&&(b=!0);let M=this.boundDynamicVertexBuffers.length!==x.length;for(let E=0;!M&&E<x.length;E++)this.boundDynamicVertexBuffers[E]!==x[E]&&(M=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||b||M||this.boundIndexBuffer!==f||this.boundVertexOffset!==y)this.freshBind(o,h,d,f,y,x);else{n.bindVertexArrayOES.set(this.vao);for(const E of x)E&&E.bind();f&&f.dynamicDraw&&f.bind()}}freshBind(n,o,h,d,f,y){let x;const b=n.numAttributes,M=this.context,E=M.gl;if(M.extVertexArrayObject)this.vao&&this.destroy(),this.vao=M.extVertexArrayObject.createVertexArrayOES(),M.bindVertexArrayOES.set(this.vao),x=0,this.boundProgram=n,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=d,this.boundVertexOffset=f,this.boundDynamicVertexBuffers=y;else{x=M.currentNumAttributes||0;for(let z=b;z<x;z++)E.disableVertexAttribArray(z)}o.enableAttributes(E,n),o.bind(),o.setVertexAttribPointers(E,n,f);for(const z of h)z.enableAttributes(E,n),z.bind(),z.setVertexAttribPointers(E,n,f);for(const z of y)z&&(z.enableAttributes(E,n),z.bind(),z.setVertexAttribPointers(E,n,f));d&&d.bind(),M.currentNumAttributes=b}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ds(l,n){const o=Math.pow(2,n.canonical.z),h=n.canonical.y;return[new a.MercatorCoordinate(0,h/o).toLngLat().lat,new a.MercatorCoordinate(0,(h+1)/o).toLngLat().lat]}function Va(l,n,o,h,d,f,y){const x=l.context,b=x.gl,M=o.fbo;if(!M)return;l.prepareDrawTile();const E=l.useProgram("hillshade");x.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,M.colorAttachment.get());const z=((Z,O,R,q)=>{const N=R.paint.get("hillshade-shadow-color"),H=R.paint.get("hillshade-highlight-color"),te=R.paint.get("hillshade-accent-color");let Q=R.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===R.paint.get("hillshade-illumination-anchor")&&(Q-=Z.transform.angle);const re=!Z.options.moving;return{u_matrix:q||Z.transform.calculateProjMatrix(O.tileID.toUnwrapped(),re),u_image:0,u_latrange:ds(0,O.tileID),u_light:[R.paint.get("hillshade-exaggeration"),Q],u_shadow:N,u_highlight:H,u_accent:te}})(l,o,h,l.terrain?n.projMatrix:null);l.prepareDrawProgram(x,E,n.toUnwrapped());const{tileBoundsBuffer:P,tileBoundsIndexBuffer:U,tileBoundsSegments:F}=l.getTileBoundsBuffers(o);E.draw(x,b.TRIANGLES,d,f,y,a.CullFaceMode.disabled,z,h.id,P,U,F)}function Oo(l,n,o){if(!n.needsDEMTextureUpload)return;const h=l.context,d=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||l.getTileTexture(o.stride);const f=o.getPixels();n.demTexture?n.demTexture.update(f,{premultiply:!1}):n.demTexture=new a.Texture(h,f,d.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Xs(l,n,o,h,d,f){const y=l.context,x=y.gl;if(!n.dem)return;const b=n.dem;if(y.activeTexture.set(x.TEXTURE1),Oo(l,n,b),!n.demTexture)return;n.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const M=b.dim;y.activeTexture.set(x.TEXTURE0);let E=n.fbo;if(!E){const F=new a.Texture(y,{width:M,height:M,data:null},x.RGBA);F.bind(x.LINEAR,x.CLAMP_TO_EDGE),E=n.fbo=y.createFramebuffer(M,M,!0),E.colorAttachment.set(F.texture)}y.bindFramebuffer.set(E.framebuffer),y.viewport.set([0,0,M,M]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:P,tileBoundsSegments:U}=l.getMercatorTileBoundsBuffers();l.useProgram("hillshadePrepare").draw(y,x.TRIANGLES,h,d,f,a.CullFaceMode.disabled,((F,Z)=>{const O=Z.stride,R=a.create();return a.ortho(R,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(R,R,[0,-a.EXTENT,0]),{u_matrix:R,u_image:1,u_dimension:[O,O],u_zoom:F.overscaledZ,u_unpack:Z.unpackVector}})(n.tileID,b),o.id,z,P,U),n.needsHillshadePrepare=!1}const ps=l=>({u_matrix:new a.UniformMatrix4f(l),u_image0:new a.Uniform1i(l),u_skirt_height:new a.Uniform1f(l)}),Hs=(l,n)=>({u_matrix:l,u_image0:0,u_skirt_height:n}),ja=(l,n,o,h,d,f,y,x,b,M,E,z,P,U)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:o,u_zoom_transition:d,u_merc_center:f,u_image0:0,u_frustum_tl:y,u_frustum_tr:x,u_frustum_br:b,u_frustum_bl:M,u_globe_pos:E,u_globe_radius:z,u_viewport:P,u_grid_matrix:U?Float32Array.from(U):new Float32Array(9)});function Ys(l,n){return null!=l&&null!=n&&!(!l.hasData()||!n.hasData())&&null!=l.demTexture&&null!=n.demTexture&&l.tileID.key!==n.tileID.key}const uo=new class{constructor(){this.operations={}}newMorphing(l,n,o,h,d){if(l in this.operations){const f=this.operations[l];f.to.tileID.key!==o.tileID.key&&(f.queued=o)}else this.operations[l]={startTime:h,phase:0,duration:d,from:n,to:o,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const n=this.operations[l];return{from:n.from,to:n.to,phase:n.phase}}update(l){for(const n in this.operations){const o=this.operations[n];for(o.phase=(l-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,l)){delete this.operations[n];break}}}_nextOp(l,n){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=n,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Ro={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Js(l,n){const o=1<<l.z;return!n&&(0===l.x||l.x===o-1)||0===l.y||l.y===o-1}const fs=l=>({u_matrix:l});function Ks(l,n,o,h,d){if(d>0){const f=a.exported.now(),y=(f-l.timeAdded)/d,x=n?(f-n.timeAdded)/d:-1,b=o.getSource(),M=h.coveringZoomLevel({tileSize:b.tileSize,roundZoom:b.roundZoom}),E=!n||Math.abs(n.tileID.overscaledZ-M)>Math.abs(l.tileID.overscaledZ-M),z=E&&l.refreshedUponExpiration?1:a.clamp(E?y:1-x,0,1);return l.refreshedUponExpiration&&y>=1&&(l.refreshedUponExpiration=!1),n?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class At extends a.SourceCache{constructor(n){const o={type:"raster-dem",maxzoom:n.transform.maxZoom},h=new Tn(ot(),null),d=ae("mock-dem",o,h,n.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,o){n.state="loaded",o(null)}}class Qs extends a.SourceCache{constructor(n){const o=ae("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Tn(ot(),null),n.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,o,h){if(n.freezeTileCoverage)return;this.transform=n;const d=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((f,y)=>{if(f[y.key]="",!this._tiles[y.key]){const x=new a.Tile(y,this._source.tileSize*y.overscaleFactor(),n.tileZoom);x.state="loaded",this._tiles[y.key]=x}return f},{});for(const f in this._tiles)f in d||(this.freeFBO(f),this._tiles[f].unloadVectorData(),delete this._tiles[f])}freeFBO(n){const o=this.proxyCachedFBO[n];if(void 0!==o){const h=Object.values(o);this.renderCachePool.push(...h),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ga extends a.OverscaledTileID{constructor(n,o,h){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=o,this.projMatrix=h}}class sc extends a.Elevation{constructor(n,o){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,d,f]=function(b){const M=new a.StructArrayLayout4i8,E=new a.StructArrayLayout3ui6,z=131;M.reserve(17161),E.reserve(33800);const P=a.EXTENT/128,U=a.EXTENT+P/2,F=U+P;for(let O=-P;O<F;O+=P)for(let R=-P;R<F;R+=P){const q=R<0||R>U||O<0||O>U?24575:0,N=a.clamp(Math.round(R),0,a.EXTENT),H=a.clamp(Math.round(O),0,a.EXTENT);M.emplaceBack(N+q,H,N,H)}const Z=(O,R)=>{const q=R*z+O;E.emplaceBack(q+1,q,q+z),E.emplaceBack(q+z,q+z+1,q+1)};for(let O=1;O<129;O++)for(let R=1;R<129;R++)Z(R,O);return[0,129].forEach(O=>{for(let R=0;R<130;R++)Z(R,O),Z(O,R)}),[M,E,32768]}(),y=n.context;this.gridBuffer=y.createVertexBuffer(h,a.boundsAttributes.members),this.gridIndexBuffer=y.createIndexBuffer(d),this.gridSegments=a.SegmentVector.simpleSegment(0,0,h.length,d.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,h.length,f),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Qs(o.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,a.EXTENT,0,a.EXTENT,0,1);const x=y.gl;this._overlapStencilMode=new a.StencilMode({func:x.GEQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new At(o.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,o,h){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const d=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(d.get("source")),this._exaggeration=d.get("exaggeration");const f=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const y=this.getScaledDemTileSize();this.sourceCache.update(o,y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,f(),this._initializing=!0),f(),o.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&a.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=0===h._centerAltitude&&-1===this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(h.center),-1),this._emptyDEMTextureDirty=!this._initializing);const d=this.proxyCoords=o.getIds().map(b=>{const M=o.getTileByID(b).tileID;return M.projMatrix=h.calculateProjMatrix(M.toUnwrapped()),M});(function(b,M){const E=M.transform.pointCoordinate(M.transform.getCameraPoint()),z=new a.pointGeometry(E.x,E.y);b.sort((P,U)=>{if(U.overscaledZ-P.overscaledZ)return U.overscaledZ-P.overscaledZ;const F=new a.pointGeometry(P.canonical.x+(1<<P.canonical.z)*P.wrap,P.canonical.y),Z=new a.pointGeometry(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),O=z.mult(1<<P.canonical.z);return O.x-=.5,O.y-=.5,O.distSqr(F)-O.distSqr(Z)})})(d,this.painter),this._previousZoom=h.zoom;const f=this.proxyToSource||{};this.proxyToSource={},d.forEach(b=>{this.proxyToSource[b.key]={}}),this.terrainTileForTile={};const y=this._style._sourceCaches;for(const b in y){const M=y[b];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,n[b],f),M.usedForTerrain))continue;const E=n[b];M.getSource().reparseOverscaled&&this._assignTerrainTiles(E)}this.proxiedCoords[o.id]=d.map(b=>new Ga(b,b.key,this.orthoMatrix)),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(f),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const x={};this._visibleDemTiles=[];for(const b of this.proxyCoords){const M=this.terrainTileForTile[b.key];if(!M)continue;const E=M.tileID.key;E in x||(this._visibleDemTiles.push(M),x[E]=E)}}_assignTerrainTiles(n){this._initializing||n.forEach(o=>{if(this.terrainTileForTile[o.key])return;const h=this._findTileCoveringTileID(o,this.sourceCache);h&&(this.terrainTileForTile[o.key]=h)})}_prepareDEMTextures(){const n=this.painter.context,o=n.gl;for(const h in this.terrainTileForTile){const d=this.terrainTileForTile[h],f=d.dem;!f||d.demTexture&&!d.needsDEMTextureUpload||(n.activeTexture.set(o.TEXTURE1),Oo(this.painter,d,f))}}_prepareDemTileUniforms(n,o,h,d){if(!o||null==o.demTexture)return!1;const f=n.tileID.canonical,y=Math.pow(2,o.tileID.canonical.z-f.z),x=d||"";return h[`u_dem_tl${x}`]=[f.x*y%1,f.y*y%1],h[`u_dem_scale${x}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,o=n.gl;if(!this._emptyDepthBufferTexture){const h=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(n,h,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const o=this._visibleDemTiles.reduce((h,d)=>{if(!d.dem)return h;const f=d.dem.tree.minimums[0];return f>0&&n++,h+f},0);return n?o/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,o=n.gl;n.activeTexture.set(o.TEXTURE2);const h=this._getLoadedAreaMinimum(),d=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(h,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let f=this._emptyDEMTexture;return f?f.update(d,{premultiply:!1}):f=this._emptyDEMTexture=new a.Texture(n,d,o.RGBA,{premultiply:!1}),f}setupElevationDraw(n,o,h){const d=this.painter.context,f=d.gl,y=(x=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(x),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var x;y.u_dem_size=this.sourceCache.getSource().tileSize,y.u_exaggeration=this.exaggeration();let b=null,M=null,E=1;if(h&&h.morphing&&this._useVertexMorphing){const z=h.morphing.srcDemTile,P=h.morphing.dstDemTile;E=h.morphing.phase,z&&P&&(this._prepareDemTileUniforms(n,z,y,"_prev")&&(M=z),this._prepareDemTileUniforms(n,P,y)&&(b=P))}if(M&&b?(d.activeTexture.set(f.TEXTURE2),b.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),d.activeTexture.set(f.TEXTURE4),M.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),y.u_dem_lerp=E):(b=this.terrainTileForTile[n.tileID.key],d.activeTexture.set(f.TEXTURE2),(this._prepareDemTileUniforms(n,b,y)?b.demTexture:this.emptyDEMTexture).bind(f.NEAREST,f.CLAMP_TO_EDGE)),d.activeTexture.set(f.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),this._depthFBO&&(y.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),y.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&b){const z=(1<<b.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=z}if(h&&h.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),o.setTerrainUniformValues(d,y),"globe"===this.painter.transform.projection.name){const z=this.globeUniformValues(this.painter.transform,n.tileID.canonical,h&&h.useDenormalizedUpVectorScale);o.setGlobeUniformValues(d,z)}}globeUniformValues(n,o,h){const d=n.projection;return{u_tile_tl_up:d.upVector(o,0,0),u_tile_tr_up:d.upVector(o,a.EXTENT,0),u_tile_br_up:d.upVector(o,a.EXTENT,a.EXTENT),u_tile_bl_up:d.upVector(o,0,a.EXTENT),u_tile_up_scale:h?a.GLOBE_METERS_TO_ECEF:d.upVectorScale(o,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const o=this.painter,h=this.painter.context;0!==n.length&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(d,f,y,x,b){if("globe"===d.transform.projection.name)!function(M,E,z,P,U){const F=M.context,Z=F.gl;let O,R;const q=M.options.showTerrainWireframe?2:0,N=M.transform,H=a.globeUseCustomAntiAliasing(M,F,N),te=(De,ve)=>{if(R===De)return;const Ie=[Ro[De],"PROJECTION_GLOBE_VIEW"];H&&Ie.push("CUSTOM_ANTIALIASING"),ve&&Ie.push(Ro[q]),O=M.useProgram("globeRaster",null,Ie),R=De},Q=M.colorModeForRenderPass(),re=new a.DepthMode(Z.LEQUAL,a.DepthMode.ReadWrite,M.depthRangeFor3D);uo.update(U);const me=a.calculateGlobeMercatorMatrix(N),de=[a.mercatorXfromLng(N.center.lng),a.mercatorYfromLat(N.center.lat)],oe=q?[!1,!0]:[!1],Oe=M.globeSharedBuffers,he=[N.width*a.exported.devicePixelRatio,N.height*a.exported.devicePixelRatio],Te=Float32Array.from(N.globeMatrix),ge={useDenormalizedUpVectorScale:!0};if(oe.forEach(De=>{R=-1;const ve=De?Z.LINES:Z.TRIANGLES;for(const Ie of P){const Re=z.getTile(Ie),se=a.StencilMode.disabled,_e=E.prevTerrainTileForTile[Ie.key],Xe=E.terrainTileForTile[Ie.key];Ys(_e,Xe)&&uo.newMorphing(Ie.key,_e,Xe,U,250),F.activeTexture.set(Z.TEXTURE0),Re.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Qe=uo.getMorphValuesForProxy(Ie.key),He=Qe?1:0;Qe&&a.extend$1(ge,{morphing:{srcDemTile:Qe.from,dstDemTile:Qe.to,phase:a.easeCubicInOut(Qe.phase)}});const st=a.tileCornersToBounds(Ie.canonical),dt=a.getLatitudinalLod(st.getCenter().lat),et=a.getGridMatrix(Ie.canonical,st,dt,N.worldSize/N._pixelsPerMercatorPixel),qe=a.globeNormalizeECEF(a.globeTileBounds(Ie.canonical)),Rt=ja(N.projMatrix,Te,me,qe,a.globeToMercatorTransition(N.zoom),de,N.frustumCorners.TL,N.frustumCorners.TR,N.frustumCorners.BR,N.frustumCorners.BL,N.globeCenterInViewSpace,N.globeRadius,he,et);if(te(He,De),E.setupElevationDraw(Re,O,ge),M.prepareDrawProgram(F,O,Ie.toUnwrapped()),Oe){const[kt,Gt,Zt]=De?Oe.getWirefameBuffers(M.context,dt):Oe.getGridBuffers(dt);O.draw(F,ve,re,se,Q,a.CullFaceMode.backCCW,Rt,"globe_raster",kt,Gt,Zt)}}}),Oe){const De=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];H&&De.push("CUSTOM_ANTIALIASING"),O=M.useProgram("globeRaster",null,De);for(const ve of P){const{x:Ie,y:Re,z:se}=ve.canonical,_e=0===Re,Xe=Re===(1<<se)-1,[Qe,He,st,dt]=Oe.getPoleBuffers(se);if(dt&&(_e||Xe)){const et=z.getTile(ve);F.activeTexture.set(Z.TEXTURE0),et.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let qe=a.globePoleMatrixForTile(se,Ie,N);const Rt=a.globeNormalizeECEF(a.globeTileBounds(ve.canonical)),kt=(Gt,Zt)=>Gt.draw(F,Z.TRIANGLES,re,a.StencilMode.disabled,Q,a.CullFaceMode.disabled,ja(N.projMatrix,qe,qe,Rt,0,de,N.frustumCorners.TL,N.frustumCorners.TR,N.frustumCorners.BR,N.frustumCorners.BL,N.globeCenterInViewSpace,N.globeRadius,he),"globe_pole_raster",Zt,st,dt);E.setupElevationDraw(et,O,ge),M.prepareDrawProgram(F,O,ve.toUnwrapped()),_e&&kt(O,Qe),Xe&&(qe=a.scale(a.create(),qe,[1,-1,1]),kt(O,He))}}}}(d,f,y,x,b);else{const M=d.context,E=M.gl;let z,P;const U=d.options.showTerrainWireframe?2:0,F=(N,H)=>{if(P===N)return;const te=[Ro[N]];H&&te.push(Ro[U]),z=d.useProgram("terrainRaster",null,te),P=N},Z=d.colorModeForRenderPass(),O=new a.DepthMode(E.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D);uo.update(b);const R=d.transform,q=6*Math.pow(1.5,22-R.zoom)*f.exaggeration();(U?[!1,!0]:[!1]).forEach(N=>{P=-1;const H=N?E.LINES:E.TRIANGLES,[te,Q]=N?f.getWirefameBuffer():[f.gridIndexBuffer,f.gridSegments];for(const re of x){const me=y.getTile(re),de=a.StencilMode.disabled,oe=f.prevTerrainTileForTile[re.key],Oe=f.terrainTileForTile[re.key];Ys(oe,Oe)&&uo.newMorphing(re.key,oe,Oe,b,250),M.activeTexture.set(E.TEXTURE0),me.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST);const he=uo.getMorphValuesForProxy(re.key),Te=he?1:0;let ge;he&&(ge={morphing:{srcDemTile:he.from,dstDemTile:he.to,phase:a.easeCubicInOut(he.phase)}});const De=Hs(re.projMatrix,Js(re.canonical,R.renderWorldCopies)?q/10:q);F(Te,N),f.setupElevationDraw(me,z,ge),d.prepareDrawProgram(M,z,re.toUnwrapped()),z.draw(M,H,O,de,Z,a.CullFaceMode.backCCW,De,"terrain_raster",f.gridBuffer,te,Q)}})}}(o,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const o=this.painter,h=this.painter.context,d=this.proxySourceCache,f=this.proxiedCoords[d.id],y=this._drapedRenderBatches.shift(),x=[],b=o.style.order;let M=0;for(const E of f){const z=d.getTileByID(E.proxyTileKey),P=d.proxyCachedFBO[E.key]?d.proxyCachedFBO[E.key][n]:void 0,U=void 0!==P?d.renderCache[P]:this.pool[M++],F=void 0!==P;if(z.texture=U.tex,F&&!U.dirty){x.push(z.tileID);continue}let Z;h.bindFramebuffer.set(U.fb.framebuffer),this.renderedToTile=!1,U.dirty&&(h.clear({color:a.Color.transparent,stencil:0}),U.dirty=!1);for(let O=y.start;O<=y.end;++O){const R=o.style._layers[b[O]];if(R.isHidden(o.transform.zoom))continue;const q=o.style._getLayerSourceCache(R),N=q?this.proxyToSource[E.key][q.id]:[E];if(!N)continue;const H=N;h.viewport.set([0,0,U.fb.width,U.fb.height]),Z!==(q?q.id:null)&&(this._setupStencil(U,N,R,q),Z=q?q.id:null),o.renderLayer(o,q,R,H)}this.renderedToTile?(U.dirty=!0,x.push(z.tileID)):F||--M,5===M&&(M=0,this.renderToBackBuffer(x))}return this.renderToBackBuffer(x),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,o.width,o.height]),y.end+1}postRender(){}renderCacheEfficiency(n){const o=n.order.length;if(0===o)return{efficiency:100};let h,d=0,f=0,y=!1;for(let x=0;x<o;++x){const b=n._layers[n.order[x]];this._style.isLayerDraped(b)?(y&&++d,++f):y||(y=!0,h=b.id)}return 0===f?{efficiency:100}:{efficiency:100*(1-d/f),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{n=Math.min(n,o.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,o,h){if(!this._visibleDemTiles)return null;const d=this._visibleDemTiles.filter(f=>f.dem).map(f=>{const y=f.tileID,x=1<<y.overscaledZ,{x:b,y:M}=y.canonical,E=b/x,z=(b+1)/x,P=M/x,U=(M+1)/x;return{minx:E,miny:P,maxx:z,maxy:U,t:f.dem.tree.raycastRoot(E,P,z,U,n,o,h),tile:f}});d.sort((f,y)=>(null!==f.t?f.t:Number.MAX_VALUE)-(null!==y.t?y.t:Number.MAX_VALUE));for(const f of d){if(null==f.t)return null;const y=f.tile.dem.tree.raycast(f.minx,f.miny,f.maxx,f.maxy,n,o,h);if(null!=y)return y}return null}_createFBO(){const n=this.painter.context,o=n.gl,h=this.drapeBufferSize;n.activeTexture.set(o.TEXTURE0);const d=new a.Texture(n,{width:h[0],height:h[1],data:null},o.RGBA);d.bind(o.LINEAR,o.CLAMP_TO_EDGE);const f=n.createFramebuffer(h[0],h[1],!1);return f.colorAttachment.set(d.texture),f.depthAttachment=new to(n,f.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,f.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):f.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:f,tex:d,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const o=this._style._layers[n],h=o.isHidden(this.painter.transform.zoom);return"custom"!==o.type&&!h&&o.hasTransition()})}_clearRasterFadeFromRenderCache(){let n=!1;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o]._source instanceof D){n=!0;break}if(n)for(let o=0;o<this._style.order.length;++o){const h=this._style._layers[this._style.order[o]],d=h.isHidden(this.painter.transform.zoom),f=this._style._getLayerSourceCache(h);if("raster"!==h.type||d||!f)continue;const y=h.paint.get("raster-fade-duration");for(const x of this.proxyCoords){const b=this.proxyToSource[x.key][f.id];if(b)for(const M of b){const E=Ks(f.getTile(M),f.findLoadedParent(M,0),f,this.painter.transform,y);(1!==E.opacity||0!==E.mix)&&this._clearRenderCacheForTile(f.id,M)}}}}_setupDrapedRenderBatches(){const n=this._style.order,o=n.length;if(0===o)return;const h=[];let d,f=0,y=this._style._layers[n[f]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++f<o;)y=this._style._layers[n[f]];for(;f<o;++f){const x=this._style._layers[n[f]];x.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(x)?void 0===d&&(d=f):void 0!==d&&(h.push({start:d,end:f-1}),d=void 0))}void 0!==d&&h.push({start:d,end:f-1}),this._drapedRenderBatches=h}_setupRenderCache(n){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const y=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let x=0;x<y.length;++x){const b=Object.values(y[x]);o.renderCachePool.push(...b)}}return}this._clearRasterFadeFromRenderCache();const h=this.proxyCoords,d=this._tilesDirty;for(let y=h.length-1;y>=0;y--){const x=h[y];if(o.getTileByID(x.key),void 0!==o.proxyCachedFBO[x.key]){const b=n[x.key],M=this.proxyToSource[x.key];let E=0;for(const z in M){const P=M[z],U=b[z];if(!U||U.length!==P.length||P.some((F,Z)=>F!==U[Z]||d[z]&&d[z].hasOwnProperty(F.key))){E=-1;break}++E}for(const z in o.proxyCachedFBO[x.key])o.renderCache[o.proxyCachedFBO[x.key][z]].dirty=E<0||E!==Object.values(b).length}}const f=[...this._drapedRenderBatches];f.sort((y,x)=>x.end-x.start-(y.end-y.start));for(const y of f)for(const x of h){if(o.proxyCachedFBO[x.key])continue;let b=o.renderCachePool.pop();void 0===b&&o.renderCache.length<50&&(b=o.renderCache.length,o.renderCache.push(this._createFBO())),void 0!==b&&(o.proxyCachedFBO[x.key]={},o.proxyCachedFBO[x.key][y.start]=b,o.renderCache[b].dirty=!0)}this._tilesDirty={}}_setupStencil(n,o,h,d){if(!d||!this._sourceTilesOverlap[d.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const f=this.painter.context,y=f.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let x;if(h.isTileClipped())x=o.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);x=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+x>255&&(f.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=x,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(n,o){const h=this.painter,d=this.painter.context,f=d.gl;h._tileClippingMaskIDs={},d.setColorMode(a.ColorMode.disabled),d.setDepthMode(a.DepthMode.disabled);const y=h.useProgram("clippingMask");for(const x of n){const b=h._tileClippingMaskIDs[x.key]=--o;y.draw(d,f.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:f.ALWAYS,mask:0},b,255,f.KEEP,f.KEEP,f.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,fs(x.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(n){const o=this.painter.transform;if(n.x<0||n.x>o.width||n.y<0||n.y>o.height)return null;const h=[n.x,n.y,1,1];a.transformMat4$1(h,h,o.pixelMatrixInverse),a.scale$1(h,h,1/h[3]),h[0]/=o.worldSize,h[1]/=o.worldSize;const d=o._camera.position,f=a.mercatorZfromAltitude(1,o.center.lat),y=[d[0],d[1],d[2]/f,0],x=a.subtract([],h.slice(0,3),y);a.normalize(x,x);const b=this.raycast(y,x,this._exaggeration);return null!==b&&b?(a.scaleAndAdd(y,y,x,b),y[3]=y[2],y[2]*=f,y):null}drawDepth(){const n=this.painter,o=n.context,h=this.proxySourceCache,d=Math.ceil(n.width),f=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===d&&this._depthFBO.height===f||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const y=o.gl,x=o.createFramebuffer(d,f,!0);o.activeTexture.set(y.TEXTURE0);const b=new a.Texture(o,{width:d,height:f,data:null},y.RGBA);b.bind(y.NEAREST,y.CLAMP_TO_EDGE),x.colorAttachment.set(b.texture);const M=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,d,f);x.depthAttachment.set(M),this._depthFBO=x,this._depthTexture=b}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,d,f]),function(y,x,b,M){if("globe"===y.transform.projection.name)return;const E=y.context,z=E.gl;E.clear({depth:1});const P=y.useProgram("terrainDepth"),U=new a.DepthMode(z.LESS,a.DepthMode.ReadWrite,y.depthRangeFor3D);for(const F of M){const Z=b.getTile(F),O=Hs(F.projMatrix,0);x.setupElevationDraw(Z,P),P.draw(E,z.TRIANGLES,U,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,O,"terrain_depth",x.gridBuffer,x.gridIndexBuffer,x.gridNoSkirtSegments)}}(n,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,o,h){if(n.getSource()instanceof ie)return this._setupProxiedCoordsForImageSource(n,o,h);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const d=this.proxiedCoords[n.id]=[],f=this.proxyCoords;for(let x=0;x<f.length;x++){const b=f[x],M=this._findTileCoveringTileID(b,n);if(M){const E=this._createProxiedId(b,M,h[b.key]&&h[b.key][n.id]);d.push(E),this.proxyToSource[b.key][n.id]=[E]}}let y=!1;for(let x=0;x<o.length;x++){const b=n.getTile(o[x]);if(!b||!b.hasData())continue;const M=this._findTileCoveringTileID(b.tileID,this.proxySourceCache);if(M&&M.tileID.canonical.z!==b.tileID.canonical.z){const E=this.proxyToSource[M.tileID.key][n.id],z=this._createProxiedId(M.tileID,b,h[M.tileID.key]&&h[M.tileID.key][n.id]);E?E.splice(E.length-1,0,z):this.proxyToSource[M.tileID.key][n.id]=[z],d.push(z),y=!0}}this._sourceTilesOverlap[n.id]=y}_setupProxiedCoordsForImageSource(n,o,h){if(!n.getSource().loaded())return;const d=this.proxiedCoords[n.id]=[],f=this.proxyCoords,y=n.getSource(),x=new a.pointGeometry(y.tileID.x,y.tileID.y)._div(1<<y.tileID.z),b=y.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((E,z)=>(E.min.x=Math.min(E.min.x,z.x-x.x),E.min.y=Math.min(E.min.y,z.y-x.y),E.max.x=Math.max(E.max.x,z.x-x.x),E.max.y=Math.max(E.max.y,z.y-x.y),E),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),M=(E,z)=>{const P=E.wrap+E.canonical.x/(1<<E.canonical.z),U=E.canonical.y/(1<<E.canonical.z),F=a.EXTENT/(1<<E.canonical.z),Z=z.wrap+z.canonical.x/(1<<z.canonical.z),O=z.canonical.y/(1<<z.canonical.z);return P+F<Z+b.min.x||P>Z+b.max.x||U+F<O+b.min.y||U>O+b.max.y};for(let E=0;E<f.length;E++){const z=f[E];for(let P=0;P<o.length;P++){const U=n.getTile(o[P]);if(!U||!U.hasData()||M(z,U.tileID))continue;const F=this._createProxiedId(z,U,h[z.key]&&h[z.key][n.id]),Z=this.proxyToSource[z.key][n.id];Z?Z.push(F):this.proxyToSource[z.key][n.id]=[F],d.push(F)}}}_createProxiedId(n,o,h){let d=this.orthoMatrix;if(h){const f=h.find(y=>y.key===o.tileID.key);if(f)return f}if(o.tileID.key!==n.key){const f=n.canonical.z-o.tileID.canonical.z;let y,x,b;d=a.create();const M=o.tileID.wrap-n.wrap<<n.overscaledZ;f>0?(y=a.EXTENT>>f,x=y*((o.tileID.canonical.x<<f)-n.canonical.x+M),b=y*((o.tileID.canonical.y<<f)-n.canonical.y)):(y=a.EXTENT<<-f,x=a.EXTENT*(o.tileID.canonical.x-(n.canonical.x+M<<-f)),b=a.EXTENT*(o.tileID.canonical.y-(n.canonical.y<<-f))),a.ortho(d,0,y,0,y,0,1),a.translate(d,d,[x,b,0])}return new Ga(o.tileID,n.key,d)}_findTileCoveringTileID(n,o){let h=o.getTile(n);if(h&&h.hasData())return h;const d=this._findCoveringTileCache[o.id],f=d[n.key];if(h=f?o.getTileByID(f):null,h&&h.hasData()||null===f)return h;let y=h?h.tileID:n,x=y.overscaledZ;const b=o.getSource().minzoom,M=[];if(!f){const z=o.getSource().maxzoom;if(n.canonical.z>=z){const P=n.canonical.z-z;o.getSource().reparseOverscaled?(x=Math.max(n.canonical.z+2,o.transform.tileZoom),y=new a.OverscaledTileID(x,n.wrap,z,n.canonical.x>>P,n.canonical.y>>P)):0!==P&&(x=z,y=new a.OverscaledTileID(x,n.wrap,z,n.canonical.x>>P,n.canonical.y>>P))}y.key!==n.key&&(M.push(y.key),h=o.getTile(y))}const E=z=>{M.forEach(P=>{d[P]=z}),M.length=0};for(x-=1;x>=b&&(!h||!h.hasData());x--){h&&E(h.tileID.key);const z=y.calculateScaledKey(x);if(h=o.getTileByID(z),h&&h.hasData())break;const P=d[z];if(null===P)break;void 0===P?M.push(z):h=o.getTileByID(P)}return E(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,o){let h=this._tilesDirty[n];h||(h=this._tilesDirty[n]={}),h[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(o){let h=0;const d=new a.StructArrayLayout2ui4,f=131;for(let y=1;y<129;y++){for(let x=1;x<129;x++)h=y*f+x,d.emplaceBack(h,h+1),d.emplaceBack(h,h+f),d.emplaceBack(h+1,h+f),128===y&&d.emplaceBack(h+f,h+f+1);d.emplaceBack(h+1,h+1+f)}return d}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class qa{static cacheKey(n,o,h,d){let f=`${o}${d?d.cacheKey:""}`;for(const y of h)n.usedDefines.includes(y)&&(f+=`/${y}`);return f}constructor(n,o,h,d,f,y){const x=n.gl;this.program=x.createProgram();const b=function(O){const R=[];for(let q=0;q<O.length;q++){if(null===O[q])continue;const N=O[q].split(" ");R.push(N.pop())}return R}(h.staticAttributes),M=d?d.getBinderAttributes():[],E=b.concat(M);let z=d?d.defines():[];z=z.concat(y.map(O=>`#define ${O}`));const P=z.concat(n.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(us):us,us,rc,Za.fragmentSource,Ws.fragmentSource,h.fragmentSource).join("\n"),U=z.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",rc,Za.vertexSource,Ws.vertexSource,nc.vertexSource,h.vertexSource).join("\n"),F=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(F,P),x.compileShader(F),x.attachShader(this.program,F);const Z=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())this.failedToCreate=!0;else{x.shaderSource(Z,U),x.compileShader(Z),x.attachShader(this.program,Z),this.attributes={},this.numAttributes=E.length;for(let O=0;O<this.numAttributes;O++)E[O]&&(x.bindAttribLocation(this.program,O,E[O]),this.attributes[E[O]]=O);x.linkProgram(this.program),x.deleteShader(Z),x.deleteShader(F),this.fixedUniforms=f(n),this.binderUniforms=d?d.getUniforms(n):[],y.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new a.Uniform1i(O=n),u_dem_prev:new a.Uniform1i(O),u_dem_unpack:new a.Uniform4f(O),u_dem_tl:new a.Uniform2f(O),u_dem_scale:new a.Uniform1f(O),u_dem_tl_prev:new a.Uniform2f(O),u_dem_scale_prev:new a.Uniform1f(O),u_dem_size:new a.Uniform1f(O),u_dem_lerp:new a.Uniform1f(O),u_exaggeration:new a.Uniform1f(O),u_depth:new a.Uniform1i(O),u_depth_size_inv:new a.Uniform2f(O),u_meter_to_dem:new a.Uniform1f(O),u_label_plane_matrix_inv:new a.UniformMatrix4f(O)}),y.includes("GLOBE")&&(this.globeUniforms=(O=>({u_tile_tl_up:new a.Uniform3f(O),u_tile_tr_up:new a.Uniform3f(O),u_tile_br_up:new a.Uniform3f(O),u_tile_bl_up:new a.Uniform3f(O),u_tile_up_scale:new a.Uniform1f(O)}))(n)),y.includes("FOG")&&(this.fogUniforms=(O=>({u_fog_matrix:new a.UniformMatrix4f(O),u_fog_range:new a.Uniform2f(O),u_fog_color:new a.Uniform4f(O),u_fog_horizon_blend:new a.Uniform1f(O),u_fog_temporal_offset:new a.Uniform1f(O),u_frustum_tl:new a.Uniform3f(O),u_frustum_tr:new a.Uniform3f(O),u_frustum_br:new a.Uniform3f(O),u_frustum_bl:new a.Uniform3f(O),u_globe_pos:new a.Uniform3f(O),u_globe_radius:new a.Uniform1f(O),u_globe_transition:new a.Uniform1f(O),u_is_globe:new a.Uniform1i(O),u_viewport:new a.Uniform2f(O)}))(n))}var O}setTerrainUniformValues(n,o){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in o)h[d]&&h[d].set(this.program,d,o[d])}}setGlobeUniformValues(n,o){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in o)h[d]&&h[d].set(this.program,d,o[d])}}setFogUniformValues(n,o){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in o)h[d].set(this.program,d,o[d])}}draw(n,o,h,d,f,y,x,b,M,E,z,P,U,F,Z){const O=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(h),n.setStencilMode(d),n.setColorMode(f),n.setCullFace(y);for(const q of Object.keys(this.fixedUniforms))this.fixedUniforms[q].set(this.program,q,x[q]);F&&F.setUniforms(this.program,n,this.binderUniforms,P,{zoom:U});const R={[O.LINES]:2,[O.TRIANGLES]:3,[O.LINE_STRIP]:1}[o];for(const q of z.get()){const N=q.vaos||(q.vaos={});(N[b]||(N[b]=new oc)).bind(n,this,M,F?F.getPaintVertexBuffers():[],E,q.vertexOffset,Z||[]),O.drawElements(o,q.primitiveLength*R,O.UNSIGNED_SHORT,q.primitiveOffset*R*2)}}}function ea(l,n){const o=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,l.transform.tileZoom)/o,d=h*(n.tileID.canonical.x+n.tileID.wrap*o),f=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/hn(n,1,l.transform.tileZoom),u_pixel_coord_upper:[d>>16,f>>16],u_pixel_coord_lower:[65535&d,65535&f]}}const ac=a.create(),lc=(l,n,o,h,d,f,y,x,b,M,E)=>{const z=n.style.light,P=z.properties.get("position"),U=[P.x,P.y,P.z],F=a.create$1();"viewport"===z.properties.get("anchor")&&(a.fromRotation(F,-n.transform.angle),a.transformMat3(U,U,F));const Z=z.properties.get("color"),O=n.transform,R={u_matrix:l,u_lightpos:U,u_lightintensity:z.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+o,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ac,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:d,u_edge_radius:f};return"globe"===O.projection.name&&(R.u_tile_id=[y.canonical.x,y.canonical.y,1<<y.canonical.z],R.u_zoom_transition=b,R.u_inv_rot_matrix=E,R.u_merc_center=M,R.u_up_dir=O.projection.upVector(new a.CanonicalTileID(0,0,0),M[0]*a.EXTENT,M[1]*a.EXTENT),R.u_height_lift=x),R},Ph=(l,n,o,h,d,f,y,x,b,M,E,z)=>{const P=lc(l,n,o,h,d,f,y,b,M,E,z),U={u_height_factor:-Math.pow(2,y.overscaledZ)/x.tileSize/8};return a.extend(P,ea(n,x),U)},ta=l=>({u_matrix:l}),ia=(l,n,o)=>a.extend(ta(l),ea(n,o)),$a=(l,n)=>({u_matrix:l,u_world:n}),Wa=(l,n,o,h)=>a.extend(ia(l,n,o),{u_world:h}),cc=a.create(),hc=(l,n,o,h,d,f)=>{const y=l.transform,x="globe"===y.projection.name;let b;if("map"===f.paint.get("circle-pitch-alignment"))if(x){const E=a.globePixelsToTileUnits(y.zoom,n.canonical)*y._pixelsPerMercatorPixel;b=Float32Array.from([E,0,0,E])}else b=y.calculatePixelsToTileUnitsMatrix(o);else b=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:l.translatePosMatrix(n.projMatrix,o,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:cc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(x){M.u_inv_rot_matrix=h,M.u_merc_center=d,M.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],M.u_zoom_transition=a.globeToMercatorTransition(y.zoom);const E=d[0]*a.EXTENT,z=d[1]*a.EXTENT;M.u_up_dir=y.projection.upVector(new a.CanonicalTileID(0,0,0),E,z)}return M},Lh=l=>{const n=[];return"map"===l.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===l.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},ms=(l,n,o,h)=>{const d=a.EXTENT/o.tileSize;return{u_matrix:l,u_camera_to_center_distance:n.getCameraToCenterDistance(h),u_extrude_scale:[n.pixelsToGLUnits[0]/d,n.pixelsToGLUnits[1]/d]}},Bo=(l,n,o=1)=>({u_matrix:l,u_color:n,u_overlay:0,u_overlay_scale:o}),uc=a.create(),na=(l,n,o,h,d,f,y)=>{const x=l.transform,b="globe"===x.projection.name,M=b?a.globePixelsToTileUnits(x.zoom,n.canonical)*x._pixelsPerMercatorPixel:hn(o,1,f),E={u_matrix:n.projMatrix,u_extrude_scale:M,u_intensity:y,u_inv_rot_matrix:uc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(b){E.u_inv_rot_matrix=h,E.u_merc_center=d,E.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],E.u_zoom_transition=a.globeToMercatorTransition(x.zoom);const z=d[0]*a.EXTENT,P=d[1]*a.EXTENT;E.u_up_dir=x.projection.upVector(new a.CanonicalTileID(0,0,0),z,P)}return E},Xa=(l,n,o,h,d,f,y)=>{const x=l.transform,b=x.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:Ha(l,n,o,h),u_pixels_to_tile_units:b,u_device_pixel_ratio:f,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:oa(o)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ra(n,l.transform),u_alpha_discard_threshold:0,u_trim_offset:y}},jn=(l,n,o,h,d)=>{const f=l.transform;return{u_matrix:Ha(l,n,o,h),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:d,u_image:0,u_tile_units_to_pixels:ra(n,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ra(l,n){return 1/hn(l,1,n.tileZoom)}function Ha(l,n,o,h){return l.translatePosMatrix(h||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function oa(l){const n=l.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const dc=(l,n,o,h,d,f)=>{return{u_matrix:l,u_tl_parent:n,u_scale_parent:o,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(x=d.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(y=d.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Ya(d.paint.get("raster-hue-rotate")),u_perspective_transform:f};var y,x};function Ya(l){l*=Math.PI/180;const n=Math.sin(l),o=Math.cos(l);return[(2*o+1)/3,(-Math.sqrt(3)*n-o+1)/3,(Math.sqrt(3)*n-o+1)/3]}const pc=a.create(),sa=(l,n,o,h,d,f,y,x,b,M,E,z,P,U,F,Z)=>{const O=d.transform,R={u_is_size_zoom_constant:+("constant"===l||"source"===l),u_is_size_feature_constant:+("constant"===l||"camera"===l),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:O.width/O.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:y,u_coord_matrix:x,u_is_text:+b,u_pitch_with_map:+h,u_texsize:M,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:pc,u_up_vector:[0,-1,0]};return"globe"===Z.name&&(R.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],R.u_zoom_transition=z,R.u_inv_rot_matrix=U,R.u_merc_center=P,R.u_camera_forward=O._camera.forward(),R.u_ecef_origin=a.globeECEFOrigin(O.globeMatrix,E.toUnwrapped()),R.u_tile_matrix=Float32Array.from(O.globeMatrix),R.u_up_vector=F),R},fc=(l,n,o,h,d,f,y,x,b,M,E,z,P,U,F,Z,O)=>a.extend(sa(l,n,o,h,d,f,y,x,b,M,z,P,U,F,Z,O),{u_gamma_scale:h?d.transform.cameraToCenterDistance*Math.cos(d.terrain?0:d.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+E}),aa=(l,n,o,h,d,f,y,x,b,M,E,z,P,U,F,Z)=>a.extend(fc(l,n,o,h,d,f,y,x,!0,b,!0,E,z,P,U,F,Z),{u_texsize_icon:M,u_texture_icon:1}),Oh=(l,n,o)=>({u_matrix:l,u_opacity:n,u_color:o}),Ja=(l,n,o,h,d)=>a.extend(function(f,y,x){const b=y.imageManager.getPattern(f.toString()),{width:M,height:E}=y.imageManager.getPixelSize(),z=Math.pow(2,x.tileID.overscaledZ),P=x.tileSize*Math.pow(2,y.transform.tileZoom)/z,U=P*(x.tileID.canonical.x+x.tileID.wrap*z),F=P*x.tileID.canonical.y;return{u_image:0,u_pattern_tl:b.tl,u_pattern_br:b.br,u_texsize:[M,E],u_pattern_size:b.displaySize,u_tile_units_to_pixels:1/hn(x,1,y.transform.tileZoom),u_pixel_coord_upper:[U>>16,F>>16],u_pixel_coord_lower:[65535&U,65535&F]}}(h,o,d),{u_matrix:l,u_opacity:n}),Rh={fillExtrusion:l=>({u_matrix:new a.UniformMatrix4f(l),u_lightpos:new a.Uniform3f(l),u_lightintensity:new a.Uniform1f(l),u_lightcolor:new a.Uniform3f(l),u_vertical_gradient:new a.Uniform1f(l),u_opacity:new a.Uniform1f(l),u_edge_radius:new a.Uniform1f(l),u_ao:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_up_dir:new a.Uniform3f(l),u_height_lift:new a.Uniform1f(l)}),fillExtrusionPattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_lightpos:new a.Uniform3f(l),u_lightintensity:new a.Uniform1f(l),u_lightcolor:new a.Uniform3f(l),u_vertical_gradient:new a.Uniform1f(l),u_height_factor:new a.Uniform1f(l),u_edge_radius:new a.Uniform1f(l),u_ao:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_up_dir:new a.Uniform3f(l),u_height_lift:new a.Uniform1f(l),u_image:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_pixel_coord_upper:new a.Uniform2f(l),u_pixel_coord_lower:new a.Uniform2f(l),u_tile_units_to_pixels:new a.Uniform1f(l),u_opacity:new a.Uniform1f(l)}),fill:l=>({u_matrix:new a.UniformMatrix4f(l)}),fillPattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_image:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_pixel_coord_upper:new a.Uniform2f(l),u_pixel_coord_lower:new a.Uniform2f(l),u_tile_units_to_pixels:new a.Uniform1f(l)}),fillOutline:l=>({u_matrix:new a.UniformMatrix4f(l),u_world:new a.Uniform2f(l)}),fillOutlinePattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_world:new a.Uniform2f(l),u_image:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_pixel_coord_upper:new a.Uniform2f(l),u_pixel_coord_lower:new a.Uniform2f(l),u_tile_units_to_pixels:new a.Uniform1f(l)}),circle:l=>({u_camera_to_center_distance:new a.Uniform1f(l),u_extrude_scale:new a.UniformMatrix2f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_up_dir:new a.Uniform3f(l)}),collisionBox:l=>({u_matrix:new a.UniformMatrix4f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_extrude_scale:new a.Uniform2f(l)}),collisionCircle:l=>({u_matrix:new a.UniformMatrix4f(l),u_inv_matrix:new a.UniformMatrix4f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_viewport_size:new a.Uniform2f(l)}),debug:l=>({u_color:new a.UniformColor(l),u_matrix:new a.UniformMatrix4f(l),u_overlay:new a.Uniform1i(l),u_overlay_scale:new a.Uniform1f(l)}),clippingMask:l=>({u_matrix:new a.UniformMatrix4f(l)}),heatmap:l=>({u_extrude_scale:new a.Uniform1f(l),u_intensity:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_up_dir:new a.Uniform3f(l)}),heatmapTexture:l=>({u_image:new a.Uniform1i(l),u_color_ramp:new a.Uniform1i(l),u_opacity:new a.Uniform1f(l)}),hillshade:l=>({u_matrix:new a.UniformMatrix4f(l),u_image:new a.Uniform1i(l),u_latrange:new a.Uniform2f(l),u_light:new a.Uniform2f(l),u_shadow:new a.UniformColor(l),u_highlight:new a.UniformColor(l),u_accent:new a.UniformColor(l)}),hillshadePrepare:l=>({u_matrix:new a.UniformMatrix4f(l),u_image:new a.Uniform1i(l),u_dimension:new a.Uniform2f(l),u_zoom:new a.Uniform1f(l),u_unpack:new a.Uniform4f(l)}),line:l=>({u_matrix:new a.UniformMatrix4f(l),u_pixels_to_tile_units:new a.UniformMatrix2f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_units_to_pixels:new a.Uniform2f(l),u_dash_image:new a.Uniform1i(l),u_gradient_image:new a.Uniform1i(l),u_image_height:new a.Uniform1f(l),u_texsize:new a.Uniform2f(l),u_tile_units_to_pixels:new a.Uniform1f(l),u_alpha_discard_threshold:new a.Uniform1f(l),u_trim_offset:new a.Uniform2f(l)}),linePattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_texsize:new a.Uniform2f(l),u_pixels_to_tile_units:new a.UniformMatrix2f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_image:new a.Uniform1i(l),u_units_to_pixels:new a.Uniform2f(l),u_tile_units_to_pixels:new a.Uniform1f(l),u_alpha_discard_threshold:new a.Uniform1f(l)}),raster:l=>({u_matrix:new a.UniformMatrix4f(l),u_tl_parent:new a.Uniform2f(l),u_scale_parent:new a.Uniform1f(l),u_fade_t:new a.Uniform1f(l),u_opacity:new a.Uniform1f(l),u_image0:new a.Uniform1i(l),u_image1:new a.Uniform1i(l),u_brightness_low:new a.Uniform1f(l),u_brightness_high:new a.Uniform1f(l),u_saturation_factor:new a.Uniform1f(l),u_contrast_factor:new a.Uniform1f(l),u_spin_weights:new a.Uniform3f(l),u_perspective_transform:new a.Uniform2f(l)}),symbolIcon:l=>({u_is_size_zoom_constant:new a.Uniform1i(l),u_is_size_feature_constant:new a.Uniform1i(l),u_size_t:new a.Uniform1f(l),u_size:new a.Uniform1f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_rotate_symbol:new a.Uniform1i(l),u_aspect_ratio:new a.Uniform1f(l),u_fade_change:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_label_plane_matrix:new a.UniformMatrix4f(l),u_coord_matrix:new a.UniformMatrix4f(l),u_is_text:new a.Uniform1i(l),u_pitch_with_map:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_camera_forward:new a.Uniform3f(l),u_tile_matrix:new a.UniformMatrix4f(l),u_up_vector:new a.Uniform3f(l),u_ecef_origin:new a.Uniform3f(l),u_texture:new a.Uniform1i(l)}),symbolSDF:l=>({u_is_size_zoom_constant:new a.Uniform1i(l),u_is_size_feature_constant:new a.Uniform1i(l),u_size_t:new a.Uniform1f(l),u_size:new a.Uniform1f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_rotate_symbol:new a.Uniform1i(l),u_aspect_ratio:new a.Uniform1f(l),u_fade_change:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_label_plane_matrix:new a.UniformMatrix4f(l),u_coord_matrix:new a.UniformMatrix4f(l),u_is_text:new a.Uniform1i(l),u_pitch_with_map:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_texture:new a.Uniform1i(l),u_gamma_scale:new a.Uniform1f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_camera_forward:new a.Uniform3f(l),u_tile_matrix:new a.UniformMatrix4f(l),u_up_vector:new a.Uniform3f(l),u_ecef_origin:new a.Uniform3f(l),u_is_halo:new a.Uniform1i(l)}),symbolTextAndIcon:l=>({u_is_size_zoom_constant:new a.Uniform1i(l),u_is_size_feature_constant:new a.Uniform1i(l),u_size_t:new a.Uniform1f(l),u_size:new a.Uniform1f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_rotate_symbol:new a.Uniform1i(l),u_aspect_ratio:new a.Uniform1f(l),u_fade_change:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_label_plane_matrix:new a.UniformMatrix4f(l),u_coord_matrix:new a.UniformMatrix4f(l),u_is_text:new a.Uniform1i(l),u_pitch_with_map:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_texsize_icon:new a.Uniform2f(l),u_texture:new a.Uniform1i(l),u_texture_icon:new a.Uniform1i(l),u_gamma_scale:new a.Uniform1f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_is_halo:new a.Uniform1i(l)}),background:l=>({u_matrix:new a.UniformMatrix4f(l),u_opacity:new a.Uniform1f(l),u_color:new a.UniformColor(l)}),backgroundPattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_opacity:new a.Uniform1f(l),u_image:new a.Uniform1i(l),u_pattern_tl:new a.Uniform2f(l),u_pattern_br:new a.Uniform2f(l),u_texsize:new a.Uniform2f(l),u_pattern_size:new a.Uniform2f(l),u_pixel_coord_upper:new a.Uniform2f(l),u_pixel_coord_lower:new a.Uniform2f(l),u_tile_units_to_pixels:new a.Uniform1f(l)}),terrainRaster:ps,terrainDepth:ps,skybox:l=>({u_matrix:new a.UniformMatrix4f(l),u_sun_direction:new a.Uniform3f(l),u_cubemap:new a.Uniform1i(l),u_opacity:new a.Uniform1f(l),u_temporal_offset:new a.Uniform1f(l)}),skyboxGradient:l=>({u_matrix:new a.UniformMatrix4f(l),u_color_ramp:new a.Uniform1i(l),u_center_direction:new a.Uniform3f(l),u_radius:new a.Uniform1f(l),u_opacity:new a.Uniform1f(l),u_temporal_offset:new a.Uniform1f(l)}),skyboxCapture:l=>({u_matrix_3f:new a.UniformMatrix3f(l),u_sun_direction:new a.Uniform3f(l),u_sun_intensity:new a.Uniform1f(l),u_color_tint_r:new a.Uniform4f(l),u_color_tint_m:new a.Uniform4f(l),u_luminance:new a.Uniform1f(l)}),globeRaster:l=>({u_proj_matrix:new a.UniformMatrix4f(l),u_globe_matrix:new a.UniformMatrix4f(l),u_normalize_matrix:new a.UniformMatrix4f(l),u_merc_matrix:new a.UniformMatrix4f(l),u_zoom_transition:new a.Uniform1f(l),u_merc_center:new a.Uniform2f(l),u_image0:new a.Uniform1i(l),u_grid_matrix:new a.UniformMatrix3f(l),u_frustum_tl:new a.Uniform3f(l),u_frustum_tr:new a.Uniform3f(l),u_frustum_br:new a.Uniform3f(l),u_frustum_bl:new a.Uniform3f(l),u_globe_pos:new a.Uniform3f(l),u_globe_radius:new a.Uniform1f(l),u_viewport:new a.Uniform2f(l)}),globeAtmosphere:l=>({u_frustum_tl:new a.Uniform3f(l),u_frustum_tr:new a.Uniform3f(l),u_frustum_br:new a.Uniform3f(l),u_frustum_bl:new a.Uniform3f(l),u_horizon:new a.Uniform1f(l),u_transition:new a.Uniform1f(l),u_fadeout_range:new a.Uniform1f(l),u_color:new a.Uniform4f(l),u_high_color:new a.Uniform4f(l),u_space_color:new a.Uniform4f(l),u_star_intensity:new a.Uniform1f(l),u_star_density:new a.Uniform1f(l),u_star_size:new a.Uniform1f(l),u_temporal_offset:new a.Uniform1f(l),u_horizon_angle:new a.Uniform1f(l),u_rotation_matrix:new a.UniformMatrix4f(l)})};let Fo;function mc(l,n,o,h,d,f,y){const x=l.context,b=x.gl,M=l.transform,E=l.useProgram("collisionBox"),z=[];let P=0,U=0;for(let H=0;H<h.length;H++){const te=h[H],Q=n.getTile(te),re=Q.getBucket(o);if(!re)continue;const me=oo(te,re,M);let de=me;0===d[0]&&0===d[1]||(de=l.translatePosMatrix(me,Q,d,f));const oe=y?re.textCollisionBox:re.iconCollisionBox,Oe=re.collisionCircleArray;if(Oe.length>0){const he=a.create(),Te=de;a.mul(he,re.placementInvProjMatrix,M.glCoordMatrix),a.mul(he,he,re.placementViewportMatrix),z.push({circleArray:Oe,circleOffset:U,transform:Te,invTransform:he,projection:re.getProjection()}),P+=Oe.length/4,U=P}oe&&(l.terrain&&l.terrain.setupElevationDraw(Q,E),E.draw(x,b.LINES,a.DepthMode.disabled,a.StencilMode.disabled,l.colorModeForRenderPass(),a.CullFaceMode.disabled,ms(de,M,Q,re.getProjection()),o.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,M.zoom,null,[oe.collisionVertexBuffer,oe.collisionVertexBufferExt]))}if(!y||!z.length)return;const F=l.useProgram("collisionCircle"),Z=new a.StructArrayLayout2f1f2i16;Z.resize(4*P),Z._trim();let O=0;for(const H of z)for(let te=0;te<H.circleArray.length/4;te++){const Q=4*te,re=H.circleArray[Q+0],me=H.circleArray[Q+1],de=H.circleArray[Q+2],oe=H.circleArray[Q+3];Z.emplace(O++,re,me,de,oe,0),Z.emplace(O++,re,me,de,oe,1),Z.emplace(O++,re,me,de,oe,2),Z.emplace(O++,re,me,de,oe,3)}(!Fo||Fo.length<2*P)&&(Fo=function(H){const te=2*H,Q=new a.StructArrayLayout3ui6;Q.resize(te),Q._trim();for(let re=0;re<te;re++){const me=6*re;Q.uint16[me+0]=4*re+0,Q.uint16[me+1]=4*re+1,Q.uint16[me+2]=4*re+2,Q.uint16[me+3]=4*re+2,Q.uint16[me+4]=4*re+3,Q.uint16[me+5]=4*re+0}return Q}(P));const R=x.createIndexBuffer(Fo,!0),q=x.createVertexBuffer(Z,a.collisionCircleLayout.members,!0);for(const H of z){const te={u_matrix:H.transform,u_inv_matrix:H.invTransform,u_camera_to_center_distance:(N=M).getCameraToCenterDistance(H.projection),u_viewport_size:[N.width,N.height]};F.draw(x,b.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,l.colorModeForRenderPass(),a.CullFaceMode.disabled,te,o.id,q,R,a.SegmentVector.simpleSegment(0,2*H.circleOffset,H.circleArray.length,H.circleArray.length/2),null,M.zoom)}var N;q.destroy(),R.destroy()}const _s=a.create();function Bh({width:l,height:n,anchor:o,textOffset:h,textScale:d},f){const{horizontalAlign:y,verticalAlign:x}=a.getAnchorAlignment(o),b=-(y-.5)*l,M=-(x-.5)*n,E=a.evaluateVariableOffset(o,h);return new a.pointGeometry((b/d+E[0])*f,(M/d+E[1])*f)}function _c(l,n,o,h,d,f,y,x,b,M,E){const z=l.text.placedSymbolArray,P=l.text.dynamicLayoutVertexArray,U=l.icon.dynamicLayoutVertexArray,F={},Z=l.getProjection(),O=so(x,Z,f),R=f.elevation,q=Z.upVectorScale(x.canonical,f.center.lat,f.worldSize).metersToTile;P.clear();for(let N=0;N<z.length;N++){const H=z.get(N),{tileAnchorX:te,tileAnchorY:Q,numGlyphs:re}=H,de=H.hidden||!H.crossTileID||l.allowVerticalPlacement&&!H.placedOrientation?null:h[H.crossTileID];if(de){let oe=0,Oe=0,he=0;if(R){const Xe=R?R.getAtTileOffset(x,te,Q):0,[Qe,He,st]=Z.upVector(x.canonical,te,Q);oe=Xe*Qe*q,Oe=Xe*He*q,he=Xe*st*q}let[Te,ge,De,ve]=vi(H.projectedAnchorX+oe,H.projectedAnchorY+Oe,H.projectedAnchorZ+he,o?O:y);const Ie=Ne(f.getCameraToCenterDistance(Z),ve);let Re=d.evaluateSizeForFeature(l.textSizeData,M,H)*Ie/a.ONE_EM;o&&(Re*=l.tilePixelRatio/b);const se=Bh(de,Re);o?(({x:Te,y:ge,z:De}=Z.projectTilePoint(te+se.x,Q+se.y,x.canonical)),[Te,ge,De]=vi(Te+oe,ge+Oe,De+he,y)):(n&&se._rotate(-f.angle),Te+=se.x,ge+=se.y,De=0);const _e=l.allowVerticalPlacement&&H.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Xe=0;Xe<re;Xe++)a.addDynamicAttributes(P,Te,ge,De,_e);E&&H.associatedIconIndex>=0&&(F[H.associatedIconIndex]={x:Te,y:ge,z:De,angle:_e})}else bi(re,P)}if(E){U.clear();const N=l.icon.placedSymbolArray;for(let H=0;H<N.length;H++){const te=N.get(H),{numGlyphs:Q}=te,re=F[H];if(te.hidden||!re)bi(Q,U);else{const{x:me,y:de,z:oe,angle:Oe}=re;for(let he=0;he<Q;he++)a.addDynamicAttributes(U,me,de,oe,Oe)}}l.icon.dynamicLayoutVertexBuffer.updateData(U)}l.text.dynamicLayoutVertexBuffer.updateData(P)}function gc(l,n,o){return o.iconsInText&&n?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function po(l,n,o,h,d,f,y,x,b,M,E,z){const P=l.context,U=P.gl,F=l.transform,Z="map"===x,O="map"===b,R=Z&&"point"!==o.layout.get("symbol-placement"),q=Z&&!O&&!R,N=void 0!==o.layout.get("symbol-sort-key").constantOr(1);let H=!1;const te=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),Q=[a.mercatorXfromLng(F.center.lng),a.mercatorYfromLat(F.center.lat)],re=o.layout.get("text-variable-anchor"),me="globe"===F.projection.name,de=[],oe=[0,-1,0];let Oe=oe;!me&&!F.mercatorFromTransition||Z||(Oe=function(he){const Te=he._camera.getWorldToCamera(he.worldSize,1),ge=a.multiply([],Te,he.globeMatrix);a.invert(ge,ge);const De=[0,0,0],ve=[0,1,0,0];return a.transformMat4$1(ve,ve,ge),De[0]=ve[0],De[1]=ve[1],De[2]=ve[2],a.normalize(De,De),De}(F));for(const he of h){const Te=n.getTile(he),ge=Te.getBucket(o);if(!ge||"mercator"===ge.projection.name&&me)continue;const De=d?ge.text:ge.icon;if(!De||ge.fullyClipped||!De.segments.get().length)continue;const ve=De.programConfigurations.get(o.id),Ie=d||ge.sdfIcons,Re=d?ge.textSizeData:ge.iconSizeData,se=O||0!==F.pitch,_e=a.evaluateSizeForZoom(Re,F.zoom);let Xe,Qe,He,st,dt=[0,0],et=null;if(d)Qe=Te.glyphAtlasTexture,He=U.LINEAR,Xe=Te.glyphAtlasTexture.size,ge.iconsInText&&(dt=Te.imageAtlasTexture.size,et=Te.imageAtlasTexture,st=se||l.options.rotating||l.options.zooming||"composite"===Re.kind||"camera"===Re.kind?U.LINEAR:U.NEAREST);else{const mn=1!==o.layout.get("icon-size").constantOr(0)||ge.iconsNeedLinear;Qe=Te.imageAtlasTexture,He=Ie||l.options.rotating||l.options.zooming||mn||se?U.LINEAR:U.NEAREST,Xe=Te.imageAtlasTexture.size}const qe="globe"===ge.projection.name,Rt=qe?Oe:oe,kt=qe?a.globeToMercatorTransition(F.zoom):0,Gt=so(he,ge.getProjection(),F),Zt=F.calculatePixelsToTileUnitsMatrix(Te),Xi=Ht(Gt,Te.tileID.canonical,O,Z,F,ge.getProjection(),Zt),an=l.terrain&&O&&R?a.invert(a.create(),Xi):_s,Vi=os(Gt,Te.tileID.canonical,O,Z,F,ge.getProjection(),Zt),$n=re&&ge.hasTextData(),Yt="none"!==o.layout.get("icon-text-fit")&&$n&&ge.hasIconData();if(R){const mn=F.elevation,Wn=mn?mn.getAtTileOffsetFunc(he,F.center.lat,F.worldSize,ge.getProjection()):null,Xn=ko(Gt,Te.tileID.canonical,O,Z,F,ge.getProjection(),Zt);gt(ge,Gt,l,d,Xn,Vi,O,M,Wn,he)}const qt=R||d&&re||Yt,St=l.translatePosMatrix(Gt,Te,f,y),ci=qt?_s:Xi,Li=l.translatePosMatrix(Vi,Te,f,y,!0),$t=ge.getProjection().createInversionMatrix(F,he.canonical),ji=[];l.terrainRenderModeElevated()&&O&&ji.push("PITCH_WITH_MAP_TERRAIN"),qe&&ji.push("PROJECTION_GLOBE_VIEW"),qt&&ji.push("PROJECTED_POS_ON_VIEWPORT");const Is=Ie&&0!==o.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1);let ur;ur=Ie?ge.iconsInText?aa(Re.kind,_e,q,O,l,St,ci,Li,Xe,dt,he,kt,Q,$t,Rt,ge.getProjection()):fc(Re.kind,_e,q,O,l,St,ci,Li,d,Xe,!0,he,kt,Q,$t,Rt,ge.getProjection()):sa(Re.kind,_e,q,O,l,St,ci,Li,d,Xe,he,kt,Q,$t,Rt,ge.getProjection());const Oi={program:l.useProgram(gc(Ie,d,ge),ve,ji),buffers:De,uniformValues:ur,atlasTexture:Qe,atlasTextureIcon:et,atlasInterpolation:He,atlasInterpolationIcon:st,isSDF:Ie,hasHalo:Is,tile:Te,labelPlaneMatrixInv:an};if(N&&ge.canOverlap){H=!0;const mn=De.segments.get();for(const Wn of mn)de.push({segments:new a.SegmentVector([Wn]),sortKey:Wn.sortKey,state:Oi})}else de.push({segments:De.segments,sortKey:0,state:Oi})}H&&de.sort((he,Te)=>he.sortKey-Te.sortKey);for(const he of de){const Te=he.state;if(l.terrain&&l.terrain.setupElevationDraw(Te.tile,Te.program,{useDepthForOcclusion:!me,labelPlaneMatrixInv:Te.labelPlaneMatrixInv}),P.activeTexture.set(U.TEXTURE0),Te.atlasTexture.bind(Te.atlasInterpolation,U.CLAMP_TO_EDGE),Te.atlasTextureIcon&&(P.activeTexture.set(U.TEXTURE1),Te.atlasTextureIcon&&Te.atlasTextureIcon.bind(Te.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Te.isSDF){const ge=Te.uniformValues;Te.hasHalo&&(ge.u_is_halo=1,yc(Te.buffers,he.segments,o,l,Te.program,te,E,z,ge)),ge.u_is_halo=0}yc(Te.buffers,he.segments,o,l,Te.program,te,E,z,Te.uniformValues)}}function yc(l,n,o,h,d,f,y,x,b){const M=h.context,E=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.globeExtVertexBuffer];d.draw(M,M.gl.TRIANGLES,f,y,x,a.CullFaceMode.disabled,b,o.id,l.layoutVertexBuffer,l.indexBuffer,n,o.paint,h.transform.zoom,l.programConfigurations.get(o.id),E)}function xc(l,n,o,h,d,f,y){const x=l.context.gl,b=o.paint.get("fill-pattern"),M=b&&b.constantOr(1);let E,z,P,U,F;y?(z=M&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",E=x.LINES):(z=M?"fillPattern":"fill",E=x.TRIANGLES);for(const Z of h){const O=n.getTile(Z);if(M&&!O.patternsLoaded())continue;const R=O.getBucket(o);if(!R)continue;l.prepareDrawTile();const q=R.programConfigurations.get(o.id),N=l.useProgram(z,q);M&&(l.context.activeTexture.set(x.TEXTURE0),O.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),q.updatePaintBuffers());const H=b.constantOr(null);if(H&&O.imageAtlas){const Q=O.imageAtlas.patternPositions[H.toString()];Q&&q.setConstantPatternPositions(Q)}const te=l.translatePosMatrix(Z.projMatrix,O,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(y){U=R.indexBuffer2,F=R.segments2;const Q=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[x.drawingBufferWidth,x.drawingBufferHeight];P="fillOutlinePattern"===z&&M?Wa(te,l,O,Q):$a(te,Q)}else U=R.indexBuffer,F=R.segments,P=M?ia(te,l,O):ta(te);l.prepareDrawProgram(l.context,N,Z.toUnwrapped()),N.draw(l.context,E,d,l.stencilModeForClipping(Z),f,a.CullFaceMode.disabled,P,o.id,R.layoutVertexBuffer,U,F,o.paint,l.transform.zoom,q)}}function Ka(l,n,o,h,d,f,y){const x=l.context,b=x.gl,M=l.transform,E=o.paint.get("fill-extrusion-pattern"),z=E.constantOr(1),P=o.paint.get("fill-extrusion-opacity"),U=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),o.paint.get("fill-extrusion-ambient-occlusion-radius")],F=o.layout.get("fill-extrusion-edge-radius"),Z="globe"===M.projection.name?a.fillExtrusionHeightLift():0,O="globe"===M.projection.name,R=O?a.globeToMercatorTransition(M.zoom):0,q=[a.mercatorXfromLng(M.center.lng),a.mercatorYfromLat(M.center.lat)],N=[];O&&(N.push("PROJECTION_GLOBE_VIEW"),l.style.terrainSetForDrapingOnly()&&N.push("TERRAIN")),U[0]>0&&N.push("FAUX_AO");for(const H of h){const te=n.getTile(H),Q=te.getBucket(o);if(!Q||Q.projection.name!==M.projection.name)continue;const re=Q.programConfigurations.get(o.id),me=l.useProgram(z?"fillExtrusionPattern":"fillExtrusion",re,N);if(l.terrain){const De=l.terrain;if(l.style.terrainSetForDrapingOnly())De.setupElevationDraw(te,me,{useMeterToDem:!0});else{if(!Q.enableTerrain)continue;if(De.setupElevationDraw(te,me,{useMeterToDem:!0}),Fh(x,n,H,Q,o,De),!Q.centroidVertexBuffer){const ve=me.attributes.a_centroid_pos;void 0!==ve&&b.vertexAttrib2f(ve,0,0)}}}z&&(l.context.activeTexture.set(b.TEXTURE0),te.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),re.updatePaintBuffers());const de=E.constantOr(null);if(de&&te.imageAtlas){const De=te.imageAtlas.patternPositions[de.toString()];De&&re.setConstantPatternPositions(De)}const oe=l.translatePosMatrix(H.projMatrix,te,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Oe=M.projection.createInversionMatrix(M,H.canonical),he=o.paint.get("fill-extrusion-vertical-gradient"),Te=z?Ph(oe,l,he,P,U,F,H,te,Z,R,q,Oe):lc(oe,l,he,P,U,F,H,Z,R,q,Oe);l.prepareDrawProgram(x,me,H.toUnwrapped());const ge=[];l.terrain&&ge.push(Q.centroidVertexBuffer),O&&ge.push(Q.layoutVertexExtBuffer),me.draw(x,x.gl.TRIANGLES,d,f,y,a.CullFaceMode.backCCW,Te,o.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,o.paint,l.transform.zoom,re,ge)}}function Fh(l,n,o,h,d,f){const y=[R=>{let q=R.canonical.x-1,N=R.wrap;return q<0&&(q=(1<<R.canonical.z)-1,N--),new a.OverscaledTileID(R.overscaledZ,N,R.canonical.z,q,R.canonical.y)},R=>{let q=R.canonical.x+1,N=R.wrap;return q===1<<R.canonical.z&&(q=0,N++),new a.OverscaledTileID(R.overscaledZ,N,R.canonical.z,q,R.canonical.y)},R=>new a.OverscaledTileID(R.overscaledZ,R.wrap,R.canonical.z,R.canonical.x,(0===R.canonical.y?1<<R.canonical.z:R.canonical.y)-1),R=>new a.OverscaledTileID(R.overscaledZ,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y===(1<<R.canonical.z)-1?0:R.canonical.y+1)],x=R=>{const q=n.getSource().minzoom,N=te=>{const Q=n.getTileByID(te);if(Q&&Q.hasData())return Q.getBucket(d)},H=[0,-1,1];for(const te of H){if(R.overscaledZ+te<q)continue;const Q=N(R.calculateScaledKey(R.overscaledZ+te));if(Q)return Q}},b=[0,0,0],M=(R,q)=>(b[0]=Math.min(R.min.y,q.min.y),b[1]=Math.max(R.max.y,q.max.y),b[2]=a.EXTENT-q.min.x>R.max.x?q.min.x-a.EXTENT:R.max.x,b),E=(R,q)=>(b[0]=Math.min(R.min.x,q.min.x),b[1]=Math.max(R.max.x,q.max.x),b[2]=a.EXTENT-q.min.y>R.max.y?q.min.y-a.EXTENT:R.max.y,b),z=[(R,q)=>M(R,q),(R,q)=>M(q,R),(R,q)=>E(R,q),(R,q)=>E(q,R)],P=new a.pointGeometry(0,0);let U,F,Z;const O=(R,q,N,H,te)=>{const Q=[[H?N:R,H?R:N,0],[H?N:q,H?q:N,0]],re=te<0?a.EXTENT+te:te,me=[H?re:(R+q)/2,H?(R+q)/2:re,0];return 0===N&&te<0||0!==N&&te>0?f.getForTilePoints(Z,[me],!0,F):Q.push(me),f.getForTilePoints(o,Q,!0,U),Math.max(Q[0][2],Q[1][2],me[2])/f.exaggeration()};for(let R=0;R<4;R++){const q=(R<2?1:5)-R,N=h.borders[R];if(0===N.length)continue;const H=Z=y[R](o),te=x(H);if(!(te&&te instanceof a.FillExtrusionBucket&&te.enableTerrain)||h.borderDoneWithNeighborZ[R]===te.canonical.z&&te.borderDoneWithNeighborZ[q]===h.canonical.z||(F=f.findDEMTileFor(H),!F||!F.dem))continue;if(!U){const de=f.findDEMTileFor(o);if(!de||!de.dem)return;U=de}const Q=te.borders[q];let re=0;const me=te.borderDoneWithNeighborZ[q]!==h.canonical.z;if(h.canonical.z===te.canonical.z){for(let de=0;de<N.length;de++){const oe=h.featuresOnBorder[N[de]],Oe=oe.borders[R];let he;for(;re<Q.length&&(he=te.featuresOnBorder[Q[re]],!(he.borders[q][1]>Oe[0]+3));)me&&te.encodeCentroid(void 0,he,!1),re++;if(he&&re<Q.length){const Te=re;let ge=0;for(;!(he.borders[q][0]>Oe[1]-3)&&(ge++,++re!==Q.length);)he=te.featuresOnBorder[Q[re]];if(he=te.featuresOnBorder[Q[Te]],oe.intersectsCount()>1||he.intersectsCount()>1||1!==ge){1!==ge&&(re=Te),h.encodeCentroid(void 0,oe,!1),me&&te.encodeCentroid(void 0,he,!1);continue}const De=z[R](oe,he),ve=R%2?a.EXTENT-1:0;P.x=O(De[0],Math.min(a.EXTENT-1,De[1]),ve,R<2,De[2]),P.y=0,h.encodeCentroid(P,oe,!1),me&&te.encodeCentroid(P,he,!1)}else h.encodeCentroid(void 0,oe,!1)}h.borderDoneWithNeighborZ[R]=te.canonical.z,h.needsCentroidUpdate=!0,me&&(te.borderDoneWithNeighborZ[q]=h.canonical.z,te.needsCentroidUpdate=!0)}else{for(const de of N)h.encodeCentroid(void 0,h.featuresOnBorder[de],!1);if(me){for(const de of Q)te.encodeCentroid(void 0,te.featuresOnBorder[de],!1);te.borderDoneWithNeighborZ[q]=h.canonical.z,te.needsCentroidUpdate=!0}h.borderDoneWithNeighborZ[R]=te.canonical.z,h.needsCentroidUpdate=!0}}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&0!==h.centroidVertexArray.length)&&h.uploadCentroid(l)}const Uh=new a.Color(1,0,0,1),Zh=new a.Color(0,1,0,1),Qa=new a.Color(0,0,1,1),el=new a.Color(1,0,1,1),vc=new a.Color(0,1,1,1);function bc(l,n,o){const h=l.context,d=l.transform,f=h.gl,y="globe"===d.projection.name,x=y?["PROJECTION_GLOBE_VIEW"]:null;let b=o.projMatrix;if(y&&a.globeToMercatorTransition(d.zoom)>0){const oe=a.transitionTileAABBinECEF(o.canonical,d),Oe=a.globeDenormalizeECEF(oe);b=a.multiply(new Float32Array(16),d.globeMatrix,Oe),a.multiply(b,d.projMatrix,b)}const M=l.useProgram("debug",null,x),E=n.getTileByID(o.key);l.terrain&&l.terrain.setupElevationDraw(E,M);const z=a.DepthMode.disabled,P=a.StencilMode.disabled,U=l.colorModeForRenderPass(),F="$debug";h.activeTexture.set(f.TEXTURE0),l.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),y?E._makeGlobeTileDebugBuffers(l.context,d):E._makeDebugTileBoundsBuffers(l.context,d.projection);const Z=E._tileDebugBuffer||l.debugBuffer,O=E._tileDebugIndexBuffer||l.debugIndexBuffer,R=E._tileDebugSegments||l.debugSegments;M.draw(h,f.LINE_STRIP,z,P,U,a.CullFaceMode.disabled,Bo(b,a.Color.red),F,Z,O,R,null,null,null,[E._globeTileDebugBorderBuffer]);const q=E.latestRawTileData,N=Math.floor((q&&q.byteLength||0)/1024),H=n.getTile(o).tileSize,te=512/Math.min(H,512)*(o.overscaledZ/d.zoom)*.5;let Q=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Q+=` => ${o.overscaledZ}`),Q+=` ${N}kb`,function(oe,Oe){oe.initDebugOverlayCanvas();const he=oe.debugOverlayCanvas,Te=oe.context.gl,ge=oe.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,he.width,he.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(Oe,5,5),ge.strokeText(Oe,5,5),oe.debugOverlayTexture.update(he),oe.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}(l,Q);const re=E._tileDebugTextBuffer||l.debugBuffer,me=E._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,de=E._tileDebugTextSegments||l.debugSegments;M.draw(h,f.TRIANGLES,z,P,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,Bo(b,a.Color.transparent,te),F,re,me,de,null,null,null,[E._globeTileDebugTextBuffer])}function tl(l,n,o,h){Gn(l,0,n+o/2,l.transform.width,o,h)}function la(l,n,o,h){Gn(l,n-o/2,0,o,l.transform.height,h)}function Gn(l,n,o,h,d,f){const y=l.context,x=y.gl;x.enable(x.SCISSOR_TEST),x.scissor(n*a.exported.devicePixelRatio,o*a.exported.devicePixelRatio,h*a.exported.devicePixelRatio,d*a.exported.devicePixelRatio),y.clear({color:f}),x.disable(x.SCISSOR_TEST)}const gs=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:wc}=gs;function sn(l,n,o,h){l.emplaceBack(n,o,h)}class fo{constructor(n){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,sn(this.vertexArray,-1,-1,1),sn(this.vertexArray,1,-1,1),sn(this.vertexArray,-1,1,1),sn(this.vertexArray,1,1,1),sn(this.vertexArray,-1,-1,-1),sn(this.vertexArray,1,-1,-1),sn(this.vertexArray,-1,1,-1),sn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,wc),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function mo(l,n,o,h,d,f){const y=l.gl,x=n.paint.get("sky-atmosphere-color"),b=n.paint.get("sky-atmosphere-halo-color"),M=n.paint.get("sky-atmosphere-sun-intensity"),E={u_matrix_3f:a.fromMat4(a.create$1(),h),u_sun_direction:d,u_sun_intensity:M,u_color_tint_r:[(F=x).r,F.g,F.b,F.a],u_color_tint_m:[(Z=b).r,Z.g,Z.b,Z.a],u_luminance:5e-5};var F,Z;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+f,n.skyboxTexture,0),o.draw(l,y.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,E,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const il=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Lt{constructor(n){const o=new a.StructArrayLayout5f20;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const h=new a.StructArrayLayout3ui6;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(o,il.members),this.indexBuffer=n.createIndexBuffer(h),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ys={symbol:function(l,n,o,h,d){if("translucent"!==l.renderPass)return;const f=a.StencilMode.disabled,y=l.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(x,b,M,E,z,P,U){const F=b.transform,Z="map"===z,O="map"===P;for(const R of x){const q=E.getTile(R),N=q.getBucket(M);if(!N||!N.text||!N.text.segments.get().length)continue;const H=a.evaluateSizeForZoom(N.textSizeData,F.zoom),te=so(R,N.getProjection(),F),Q=F.calculatePixelsToTileUnitsMatrix(q),re=Ht(te,q.tileID.canonical,O,Z,F,N.getProjection(),Q),me="none"!==M.layout.get("icon-text-fit")&&N.hasIconData();if(H){const de=Math.pow(2,F.zoom-q.tileID.overscaledZ);_c(N,Z,O,U,a.symbolSize,F,re,R,de,H,me)}}}(h,l,o,n,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),d),0!==o.paint.get("icon-opacity").constantOr(1)&&po(l,n,o,h,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),f,y),0!==o.paint.get("text-opacity").constantOr(1)&&po(l,n,o,h,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),f,y),n.map.showCollisionBoxes&&(mc(l,n,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),mc(l,n,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(l,n,o,h){if("translucent"!==l.renderPass)return;const d=o.paint.get("circle-opacity"),f=o.paint.get("circle-stroke-width"),y=o.paint.get("circle-stroke-opacity"),x=void 0!==o.layout.get("circle-sort-key").constantOr(1);if(0===d.constantOr(1)&&(0===f.constantOr(1)||0===y.constantOr(1)))return;const b=l.context,M=b.gl,E=l.transform,z=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),P=a.StencilMode.disabled,U=l.colorModeForRenderPass(),F="globe"===E.projection.name,Z=[a.mercatorXfromLng(E.center.lng),a.mercatorYfromLat(E.center.lat)],O=[];for(let q=0;q<h.length;q++){const N=h[q],H=n.getTile(N),te=H.getBucket(o);if(!te||te.projection.name!==E.projection.name)continue;const Q=te.programConfigurations.get(o.id),re=Lh(o);F&&re.push("PROJECTION_GLOBE_VIEW");const me=l.useProgram("circle",Q,re),de=te.layoutVertexBuffer,oe=te.globeExtVertexBuffer,Oe=te.indexBuffer,he=E.projection.createInversionMatrix(E,N.canonical),Te={programConfiguration:Q,program:me,layoutVertexBuffer:de,globeExtVertexBuffer:oe,indexBuffer:Oe,uniformValues:hc(l,N,H,he,Z,o),tile:H};if(x){const ge=te.segments.get();for(const De of ge)O.push({segments:new a.SegmentVector([De]),sortKey:De.sortKey,state:Te})}else O.push({segments:te.segments,sortKey:0,state:Te})}x&&O.sort((q,N)=>q.sortKey-N.sortKey);const R={useDepthForOcclusion:!F};for(const q of O){const{programConfiguration:N,program:H,layoutVertexBuffer:te,globeExtVertexBuffer:Q,indexBuffer:re,uniformValues:me,tile:de}=q.state,oe=q.segments;l.terrain&&l.terrain.setupElevationDraw(de,H,R),l.prepareDrawProgram(b,H,de.tileID.toUnwrapped()),H.draw(b,M.TRIANGLES,z,P,U,a.CullFaceMode.disabled,me,o.id,te,re,oe,o.paint,E.zoom,N,[Q])}},heatmap:function(l,n,o,h){if(0!==o.paint.get("heatmap-opacity"))if("offscreen"===l.renderPass){const d=l.context,f=d.gl,y=a.StencilMode.disabled,x=new a.ColorMode([f.ONE,f.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(U,F,Z,O){const R=U.gl,q=F.width*O,N=F.height*O;U.activeTexture.set(R.TEXTURE1),U.viewport.set([0,0,q,N]);let H=Z.heatmapFbo;if(!H||H&&(H.width!==q||H.height!==N)){H&&H.destroy();const te=R.createTexture();R.bindTexture(R.TEXTURE_2D,te),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),H=Z.heatmapFbo=U.createFramebuffer(q,N,!1),function(Q,re,me,de,oe,Oe){const he=Q.gl;he.texImage2D(he.TEXTURE_2D,0,he.RGBA,oe,Oe,0,he.RGBA,Q.extRenderToTextureHalfFloat?Q.extTextureHalfFloat.HALF_FLOAT_OES:he.UNSIGNED_BYTE,null),de.colorAttachment.set(me)}(U,0,te,H,q,N)}else R.bindTexture(R.TEXTURE_2D,H.colorAttachment.get()),U.bindFramebuffer.set(H.framebuffer)})(d,l,o,"globe"===l.transform.projection.name?.5:.25),d.clear({color:a.Color.transparent});const b=l.transform,M="globe"===b.projection.name,E=M?["PROJECTION_GLOBE_VIEW"]:null,z=M?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,P=[a.mercatorXfromLng(b.center.lng),a.mercatorYfromLat(b.center.lat)];for(let U=0;U<h.length;U++){const F=h[U];if(n.hasRenderableParent(F))continue;const Z=n.getTile(F),O=Z.getBucket(o);if(!O||O.projection.name!==b.projection.name)continue;const R=O.programConfigurations.get(o.id),q=l.useProgram("heatmap",R,E),{zoom:N}=l.transform;l.terrain&&l.terrain.setupElevationDraw(Z,q),l.prepareDrawProgram(d,q,F.toUnwrapped());const H=b.projection.createInversionMatrix(b,F.canonical);q.draw(d,f.TRIANGLES,a.DepthMode.disabled,y,x,z,na(l,F,Z,H,P,N,o.paint.get("heatmap-intensity")),o.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,o.paint,l.transform.zoom,R,M?[O.globeExtVertexBuffer]:null)}d.viewport.set([0,0,l.width,l.height])}else"translucent"===l.renderPass&&(l.context.setColorMode(l.colorModeForRenderPass()),function(d,f){const y=d.context,x=y.gl,b=f.heatmapFbo;if(!b)return;y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,b.colorAttachment.get()),y.activeTexture.set(x.TEXTURE1);let M=f.colorRampTexture;M||(M=f.colorRampTexture=new a.Texture(y,f.colorRamp,x.RGBA)),M.bind(x.LINEAR,x.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(y,x.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:f.paint.get("heatmap-opacity")},f.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,f.paint,d.transform.zoom)}(l,o))},line:function(l,n,o,h){if("translucent"!==l.renderPass)return;const d=o.paint.get("line-opacity"),f=o.paint.get("line-width");if(0===d.constantOr(1)||0===f.constantOr(1))return;const y=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),x=l.colorModeForRenderPass(),b=l.terrain&&l.terrain.renderingToTexture?1:a.exported.devicePixelRatio,M=o.paint.get("line-dasharray"),E=M.constantOr(1),z=o.layout.get("line-cap"),P=o.paint.get("line-pattern"),U=P.constantOr(1),F=o.paint.get("line-gradient"),Z=U?"linePattern":"line",O=l.context,R=O.gl,q=(H=>{const te=[];oa(H)&&te.push("RENDER_LINE_DASH"),H.paint.get("line-gradient")&&te.push("RENDER_LINE_GRADIENT");const Q=H.paint.get("line-trim-offset");0===Q[0]&&0===Q[1]||te.push("RENDER_LINE_TRIM_OFFSET");const re=H.paint.get("line-pattern").constantOr(1),me=1!==H.paint.get("line-opacity").constantOr(1);return!re&&me&&te.push("RENDER_LINE_ALPHA_DISCARD"),te})(o);let N=q.includes("RENDER_LINE_ALPHA_DISCARD");l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(N=!1);for(const H of h){const te=n.getTile(H);if(U&&!te.patternsLoaded())continue;const Q=te.getBucket(o);if(!Q)continue;l.prepareDrawTile();const re=Q.programConfigurations.get(o.id),me=l.useProgram(Z,re,q),de=P.constantOr(null);if(de&&te.imageAtlas){const Ie=te.imageAtlas.patternPositions[de.toString()];Ie&&re.setConstantPatternPositions(Ie)}const oe=M.constantOr(null),Oe=z.constantOr(null);if(!U&&oe&&Oe&&te.lineAtlas){const Ie=te.lineAtlas.getDash(oe,Oe);Ie&&re.setConstantPatternPositions(Ie)}let[he,Te]=o.paint.get("line-trim-offset");("round"===Oe||"square"===Oe)&&he!==Te&&(0===he&&(he-=1),1===Te&&(Te+=1));const ge=l.terrain?H.projMatrix:null,De=U?jn(l,te,o,ge,b):Xa(l,te,o,ge,Q.lineClipsArray.length,b,[he,Te]);if(F){const Ie=Q.gradients[o.id];let Re=Ie.texture;if(o.gradientVersion!==Ie.version){let se=256;if(o.stepInterpolant){const _e=n.getSource().maxzoom,Xe=H.canonical.z===_e?Math.ceil(1<<l.transform.maxZoom-H.canonical.z):1;se=a.clamp(a.nextPowerOfTwo(Q.maxLineLength/a.EXTENT*1024*Xe),256,O.maxTextureSize)}Ie.gradient=a.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:se,image:Ie.gradient||void 0,clips:Q.lineClipsArray}),Ie.texture?Ie.texture.update(Ie.gradient):Ie.texture=new a.Texture(O,Ie.gradient,R.RGBA),Ie.version=o.gradientVersion,Re=Ie.texture}O.activeTexture.set(R.TEXTURE1),Re.bind(o.stepInterpolant?R.NEAREST:R.LINEAR,R.CLAMP_TO_EDGE)}E&&(O.activeTexture.set(R.TEXTURE0),te.lineAtlasTexture.bind(R.LINEAR,R.REPEAT),re.updatePaintBuffers()),U&&(O.activeTexture.set(R.TEXTURE0),te.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),re.updatePaintBuffers()),l.prepareDrawProgram(O,me,H.toUnwrapped());const ve=Ie=>{me.draw(O,R.TRIANGLES,y,Ie,x,a.CullFaceMode.disabled,De,o.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,o.paint,l.transform.zoom,re,[Q.layoutVertexBuffer2])};if(N){const Ie=l.stencilModeForClipping(H).ref;0===Ie&&l.terrain&&O.clear({stencil:0});const Re={func:R.EQUAL,mask:255};De.u_alpha_discard_threshold=.8,ve(new a.StencilMode(Re,Ie,255,R.KEEP,R.KEEP,R.INVERT)),De.u_alpha_discard_threshold=0,ve(new a.StencilMode(Re,Ie,255,R.KEEP,R.KEEP,R.KEEP))}else ve(l.stencilModeForClipping(H))}N&&(l.resetStencilClippingMasks(),l.terrain&&O.clear({stencil:0}))},fill:function(l,n,o,h){const d=o.paint.get("fill-color"),f=o.paint.get("fill-opacity");if(0===f.constantOr(1))return;const y=l.colorModeForRenderPass(),x=o.paint.get("fill-pattern"),b=l.opaquePassEnabledForLayer()&&!x.constantOr(1)&&1===d.constantOr(a.Color.transparent).a&&1===f.constantOr(0)?"opaque":"translucent";if(l.renderPass===b){const M=l.depthModeForSublayer(1,"opaque"===l.renderPass?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);xc(l,n,o,h,M,y,!1)}if("translucent"===l.renderPass&&o.paint.get("fill-antialias")){const M=l.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);xc(l,n,o,h,M,y,!0)}},"fill-extrusion":function(l,n,o,h){const d=o.paint.get("fill-extrusion-opacity");if(0!==d&&"translucent"===l.renderPass){const f=new a.DepthMode(l.context.gl.LEQUAL,a.DepthMode.ReadWrite,l.depthRangeFor3D);if(1!==d||o.paint.get("fill-extrusion-pattern").constantOr(1))Ka(l,n,o,h,f,a.StencilMode.disabled,a.ColorMode.disabled),Ka(l,n,o,h,f,l.stencilModeFor3D(),l.colorModeForRenderPass()),l.resetStencilClippingMasks();else{const y=l.colorModeForRenderPass();Ka(l,n,o,h,f,a.StencilMode.disabled,y)}}},hillshade:function(l,n,o,h){if("offscreen"!==l.renderPass&&"translucent"!==l.renderPass)return;const d=l.context,f=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),y=l.colorModeForRenderPass(),x=l.terrain&&l.terrain.renderingToTexture,[b,M]="translucent"!==l.renderPass||x?[{},h]:l.stencilConfigForOverlap(h);for(const E of M){const z=n.getTile(E);if(z.needsHillshadePrepare&&"offscreen"===l.renderPass)Xs(l,z,o,f,a.StencilMode.disabled,y);else if("translucent"===l.renderPass){const P=x&&l.terrain?l.terrain.stencilModeForRTTOverlap(E):b[E.overscaledZ];Va(l,E,z,o,f,P,y)}}d.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,n,o,h,d,f){if("translucent"!==l.renderPass||0===o.paint.get("raster-opacity")||!h.length)return;const y=l.context,x=y.gl,b=n.getSource(),M=l.useProgram("raster"),E=l.colorModeForRenderPass(),z=l.terrain&&l.terrain.renderingToTexture,[P,U]=b instanceof ie||z?[{},h]:l.stencilConfigForOverlap(h),F=U[U.length-1].overscaledZ,Z=!l.options.moving;for(const O of U){const R=z?a.DepthMode.disabled:l.depthModeForSublayer(O.overscaledZ-F,1===o.paint.get("raster-opacity")?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,x.LESS),q=O.toUnwrapped(),N=n.getTile(O);if(z&&(!N||!N.hasData()))continue;const H=z?O.projMatrix:l.transform.calculateProjMatrix(q,Z),te=l.terrain&&z?l.terrain.stencilModeForRTTOverlap(O):P[O.overscaledZ],Q=f?0:o.paint.get("raster-fade-duration");N.registerFadeDuration(Q);const re=n.findLoadedParent(O,0),me=Ks(N,re,n,l.transform,Q);let de,oe;l.terrain&&l.terrain.prepareDrawTile();const Oe="nearest"===o.paint.get("raster-resampling")?x.NEAREST:x.LINEAR;y.activeTexture.set(x.TEXTURE0),N.texture.bind(Oe,x.CLAMP_TO_EDGE),y.activeTexture.set(x.TEXTURE1),re?(re.texture.bind(Oe,x.CLAMP_TO_EDGE),de=Math.pow(2,re.tileID.overscaledZ-N.tileID.overscaledZ),oe=[N.tileID.canonical.x*de%1,N.tileID.canonical.y*de%1]):N.texture.bind(Oe,x.CLAMP_TO_EDGE);const he=dc(H,oe||[0,0],de||1,me,o,b instanceof ie?b.perspectiveTransform:[0,0]);if(l.prepareDrawProgram(y,M,q),b instanceof ie)b.boundsBuffer&&b.boundsSegments&&M.draw(y,x.TRIANGLES,R,a.StencilMode.disabled,E,a.CullFaceMode.disabled,he,o.id,b.boundsBuffer,l.quadTriangleIndexBuffer,b.boundsSegments);else{const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:ge,tileBoundsSegments:De}=l.getTileBoundsBuffers(N);M.draw(y,x.TRIANGLES,R,te,E,a.CullFaceMode.disabled,he,o.id,Te,ge,De)}}l.resetStencilClippingMasks()},background:function(l,n,o,h){const d=o.paint.get("background-color"),f=o.paint.get("background-opacity");if(0===f)return;const y=l.context,x=y.gl,b=l.transform,M=b.tileSize,E=o.paint.get("background-pattern");if(l.isPatternMissing(E))return;const z=!E&&1===d.a&&1===f&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==z)return;const P=a.StencilMode.disabled,U=l.depthModeForSublayer(0,"opaque"===z?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),F=l.colorModeForRenderPass(),Z=l.useProgram(E?"backgroundPattern":"background");let O,R=h;R||(O=l.getBackgroundTiles(),R=Object.values(O).map(q=>q.tileID)),E&&(y.activeTexture.set(x.TEXTURE0),l.imageManager.bind(l.context));for(const q of R){const N=q.toUnwrapped(),H=h?q.projMatrix:l.transform.calculateProjMatrix(N);l.prepareDrawTile();const te=n?n.getTile(q):O?O[q.key]:new a.Tile(q,M,b.zoom,l),Q=E?Ja(H,f,l,E,{tileID:q,tileSize:M}):Oh(H,f,d);l.prepareDrawProgram(y,Z,N);const{tileBoundsBuffer:re,tileBoundsIndexBuffer:me,tileBoundsSegments:de}=l.getTileBoundsBuffers(te);Z.draw(y,x.TRIANGLES,U,P,F,a.CullFaceMode.disabled,Q,o.id,re,me,de)}},sky:function(l,n,o){const h=l.transform,d="mercator"===h.projection.name||"globe"===h.projection.name?1:a.smoothstep(7,8,h.zoom),f=o.paint.get("sky-opacity")*d;if(0===f)return;const y=l.context,x=o.paint.get("sky-type"),b=new a.DepthMode(y.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),M=l.frameCounter/1e3%1;"atmosphere"===x?"offscreen"===l.renderPass?o.needsSkyboxCapture(l)&&(function(E,z,P,U){const F=E.context,Z=F.gl;let O=z.skyboxFbo;if(!O){O=z.skyboxFbo=F.createFramebuffer(32,32,!1),z.skyboxGeometry=new fo(F),z.skyboxTexture=F.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,z.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let H=0;H<6;++H)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+H,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}F.bindFramebuffer.set(O.framebuffer),F.viewport.set([0,0,32,32]);const R=z.getCenter(E,!0),q=E.useProgram("skyboxCapture"),N=new Float64Array(16);a.identity(N),a.rotateY(N,N,.5*-Math.PI),mo(F,z,q,N,R,0),a.identity(N),a.rotateY(N,N,.5*Math.PI),mo(F,z,q,N,R,1),a.identity(N),a.rotateX(N,N,.5*-Math.PI),mo(F,z,q,N,R,2),a.identity(N),a.rotateX(N,N,.5*Math.PI),mo(F,z,q,N,R,3),a.identity(N),mo(F,z,q,N,R,4),a.identity(N),a.rotateY(N,N,Math.PI),mo(F,z,q,N,R,5),F.viewport.set([0,0,E.width,E.height])}(l,o),o.markSkyboxValid(l)):"sky"===l.renderPass&&function(E,z,P,U,F){const Z=E.context,O=Z.gl,R=E.transform,q=E.useProgram("skybox");Z.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_CUBE_MAP,z.skyboxTexture);const N={u_matrix:R.skyboxMatrix,u_sun_direction:z.getCenter(E,!1),u_cubemap:0,u_opacity:U,u_temporal_offset:F};E.prepareDrawProgram(Z,q),q.draw(Z,O.TRIANGLES,P,a.StencilMode.disabled,E.colorModeForRenderPass(),a.CullFaceMode.backCW,N,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(l,o,b,f,M):"gradient"===x&&"sky"===l.renderPass&&function(E,z,P,U,F){const Z=E.context,O=Z.gl,R=E.transform,q=E.useProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new fo(Z)),Z.activeTexture.set(O.TEXTURE0);let N=z.colorRampTexture;N||(N=z.colorRampTexture=new a.Texture(Z,z.colorRamp,O.RGBA)),N.bind(O.LINEAR,O.CLAMP_TO_EDGE);const H=(te=R.skyboxMatrix,Q=z.getCenter(E,!1),re=z.paint.get("sky-gradient-radius"),me=U,de=F,{u_matrix:te,u_color_ramp:0,u_center_direction:Q,u_radius:a.degToRad(re),u_opacity:me,u_temporal_offset:de});var te,Q,re,me,de;E.prepareDrawProgram(Z,q),q.draw(Z,O.TRIANGLES,P,a.StencilMode.disabled,E.colorModeForRenderPass(),a.CullFaceMode.backCW,H,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(l,o,b,f,M)},debug:function(l,n,o){for(let h=0;h<o.length;h++)bc(l,n,o[h])},custom:function(l,n,o){const h=l.context,d=o.implementation;if(l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===l.renderPass){const f=d.prerender;f&&(l.setCustomLayerDefaults(),h.setColorMode(l.colorModeForRenderPass()),f.call(d,h.gl,l.transform.customLayerMatrix()),h.setDirty(),l.setBaseState())}else if("translucent"===l.renderPass){l.setCustomLayerDefaults(),h.setColorMode(l.colorModeForRenderPass()),h.setStencilMode(a.StencilMode.disabled);const f="3d"===d.renderingMode?new a.DepthMode(l.context.gl.LEQUAL,a.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,a.DepthMode.ReadOnly);h.setDepthMode(f),d.render(h.gl,l.transform.customLayerMatrix()),h.setDirty(),l.setBaseState(),h.bindFramebuffer.set(null)}}};class Nh{constructor(n,o){this.context=new S(n),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vn,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,o){const h=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new sc(this,n));const d=this._terrain;this.transform.elevation=h?d:null,d.update(n,this.transform,o)}_updateFog(n){const o=n.fog;if(!o||"globe"===this.transform.projection.name||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,d]=o.getFovAdjustedRange(this.transform._fov);if(h>d)return void(this.transform.fogCullDistSq=null);const f=h+.78*(d-h);this.transform.fogCullDistSq=f*f}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,o){if(this.width=n*a.exported.devicePixelRatio,this.height=o*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const n=this.context,o=new a.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(a.EXTENT,0),o.emplaceBack(0,a.EXTENT),o.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(o,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const h=new a.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(a.EXTENT,0),h.emplaceBack(0,a.EXTENT),h.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=n.createVertexBuffer(h,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const d=new a.StructArrayLayout2i4;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(-1,1),d.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(d,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const f=new a.StructArrayLayout4i8;f.emplaceBack(0,0,0,0),f.emplaceBack(a.EXTENT,0,a.EXTENT,0),f.emplaceBack(0,a.EXTENT,0,a.EXTENT),f.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(f,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const y=new a.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(y);const x=new a.StructArrayLayout1ui2;for(const M of[0,1,3,2,0])x.emplaceBack(M);this.debugIndexBuffer=n.createIndexBuffer(x),this.emptyTexture=new a.Texture(n,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=a.create();const b=this.context.gl;this.stencilClearMode=new a.StencilMode({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new Lt(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,o=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,o.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,fs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,o,h){if(!o||this.currentStencilSource===o.id||!n.isTileClipped()||!h||0===h.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let x=!1;for(const b of h)if(void 0===this._tileClippingMaskIDs[b.key]){x=!0;break}if(!x)return}this.currentStencilSource=o.id;const d=this.context,f=d.gl;this.nextStencilID+h.length>256&&this.clearStencil(),d.setColorMode(a.ColorMode.disabled),d.setDepthMode(a.DepthMode.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of h){const b=o.getTile(x),M=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,{tileBoundsBuffer:E,tileBoundsIndexBuffer:z,tileBoundsSegments:P}=this.getTileBoundsBuffers(b);y.draw(d,f.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:f.ALWAYS,mask:0},M,255,f.KEEP,f.KEEP,f.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,fs(x.projMatrix),"$clipping",E,z,P)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,o=this.context.gl;return new a.StencilMode({func:o.NOTEQUAL,mask:255},n,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const o=this.context.gl;return new a.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(n){const o=this.context.gl,h=n.sort((y,x)=>x.overscaledZ-y.overscaledZ),d=h[h.length-1].overscaledZ,f=h[0].overscaledZ-d+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const y={};for(let x=0;x<f;x++)y[x+d]=new a.StencilMode({func:o.GEQUAL,mask:255},x+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=f,[y,h]}return[{[d]:a.StencilMode.disabled},h]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([n.CONSTANT_COLOR,n.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(n,o,h){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new a.DepthMode(h||this.context.gl.LEQUAL,o,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,o){this.style=n,this.options=o,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const h=this.style.order,d=this.style._sourceCaches;for(const b in d){const M=d[b];M.used&&M.prepare(this.context)}const f={},y={},x={};for(const b in d){const M=d[b];f[b]=M.getVisibleCoordinates(),y[b]=f[b].slice().reverse(),x[b]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let b=0;b<h.length;b++)if(this.style._layers[h[b]].is3D()){this.opaquePassCutoff=b;break}if(this.terrain&&(this.terrain.updateTileBinding(x),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),a.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const b of h){const M=this.style._layers[b],E=n._getLayerSourceCache(M);if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const z=E?y[E.id]:void 0;("custom"===M.type||M.isSky()||z&&z.length)&&this.renderLayer(this,E,M,z)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:o.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const b=this.style._layers[h[this.currentLayer]],M=n._getLayerSourceCache(b);if(b.isSky())continue;const E=M?y[M.id]:void 0;this._renderTileClippingMasks(b,M,E),this.renderLayer(this,M,b,E)}if(this.style.fog&&this.transform.projection.supportsFog&&function(b,M){const E=b.context,z=E.gl,P=b.transform,U=new a.DepthMode(z.LEQUAL,a.DepthMode.ReadOnly,[0,1]),F=b.useProgram("globeAtmosphere",null,"globe"===P.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Z=a.globeToMercatorTransition(P.zoom),O=M.properties.get("color").toArray01(),R=M.properties.get("high-color").toArray01(),q=M.properties.get("space-color").toArray01PremultipliedAlpha(),N=a.identity$1([]);a.rotateY$1(N,N,-a.degToRad(P._center.lng)),a.rotateX$1(N,N,a.degToRad(P._center.lat)),a.rotateZ$1(N,N,P.angle),a.rotateX$1(N,N,-P._pitch);const H=a.fromQuat(new Float32Array(16),N),te=a.mapValue(M.properties.get("star-intensity"),0,1,0,.25),Q=5e-4,re=a.mapValue(M.properties.get("horizon-blend"),0,1,Q,.25),me=a.globeUseCustomAntiAliasing(b,E,P)&&re===Q?P.worldSize/(2*Math.PI*1.025)-1:P.globeRadius,de=b.frameCounter/1e3%1,oe=a.length(P.globeCenterInViewSpace),Oe=Math.sqrt(Math.pow(oe,2)-Math.pow(me,2)),he=Math.acos(Oe/oe),Te={u_frustum_tl:P.frustumCorners.TL,u_frustum_tr:P.frustumCorners.TR,u_frustum_br:P.frustumCorners.BR,u_frustum_bl:P.frustumCorners.BL,u_horizon:P.frustumCorners.horizon,u_transition:Z,u_fadeout_range:re,u_color:O,u_high_color:R,u_space_color:q,u_star_intensity:te,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:de,u_horizon_angle:he,u_rotation_matrix:H};b.prepareDrawProgram(E,F);const ge=b.atmosphereBuffer;ge&&F.draw(E,z.TRIANGLES,U,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,Te,"skybox",ge.vertexBuffer,ge.indexBuffer,ge.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const b=this.style._layers[h[this.currentLayer]],M=n._getLayerSourceCache(b);b.isSky()&&this.renderLayer(this,M,b,M?y[M.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const b=this.style._layers[h[this.currentLayer]],M=n._getLayerSourceCache(b);if(b.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(b)){if(b.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const E=M?("symbol"===b.type?x:y)[M.id]:void 0;this._renderTileClippingMasks(b,M,M?f[M.id]:void 0),this.renderLayer(this,M,b,E),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let b=null;a.values(this.style._layers).forEach(M=>{const E=n._getLayerSourceCache(M);E&&!M.isHidden(this.transform.zoom)&&(!b||b.getSource().maxzoom<E.getSource().maxzoom)&&(b=E)}),b&&this.options.showTileBoundaries&&ys.debug(this,b,b.getVisibleCoordinates())}this.options.showPadding&&function(b){const M=b.transform.padding;tl(b,b.transform.height-(M.top||0),3,Uh),tl(b,M.bottom||0,3,Zh),la(b,M.left||0,3,Qa),la(b,b.transform.width-(M.right||0),3,el);const E=b.transform.centerPoint;var z,P,U,F;Gn(z=b,(P=E.x)-1,(U=b.transform.height-E.y)-10,2,20,F=vc),Gn(z,P-10,U-1,20,2,F)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,o,h,d){h.isHidden(this.transform.zoom)||("background"===h.type||"sky"===h.type||"custom"===h.type||d&&d.length)&&(this.id=h.id,this.gpuTimingStart(h),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(h.type)||ys[h.type](n,o,h,d,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let h=this.gpuTimers[n.id];h||(h=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),h.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,h.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,o=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(o),n.beginQueryEXT(n.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const o={};for(const h in n){const d=n[h],f=this.context.extTimerQuery,y=f.getQueryObjectEXT(d.query,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(d.query),o[h]=y}return o}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery;let h=0;for(const d of n)h+=o.getQueryObjectEXT(d,o.QUERY_RESULT_EXT)/1e6,o.deleteQueryEXT(d);return h}translatePosMatrix(n,o,h,d,f){if(!h[0]&&!h[1])return n;const y=f?"map"===d?this.transform.angle:0:"viewport"===d?-this.transform.angle:0;if(y){const M=Math.sin(y),E=Math.cos(y);h=[h[0]*E-h[1]*M,h[0]*M+h[1]*E]}const x=[f?h[0]:hn(o,h[0],this.transform.zoom),f?h[1]:hn(o,h[1],this.transform.zoom),0],b=new Float32Array(16);return a.translate(b,n,x),b}saveTileTexture(n){const o=this._tileTextures[n.size[0]];o?o.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const o=this._tileTextures[n];return o&&o.length>0?o.pop():null}isPatternMissing(n){return null===n||void 0!==n&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,o=this.terrain&&0===this.terrain.exaggeration(),h=this.style&&this.style.fog,d=[];return this.terrainRenderModeElevated()&&d.push("TERRAIN"),"globe"===this.transform.projection.name&&d.push("GLOBE"),o&&d.push("ZERO_EXAGGERATION"),h&&!n&&0!==h.getOpacity(this.transform.pitch)&&d.push("FOG"),n&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}useProgram(n,o,h){this.cache=this.cache||{};const d=h||[],f=this.currentGlobalDefines().concat(d),y=qa.cacheKey(Na[n],n,f,o);return this.cache[y]||(this.cache[y]=new qa(this.context,n,Na[n],o,Rh[n],f)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,o,h){if(this.terrain&&this.terrain.renderingToTexture)return;const d=this.style.fog;if(d){const f=d.getOpacity(this.transform.pitch),y=((x,b,M,E,z,P,U,F,Z,O,R)=>{const q=x.transform,N=b.properties.get("color").toArray01();N[3]=E;const H=x.frameCounter/1e3%1;return{u_fog_matrix:M?q.calculateFogTileMatrix(M):x.identityMat,u_fog_range:b.getFovAdjustedRange(q._fov),u_fog_color:N,u_fog_horizon_blend:b.properties.get("horizon-blend"),u_fog_temporal_offset:H,u_frustum_tl:z,u_frustum_tr:P,u_frustum_br:U,u_frustum_bl:F,u_globe_pos:Z,u_globe_radius:O,u_viewport:R,u_globe_transition:a.globeToMercatorTransition(q.zoom),u_is_globe:+("globe"===q.projection.name)}})(this,d,h,f,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);o.setFogUniformValues(n,y)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,o=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const d of h)o[d.key]=n[d.key]||new a.Tile(d,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class ca{constructor(n=0,o=0,h=0,d=0){if(isNaN(n)||n<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=o,this.left=h,this.right=d}interpolate(n,o,h){return null!=o.top&&null!=n.top&&(this.top=a.number(n.top,o.top,h)),null!=o.bottom&&null!=n.bottom&&(this.bottom=a.number(n.bottom,o.bottom,h)),null!=o.left&&null!=n.left&&(this.left=a.number(n.left,o.left,h)),null!=o.right&&null!=n.right&&(this.right=a.number(n.right,o.right,h)),this}getCenter(n,o){const h=a.clamp((this.left+n-this.right)/2,0,n),d=a.clamp((this.top+o-this.bottom)/2,0,o);return new a.pointGeometry(h,d)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Uo(l,n){const o=a.getColumn(l,3);a.fromQuat(l,n),a.setColumn(l,3,o)}function nl(l,n){const o=a.identity$1([]);return a.rotateZ$1(o,o,-n),a.rotateX$1(o,o,-l),o}function Tc(l,n){const o=[l[0],l[1],0],h=[n[0],n[1],0];if(a.length(o)>=1e-15){const y=a.normalize([],o);a.scale$2(h,y,a.dot(h,y)),n[0]=h[0],n[1]=h[1]}const d=a.cross([],n,l);if(a.len(d)<1e-15)return null;const f=Math.atan2(-d[1],d[0]);return nl(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),f)}class rl{constructor(n,o){this.position=n,this.orientation=o}get position(){return this._position}set position(n){if(n){const o=n instanceof a.MercatorCoordinate?n:new a.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(o.x=a.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(n,o){if(this.orientation=null,!this.position)return;const h=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(n)):0,d=this.position,f=a.MercatorCoordinate.fromLngLat(n,h),y=[f.x-d.x,f.y-d.y,f.z-d.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=Tc(y,o)}setPitchBearing(n,o){this.orientation=nl(a.degToRad(n),a.degToRad(-o))}}class ol{constructor(n,o){this._transform=a.identity([]),this.orientation=o,this.position=n}get mercatorPosition(){const n=this.position;return new a.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=a.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var o;n&&a.setColumn(this._transform,3,[(o=n)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||a.identity$1([]),n&&Uo(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,o){this._orientation=nl(n,o),Uo(this._transform,this._orientation)}forward(){const n=a.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=a.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=a.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,o){const h=new Float64Array(16);return a.invert(h,this.getWorldToCamera(n,o)),h}getWorldToCameraPosition(n,o,h){const d=this.position;a.scale$2(d,d,-n);const f=new Float64Array(16);return a.fromScaling(f,[h,h,h]),a.translate(f,f,d),f[10]*=o,f}getWorldToCamera(n,o){const h=new Float64Array(16),d=new Float64Array(4),f=this.position;return a.conjugate(d,this._orientation),a.scale$2(f,f,-n),a.fromQuat(h,d),a.translate(h,h,f),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=o,h[9]*=o,h[10]*=o,h[11]*=o,h}getCameraToClipPerspective(n,o,h,d){const f=new Float64Array(16);return a.perspective(f,n,o,h,d),f}getDistanceToElevation(n,o=!1){const h=0===n?0:a.mercatorZfromAltitude(n,o?a.latFromMercatorY(this.position[1]):this.position[1]),d=this.forward();return(h-this.position[2])/d[2]}clone(){return new ol([...this.position],[...this.orientation])}}function ha(l,n){const o=Dr(l.projection,l.zoom,l.width,l.height),h=function(f,y,x,b,M){const E=new a.LngLat(x.lng-180*Pr,x.lat),z=new a.LngLat(x.lng+180*Pr,x.lat),P=f.project(E.lng,E.lat),U=f.project(z.lng,z.lat),F=-Math.atan2(U.y-P.y,U.x-P.x),Z=a.MercatorCoordinate.fromLngLat(x);Z.y=a.clamp(Z.y,-.999975,.999975);const O=Z.toLngLat(),R=f.project(O.lng,O.lat),q=a.MercatorCoordinate.fromLngLat(O);q.x+=Pr;const N=q.toLngLat(),H=f.project(N.lng,N.lat),te=sl(H.x-R.x,H.y-R.y,F),Q=a.MercatorCoordinate.fromLngLat(O);Q.y+=Pr;const re=Q.toLngLat(),me=f.project(re.lng,re.lat),de=sl(me.x-R.x,me.y-R.y,F),oe=Math.abs(te.x)/Math.abs(de.y),Oe=a.identity([]);a.rotateZ(Oe,Oe,-F*(1-(M?0:b)));const he=a.identity([]);return a.scale(he,he,[1,1-(1-oe)*b,1]),he[4]=-de.x/de.y*b,a.rotateZ(he,he,F),a.multiply(he,Oe,he),he}(l.projection,0,l.center,o,n),d=xs(l);return a.scale(h,h,[d,d,1]),h}function xs(l){const n=l.projection,o=Dr(l.projection,l.zoom,l.width,l.height),h=ua(n,l.center),d=ua(n,a.LngLat.convert(n.center));return Math.pow(2,h*o+(1-o)*d)}function Dr(l,n,o,h,d=1/0){const f=l.range;if(!f)return 0;const y=Math.min(d,Math.max(o,h)),x=Math.log(y/1024)/Math.LN2;return a.smoothstep(f[0]+x,f[1]+x,n)}const Pr=1/4e4;function ua(l,n){const o=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),h=new a.LngLat(n.lng-180*Pr,o),d=new a.LngLat(n.lng+180*Pr,o),f=l.project(h.lng,o),y=l.project(d.lng,o),x=a.MercatorCoordinate.fromLngLat(h),b=a.MercatorCoordinate.fromLngLat(d),M=y.x-f.x,E=y.y-f.y,z=b.x-x.x,P=b.y-x.y,U=Math.sqrt((z*z+P*P)/(M*M+E*E));return Math.log(U)/Math.LN2}function sl(l,n,o){const h=Math.cos(o),d=Math.sin(o);return{x:l*h-n*d,y:l*d+n*h}}class Zo{constructor(n,o,h,d,f,y,x){this.tileSize=512,this._renderWorldCopies=void 0===f||f,this._minZoom=n||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=d??60,this.setProjection(y),this.setMaxBounds(x),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ca,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ol,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new Zo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,o=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||h)&&this._updateCameraOnTerrain(),(n||h)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const h=!Se(o,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const o=n!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const o=-n*Math.PI/180;var h,d,f,y,x,b,M,E,z,P;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(h=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),d=this.rotationMatrix,y=this.angle,x=(f=this.rotationMatrix)[0],b=f[1],M=f[2],E=f[3],z=Math.sin(y),P=Math.cos(y),d[0]=x*P+M*z,d[1]=b*P+E*z,d[2]=x*-z+M*P,d[3]=b*-z+E*P)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const o=a.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=a.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const o=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let d=0,f=0;for(let y=0;y<o.length;y++){const x=new a.pointGeometry(o[y][0]*this.width,h+o[y][1]*(this.height-h)),b=n.pointCoordinate(x);if(!b)continue;const M=1/Math.hypot(b[0]-this._camera.position[0],b[1]-this._camera.position[1]);d+=b[3]*M,f+=M}return 0===f?NaN:d/f}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const n=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*o,d=this._mercatorZfromZoom(n),f=this._mercatorZfromZoom(this._maxZoom),y=Math.max(d-h,f);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let h;h=n.z<this._camera.position[2]?[o.x,o.y,o.z]:[n.x,n.y,n.z];const d=a.length(a.sub([],this._camera.position,h));return a.clamp(this._zoomFromMercatorZ(d),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let o=!1;if(n.orientation&&!a.exactEquals(n.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(n.orientation)),n.position){const h=[n.position.x,n.position.y,n.position.z];a.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,o=new rl;return o.position=new a.MercatorCoordinate(n[0],n[1],n[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(n){if(!a.length$1(n))return!1;a.normalize$1(n,n);const o=a.transformQuat([],[0,0,-1],n),h=a.transformQuat([],[0,-1,0],n);if(h[2]<0)return!1;const d=Tc(o,h);return!!d&&(this._camera.orientation=d,!0)}_setCameraPosition(n){const o=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,d=this.cameraToCenterDistance;n[2]=a.clamp(n[2],d/h,d/o),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,o,h){this._unmodified=!1,this._edgeInsets.interpolate(n,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const o=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(n){const o=[new a.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const h=this.pointCoordinate(new a.pointGeometry(0,0)),d=this.pointCoordinate(new a.pointGeometry(this.width,0)),f=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),y=this.pointCoordinate(new a.pointGeometry(0,this.height)),x=Math.floor(Math.min(h.x,d.x,f.x,y.x)),b=Math.floor(Math.max(h.x,d.x,f.x,y.x)),M=1;for(let E=x-M;E<=b+M;E++)0!==E&&o.push(new a.UnwrappedTileID(E,n))}return o}coveringTiles(n){let o=this.coveringZoomLevel(n);const h=o,d=this.elevation&&!n.isTerrainDEM,f="mercator"===this.projection.name;if(void 0!==n.minzoom&&o<n.minzoom)return[];void 0!==n.maxzoom&&o>n.maxzoom&&(o=n.maxzoom);const y=this.locationCoordinate(this.center),x=this.center.lat,b=1<<o,M=[b*y.x,b*y.y,0],E="globe"===this.projection.name,z=!E,P=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,z),U=E?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),F=b*a.mercatorZfromAltitude(1,this.center.lat),Z=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),O=[b*U.x,b*U.y,Z*(z?1:F)],R=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,N=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,H=n.isTerrainDEM?-N:this._elevation?this._elevation.getMinElevationBelowMSL():0,te=this.projection.isReprojectedInTileSpace?xs(this):1,Q=ve=>{const Re=new a.MercatorCoordinate(ve.x+25e-6,ve.y,ve.z),se=new a.MercatorCoordinate(ve.x,ve.y+25e-6,ve.z),_e=ve.toLngLat(),Xe=Re.toLngLat(),Qe=se.toLngLat(),He=this.locationCoordinate(_e),st=this.locationCoordinate(Xe),dt=this.locationCoordinate(Qe),et=Math.hypot(st.x-He.x,st.y-He.y),qe=Math.hypot(dt.x-He.x,dt.y-He.y);return Math.sqrt(et*qe)*te/25e-6},re=ve=>{const Ie=N,Re=H;return{aabb:a.tileAABB(this,b,0,0,0,ve,Re,Ie,this.projection),zoom:0,x:0,y:0,minZ:Re,maxZ:Ie,wrap:ve,fullyVisible:!1}},me=[];let de=[];const oe=o,Oe=n.reparseOverscaled?h:o,he=ve=>ve*ve,Te=he((Z-this._centerAltitude)*F),ge=ve=>{if(!this._elevation||!ve.tileID||!f)return;const Ie=this._elevation.getMinMaxForTile(ve.tileID),Re=ve.aabb;Ie?(Re.min[2]=Ie.min,Re.max[2]=Ie.max,Re.center[2]=(Re.min[2]+Re.max[2])/2):(ve.shouldSplit=De(ve),ve.shouldSplit||(Re.min[2]=Re.max[2]=Re.center[2]=this._centerAltitude))},De=ve=>{if(ve.zoom<q)return!0;if(ve.zoom===oe)return!1;if(null!=ve.shouldSplit)return ve.shouldSplit;const Ie=ve.aabb.distanceX(O),Re=ve.aabb.distanceY(O);let se=Te,_e=1;if(E){se=he(ve.aabb.distanceZ(O));const He=Math.pow(2,ve.zoom),st=a.latFromMercatorY((ve.y+1)/He),dt=a.latFromMercatorY(ve.y/He),et=Math.min(Math.max(x,st),dt),qe=a.circumferenceAtLatitude(et)/a.circumferenceAtLatitude(x);if(_e=et===x?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,qe/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&ve.zoom===oe-1&&qe>=.9)return!0}else if(d&&(se=he(ve.aabb.distanceZ(O)*F)),this.projection.isReprojectedInTileSpace&&h<=5){const He=Math.pow(2,ve.zoom),st=Q(new a.MercatorCoordinate((ve.x+.5)/He,(ve.y+.5)/He));_e=st>.85?1:st}const Xe=Ie*Ie+Re*Re+se;return Xe<he((1<<oe-ve.zoom)*R*_e*((He,st)=>{if(st*he(.707)<He)return 1;const dt=Math.sqrt(st/He);return dt/(1.4144271570014144+(Math.pow(1.1,dt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(se,Te),Xe))};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)me.push(re(-ve)),me.push(re(ve));for(me.push(re(0));me.length>0;){const ve=me.pop(),Ie=ve.x,Re=ve.y;let se=ve.fullyVisible;if(!se){const _e=ve.aabb.intersects(P);if(0===_e)continue;se=2===_e}if(ve.zoom!==oe&&De(ve))for(let _e=0;_e<4;_e++){const Xe=(Ie<<1)+_e%2,Qe=(Re<<1)+(_e>>1),He={aabb:f?ve.aabb.quadrant(_e):a.tileAABB(this,b,ve.zoom+1,Xe,Qe,ve.wrap,ve.minZ,ve.maxZ,this.projection),zoom:ve.zoom+1,x:Xe,y:Qe,wrap:ve.wrap,fullyVisible:se,tileID:void 0,shouldSplit:void 0,minZ:ve.minZ,maxZ:ve.maxZ};d&&!E&&(He.tileID=new a.OverscaledTileID(ve.zoom+1===oe?Oe:ve.zoom+1,ve.wrap,ve.zoom+1,Xe,Qe),ge(He)),me.push(He)}else{const _e=ve.zoom===oe?Oe:ve.zoom;if(n.minzoom&&n.minzoom>_e)continue;const Xe=M[0]-(.5+Ie+(ve.wrap<<ve.zoom))*(1<<o-ve.zoom),Qe=M[1]-.5-Re,He=ve.tileID?ve.tileID:new a.OverscaledTileID(_e,ve.wrap,ve.zoom,Ie,Re);de.push({tileID:He,distanceSq:Xe*Xe+Qe*Qe})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,Ie=this.horizonLineFromTop();de=de.filter(Re=>{const se=[0,0,0,1],_e=[a.EXTENT,a.EXTENT,0,1],Xe=this.calculateFogTileMatrix(Re.tileID.toUnwrapped());a.transformMat4$1(se,se,Xe),a.transformMat4$1(_e,_e,Xe);const Qe=a.getAABBPointSquareDist(se,_e);if(0===Qe)return!0;let He=!1;const st=this._elevation;if(st&&Qe>ve&&0!==Ie){const dt=this.calculateProjMatrix(Re.tileID.toUnwrapped());let et;n.isTerrainDEM||(et=st.getMinMaxForTile(Re.tileID)),et||(et={min:H,max:N});const qe=a.furthestTileCorner(this.rotation),Rt=[qe[0]*a.EXTENT,qe[1]*a.EXTENT,et.max];a.transformMat4(Rt,Rt,dt),He=(1-Rt[1])*this.height*.5<Ie}return Qe<ve||He})}return de.sort((ve,Ie)=>ve.distanceSq-Ie.distanceSq).map(ve=>ve.tileID)}resize(n,o){this.width=n,this.height=o,this.pixelsToGLUnits=[2/n,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const o=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),h=this.projection.project(n.lng,o);return new a.pointGeometry(h.x*this.worldSize,h.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,o){let h,d;const f=this.centerPoint;if("globe"===this.projection.name){const x=this.worldSize;h=(o.x-f.x)/x,d=(o.y-f.y)/x}else{const x=this.pointCoordinate(o),b=this.pointCoordinate(f);h=x.x-b.x,d=x.y-b.y}const y=this.locationCoordinate(n);this.setLocation(new a.MercatorCoordinate(y.x-h,y.y-d))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,o){const h=o?a.mercatorZfromAltitude(o,n.lat):void 0,d=this.projection.project(n.lng,n.lat);return new a.MercatorCoordinate(d.x,d.y,h)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,o){const h=o??this._centerAltitude,d=[n.x,n.y,0,1],f=[n.x,n.y,1,1];a.transformMat4$1(d,d,this.pixelMatrixInverse),a.transformMat4$1(f,f,this.pixelMatrixInverse);const y=f[3];a.scale$1(d,d,1/d[3]),a.scale$1(f,f,1/y);const x=d[2],b=f[2];return{p0:d,p1:f,t:x===b?0:(h-x)/(b-x)}}screenPointToMercatorRay(n){const o=[n.x,n.y,0,1],h=[n.x,n.y,1,1];return a.transformMat4$1(o,o,this.pixelMatrixInverse),a.transformMat4$1(h,h,this.pixelMatrixInverse),a.scale$1(o,o,1/o[3]),a.scale$1(h,h,1/h[3]),o[2]=a.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,h[2]=a.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,a.scale$1(o,o,1/this.worldSize),a.scale$1(h,h,1/this.worldSize),new a.Ray([o[0],o[1],o[2]],a.normalize([],a.sub([],h,o)))}rayIntersectionCoordinate(n){const{p0:o,p1:h,t:d}=n,f=a.mercatorZfromAltitude(o[2],this._center.lat),y=a.mercatorZfromAltitude(h[2],this._center.lat);return new a.MercatorCoordinate(a.number(o[0],h[0],d)/this.worldSize,a.number(o[1],h[1],d)/this.worldSize,a.number(f,y,d))}pointCoordinate(n,o=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,o)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let o=this.projection.pointCoordinate3D(this,n.x,n.y);if(o)return new a.MercatorCoordinate(o[0],o[1],o[2]);let h=0,d=this.horizonLineFromTop();if(n.y>d)return this.pointCoordinate(n);const f=.02*d,y=n.clone();for(let x=0;x<10&&d-h>f;x++){y.y=a.number(h,d,.66);const b=this.projection.pointCoordinate3D(this,y.x,y.y);b?(d=y.y,o=b):h=y.y}return o?new a.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,o){const h=o&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,d=[n.x*this.worldSize,n.y*this.worldSize,h+n.toAltitude(),1];return a.transformMat4$1(d,d,this.pixelMatrix),d[3]>0?new a.pointGeometry(d[0]/d[3],d[1]/d[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:n,left:o}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,f=this.pointCoordinate3D(new a.pointGeometry(o,n)),y=this.pointCoordinate3D(new a.pointGeometry(d,n)),x=this.pointCoordinate3D(new a.pointGeometry(d,h)),b=this.pointCoordinate3D(new a.pointGeometry(o,h));let M=Math.min(f.x,b.x),E=Math.max(y.x,x.x),z=Math.min(f.y,y.y),P=Math.max(b.y,x.y);const U=Math.pow(2,-this.zoom)/16,F=(Q,re,me,de)=>{const oe=(Q+me)/2,Oe=(re+de)/2,he=new a.pointGeometry(oe,Oe),Te=this.pointCoordinate3D(he),ge=Math.max(0,M-Te.x,z-Te.y,Te.x-E,Te.y-P);M=Math.min(M,Te.x),E=Math.max(E,Te.x),z=Math.min(z,Te.y),P=Math.max(P,Te.y),ge>U&&(F(Q,re,oe,Oe),F(oe,Oe,me,de))};F(o,n,d,n),F(d,n,d,h),F(d,h,o,h),F(o,h,o,n);const[Z,O]=a.polesInViewport(this),R=Z||O,q=Z?90:a.latFromMercatorY(z),N=R?180:a.lngFromMercatorX(E),H=O?-90:a.latFromMercatorY(P),te=R?-180:a.lngFromMercatorX(M);return new a.LngLatBounds(new a.LngLat(te,H),new a.LngLat(N,q))}_getBounds(n,o){if("globe"===this.projection.name)return this._getGlobeBounds();const h=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),d=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),f=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),y=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let x=this.pointCoordinate(h,n),b=this.pointCoordinate(d,n);const M=this.pointCoordinate(f,o),E=this.pointCoordinate(y,o),z=(P,U)=>(U.y-P.y)/(U.x-P.x);return x.y>1&&b.y>=0?x=new a.MercatorCoordinate((1-E.y)/z(E,x)+E.x,1):x.y<0&&b.y<=1&&(x=new a.MercatorCoordinate(-E.y/z(E,x)+E.x,0)),b.y>1&&x.y>=0?b=new a.MercatorCoordinate((1-M.y)/z(M,b)+M.x,1):b.y<0&&x.y<=1&&(b=new a.MercatorCoordinate(-M.y/z(M,b)+M.x,0)),(new a.LngLatBounds).extend(this.coordinateLocation(x)).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(M))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBounds(0,0);const o=n.visibleDemTiles.reduce((h,d)=>{if(d.dem){const f=d.dem.tree;h.min=Math.min(h.min,f.minimums[0]),h.max=Math.max(h.max,f.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBounds(o.min*n.exaggeration(),o.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-o*(1-this._horizonShift);return n?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,o){return this.projection.createTileMatrix(this,o,n)}calculateDistanceTileData(n){const o=n.key,h=this._distanceTileDataCache;if(h[o])return h[o];const d=n.canonical,f=1/this.height,y=this.cameraWorldSize,x=y/this.zoomScale(d.z),b=(d.x+Math.pow(2,d.z)*n.wrap)*x,M=d.y*x,E=this.point;E.x*=y/this.worldSize,E.y*=y/this.worldSize;const z=this.angle,P=Math.sin(-z),U=-Math.cos(-z);return h[o]={bearing:[P,U],center:[(E.x-b)*f,(E.y-M)*f],scale:x/a.EXTENT*f},h[o]}calculateFogTileMatrix(n){const o=n.key,h=this._fogTileMatrixCache;if(h[o])return h[o];const d=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return a.multiply(d,this.worldToFogMatrix,d),h[o]=new Float32Array(d),h[o]}calculateProjMatrix(n,o=!1){const h=n.key,d=o?this._alignedProjMatrixCache:this._projMatrixCache;if(d[h])return d[h];const f=this.calculatePosMatrix(n,this.worldSize);return a.multiply(f,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,f),d[h]=new Float32Array(f),d[h]}calculatePixelsToTileUnitsMatrix(n){const o=n.tileID.key,h=this._pixelsToTileUnitsCache;if(h[o])return h[o];const d=function(f,y){const{scale:x}=f.tileTransform,b=x*a.EXTENT/(f.tileSize*Math.pow(2,y.zoom-f.tileID.overscaledZ+f.tileID.canonical.z));return M=new Float32Array(4),P=(E=y.inverseAdjustmentMatrix)[1],U=E[2],F=E[3],O=(z=[b,b])[1],M[0]=E[0]*(Z=z[0]),M[1]=P*Z,M[2]=U*O,M[3]=F*O,M;var M,E,z,P,U,F,Z,O}(n,this);return h[o]=d,h[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const n=this._elevation;this._updateCameraState();const o=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(o),d=this._camera.forward(),f=a.mercatorZfromAltitude(1,this._center.lat);h[2]/=f,d[2]/=f,a.normalize(d,d);const y=n.raycast(h,d,n.exaggeration());if(y){const x=a.scaleAndAdd([],h,d,y),b=new a.MercatorCoordinate(x[0],x[1],a.mercatorZfromAltitude(x[2],a.latFromMercatorY(x[1]))),M=(b.z+a.length([b.x-h[0],b.y-h[1],b.z-h[2]*f]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=b.toAltitude(),this._center=this.coordinateLocation(b),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const o=this._elevation,h=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(h),f=o.getAtPointOrZero(new a.MercatorCoordinate(...d)),y=this.pixelsPerMeter/this.worldSize*f,x=this._minimumHeightOverTerrain(),b=d[2]-y;if(b<=x)if(b<0||n){const M=this.locationCoordinate(this._center,this._centerAltitude),E=[d[0],d[1],M.z-d[2]],z=a.length(E);E[2]-=(x-b)/this._pixelsPerMercatorPixel;const P=a.length(E);if(0===P)return;a.scale$2(E,E,z/P*this._pixelsPerMercatorPixel),this._camera.position=[d[0],d[1],M.z*this._pixelsPerMercatorPixel-E[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const P=this.center;return P.lat=a.clamp(P.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(P.lng=a.clamp(P.lng,this.minLng,this.maxLng)),this.center=P,void(this._constraining=!1)}const o=this._unmodified,{x:h,y:d}=this.point;let f=0,y=h,x=d;const b=this.width/2,M=this.height/2,E=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(d-M<E&&(x=E+M),d+M>z&&(x=z-M),z-E<this.height&&(f=Math.max(f,this.height/(z-E)),x=(z+E)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const P=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,F=this.worldSize/2-(P+U)/2;y=(h+F+this.worldSize)%this.worldSize-F,y-b<P&&(y=P+b),y+b>U&&(y=U-b),U-P<this.width&&(f=Math.max(f,this.width/(U-P)),y=(U+P)/2)}y===h&&x===d||(this.center=this.unproject(new a.pointGeometry(y,x))),f&&(this.zoom+=this.scaleZoom(f)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,o=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const h=Dr(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,h),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const d=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?o:1),f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);f[8]=2*-n.x/this.width,f[9]=2*n.y/this.height;let y=a.mul([],f,d);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),Q=a.identity([]);a.translate(Q,Q,[te.x*this.worldSize,te.y*this.worldSize,0]),a.multiply(Q,Q,ha(this)),a.translate(Q,Q,[-te.x*this.worldSize,-te.y*this.worldSize,0]),a.multiply(y,y,Q),this.inverseAdjustmentMatrix=function(re){const me=ha(re,!0);return vt([],[me[0],me[1],me[4],me[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],y,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=y,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const x=a.invert([],f);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(x,this.horizonLineFromTop(),this.height);const b=new Float32Array(16);a.identity(b),a.scale(b,b,[1,-1,1]),a.rotateX(b,b,this._pitch),a.rotateZ(b,b,this.angle);const M=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),E=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;M[8]=2*-n.x/this.width,M[9]=2*(n.y+E)/this.height,this.skyboxMatrix=a.multiply(b,M,b);const z=this.point,P=z.x,U=z.y,F=this.width%2/2,Z=this.height%2/2,O=Math.cos(this.angle),R=Math.sin(this.angle),q=P-Math.round(P)+O*F+R*Z,N=U-Math.round(U)+O*Z+R*F,H=new Float64Array(y);if(a.translate(H,H,[q>.5?q-1:q,N>.5?N-1:N,0]),this.alignedProjMatrix=H,y=a.create(),a.scale(y,y,[this.width/2,-this.height/2,1]),a.translate(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=a.create(),a.scale(y,y,[1,-1,1]),a.translate(y,y,[-1,-1,0]),a.scale(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},y=a.invert(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=y,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(te,te,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=y;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,h=this._camera.position,d=1/this.height/this._pixelsPerMercatorPixel,f=[n,n,o];a.scale$2(f,f,d),a.scale$2(h,h,-1),a.multiply$2(h,h,f);const y=a.create();a.translate(y,y,h),a.scale(y,y,f),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,o,d)}_computeCameraPosition(n){const o=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),d=this.point,f=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-n/this.worldSize*this._centerAltitude;return[d.x/this.worldSize-h[0]*f,d.y/this.worldSize-h[1]*f,n/this.worldSize*this._centerAltitude-h[2]*f]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],d=n[2];let f=1;this.projection.wrap&&(this.center=this.center.wrap()),d>0&&(f=Math.min((o-h)/d,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,n,f),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,o=this._camera.forward(),{pitch:h,bearing:d}=this._camera.getPitchBearing(),f=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),x=Math.max((n[2]-f)/Math.cos(h),y),b=this._zoomFromMercatorZ(x);a.scaleAndAdd(n,n,o,x),this._pitch=a.clamp(h,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(d,-Math.PI,Math.PI),this._setZoom(a.clamp(b,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){const o=y=>{const x=this.getCameraToCenterDistance(this.projection,y);return this.scaleZoom(x/(n*this.tileSize))};let h,d=o(this.zoom),f=Math.abs(d-o(d));for(;h!==f;)d=o(d),h=f,f=Math.abs(d-o(d));return d}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,o){const h=Math.min(n.x,o.x),d=Math.max(n.x,o.x),f=Math.min(n.y,o.y),y=Math.max(n.y,o.y);if(f<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const x=[new a.pointGeometry(h,f),new a.pointGeometry(d,y),new a.pointGeometry(h,y),new a.pointGeometry(d,f)],b=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(const E of x){const z=this.pointRayIntersection(E);if(z.t<0)return!0;const P=this.rayIntersectionCoordinate(z);if(P.x<b||P.y<0||P.x>M||P.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,o){const h=a.length(a.sub([],this._camera.position,n)),d=this._zoomFromMercatorZ(h)+o;return h-this._mercatorZfromZoom(d)}getCameraPoint(){if("globe"===this.projection.name){const n=function([o,h,d],f){const y=[o,h,d,1];a.transformMat4$1(y,y,f);const x=y[3]=Math.max(y[3],1e-6);return y[0]/=x,y[1]/=x,y[2]/=x,y}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,n))}}getCameraToCenterDistance(n,o=this.zoom){const h=Dr(n,o,this.width,this.height,1024),d=n.pixelSpaceConversion(this.center.lat,this.worldSize,h);return.5/Math.tan(.5*this._fov)*this.height*d}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&a.multiply(n,n,this.globeMatrix),n}}function vs(l,n){let o=!1,h=null;const d=()=>{h=null,o&&(l(),h=setTimeout(d,n),o=!1)};return()=>(o=!0,h||d(),h)}class Ge{constructor(n){this._hashName=n&&encodeURIComponent(n),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=vs(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,a.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const o=fn(n);if(this._hashName){const h=this._hashName;let d=!1;const f=a.window.location.hash.slice(1).split("&").map(y=>{const x=y.split("=")[0];return x===h?(d=!0,`${x}=${o}`):y}).filter(y=>y);return d||f.push(`${h}=${o}`),`#${f.join("&")}`}return`#${o}`}_getCurrentHash(){const n=a.window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(o=h)}),(o&&o[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(o[3]||0):n.getBearing();return n.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,n)}}function fn(l,n){const o=l.getCenter(),h=Math.round(100*l.getZoom())/100,d=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,d),y=Math.round(o.lng*f)/f,x=Math.round(o.lat*f)/f,b=l.getBearing(),M=l.getPitch();let E=n?`/${y}/${x}/${h}`:`${h}/${x}/${y}`;return(b||M)&&(E+="/"+Math.round(10*b)/10),M&&(E+=`/${Math.round(M)}`),E}const bs={linearity:.3,easing:a.bezier(0,0,.3,1)},Ec=a.extend({deceleration:2500,maxSpeed:1400},bs),Mc=a.extend({deceleration:20,maxSpeed:1400},bs),No=a.extend({deceleration:1e3,maxSpeed:360},bs),Cc=a.extend({deceleration:1e3,maxSpeed:90},bs);class da{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,o=a.exported.now();for(;n.length>0&&o-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)o.zoom+=f.zoomDelta||0,o.bearing+=f.bearingDelta||0,o.pitch+=f.pitchDelta||0,f.panDelta&&o.pan._add(f.panDelta),f.around&&(o.around=f.around),f.pinchAround&&(o.pinchAround=f.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){const f=_o(o.pan.mag(),h,a.extend({},Ec,n||{}));d.offset=o.pan.mult(f.amount/o.pan.mag()),d.center=this._map.transform.center,Vo(d,f)}if(o.zoom){const f=_o(o.zoom,h,Mc);d.zoom=this._map.transform.zoom+f.amount,Vo(d,f)}if(o.bearing){const f=_o(o.bearing,h,No);d.bearing=this._map.transform.bearing+a.clamp(f.amount,-179,179),Vo(d,f)}if(o.pitch){const f=_o(o.pitch,h,Cc);d.pitch=this._map.transform.pitch+f.amount,Vo(d,f)}if(d.zoom||d.bearing){const f=void 0===o.pinchAround?o.around:o.pinchAround;d.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),d.noMoveStart=!0,d}}function Vo(l,n){(!l.duration||l.duration<n.duration)&&(l.duration=n.duration,l.easing=n.easing)}function _o(l,n,o){const{maxSpeed:h,linearity:d,deceleration:f}=o,y=a.clamp(l*d/(n/1e3),-h,h),x=Math.abs(y)/(f*d);return{easing:o.easing,duration:1e3*x,amount:y*(x/2)}}class Wi extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,h,d={}){const f=Be(o.getCanvasContainer(),h),y=o.unproject(f);super(n,a.extend({point:f,lngLat:y,originalEvent:h},d)),this._defaultPrevented=!1,this.target=o}}class ws extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,h){const d="touchend"===n?h.changedTouches:h.touches,f=Fi(o.getCanvasContainer(),d),y=f.map(b=>o.unproject(b)),x=f.reduce((b,M,E,z)=>b.add(M.div(z.length)),new a.pointGeometry(0,0));super(n,{points:f,point:x,lngLats:y,lngLat:o.unproject(x),originalEvent:h}),this._defaultPrevented=!1}}class jo extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,h){super(n,{originalEvent:h}),this._defaultPrevented=!1}}class Vh{constructor(n,o){this._map=n,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new jo(n.type,this._map,n))}mousedown(n,o){return this._mousedownPos=o,this._firePreventable(new Wi(n.type,this._map,n))}mouseup(n){this._map.fire(new Wi(n.type,this._map,n))}preclick(n){const o=a.extend({},n);o.type="preclick",this._map.fire(new Wi(o.type,this._map,o))}click(n,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Wi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Wi(n.type,this._map,n))}mouseover(n){this._map.fire(new Wi(n.type,this._map,n))}mouseout(n){this._map.fire(new Wi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new ws(n.type,this._map,n))}touchmove(n){this._map.fire(new ws(n.type,this._map,n))}touchend(n){this._map.fire(new ws(n.type,this._map,n))}touchcancel(n){this._map.fire(new ws(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jh{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Wi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Wi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ic{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,o){this.isEnabled()&&n.shiftKey&&0===n.button&&(qr(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(n,o){if(!this._active)return;const h=o,d=this._startPos,f=this._lastPos;if(!d||!f||f.equals(h)||!this._box&&h.dist(d)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=ut("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const y=Math.min(d.x,h.x),x=Math.max(d.x,h.x),b=Math.min(d.y,h.y),M=Math.max(d.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${b}px)`,this._box.style.width=x-y+"px",this._box.style.height=M-b+"px")})}mouseupWindow(n,o){if(!this._active)return;const h=this._startPos,d=o;if(h&&0===n.button){if(this.reset(),yr(),h.x!==d.x||h.y!==d.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:f=>f.fitScreenCoordinates(h,d,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),cn(),delete this._startPos,delete this._lastPos}_fireEvent(n,o){return this._map.fire(new a.Event(n,{originalEvent:o}))}}function Go(l,n){const o={};for(let h=0;h<l.length;h++)o[l[h].identifier]=n[h];return o}class al{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=n.timeStamp),h.length===this.numTouches&&(this.centroid=function(d){const f=new a.pointGeometry(0,0);for(const y of d)f._add(y);return f.div(d.length)}(o),this.touches=Go(h,o)))}touchmove(n,o,h){if(this.aborted||!this.centroid)return;const d=Go(h,o);for(const f in this.touches){const x=d[f];(!x||x.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(n,o,h){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===h.length){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class pa{constructor(n){this.singleTap=new al(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,o,h){this.singleTap.touchstart(n,o,h)}touchmove(n,o,h){this.singleTap.touchmove(n,o,h)}touchend(n,o,h){const d=this.singleTap.touchend(n,o,h);if(d){const f=n.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(d)<30;if(f&&y||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Ac{constructor(){this._zoomIn=new pa({numTouches:1,numTaps:2}),this._zoomOut=new pa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,o,h){this._zoomIn.touchstart(n,o,h),this._zoomOut.touchstart(n,o,h)}touchmove(n,o,h){this._zoomIn.touchmove(n,o,h),this._zoomOut.touchmove(n,o,h)}touchend(n,o,h){const d=this._zoomIn.touchend(n,o,h),f=this._zoomOut.touchend(n,o,h);return d?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(d)},{originalEvent:n})}):f?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(f)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fa={0:1,2:2};class Ts{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,o){return!1}_move(n,o){return{}}mousedown(n,o){if(this._lastPoint)return;const h=wn(n);this._correctButton(n,h)&&(this._lastPoint=o,this._eventButton=h)}mousemoveWindow(n,o){const h=this._lastPoint;if(h)if(n.preventDefault(),null!=this._eventButton&&function(d,f){const y=fa[f];return void 0===d.buttons||(d.buttons&y)!==y}(n,this._eventButton))this.reset();else if(this._moved||!(o.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(h,o)}mouseupWindow(n){this._lastPoint&&wn(n)===this._eventButton&&(this._moved&&yr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sc extends Ts{mousedown(n,o){super.mousedown(n,o),this._lastPoint&&(this._active=!0)}_correctButton(n,o){return 0===o&&!n.ctrlKey}_move(n,o){return{around:o,panDelta:o.sub(n)}}}class ll extends Ts{_correctButton(n,o){return 0===o&&n.ctrlKey||2===o}_move(n,o){const h=.8*(o.x-n.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(n){n.preventDefault()}}class cl extends Ts{_correctButton(n,o){return 0===o&&n.ctrlKey||2===o}_move(n,o){const h=-.5*(o.y-n.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(n){n.preventDefault()}}class zc{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(n,o,h){return this._calculateTransform(n,o,h)}touchmove(n,o,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===h.length&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,o,h)}}touchend(n,o,h){this._calculateTransform(n,o,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,o,h){h.length>0&&(this._active=!0);const d=Go(h,o),f=new a.pointGeometry(0,0),y=new a.pointGeometry(0,0);let x=0;for(const M in d){const E=d[M],z=this._touches[M];z&&(f._add(E),y._add(E.sub(z)),x++,d[M]=E)}if(this._touches=d,x<this._minTouches||!y.mag())return;const b=y.div(x);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(x),panDelta:b}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ut("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ma{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,o,h){return{}}touchstart(n,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(n,o,h){const d=this._firstTwoTouches;if(!d)return;n.preventDefault();const[f,y]=d,x=cr(h,o,f),b=cr(h,o,y);if(!x||!b)return;const M=this._aroundCenter?null:x.add(b).div(2);return this._move([x,b],M,n)}touchend(n,o,h){if(!this._firstTwoTouches)return;const[d,f]=this._firstTwoTouches,y=cr(h,o,d),x=cr(h,o,f);y&&x||(this._active&&yr(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function cr(l,n,o){for(let h=0;h<l.length;h++)if(l[h].identifier===o)return n[h]}function hl(l,n){return Math.log(l/n)/Math.LN2}class kc extends ma{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,o){const h=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(hl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hl(this._distance,h),pinchAround:o}}}function Dc(l,n){return 180*l.angleWith(n)/Math.PI}class Pc extends ma{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,o){const h=this._vector;if(this._vector=n[0].sub(n[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Dc(this._vector,h),pinchAround:o}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const o=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const d=Dc(n,h);return Math.abs(d)<o}}function _a(l){return Math.abs(l.y)>Math.abs(l.x)}class Lc extends ma{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,_a(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,o,h){const d=this._lastPoints;if(!d)return;const f=n[0].sub(d[0]),y=n[1].sub(d[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(f,y,h.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(f.y+y.y)/2*-.5})}gestureBeginsVertically(n,o,h){if(void 0!==this._valid)return this._valid;const d=n.mag()>=2,f=o.mag()>=2;if(!d&&!f)return;if(!d||!f)return null==this._firstMove&&(this._firstMove=h),h-this._firstMove<100&&void 0;const y=n.y>0==o.y>0;return _a(n)&&_a(o)&&y}}const Oc={panStep:100,bearingStep:15,pitchStep:10};class Pi{constructor(){const n=Oc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let o=0,h=0,d=0,f=0,y=0;switch(n.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),f=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),f=1);break;case 38:n.shiftKey?d=1:(n.preventDefault(),y=-1);break;case 40:n.shiftKey?d=-1:(n.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(h=0,d=0),{cameraAnimation:x=>{const b=x.getZoom();x.easeTo({duration:300,easeId:"keyboardHandler",easing:Gh,zoom:o?Math.round(b)+o*(n.shiftKey?2:1):b,bearing:x.getBearing()+h*this._bearingStep,pitch:x.getPitch()+d*this._pitchStep,offset:[-f*this._panStep,-y*this._panStep],center:x.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gh(l){return l*(2-l)}const ul=4.000244140625;class qh{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=n.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const h=a.exported.now(),d=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,0!==o&&o%ul==0?this._type="wheel":0!==o&&Math.abs(o)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(d*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),n.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=n,this._delta-=o,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Be(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;"wheel"===this._type&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const b="wheel"===this._type&&Math.abs(this._delta)>ul?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&0!==M&&(M=1/M);const E=o(),z=Math.pow(2,E),P="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(P*M))),"wheel"===this._type&&(this._startZoom=E,this._easing=this._smoothOutEasing(200)),this._delta=0}const h="number"==typeof this._targetZoom?this._targetZoom:o(),d=this._startZoom,f=this._easing;let y,x=!1;if("wheel"===this._type&&d&&f){const b=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),M=f(b);y=a.number(d,h,M),b<1?this._frameId||(this._frameId=!0):x=!0}else y=h,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:y-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let o=a.ease;if(this._prevEase){const h=this._prevEase,d=(a.exported.now()-h.start)/h.duration,f=h.easing(d+.01)-h.easing(d),y=.27/Math.sqrt(f*f+1e-4)*.01,x=Math.sqrt(.0729-y*y);o=a.bezier(y,x,.25,1)}return this._prevEase={start:a.exported.now(),duration:n,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ut("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class $h{constructor(n,o){this._clickZoom=n,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,o){return n.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(n.shiftKey?-1:1),around:h.unproject(o)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rc{constructor(){this._tap=new pa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,o,h){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=o[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(n,o,h))}touchmove(n,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const d=o[0],f=d.y-this._swipePoint.y;return this._swipePoint=d,n.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(n,o,h)}touchend(n,o,h){this._tapTime?this._swipePoint&&0===h.length&&this.reset():this._tap.touchend(n,o,h)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qo{constructor(n,o,h){this._el=n,this._mousePan=o,this._touchPan=h}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qn{constructor(n,o,h){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ga{constructor(n,o,h,d){this._el=n,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $e=l=>l.zoom||l.drag||l.pitch||l.rotate;class Bc extends a.Event{}class Fc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,o){const h=a.sub([],o,n);this.radius=a.length(h[2]<0?a.div([],h,this.constants):[h[0],h[1],0])}projectRay(n){a.div(n,n,this.constants),a.normalize(n,n),a.mul$1(n,n,this.constants);const o=a.scale$2([],n,this.radius);if(o[2]>0){const h=a.scale$2([],[0,0,1],a.dot(o,[0,0,1])),d=a.scale$2([],a.normalize([],[o[0],o[1],0]),this.radius),f=a.add([],o,a.scale$2([],a.sub([],a.add([],d,h),o),2));o[0]=f[0],o[1]=f[1]}return o}}function Lr(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Es{constructor(n,o){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new da(n),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Fc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),a.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[d,f,y]of this._listeners)d.addEventListener(f,d===a.window.document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[n,o,h]of this._listeners)n.removeEventListener(o,n===a.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(n){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new Vh(o,n));const d=o.boxZoom=new Ic(o,n);this._add("boxZoom",d);const f=new Ac,y=new hr;o.doubleClickZoom=new $h(y,f),this._add("tapZoom",f),this._add("clickZoom",y);const x=new Rc;this._add("tapDragZoom",x);const b=o.touchPitch=new Lc(o);this._add("touchPitch",b);const M=new ll(n),E=new cl(n);o.dragRotate=new qn(n,M,E),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",E,["mouseRotate"]);const z=new Sc(n),P=new zc(o,n);o.dragPan=new qo(h,z,P),this._add("mousePan",z),this._add("touchPan",P,["touchZoom","touchRotate"]);const U=new Pc,F=new kc;o.touchZoomRotate=new ga(h,F,U,x),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",F,["touchPan","touchRotate"]),this._add("blockableMapEvent",new jh(o));const Z=o.scrollZoom=new qh(o,this);this._add("scrollZoom",Z,["mousePan"]);const O=o.keyboard=new Pi;this._add("keyboard",O);for(const R of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[R]&&o[R].enable(n[R])}_add(n,o,h){this._handlers.push({handlerName:n,handler:o,allowed:h}),this._handlersById[n]=o}stop(n){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$e(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,o,h){for(const d in n)if(d!==h&&(!o||o.indexOf(d)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const o=[];for(const h of n)this._el.contains(h.target)&&o.push(h);return o}handleEvent(n,o){this._updatingCamera=!0;const h="renderFrame"===n.type,d=h?void 0:n,f={needsRenderFrame:!1},y={},x={},b=n.touches?this._getMapTouches(n.touches):void 0,M=b?Fi(this._el,b):h?void 0:Be(this._el,n);for(const{handlerName:P,handler:U,allowed:F}of this._handlers){if(!U.isEnabled())continue;let Z;this._blockedByActive(x,F,P)?U.reset():U[o||n.type]&&(Z=U[o||n.type](n,M,b),this.mergeHandlerResult(f,y,Z,P,d),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||U.isActive())&&(x[P]=U)}const E={};for(const P in this._previousActiveHandlers)x[P]||(E[P]=d);this._previousActiveHandlers=x,(Object.keys(E).length||Lr(f))&&(this._changes.push([f,y,E]),this._triggerRenderFrame()),(Object.keys(x).length||Lr(f))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=f;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(n,o,h,d,f){if(!h)return;a.extend(n,h);const y={handlerName:d,originalEvent:h.originalEvent||f};void 0!==h.zoomDelta&&(o.zoom=y),void 0!==h.panDelta&&(o.drag=y),void 0!==h.pitchDelta&&(o.pitch=y),void 0!==h.bearingDelta&&(o.rotate=y)}_applyChanges(){const n={},o={},h={};for(const[d,f,y]of this._changes)d.panDelta&&(n.panDelta=(n.panDelta||new a.pointGeometry(0,0))._add(d.panDelta)),d.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+d.pitchDelta),void 0!==d.around&&(n.around=d.around),void 0!==d.aroundCoord&&(n.aroundCoord=d.aroundCoord),void 0!==d.pinchAround&&(n.pinchAround=d.pinchAround),d.noInertia&&(n.noInertia=d.noInertia),a.extend(o,f),a.extend(h,y);this._updateMapTransform(n,o,h),this._changes=[]}_updateMapTransform(n,o,h){const d=this._map,f=d.transform,y=q=>[q.x,q.y,q.z];if((q=>{const N=this._eventsInProgress.drag;return N&&!this._handlersById[N.handlerName].isActive()})()&&!Lr(n)){const q=f.zoom;f.cameraElevationReference="sea",f.recenterOnTerrain(),f.cameraElevationReference="ground",q!==f.zoom&&this._map._update(!0)}if(f._isCameraConstrained&&d._stop(!0),!Lr(n))return void this._fireEvents(o,h,!0);let{panDelta:x,zoomDelta:b,bearingDelta:M,pitchDelta:E,around:z,aroundCoord:P,pinchAround:U}=n;f._isCameraConstrained&&(b>0&&(b=0),f._isCameraConstrained=!1),void 0!==U&&(z=U),(q=>o.drag&&!this._eventsInProgress.drag)()&&z&&(this._dragOrigin=y(f.pointCoordinate3D(z)),this._trackingEllipsoid.setup(f._camera.position,this._dragOrigin)),f.cameraElevationReference="sea",d._stop(!0),z=z||d.transform.centerPoint,M&&(f.bearing+=M),E&&(f.pitch+=E),f._updateCameraState();const F=[0,0,0];if(x)if("mercator"===f.projection.name){const q=this._trackingEllipsoid.projectRay(f.screenPointToMercatorRay(z).dir),N=this._trackingEllipsoid.projectRay(f.screenPointToMercatorRay(z.sub(x)).dir);F[0]=N[0]-q[0],F[1]=N[1]-q[1]}else{const q=f.pointCoordinate(z);if("globe"===f.projection.name){x=x.rotate(-f.angle);const N=f._pixelsPerMercatorPixel/f.worldSize;F[0]=-x.x*a.mercatorScale(a.latFromMercatorY(q.y))*N,F[1]=-x.y*a.mercatorScale(f.center.lat)*N}else{const N=f.pointCoordinate(z.sub(x));q&&N&&(F[0]=N.x-q.x,F[1]=N.y-q.y)}}const Z=f.zoom,O=[0,0,0];if(b){const q=y(P||f.pointCoordinate3D(z)),N={dir:a.normalize([],a.sub([],q,f._camera.position))};if(N.dir[2]<0){const H=f.zoomDeltaToMovement(q,b);a.scale$2(O,N.dir,H)}}const R=a.add(F,F,O);f._translateCameraConstrained(R),b&&Math.abs(f.zoom-Z)>1e-4&&f.recenterOnTerrain(),f.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(o,h,!0)}_fireEvents(n,o,h){const d=$e(this._eventsInProgress),f=$e(n),y={};for(const E in n){const{originalEvent:z}=n[E];this._eventsInProgress[E]||(y[`${E}start`]=z),this._eventsInProgress[E]=n[E]}!d&&f&&this._fireEvent("movestart",f.originalEvent);for(const E in y)this._fireEvent(E,y[E]);f&&this._fireEvent("move",f.originalEvent);for(const E in n){const{originalEvent:z}=n[E];this._fireEvent(E,z)}const x={};let b;for(const E in this._eventsInProgress){const{handlerName:z,originalEvent:P}=this._eventsInProgress[E];this._handlersById[z].isActive()||(delete this._eventsInProgress[E],b=o[z]||P,x[`${E}end`]=b)}for(const E in x)this._fireEvent(E,x[E]);const M=$e(this._eventsInProgress);if(h&&(d||f)&&!M){this._updatingCamera=!0;const E=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=P=>0!==P&&-this._bearingSnap<P&&P<this._bearingSnap;E?(z(E.bearing||this._map.getBearing())&&(E.bearing=0),this._map.easeTo(E,{originalEvent:b})):(this._map.fire(new a.Event("moveend",{originalEvent:b})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,o){this._map.fire(new a.Event(n,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Bc("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const dl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Uc extends a.Evented{constructor(n,o){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=o.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,o){return this.jumpTo({center:n},o)}panBy(n,o,h){return n=a.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,a.extend({offset:n},o),h)}panTo(n,o,h){return this.easeTo(a.extend({center:n},o),h)}getZoom(){return this.transform.zoom}setZoom(n,o){return this.jumpTo({zoom:n},o),this}zoomTo(n,o,h){return this.easeTo(a.extend({zoom:n},o),h)}zoomIn(n,o){return this.zoomTo(this.getZoom()+1,n,o),this}zoomOut(n,o){return this.zoomTo(this.getZoom()-1,n,o),this}getBearing(){return this.transform.bearing}setBearing(n,o){return this.jumpTo({bearing:n},o),this}getPadding(){return this.transform.padding}setPadding(n,o){return this.jumpTo({padding:n},o),this}rotateTo(n,o,h){return this.easeTo(a.extend({bearing:n},o),h)}resetNorth(n,o){return this.rotateTo(0,a.extend({duration:1e3},n),o),this}resetNorthPitch(n,o){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},n),o),this}snapToNorth(n,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,o):this}getPitch(){return this.transform.pitch}setPitch(n,o){return this.jumpTo({pitch:n},o),this}cameraForBounds(n,o){n=a.LngLatBounds.convert(n);const h=o&&o.bearing||0,d=o&&o.pitch||0,f=n.getNorthWest(),y=n.getSouthEast();return this._cameraForBounds(this.transform,f,y,h,d,o)}_extendCameraOptions(n){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=a.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const h=n.padding;n.padding={top:h,bottom:h,right:h,left:h}}return n.padding=a.extend(o,n.padding),n}_minimumAABBFrustumDistance(n,o){const h=o.max[0]-o.min[0],d=o.max[1]-o.min[1];return h/d>n.aspect?h/(2*Math.tan(.5*n.fovX)*n.aspect):d/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,o,h,d,f,y){const x=n.clone(),b=this._extendCameraOptions(y);x.bearing=d,x.pitch=f;const M=a.LngLat.convert(o),E=a.LngLat.convert(h),z=.5*(M.lat+E.lat),P=.5*(M.lng+E.lng),U=a.latLngToECEF(z,P),F=a.normalize([],U),Z=a.normalize([],a.cross([],F,[0,1,0])),O=a.cross([],Z,F),R=[Z[0],Z[1],Z[2],0,O[0],O[1],O[2],0,F[0],F[1],F[2],0,0,0,0,1],q=[U,a.latLngToECEF(M.lat,M.lng),a.latLngToECEF(E.lat,M.lng),a.latLngToECEF(E.lat,E.lng),a.latLngToECEF(M.lat,E.lng),a.latLngToECEF(z,M.lng),a.latLngToECEF(z,E.lng),a.latLngToECEF(M.lat,P),a.latLngToECEF(E.lat,P)];let N=a.Aabb.fromPoints(q.map(se=>[a.dot(Z,se),a.dot(O,se),a.dot(F,se)]));const H=a.transformMat4([],N.center,R);0===a.squaredLength(H)&&a.set(H,0,0,1),a.normalize(H,H),a.scale$2(H,H,a.GLOBE_RADIUS),x.center=a.ecefToLatLng(H);const te=x.getWorldToCameraMatrix(),Q=a.invert(new Float64Array(16),te);N=a.Aabb.applyTransform(N,a.multiply([],te,R)),a.transformMat4(H,H,te);const re=.5*(N.max[2]-N.min[2]),me=this._minimumAABBFrustumDistance(x,N),de=a.scale$2([],[0,0,1],re),oe=a.add(de,H,de),Oe=me+(0===x.pitch?0:a.distance(H,oe)),he=x.globeCenterInViewSpace,Te=a.sub([],H,[he[0],he[1],he[2]]);a.normalize(Te,Te),a.scale$2(Te,Te,Oe);const ge=a.add([],H,Te);a.transformMat4(ge,ge,Q);const De=a.earthRadius/a.GLOBE_RADIUS,ve=a.length(ge),Ie=a.mercatorZfromAltitude(ve*De-a.earthRadius,0),Re=Math.min(x.zoomFromMercatorZAdjusted(Ie),b.maxZoom);return Re>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(x.setProjection({name:"mercator"}),x.zoom=Re,this._cameraForBounds(x,o,h,d,f,y)):{center:x.center,zoom:Re,bearing:d,pitch:f}}queryTerrainElevation(n,o){const h=this.transform.elevation;return h?(o=a.extend({},{exaggerated:!0},o),h.getAtPoint(a.MercatorCoordinate.fromLngLat(n),null,o.exaggerated)):null}_cameraForBounds(n,o,h,d,f,y){if("globe"===n.projection.name)return this._cameraForBoundsOnGlobe(n,o,h,d,f,y);const x=n.clone(),b=this._extendCameraOptions(y),M=x.padding;x.bearing=d,x.pitch=f;const E=a.LngLat.convert(o),z=a.LngLat.convert(h),P=new a.LngLat(E.lng,z.lat),U=new a.LngLat(z.lng,E.lat),F=x.project(E),Z=x.project(z),O=this.queryTerrainElevation(E),R=this.queryTerrainElevation(z),q=this.queryTerrainElevation(P),N=this.queryTerrainElevation(U),H=[[F.x,F.y,Math.min(O||0,R||0,q||0,N||0)],[Z.x,Z.y,Math.max(O||0,R||0,q||0,N||0)]];let te=a.Aabb.fromPoints(H);const Q=x.getWorldToCameraMatrix(),re=a.invert(new Float64Array(16),Q);te=a.Aabb.applyTransform(te,Q);const me=a.sub([],te.max,te.min),de=M.left||0,oe=M.right||0,Oe=M.bottom||0,he=M.top||0,{left:Te,right:ge,top:De,bottom:ve}=b.padding,Ie=.5*(de+oe),Re=.5*(he+Oe),se=Math.min(x.scaleZoom(x.scale*Math.min((x.width-(de+oe+Te+ge))/me[0],(x.height-(Oe+he+ve+De))/me[1])),b.maxZoom),_e=x.scale/x.zoomScale(se);te=new a.Aabb([te.min[0]-(Te+Ie)*_e,te.min[1]-(ve+Re)*_e,te.min[2]],[te.max[0]+(ge+Ie)*_e,te.max[1]+(De+Re)*_e,te.max[2]]);const Xe=.5*me[2],Qe=this._minimumAABBFrustumDistance(x,te),He=[0,0,1,0];a.transformMat4$1(He,He,Q),a.normalize$2(He,He);const st=a.scale$2([],He,Qe+Xe),dt=a.add([],te.center,st),et=("number"==typeof b.offset.x&&"number"==typeof b.offset.y?new a.pointGeometry(b.offset.x,b.offset.y):a.pointGeometry.convert(b.offset)).rotate(-a.degToRad(d));te.center[0]-=et.x*_e,te.center[1]+=et.y*_e,a.transformMat4(te.center,te.center,re),a.transformMat4(dt,dt,re);const qe=[te.center[0],te.center[1],dt[2]*x.pixelsPerMeter];a.scale$2(qe,qe,1/x.worldSize);const Rt=a.lngFromMercatorX(qe[0]),kt=a.latFromMercatorY(qe[1]),Gt=Math.min(x._zoomFromMercatorZ(qe[2]),b.maxZoom),Zt=new a.LngLat(Rt,kt);return x.mercatorFromTransition&&Gt<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(x.setProjection({name:"globe"}),x.zoom=Gt,this._cameraForBounds(x,o,h,d,f,y)):{center:Zt,zoom:Gt,bearing:d,pitch:f}}fitBounds(n,o,h){const d=this.cameraForBounds(n,o);return this._fitInternal(d,o,h)}fitScreenCoordinates(n,o,h,d,f){const y=a.pointGeometry.convert(n),x=a.pointGeometry.convert(o),b=new a.pointGeometry(Math.min(y.x,x.x),Math.min(y.y,x.y)),M=new a.pointGeometry(Math.max(y.x,x.x),Math.max(y.y,x.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(y,x))return this;const E=this.transform.pointLocation3D(b),z=this.transform.pointLocation3D(M),P=this.transform.pointLocation3D(new a.pointGeometry(b.x,M.y)),U=this.transform.pointLocation3D(new a.pointGeometry(M.x,b.y)),F=[Math.min(E.lng,z.lng,P.lng,U.lng),Math.min(E.lat,z.lat,P.lat,U.lat)],Z=[Math.max(E.lng,z.lng,P.lng,U.lng),Math.max(E.lat,z.lat,P.lat,U.lat)],O=d&&d.pitch?d.pitch:this.getPitch(),R=this._cameraForBounds(this.transform,F,Z,h,O,d);return this._fitInternal(R,d,f)}_fitInternal(n,o,h){return n?(delete(o=a.extend(n,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(n,o){this.stop();const h=n.preloadOnly?this.transform.clone():this.transform;let d=!1,f=!1,y=!1;return"zoom"in n&&h.zoom!==+n.zoom&&(d=!0,h.zoom=+n.zoom),void 0!==n.center&&(h.center=a.LngLat.convert(n.center)),"bearing"in n&&h.bearing!==+n.bearing&&(f=!0,h.bearing=+n.bearing),"pitch"in n&&h.pitch!==+n.pitch&&(y=!0,h.pitch=+n.pitch),null==n.padding||h.isPaddingEqual(n.padding)||(h.padding=n.padding),n.preloadOnly?(this._preloadTiles(h),this):(this.fire(new a.Event("movestart",o)).fire(new a.Event("move",o)),d&&this.fire(new a.Event("zoomstart",o)).fire(new a.Event("zoom",o)).fire(new a.Event("zoomend",o)),f&&this.fire(new a.Event("rotatestart",o)).fire(new a.Event("rotate",o)).fire(new a.Event("rotateend",o)),y&&this.fire(new a.Event("pitchstart",o)).fire(new a.Event("pitch",o)).fire(new a.Event("pitchend",o)),this.fire(new a.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(dl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,o){const h=this.transform;if(!h.projection.supportsFreeCamera)return a.warnOnce(dl),this;this.stop();const d=h.zoom,f=h.pitch,y=h.bearing;h.setFreeCameraOptions(n);const x=d!==h.zoom,b=f!==h.pitch,M=y!==h.bearing;return this.fire(new a.Event("movestart",o)).fire(new a.Event("move",o)),x&&this.fire(new a.Event("zoomstart",o)).fire(new a.Event("zoom",o)).fire(new a.Event("zoomend",o)),M&&this.fire(new a.Event("rotatestart",o)).fire(new a.Event("rotate",o)).fire(new a.Event("rotateend",o)),b&&this.fire(new a.Event("pitchstart",o)).fire(new a.Event("pitch",o)).fire(new a.Event("pitchend",o)),this.fire(new a.Event("moveend",o)),this}easeTo(n,o){this._stop(!1,n.easeId),(!1===(n=a.extend({offset:[0,0],duration:500,easing:a.ease},n)).animate||!n.essential&&a.exported.prefersReducedMotion)&&(n.duration=0);const h=this.transform,d=this.getZoom(),f=this.getBearing(),y=this.getPitch(),x=this.getPadding(),b="zoom"in n?+n.zoom:d,M="bearing"in n?this._normalizeBearing(n.bearing,f):f,E="pitch"in n?+n.pitch:y,z="padding"in n?n.padding:h.padding,P=a.pointGeometry.convert(n.offset);let U,F,Z;if("globe"===h.projection.name){const de=a.MercatorCoordinate.fromLngLat(h.center),oe=P.rotate(-h.angle);de.x+=oe.x/h.worldSize,de.y+=oe.y/h.worldSize;const Oe=de.toLngLat(),he=a.LngLat.convert(n.center||Oe);this._normalizeCenter(he),U=h.centerPoint.add(oe),F=new a.pointGeometry(de.x,de.y).mult(h.worldSize),Z=new a.pointGeometry(a.mercatorXfromLng(he.lng),a.mercatorYfromLat(he.lat)).mult(h.worldSize).sub(F)}else{U=h.centerPoint.add(P);const de=h.pointLocation(U),oe=a.LngLat.convert(n.center||de);this._normalizeCenter(oe),F=h.project(de),Z=h.project(oe).sub(F)}const O=h.zoomScale(b-d);let R,q;n.around&&(R=a.LngLat.convert(n.around),q=h.locationPoint(R));const N=this._zooming||b!==d,H=this._rotating||f!==M,te=this._pitching||E!==y,Q=!h.isPaddingEqual(z),re=de=>oe=>{if(N&&(de.zoom=a.number(d,b,oe)),H&&(de.bearing=a.number(f,M,oe)),te&&(de.pitch=a.number(y,E,oe)),Q&&(de.interpolatePadding(x,z,oe),U=de.centerPoint.add(P)),R)de.setLocationAtPoint(R,q);else{const Oe=de.zoomScale(de.zoom-d),he=b>d?Math.min(2,O):Math.max(.5,O),Te=Math.pow(he,1-oe),ge=de.unproject(F.add(Z.mult(oe*Te)).mult(Oe));de.setLocationAtPoint(de.renderWorldCopies?ge.wrap():ge,U)}return n.preloadOnly||this._fireMoveEvents(o),de};if(n.preloadOnly){const de=this._emulate(re,n.duration,h);return this._preloadTiles(de),this}const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=N,this._rotating=H,this._pitching=te,this._padding=Q,this._easeId=n.easeId,this._prepareEase(o,n.noMoveStart,me),this._ease(re(h),de=>{h.recenterOnTerrain(),this._afterEase(o,de)},n),this}_prepareEase(n,o,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||h.moving||this.fire(new a.Event("movestart",n)),this._zooming&&!h.zooming&&this.fire(new a.Event("zoomstart",n)),this._rotating&&!h.rotating&&this.fire(new a.Event("rotatestart",n)),this._pitching&&!h.pitching&&this.fire(new a.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new a.Event("move",n)),this._zooming&&this.fire(new a.Event("zoom",n)),this._rotating&&this.fire(new a.Event("rotate",n)),this._pitching&&this.fire(new a.Event("pitch",n))}_afterEase(n,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,d=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new a.Event("zoomend",n)),d&&this.fire(new a.Event("rotateend",n)),f&&this.fire(new a.Event("pitchend",n)),this.fire(new a.Event("moveend",n))}flyTo(n,o){if(!n.essential&&a.exported.prefersReducedMotion){const se=a.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(se,o)}this.stop(),n=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},n);const h=this.transform,d=this.getZoom(),f=this.getBearing(),y=this.getPitch(),x=this.getPadding(),b="zoom"in n?a.clamp(+n.zoom,h.minZoom,h.maxZoom):d,M="bearing"in n?this._normalizeBearing(n.bearing,f):f,E="pitch"in n?+n.pitch:y,z="padding"in n?n.padding:h.padding,P=h.zoomScale(b-d),U=a.pointGeometry.convert(n.offset);let F=h.centerPoint.add(U);const Z=h.pointLocation(F),O=a.LngLat.convert(n.center||Z);this._normalizeCenter(O);const R=h.project(Z),q=h.project(O).sub(R);let N=n.curve;const H=Math.max(h.width,h.height),te=H/P,Q=q.mag();if("minZoom"in n){const se=a.clamp(Math.min(n.minZoom,d,b),h.minZoom,h.maxZoom),_e=H/h.zoomScale(se-d);N=Math.sqrt(_e/Q*2)}const re=N*N;function me(se){const _e=(te*te-H*H+(se?-1:1)*re*re*Q*Q)/(2*(se?te:H)*re*Q);return Math.log(Math.sqrt(_e*_e+1)-_e)}function de(se){return(Math.exp(se)-Math.exp(-se))/2}function oe(se){return(Math.exp(se)+Math.exp(-se))/2}const Oe=me(0);let he=function(se){return oe(Oe)/oe(Oe+N*se)},Te=function(se){return H*((oe(Oe)*(de(_e=Oe+N*se)/oe(_e))-de(Oe))/re)/Q;var _e},ge=(me(1)-Oe)/N;if(Math.abs(Q)<1e-6||!isFinite(ge)){if(Math.abs(H-te)<1e-6)return this.easeTo(n,o);const se=te<H?-1:1;ge=Math.abs(Math.log(te/H))/N,Te=function(){return 0},he=function(_e){return Math.exp(se*N*_e)}}n.duration="duration"in n?+n.duration:1e3*ge/("screenSpeed"in n?+n.screenSpeed/N:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const De=f!==M,ve=E!==y,Ie=!h.isPaddingEqual(z),Re=se=>_e=>{const Xe=_e*ge,Qe=1/he(Xe);se.zoom=1===_e?b:d+se.scaleZoom(Qe),De&&(se.bearing=a.number(f,M,_e)),ve&&(se.pitch=a.number(y,E,_e)),Ie&&(se.interpolatePadding(x,z,_e),F=se.centerPoint.add(U));const He=1===_e?O:se.unproject(R.add(q.mult(Te(Xe))).mult(Qe));return se.setLocationAtPoint(se.renderWorldCopies?He.wrap():He,F),se._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(o),se};if(n.preloadOnly){const se=this._emulate(Re,n.duration,h);return this._preloadTiles(se),this}return this._zooming=!0,this._rotating=De,this._pitching=ve,this._padding=Ie,this._prepareEase(o,!1),this._ease(Re(h),()=>this._afterEase(o),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,o)}if(!n){const h=this.handlers;h&&h.stop(!1)}return this}_ease(n,o,h){!1===h.animate||0===h.duration?(n(1),o()):(this._easeStart=a.exported.now(),this._easeOptions=h,this._onEaseFrame=n,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,o){n=a.wrap(n,-180,180);const h=Math.abs(n-o);return Math.abs(n-360-o)<h&&(n-=360),Math.abs(n+360-o)<h&&(n+=360),n}_normalizeCenter(n){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const h=n.lng-o.center.lng;n.lng+=h>180?-360:h<-180?360:0}_emulate(n,o,h){const d=Math.ceil(15*o/1e3),f=[],y=n(h.clone());for(let x=0;x<=d;x++){const b=y(x/d);f.push(b.clone())}return f}}class pl{constructor(n={}){this.options=n,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const o=this.options&&this.options.compact;return this._map=n,this._container=ut("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ut("button","mapboxgl-ctrl-attrib-button",this._container),ut("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ut("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===o&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,o){const h=this._map._getUIString(`AttributionControl.${o}`);n.setAttribute("aria-label",h),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(n){const h=o.reduce((d,f,y)=>(f.value&&(d+=`${f.key}=${f.value}${y<o.length-1?"&":""}`),d),"?");n.href=`${a.config.FEEDBACK_URL}/${h}#${fn(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const o=this._map.style._sourceCaches;for(const d in o){const f=o[d];if(f.used){const y=f.getSource();y.attribution&&n.indexOf(y.attribution)<0&&n.push(y.attribution)}}n.sort((d,f)=>d.length-f.length),n=n.filter((d,f)=>{for(let y=f+1;y<n.length;y++)if(n[y].indexOf(d)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const h=n.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,n.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class fl{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=ut("div","mapboxgl-ctrl");const o=ut("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const o in n){const h=n[o].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class ml{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const o=++this._id;return this._queue.push({callback:n,id:o,cancelled:!1}),o}remove(n){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const d of h)if(d.id===n)return void(d.cancelled=!0)}run(n=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function _l(l,n,o){if(l=new a.LngLat(l.lng,l.lat),n){const h=new a.LngLat(l.lng-360,l.lat),d=new a.LngLat(l.lng+360,l.lat),f=360*Math.ceil(Math.abs(l.lng-o.center.lng)/360),y=o.locationPoint(l).distSqr(n),x=n.x<0||n.y<0||n.x>o.width||n.y>o.height;o.locationPoint(h).distSqr(n)<y&&(x||Math.abs(h.lng-o.center.lng)<f)?l=h:o.locationPoint(d).distSqr(n)<y&&(x||Math.abs(d.lng-o.center.lng)<f)&&(l=d)}for(;Math.abs(l.lng-o.center.lng)>180;){const h=o.locationPoint(l);if(h.x>=0&&h.y>=0&&h.x<=o.width&&h.y<=o.height)break;l.lng>o.center.lng?l.lng-=360:l.lng+=360}return l}const $o={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ms extends a.Evented{constructor(n,o){if(super(),(n instanceof a.window.HTMLElement||o)&&(n=a.extend({element:n},o)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=a.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=ut("div");const d=41,f=27,y=xi("svg",{display:"block",height:d*this._scale+"px",width:f*this._scale+"px",viewBox:`0 0 ${f} ${d}`},this._element),x=xi("radialGradient",{id:"shadowGradient"},xi("defs",{},y));xi("stop",{offset:"10%","stop-opacity":.4},x),xi("stop",{offset:"100%","stop-opacity":.05},x),xi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},y),xi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},y),xi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},y),xi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},y),this._offset=a.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()});const h=this._element.classList;for(const d in $o)h.remove(`mapboxgl-marker-anchor-${d}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const o=n.code,h=n.charCode||n.keyCode;"Space"!==o&&"Enter"!==o&&32!==h&&13!==h||this.togglePopup()}_onMapClick(n){const o=n.originalEvent.target,h=this._element;this._popup&&(o===h||h.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,o=this._pos;if(!n||!o)return!1;const h=n.unproject(o),d=n.getFreeCameraOptions();if(!d.position)return!1;const f=d.position.toLngLat();return f.distanceTo(h)<.9*f.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const o=this._pos;if(!o||o.x<0||o.x>n.transform.width||o.y<0||o.y>n.transform.height)return void this._clearFadeTimer();const h=n.unproject(o);let d;n._showingGlobe()&&a.isLngLatBehindGlobe(n.transform,this._lngLat)?d=0:(d=1-n._queryFogOpacity(h),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(d*=this._occludedOpacity)),this._element.style.opacity=`${d}`,this._element.style.pointerEvents=d>0?"auto":"none",this._popup&&this._popup._setOpacity(d),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${n.x}px,${n.y}px)\n            ${$o[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${o.x}px,${o.y}px)\n        `}_calculateXYTransform(){const n=this._pos,o=this._map,h=this.getPitchAlignment();if(!o||!n||"map"!==h)return"";if(!o._showingGlobe()){const b=o.getPitch();return b?`rotateX(${b}deg)`:""}const d=a.radToDeg(a.globeTiltAtLngLat(o.transform,this._lngLat)),f=n.sub(a.globeCenterToScreenPoint(o.transform)),y=Math.abs(f.x)+Math.abs(f.y);if(0===y)return"";const x=d/y;return`rotateX(${-f.y*x}deg) rotateY(${f.x*x}deg)`}_calculateZTransform(){const n=this._pos,o=this._map;if(!o||!n)return"";let h=0;const d=this.getRotationAlignment();if("map"===d)if(o._showingGlobe()){const f=o.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),y=o.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(f);h=a.radToDeg(Math.atan2(y.y,y.x))-90}else h=-o.getBearing();else if("horizon"===d){const f=a.smoothstep(4,6,o.getZoom()),y=a.globeCenterToScreenPoint(o.transform);y.y+=f*o.transform.height;const x=n.sub(y),b=a.radToDeg(Math.atan2(x.y,x.x));h=(b>90?b-270:b+90)*(1-f)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(n){a.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=_l(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),!0===n?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=a.pointGeometry.convert(n),this._update(),this}_onMove(n){const o=this._map;if(!o)return;const h=this._pointerdownPos,d=this._positionDelta;if(h&&d){if(!this._isDragging){const f=this._clickTolerance||o._clickTolerance;if(n.point.dist(h)<f)return;this._isDragging=!0}this._pos=n.point.sub(d),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(n){const o=this._map,h=this._pos;o&&h&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(h),this._pointerdownPos=n.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const o=this._map;return o&&(n?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ya={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gl(l=new a.pointGeometry(0,0),n="bottom"){if("number"==typeof l){const o=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(n){case"top":return new a.pointGeometry(0,l);case"top-left":return new a.pointGeometry(o,o);case"top-right":return new a.pointGeometry(-o,o);case"bottom":return new a.pointGeometry(0,-l);case"bottom-left":return new a.pointGeometry(o,-o);case"bottom-right":return new a.pointGeometry(-o,-o);case"left":return new a.pointGeometry(l,0);case"right":return new a.pointGeometry(-l,0)}return new a.pointGeometry(0,0)}return l instanceof a.pointGeometry||Array.isArray(l)?a.pointGeometry.convert(l):a.pointGeometry.convert(l[n]||[0,0])}class Nc{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const o=a.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,o,h){this._start=this.getValue(o),this._end=n,this._startTime=o,this._endTime=o+h}}const Vc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},jc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Gc={showCompass:!0,showZoom:!0,visualizePitch:!1};class qc{constructor(n,o,h=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new ll({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,h&&(this.mousePitch=new cl({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(n,o){this.mouseRotate.mousedown(n,o),this.mousePitch&&this.mousePitch.mousedown(n,o),qr()}move(n,o){const h=this.map,d=this.mouseRotate.mousemoveWindow(n,o),f=d&&d.bearingDelta;if(f&&h.setBearing(h.getBearing()+f),this.mousePitch){const y=this.mousePitch.mousemoveWindow(n,o),x=y&&y.pitchDelta;x&&h.setPitch(h.getPitch()+x)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){cn(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(a.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Be(this.element,n)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Be(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=Fi(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=Fi(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const yl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},$c={maxWidth:100,unit:"metric"};function Wc(l,n,o){const h=xl(n),d=h/n,f={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[o];this._map._requestDomTask(()=>{this._container.style.width=l*d+"px",this._container.innerHTML=`${h}&nbsp;${f}`})}function xl(l){const n=Math.pow(10,`${Math.floor(l)}`.length-1);let o=l/n;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(h){const d=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*d)/d}(o),n*o}const Cs={version:a.version,supported:vn,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Uc{constructor(l){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),null!=(l=a.extend({},jc,l)).minZoom&&null!=l.maxZoom&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=l.minPitch&&null!=l.maxPitch&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=l.minPitch&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=l.maxPitch&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(l.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Zo(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new ml,this._domRenderTaskQueue=new ml,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Vc,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Nc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,"string"==typeof l.container){if(this._container=a.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==a.window&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Es(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this._hash=l.hash&&new Ge("string"==typeof l.hash&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,a.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),l.attributionControl&&this.addControl(new pl({customAttribution:l.customAttribution})),this._logoControl=new fl,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new a.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(l,n){if(void 0===n&&(n=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=l.onAdd(this);this._controls.push(l);const h=this._controlPositions[n];return-1!==n.indexOf("bottom")?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(l);return n>-1&&this._controls.splice(n,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),this.fire(new a.Event("resize",l)),n&&this.fire(new a.Event("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(a.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return"auto"===l?a.window.navigator.language:Array.isArray(l)?0===l.length?void 0:l.map(n=>"auto"===n?a.window.navigator.language:n):l}setLanguage(l){const n=this._parseLanguage(l);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(l){return this._lazyInitEmptyStyle(),l?"string"==typeof l&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const l=this.transform,n=l.projection.name;let o;"globe"===n&&l.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(l.setMercatorFromTransition(),o=!0):"mercator"===n&&l.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(l.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,n){return this._updateProjection(l||n||{name:"mercator"})}_updateProjection(l){let n;if(n="globe"===l.name&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const o in this.style._sourceCaches)this.style._sourceCaches[o].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(l){return this.transform.locationPoint3D(a.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(a.pointGeometry.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,n,o){if("mouseenter"===l||"mouseover"===l){let h=!1;const d=y=>{const x=n.filter(M=>this.getLayer(M)),b=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];b.length?h||(h=!0,o.call(this,new Wi(l,this,y.originalEvent,{features:b}))):h=!1},f=()=>{h=!1};return{layers:new Set(n),listener:o,delegates:{mousemove:d,mouseout:f}}}if("mouseleave"===l||"mouseout"===l){let h=!1;const d=y=>{const x=n.filter(b=>this.getLayer(b));(x.length?this.queryRenderedFeatures(y.point,{layers:x}):[]).length?h=!0:h&&(h=!1,o.call(this,new Wi(l,this,y.originalEvent)))},f=y=>{h&&(h=!1,o.call(this,new Wi(l,this,y.originalEvent)))};return{layers:new Set(n),listener:o,delegates:{mousemove:d,mouseout:f}}}{const h=d=>{const f=n.filter(x=>this.getLayer(x)),y=f.length?this.queryRenderedFeatures(d.point,{layers:f}):[];y.length&&(d.features=y,o.call(this,d),delete d.features)};return{layers:new Set(n),listener:o,delegates:{[l]:h}}}}on(l,n,o){if(void 0===o)return super.on(l,n);Array.isArray(n)||(n=[n]);const h=this._createDelegatedListener(l,n,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(h);for(const d in h.delegates)this.on(d,h.delegates[d]);return this}once(l,n,o){if(void 0===o)return super.once(l,n);Array.isArray(n)||(n=[n]);const h=this._createDelegatedListener(l,n,o);for(const d in h.delegates)this.once(d,h.delegates[d]);return this}off(l,n,o){if(void 0===o)return super.off(l,n);n=new Set(Array.isArray(n)?n:[n]);const h=(f,y)=>{if(f.size!==y.size)return!1;for(const x of f)if(!y.has(x))return!1;return!0},d=this._delegatedListeners?this._delegatedListeners[l]:void 0;return d&&(f=>{for(let y=0;y<f.length;y++){const x=f[y];if(x.listener===o&&h(x.layers,n)){for(const b in x.delegates)this.off(b,x.delegates[b]);return f.splice(y,1),this}}})(d),this}queryRenderedFeatures(l,n){return this.style?(void 0!==n||void 0===l||l instanceof a.pointGeometry||Array.isArray(l)||(n=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(l,n){return this.style.querySourceFeatures(l,n)}setStyle(l,n){return!1!==(n=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(l,n))}_getUIString(l){const n=this._locale[l];if(null==n)throw new Error(`Missing UI string '${l}'`);return n}_updateStyle(l,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l&&(this.style=new Ci(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof l?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ci(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,n){if("string"==typeof l){const o=this._requestManager.normalizeStyleURL(l),h=this._requestManager.transformRequest(o,a.ResourceType.Style);a.getJSON(h,(d,f)=>{d?this.fire(new a.ErrorEvent(d)):f&&this._updateDiff(f,n)})}else"object"==typeof l&&this._updateDiff(l,n)}_updateDiff(l,n){try{this.style.setState(l)&&this._update(!0)}catch(o){a.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(l,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(l,n){return this._lazyInitEmptyStyle(),this.style.addSource(l,n),this._update(!0)}isSourceLoaded(l){return!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){const l=this.style&&this.style._sourceCaches;for(const n in l){const o=l[n]._tiles;for(const h in o){const d=o[h];if("loaded"!==d.state&&"errored"!==d.state)return!1}}return!0}addSourceType(l,n,o){this._lazyInitEmptyStyle(),this.style.addSourceType(l,n,o)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,n,{pixelRatio:o=1,sdf:h=!1,stretchX:d,stretchY:f,content:y}={}){if(this._lazyInitEmptyStyle(),n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap){const{width:x,height:b,data:M}=a.exported.getImageData(n);this.style.addImage(l,{data:new a.RGBAImage({width:x,height:b},M),pixelRatio:o,stretchX:d,stretchY:f,content:y,sdf:h,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:x,height:b}=n,M=n;this.style.addImage(l,{data:new a.RGBAImage({width:x,height:b},new Uint8Array(M.data)),pixelRatio:o,stretchX:d,stretchY:f,content:y,sdf:h,version:0,userImage:M}),M.onAdd&&M.onAdd(this,l)}}updateImage(l,n){const o=this.style.getImage(l);if(!o)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap?a.exported.getImageData(n):n,{width:d,height:f}=h;void 0!==d&&void 0!==f?d===o.data.width&&f===o.data.height?(o.data.replace(h.data,!(n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap)),this.style.updateImage(l,o)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${d}, ${f})\n                must be that same as the previous version of the image\n                (${o.data.width}, ${o.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,n){a.getImage(this._requestManager.transformRequest(l,a.ResourceType.Image),(o,h)=>{n(o,h instanceof a.window.HTMLImageElement?a.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(l,n){return this._lazyInitEmptyStyle(),this.style.addLayer(l,n),this._update(!0)}moveLayer(l,n){return this.style.moveLayer(l,n),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,n,o){return this.style.setLayerZoomRange(l,n,o),this._update(!0)}setFilter(l,n,o={}){return this.style.setFilter(l,n,o),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,n,o,h={}){return this.style.setPaintProperty(l,n,o,h),this._update(!0)}getPaintProperty(l,n){return this.style.getPaintProperty(l,n)}setLayoutProperty(l,n,o,h={}){return this.style.setLayoutProperty(l,n,o,h),this._update(!0)}getLayoutProperty(l,n){return this.style.getLayoutProperty(l,n)}setLight(l,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(l),this.transform):0}setFeatureState(l,n){return this.style.setFeatureState(l,n),this._update()}removeFeatureState(l,n){return this.style.removeFeatureState(l,n),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let o,h,d,f=this._container;for(;f&&(!h||!d);){const y=a.window.getComputedStyle(f).transform;y&&"none"!==y&&(o=y.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&"0"!==o[0]&&"1"!==o[0]&&(h=o[0]),o[3]&&"0"!==o[3]&&"1"!==o[3]&&(d=o[3])),f=f.parentElement}this._containerWidth=h?Math.abs(l/h):l,this._containerHeight=d?Math.abs(n/d):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=ut("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=ut("div","mapboxgl-canvas-container",l);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=ut("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=ut("div","mapboxgl-control-container",l),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{h[d]=ut("div",`mapboxgl-ctrl-${d}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,n){const o=a.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(l),this._canvas.height=o*Math.ceil(n),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${n}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const n=this._markers.indexOf(l);-1!==n&&this._markers.splice(n,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const n=this._popups.indexOf(l);-1!==n&&this._popups.splice(n,1)}_setupPainter(){const l=a.extend({},vn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);n?(a.storeAuthState(n,!0),this.painter=new Nh(n,this.transform),this.on("data",o=>{"source"===o.dataType&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(n)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let n;const o=this.painter.context.extTimerQuery,h=a.exported.now();if(this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const d=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,b=this.transform.pitch,M=a.exported.now(),E=new a.EvaluationParameters(x,{now:M,fadeDuration:d,pitch:b,transition:this.style.getTransition()});this.style.update(E)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let f=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),f=this._updateAverageElevation(h),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):f=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,d,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:d,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const x=a.exported.now()-h;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout(()=>{const b=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),this.fire(new a.Event("gpu-timing-frame",{cpuTime:x,gpuTime:b})),a.window.performance.mark("frame-gpu",{startTime:h,detail:{gpuTime:b}})},50)}if(this.listens("gpu-timing-layer")){const x=this.painter.collectGpuTimers();setTimeout(()=>{const b=this.painter.queryGpuTimers(x);this.fire(new a.Event("gpu-timing-layer",{layerTimes:b}))},50)}if(this.listens("gpu-timing-deferred-render")){const x=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const b=this.painter.queryGpuTimeDeferredRender(x);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:b}))},50)}const y=this._sourcesDirty||this._styleDirty||this._placementDirty||f;if(y||this._repaint)this.triggerRepaint();else{const x=!this.isMoving()&&this.loaded();if(x&&(f=this._updateAverageElevation(h,!0)),f)this.triggerRepaint();else if(this._triggerFrame(!1),x&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const b=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:b})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const n of this._markers)l&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!l||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(l,n=!1){const o=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&o(0);if((n||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const h=this.transform.averageElevation;let d=this.transform.sampleAverageElevation(),f=!1;this.transform.elevation&&(f=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(d)?d=0:this._averageElevationLastSampledAt=l;const y=Math.abs(h-d);if(y>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(d),o(d);this._averageElevation.easeTo(d,l,300)}else if(y>1e-4)return this._averageElevation.jumpTo(d),o(d)}return!!this._averageElevation.isEasing(l)&&o(this._averageElevation.getValue(l))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===a.AUTH_ERR_MSG||401===l.status)){const n=this.painter.context.gl;a.storeAuthState(n,!1),this._logoControl instanceof fl&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const o=this.painter.context.gl,h=o.createFramebuffer();function d(f){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,f,0);const y=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,y),y}return o.bindFramebuffer(o.FRAMEBUFFER,h),this._canvasPixelComparison(d(l),n.canvasCopies.map(d),n.timeStamps)}_canvasPixelComparison(l,n,o){let h=o[1]-o[0];const d=l.length/4;for(let f=0;f<n.length;f++){const y=n[f];let x=0;for(let b=0;b<y.length;b+=4)y[b]===l[b]&&y[b+1]===l[b+1]&&y[b+2]===l[b+2]&&y[b+3]===l[b+3]&&(x+=1);h+=(o[f+2]-o[f+1])*(1-x/d)}return h}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==a.window&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=a.exported.frame(n=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(n)}))}_preloadTiles(l){const n=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(n,(o,h)=>o._preloadTiles(l,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){"hidden"===a.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,l&&this._update())}_setCacheLimits(l,n){a.setCacheLimits(l,n)}get version(){return a.version}},NavigationControl:class{constructor(l){this.options=a.extend({},Gc,l),this._container=ut("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),ut("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),ut("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:n}):o.resetNorth({},{originalEvent:n}))}),this._compassIcon=ut("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const n=l.getZoom(),o=n===l.getMaxZoom(),h=n===l.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new qc(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,n){const o=ut("button",l,this._container);return o.type="button",o.addEventListener("click",n),o}_setButtonTitle(l,n){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${n}`);l.setAttribute("aria-label",o),l.firstElementChild&&l.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends a.Evented{constructor(l){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},yl,l),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=vs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=ut("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const n=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,l(o)};void 0!==this._supportsGeolocation?l(this._supportsGeolocation):void 0!==a.window.navigator.permissions?a.window.navigator.permissions.query({name:"geolocation"}).then(o=>n("denied"!==o.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(l){const n=this._map.getMaxBounds(),o=l.coords;return!!n&&(o.longitude<n.getWest()||o.longitude>n.getEast()||o.latitude<n.getSouth()||o.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(l),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",l)),this._finish()}}_updateCamera(l){const n=new a.LngLat(l.coords.longitude,l.coords.latitude),o=l.coords.accuracy,h=this._map.getBearing(),d=a.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(o),d,{geolocateSource:!0})}_updateMarker(l){if(l){const n=new a.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,n=a.mercatorZfromAltitude(1,l._center.lat)*l.worldSize,o=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(1===l.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===l.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=ut("button","mapboxgl-ctrl-geolocate",this._container),ut("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===l){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ut("div","mapboxgl-user-location"),this._dotElement.appendChild(ut("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ut("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ms({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ut("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ms({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:!0===l.absolute&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==a.window.DeviceMotionEvent&&"function"==typeof a.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:pl,ScaleControl:class{constructor(l){this.options=a.extend({},$c,l),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Wc.bind(this)),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,n=this._map,o=n._containerHeight/2,h=n._containerWidth/2-l/2,d=n.unproject([h,o]),f=n.unproject([h+l,o]),y=d.distanceTo(f);if("imperial"===this.options.unit){const x=3.2808*y;x>5280?this._setScale(l,x/5280,"mile"):this._setScale(l,x,"foot")}else"nautical"===this.options.unit?this._setScale(l,y/1852,"nautical-mile"):y>=1e3?this._setScale(l,y/1e3,"kilometer"):this._setScale(l,y,"meter")}_setScale(l,n,o){const h=xl(n),d=h/n;this._map._requestDomTask(()=>{this._container.style.width=l*d+"px",this._container.innerHTML="nautical-mile"!==o?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:o}).format(h):`${h}&nbsp;nm`})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=ut("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof a.window.HTMLElement?this._container=l.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=ut("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=ut("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ut("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(l){super(),this.options=a.extend(Object.create(ya),l),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=a.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(a.window.document.createTextNode(l))}setHTML(l){const n=a.window.document.createDocumentFragment(),o=a.window.document.createElement("body");let h;for(o.innerHTML=l;h=o.firstChild,h;)n.appendChild(h);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=ut("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(l),this.options.closeButton){const o=this._closeButton=ut("button","mapboxgl-popup-close-button",n);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let n;return this._classList.delete(l)?n=!1:(this._classList.add(l),n=!0),this._updateClassList(),n}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const n=this._map,o=this._container,h=this._pos;if(!n||!o||!h)return"bottom";const d=o.offsetWidth,f=o.offsetHeight,y=h.x<d/2,x=h.x>n.transform.width-d/2;if(h.y+l<f)return y?"top-left":x?"top-right":"top";if(h.y>n.transform.height-f){if(y)return"bottom-left";if(x)return"bottom-right"}return y?"left":x?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),l.className=n.join(" ")}_update(l){const n=this._map,o=this._content;if(!n||!this._lngLat&&!this._trackPointer||!o)return;let h=this._container;if(h||(h=this._container=ut("div","mapboxgl-popup",n.getContainer()),this._tip=ut("div","mapboxgl-popup-tip",h),h.appendChild(o)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_l(this._lngLat,this._pos,n.transform)),!this._trackPointer||l){const d=this._pos=this._trackPointer&&l?l:n.project(this._lngLat),f=gl(this.options.offset),y=this._anchor=this._getAnchor(f.y),x=gl(this.options.offset,y),b=d.add(x).round();n._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${$o[y]} translate(${b.x}px,${b.y}px)`)})}if(!this._marker&&n._showingGlobe()){const d=a.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(d)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(Zc);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:Ms,Style:Ci,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:rl,Evented:a.Evented,config:a.config,prewarm:function(){ot().acquire(tt)},clearPrewarmedResources:function(){const l=Je;l&&(l.isPreloaded()&&1===l.numActive()?(l.release(tt),Je=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(l){a.config.ACCESS_TOKEN=l},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(l){a.config.API_URL=l},get workerCount(){return Ke.workerCount},set workerCount(l){Ke.workerCount=l},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){a.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){a.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return Cs}),ai}()}}]);